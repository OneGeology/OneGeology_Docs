

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Providing Data / Services &mdash; OneGeology Documentation 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/OneGeology_favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using the OneGeology Portal" href="portal.html" />
    <link rel="prev" title="Welcome to OneGeology documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> OneGeology Documentation
          

          
            
            <img src="_static/Onegeology_logo_large.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Providing Data / Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-aim-one-service-many-uses">The aim: One service - many uses</a></li>
<li class="toctree-l2"><a class="reference internal" href="#map-specifications">Map specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-specifications-and-requirements">Technical specifications and requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#level-1-involvement-with-onegeology-web-services">Level 1 involvement with OneGeology web services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#level-2-involvement-with-onegeology-web-services">Level 2 involvement with OneGeology web services</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cookbooks">Cookbooks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-a-cookbook">What is a cookbook?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cookbook-specification">Cookbook specification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#support-services">Support services</a></li>
<li class="toctree-l2"><a class="reference internal" href="#register-your-data-or-service-for-the-portal">Register your data or service for the Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#service-types">Service Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-formats">Data formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-content">Data content</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-preparation">Data preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scanning-a-paper-map">Scanning a paper map</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scanning">Scanning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1">Step 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2a">Step 2A</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2b">Step 2B</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2c">Step 2C</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-stitching">Step 3 ~ Stitching</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#georeferencing-a-scanned-map">Georeferencing a scanned map</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-formats-and-transparency">Image formats and transparency</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-legend-for-the-scanned-map">The legend for the scanned map</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lite-schemas">Lite Schemas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#geosciml-lite">GeoSciML-Lite</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#contactview-features">ContactView features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sheardisplacementstructureview-features">ShearDisplacementStructureView features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologicunitview-features">GeologicUnitView features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boreholeview-features">BoreholeView features</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#earthresourceml-lite">EarthResourceML-Lite</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mineraloccurrenceview-features">MineralOccurrenceView features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#commodityresourceview-features">CommodityResourceView features</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#complex-feature-data">Complex Feature Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mapped-feature-and-geologic-feature">Mapped Feature and Geologic Feature</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mapped-feature-mapping-frame">Mapped Feature - mapping frame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mapped-feature-geometry-shape">Mapped Feature - geometry (shape)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-feature-inspireid">Geologic Feature - inspireId</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-feature-name">Geologic Feature - name</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#geologic-age">Geologic Age</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#geologic-event-name">Geologic Event - name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-event-youngernamedage-and-oldernamedage">Geologic Event - youngerNamedAge and olderNamedAge</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-event-eventprocess">Geologic Event - eventProcess</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-event-eventenvironment">Geologic Event - eventEnvironment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#geologic-unit-and-earth-material">Geologic Unit and Earth Material</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#geologic-unit-geologic-unit-type">Geologic Unit - geologic unit type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-unit-composition">Geologic Unit - composition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#composition-part-role">Composition Part - role</a></li>
<li class="toctree-l4"><a class="reference internal" href="#composition-part-proportion">Composition Part - proportion</a></li>
<li class="toctree-l4"><a class="reference internal" href="#composition-part-material">Composition Part - material</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rock-material-lithology">Rock Material -lithology</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#geologic-structure">Geologic Structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#shear-displacement-structure-faulttype">Shear Displacement Structure - faultType</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fold-profiletype">Fold - profileType</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#geomorphologic-feature">Geomorphologic Feature</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#natural-geomorphologic-feature-naturalgeomorphologicfeaturetype">Natural Geomorphologic Feature - NaturalGeomorphologicFeatureType</a></li>
<li class="toctree-l4"><a class="reference internal" href="#natural-geomorphologic-feature-activity">Natural Geomorphologic Feature - activity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#anthropogenic-geomorphologic-feature-anthropogenicgeomorphologicfeaturetype">Anthropogenic Geomorphologic Feature - AnthropogenicGeomorphologicFeatureType</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#thematic-class">Thematic Class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#geologic-feature-classifier">Geologic Feature - classifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="#borehole">Borehole</a></li>
<li class="toctree-l4"><a class="reference internal" href="#borehole-inspireid">Borehole - inspireId</a></li>
<li class="toctree-l4"><a class="reference internal" href="#borehole-sampledfeature">Borehole - sampledFeature</a></li>
<li class="toctree-l4"><a class="reference internal" href="#borehole-downholegeometry">Borehole - downholeGeometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#borehole-location-and-elevation">Borehole - location and elevation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#borehole-purpose">Borehole - purpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="#borehole-boreholelength">Borehole - boreholeLength</a></li>
<li class="toctree-l4"><a class="reference internal" href="#borehole-interval-mappingframe">Borehole Interval - mappingFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boreholeinterval-geometry-shape">BoreholeInterval - geometry (shape)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boreholeinterval-specification">BoreholeInterval - specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boreholeinterval-mappedintervalbegin-mappedintervalend">BoreholeInterval - mappedIntervalBegin &amp; mappedIntervalEnd</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#geologic-collection">Geologic Collection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#geologic-collection-inspireid">Geologic Collection - inspireId</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologiccollection-name">GeologicCollection - name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-collection-collectiontype">Geologic Collection - collectionType</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-collection-member">Geologic Collection - member</a></li>
<li class="toctree-l4"><a class="reference internal" href="#md-metadata-contact">MD_Metadata - contact</a></li>
<li class="toctree-l4"><a class="reference internal" href="#md-metadata-datestamp">MD_Metadata - dateStamp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-collection-reference">Geologic Collection - reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#documentcitation-name">DocumentCitation - name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#documentcitation-shortname">DocumentCitation - shortName</a></li>
<li class="toctree-l4"><a class="reference internal" href="#document-citation-date">Document Citation - date</a></li>
<li class="toctree-l4"><a class="reference internal" href="#documentcitation-link">DocumentCitation - link</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geologic-collection-beginlifespanversion-endlifespanversion">Geologic Collection - beginLifespanVersion &amp; endLifespanVersion</a></li>
<li class="toctree-l4"><a class="reference internal" href="#md-dataidentification-abstract">MD_DataIdentification - abstract</a></li>
<li class="toctree-l4"><a class="reference internal" href="#md-dataidentification-language">MD_DataIdentification - language</a></li>
<li class="toctree-l4"><a class="reference internal" href="#md-dataidentification-topiccategory">MD_DataIdentification - topicCategory</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#onegeology-profile">OneGeology Profile</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ogc-service-level-metadata">OGC service level metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#service-title">Service title</a></li>
<li class="toctree-l4"><a class="reference internal" href="#service-abstract">Service abstract</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fees">Fees</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-constraints">Access constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#keywords">Keywords</a></li>
<li class="toctree-l4"><a class="reference internal" href="#contact-information">Contact information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-provider">Data provider</a></li>
<li class="toctree-l4"><a class="reference internal" href="#online-resource">Online resource</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#layer-coverage-feature-metadata">Layer / Coverage / Feature metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#wms-layer-and-wcs-coverage-naming">WMS layer and WCS coverage naming</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#geographic-extent">Geographic extent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-owner">Data owner</a></li>
<li class="toctree-l4"><a class="reference internal" href="#language">Language</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scale">Scale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#theme">Theme</a></li>
<li class="toctree-l4"><a class="reference internal" href="#layer-title-examples">Layer title examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#layer-name-examples">Layer name examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspire-layer-naming-considerations">INSPIRE layer naming considerations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#summary-of-layer-coverage-feature-metadata">Summary of layer/coverage/feature metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#machine-readable-name">Machine readable name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#human-readable-name">Human readable name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#abstract">Abstract</a></li>
<li class="toctree-l4"><a class="reference internal" href="#service-provision-onegeology-profile-layer-keywords">Keywords</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wms-specific-metadata">WMS Specific Metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#extent">Extent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spatial-coordinate-reference-system">Spatial/Coordinate reference system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boundingbox">BoundingBox</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dataurl-optional">DataURL (optional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metadataurl-optional">MetadataURL (optional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#legend-url">Legend url</a></li>
<li class="toctree-l4"><a class="reference internal" href="#layer-styling-information">Layer styling information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wms-getfeatureinfo-response">WMS GetFeatureInfo response</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#core-tc211-iso-19115-metadata">Core TC211/ISO:19115 Metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id34">GeoSciML</a></li>
<li class="toctree-l2"><a class="reference internal" href="#web-services">Web Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cookbook-example-data">Cookbook example data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#geopackage">GeoPackage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#postgis-data">PostGIS data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-with-world-file">Image with world file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shapefile">Shapefile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geotiff">GeoTIFF</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-a-server">Setting up a Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-geoserver">Using GeoServer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pre-requisites-system-requirements">Pre-requisites / System Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#software-installation">Software Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#app-schema-plugin-installation">App-schema Plugin Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspire-plugin-installation">INSPIRE Plugin Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#database">Database</a></li>
<li class="toctree-l4"><a class="reference internal" href="#assumptions">Assumptions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-setup">Common Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#logging-in">Logging in</a></li>
<li class="toctree-l4"><a class="reference internal" href="#editing-contact-information-metadata">Editing contact information metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="#workspaces">Workspaces</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-data">Example Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-wms">Simple WMS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#inspire-extended-capabilities">INSPIRE Extended Capabilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-a-data-store">Configuring a data store</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-layers-to-a-workspace">Adding layers to a workspace</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-data-tab-of-the-edit-layer-page">The Data tab of the Edit Layer page</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-publishing-tab-of-the-edit-layer-page">The Publishing tab of the Edit Layer page</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-group-layers">Creating group layers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sld-enabled-wms">SLD enabled WMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-feature-wfs">Simple Feature WFS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-application-schemas-extension">Using application schemas extension</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-mapping-file">Create mapping file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#edit-datastore-xml-file">Edit datastore.xml file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#complex-feature-wfs">Complex Feature WFS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-example-configuration">Obtaining example configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#complex-feature-test-requests">Complex Feature Test requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id56">INSPIRE Extended Capabilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspire-pre-defined-dataset-download">INSPIRE Pre-defined Dataset Download</a></li>
<li class="toctree-l4"><a class="reference internal" href="#app-schema-properties">app-schema.properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-directory">Data directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#workspace-layout">Workspace layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datastore-xml">datastore.xml</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mapping-files">Mapping files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#namespaces">Namespaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-data-store">Source data store</a></li>
<li class="toctree-l4"><a class="reference internal" href="#target-types">Target types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mappings">Mappings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gml-id-mapping">gml:id mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspireid-mapping">inspireId mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ordinary-mapping">Ordinary mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#client-properties">Client properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#feature-chaining">Feature chaining</a></li>
<li class="toctree-l4"><a class="reference internal" href="#polymorphism">Polymorphism</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspire-geology-theme-schema">INSPIRE Geology Theme Schema</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wcs">WCS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exemplar-data-used-in-this-cookbook">Exemplar data used in this cookbook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metadata-to-be-used-in-configuring-your-service-and-coverages-layers">Metadata to be used in configuring your service and coverages (layers)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id64">Stores</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id65">Layers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#service-level-metadata">Service level metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id66">INSPIRE Extended Capabilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#geoserver-troubleshooting">GeoServer troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-mapserver">Using MapServer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id70">Software Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-ms4w">Installing MS4W</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-exemplar-services">Configuring the exemplar services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-your-own-services-using-the-exemplars-as-examples">Configuring your own services using the exemplars as examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#c-ms4w-apache-cgi-bin">C:\ms4w\Apache\cgi-bin\</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-ms4w-apps-cookbookexemplars">C:\ms4w\apps\cookbookExemplars</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-ms4w-httpd-d">C:\ms4w\httpd.d\</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-ms4w-apache-htdocs">C:\ms4w\Apache\htdocs\</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-and-configuring-apache-http-web-server">Installing and configuring Apache HTTP web server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bit-apache-http-server">64-bit Apache HTTP server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#httpd-d-configuration-files">httpd.d configuration files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#apache-conf">apache.conf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-alias-configuration-files">Create alias configuration files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-gisinternals-packages-for-windows">Installing GISInternals packages for Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id72">Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mapserver-cgi-bin">MapServer cgi-bin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-mapserver-on-linux-using-ppas">Installing MapServer on Linux using PPAs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-mapserver-exemplar-services-on-a-lamp-server">Configuring MapServer exemplar services on a LAMP server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-a-ows-shell-script">Create a ows shell script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modify-paths-in-the-mapfile">Modify paths in the Mapfile</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#alternative-mapserver-configurations">Alternative MapServer configurations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mapserver-and-iis">MapServer and IIS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compiling-mapserver-on-linux">Compiling MapServer on Linux</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#general-configuration">General configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-alternate-character-set-support">Adding alternate character set support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-your-own-symbology">Creating your own symbology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-include-files">Example include files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-common-errors">Debugging common errors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#symbol-definition-error">Symbol definition error</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unknown-identifier">Unknown identifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="#missing-magic-string">Missing magic string</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#connecting-to-a-database">Connecting to a database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wms">WMS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#raster-image-data-exemplar-layer-configuration">Raster image data exemplar (LAYER configuration)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vector-data-exemplar-layer-configuration">Vector data exemplar (LAYER configuration)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-html-query-templates">Configuring HTML query templates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-your-requests">Debugging your requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handling-fields-for-which-you-have-no-data">Handling fields for which you have no data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-javascript">Using JavaScript</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-group-layering">Configuring group layering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id73">Simple feature WFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id74">WCS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#inspire-metadata">INSPIRE metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-arcgis">Using ArcGIS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id76">WMS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prepare-the-map-document">Prepare the map document</a></li>
<li class="toctree-l4"><a class="reference internal" href="#publishing-your-wms">Publishing your WMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#edit-the-getcapabilities-documents">Edit the GetCapabilities documents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspire">INSPIRE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#arcgis-server">ArcGIS Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#inspire-layer-names">INSPIRE Layer Names</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspire-coordinate-systems">INSPIRE Coordinate Systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id81">INSPIRE extended capabilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspire-extension">INSPIRE Extension</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-inspire-geodatabase">Create INSPIRE geodatabase</a></li>
<li class="toctree-l4"><a class="reference internal" href="#populate-inspire-geodatabase">Populate INSPIRE geodatabase</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customise-layers-in-inspire-geodatabase">Customise layers in INSPIRE geodatabase</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-inspire-layers-to-your-map-document">Add INSPIRE layers to your map document</a></li>
<li class="toctree-l4"><a class="reference internal" href="#publish-inspire-view-service">Publish INSPIRE View service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-inspire-view-service">Configure INSPIRE View service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-inspire-view-service-getcapabilities-document">Custom INSPIRE View service GetCapabilities document</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-inspire-view-service">Use INSPIRE View service</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#arcgis-server-issues">ArcGIS server issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id84">Simple Feature WFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id86">WCS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-a-map-document">Create a map document</a></li>
<li class="toctree-l4"><a class="reference internal" href="#publish-the-wcs-service">Publish the WCS service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#edit-the-getcapabilities-document">Edit the GetCapabilities document</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-apache-http-server-as-a-reverse-proxy">Using Apache HTTP server as a reverse proxy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="portal.html">Using the OneGeology Portal</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices.html">Appendices</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OneGeology Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Providing Data / Services</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/providingdata.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="providing-data-services">
<h1>Providing Data / Services<a class="headerlink" href="#providing-data-services" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="http://onegeology.org/what_is/mission.html">mission</a> of OneGeology is being fulfilled by the cooperation of participating member organisations worldwide. This part of the website gives technical guidance on how to provide services for OneGeology to those organisations that fit within the <a class="reference external" href="http://onegeology.org/participants/home.html#statement">prospective member guidelines</a> and have <a class="reference external" href="http://onegeology.org/getting_involved/home.html">registered</a> with OneGeology as participants. Some of the guidance may also be of use to others who wish to set up similar services outside OneGeology.</p>
<p>As described in the pages on <a class="reference external" href="http://onegeology.org/use/home.html">using</a> OneGeology data there are different kinds of data and levels of interaction with that data that are provided by OneGeology services. As a participant you need to decide what kinds of service to set up. This will depend on what data you have available and what level of access you wish to provide to it. You will also need to decide how much effort you are able to spend to harmonise your data with relevant standards. The next sections give an overview of different kinds of data source you might use and what levels of functionality you could provide with different services.</p>
<div class="section" id="the-aim-one-service-many-uses">
<h2>The aim: One service - many uses<a class="headerlink" href="#the-aim-one-service-many-uses" title="Permalink to this headline">¶</a></h2>
<p>Geological map data will be made available as a distributed web service, using the OGC ‘web feature mapping’ approach. The priority of OneGeology is to make available interoperable, Internet-accessible, scientifically-attributed data and to make progress at levels appropriate to participants’ capability. Surveys and organisations are encouraged to work together to develop and implement the required interchange standard to make their data interoperable. This can be achieved by using GML (Geography Mark-up Language) based
data.</p>
<div class="align-center figure" id="id89">
<a class="reference internal image-reference" href="_images/gml_based_data.jpg"><img alt="GML-Based data" src="_images/gml_based_data.jpg" style="width: 417px; height: 249px;" /></a>
<p class="caption"><span class="caption-text">GML Based Data</span><a class="headerlink" href="#id89" title="Permalink to this image">¶</a></p>
</div>
<p>GML based data (including <a class="reference external" href="http://www.cgi-iugs.org/tech_collaboration/geosciml.html">GeoSciML</a>) can be used in many different ways.
For example, basic data can be rendered into a map that can be interrogated for further detailed information, the data can be formatted into a report, or it can be used in other applications for further development.</p>
</div>
<div class="section" id="map-specifications">
<h2>Map specifications<a class="headerlink" href="#map-specifications" title="Permalink to this headline">¶</a></h2>
<p>Prerequisites for OneGeology involvement:</p>
<ul class="simple">
<li><p>the target scale is 1:1 000 000 but the project will be pragmatic and accept a range of scales and the best available data.</p></li>
<li><p>to provide a WMS you only require a georeferenced scanned paper map or raster or vector digital GIS data.</p></li>
<li><p>to provide feature and complex data queries via GeoSciML based WFS you</p>
<ul>
<li><p>need to map from your GIS (ESRI ARCINFO, MapInfo, ORACLE etc.) data store to WFS server configuration (Geoserver or Mapserver/Cocoon).</p></li>
<li><p>need a (trained) person week, but includes getting WFS going with open source software (IT issues).</p></li>
<li><p>should note that the mapping process will be simple (small part of GeoSciML) if the themes chosen by the geological specification group are simple e.g. simple polygons with few attributes such as bedrock, lithology and age.</p></li>
</ul>
</li>
</ul>
<p>WMS = web map service — this is level 1, the minimum for OneGeology
WFS = web feature service, this holds more detailed data.</p>
</div>
<div class="section" id="technical-specifications-and-requirements">
<h2>Technical specifications and requirements<a class="headerlink" href="#technical-specifications-and-requirements" title="Permalink to this headline">¶</a></h2>
<div class="align-center figure" id="id90">
<a class="reference internal image-reference" href="_images/map_explorer.jpg"><img alt="Map" src="_images/map_explorer.jpg" style="width: 417px; height: 249px;" /></a>
<p class="caption"><span class="caption-text">Example of a GeoSciML downloaded map — one of the aims of OneGeology</span><a class="headerlink" href="#id90" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="level-1-involvement-with-onegeology-web-services">
<h3>Level 1 involvement with OneGeology web services<a class="headerlink" href="#level-1-involvement-with-onegeology-web-services" title="Permalink to this headline">¶</a></h3>
<p>Geological surveys and similar institutions that wish to contribute to the OneGeology initiative at Level 1 are aiming to provide an <strong>OGC Web Mapping Service (WMS)</strong> from a web server within their organisation, or hosted by a neighbouring organisation, of some basic geological maps.</p>
<p>The maps will appear in the computer users application, which may be a web browser, in a raster or image form. Such image maps will be combinable with other spatial datasets depending on the application the user wishes to apply. If the data that is the source behind the WMS is of digital vector data form with attributes associated with those vectors e.g. information attached to a particular type polygon or boundary then the WMS will allow the display of such attributes for each polygon. If the data source behind the WMS is of a simple scanned raster type e.g. scanned from a paper map and served as a raster image, then such attributes or further informa0tion do not exist for separate polygons.</p>
</div>
<div class="section" id="level-2-involvement-with-onegeology-web-services">
<h3>Level 2 involvement with OneGeology web services<a class="headerlink" href="#level-2-involvement-with-onegeology-web-services" title="Permalink to this headline">¶</a></h3>
<p>Geological surveys and similar institutions that wish to contribute to the OneGeology initiative at Level 2 are aiming to provide an <strong>OGC Web Feature Service (WFS)</strong> from a web server within their organisation, or hosted by a neighbouring organisation, of some basic geological ‘map’ data.</p>
<p>These WFS will allow the user to download data in GeoSciML form resulting from queries (geographic or other attribute based) of the data over the web so that the same query could be sent to some/all of the OneGeology contributors WFS services around the world.</p>
</div>
</div>
<div class="section" id="cookbooks">
<h2>Cookbooks<a class="headerlink" href="#cookbooks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-is-a-cookbook">
<h3>What is a cookbook?<a class="headerlink" href="#what-is-a-cookbook" title="Permalink to this headline">¶</a></h3>
<p>A cookbook is a best practice manual ‘containing a straightforward set of already tried and tested <em>recipe or instructions</em> for a specific activity’.</p>
<p>A series of ‘cookbooks’ giving best practice on using open-source, i.e. freely available, software to set up WFS will be provided by the OneGeology initiative along with guidance on how to configure a WFS using GeoSciML from the institutions’ internal digital databases.</p>
<p>These documents will provide specific work-flow guidance notes to enable full participation of your organisation regardless of expertise, location or amount of data available.</p>
</div>
<div class="section" id="cookbook-specification">
<h3>Cookbook specification<a class="headerlink" href="#cookbook-specification" title="Permalink to this headline">¶</a></h3>
<p>A series of OneGeology-specific branded cookbooks are available as follows:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Online</dt><dd><ul>
<li><p><a class="reference external" href="https://onegeology-docs.readthedocs.io/en/latest/webservices.html#wms">Cookbook No 1</a> - explains how to setup a WMS (view) service (with no GML/GeoSciML).</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>PDF Download (to be moved online shortly)</dt><dd><ul>
<li><p><a class="reference external" href="http://www.onegeology.org/docs/technical/CB6-HowToServe-a-OneGeology-WCS_v1.pdf">Cookbook No 6</a> - decribes how to set up a WCS (download) web service on your web server using open-source software.</p></li>
<li><p><a class="reference external" href="http://www.onegeology.org/docs/technical/GeoSciML_Cookbook_1.3.pdf">Cookbook No 7</a> - explains how we map from the backend database to the GeoSciML WFS service.</p></li>
<li><p><a class="reference external" href="http://www.onegeology.org/docs/technical/OneGeologyWFSCookbook_v1.4.pdf">Cookbook No 8</a>- describes how to set up a WFS (download) web service on your web server using open-source software.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The aim is that multilingual versions will be available wherever possible.</p>
</div>
</div>
<div class="section" id="support-services">
<h2>Support services<a class="headerlink" href="#support-services" title="Permalink to this headline">¶</a></h2>
<p>Services which will be available to OneGeology participants to help advise and assist with serving data to the Portal include:
- This documentation including cookbooks’ for step-by-step guidance.
- a support team, and <a class="reference external" href="mailto:onegeologyhelp&#37;&#52;&#48;bgs&#46;ac&#46;uk">email</a>.
- regional workshops to build technology capability within staff.</p>
<p>Work will be based on open-source technologies so all the OGC web services required software can be purchased cost free. However, a contributing survey must either have its own standard Internet server or have access to such a server through a neighbouring or regional organisation.</p>
</div>
<div class="section" id="register-your-data-or-service-for-the-portal">
<h2>Register your data or service for the Portal<a class="headerlink" href="#register-your-data-or-service-for-the-portal" title="Permalink to this headline">¶</a></h2>
<p>OneGeology is an initiative to make web accessible the geoscience data held by national geological survey and similar organisations around the World.</p>
<p>OneGeology welcomes all geological surveys and organisations to contribute their data to OneGeology.</p>
<p>Statement guiding prospective participants - <a class="reference external" href="http://onegeology.org/participants/home.html#statement">http://onegeology.org/participants/home.html#statement</a></p>
<p>Before you can submit your service to OneGeology, you must first register your organization as a OneGeology data provider by filling out the registration form - <a class="reference external" href="http://onegeology.org/getting_involved/get_involved.cfm">http://onegeology.org/getting_involved/get_involved.cfm</a></p>
<p>If you are willing and able to host your own data you will then need to fill in the Data Coordination form on the OneGeology website - <a class="reference external" href="http://onegeology.org/technical_progress/data_coordination.cfm">http://onegeology.org/technical_progress/data_coordination.cfm</a></p>
<p>If you are unable to host your own data for any reason, then you will <em>ALSO</em> need to fill in the buddy form on the OneGeology website - <a class="reference external" href="http://onegeology.org/technical_progress/buddy_coordination.cfm">http://onegeology.org/technical_progress/buddy_coordination.cfm</a></p>
<p>Next, send an email to <a class="reference external" href="mailto:onegeologyhelp&#37;&#52;&#48;bgs&#46;ac&#46;uk">onegeologyhelp<span>&#64;</span>bgs<span>&#46;</span>ac<span>&#46;</span>uk</a> with the URL of the proposed service.</p>
<p>Include in this email:</p>
<ul class="simple">
<li><p>The name of the geographical area</p></li>
<li><p>the name of the data provider organization (usually this is the owner of the data)</p></li>
<li><p>the name of the service provider organization</p></li>
</ul>
<blockquote>
<div><p>The OneGeology secretariat will check that they have written confirmation that the service provider owns the right to serve the proposed data and/or has permission from the &lt;span class=”toolTip data”&gt;data provider&lt;/span&gt; to serve that data.</p>
</div></blockquote>
<p>You will be contacted by the OneGeology helpdesk with confirmation of receipt, plus any other feedback.</p>
<p>The service will then be reviewed for conformance with OneGeology requirements and, upon verification, the service URL will be forwarded to BRGM the OneGeology Portal hosts) by the helpdesk team with a request to register the service at <a class="reference external" href="http://portal.onegeology.org">http://portal.onegeology.org</a> and catalog - <a class="reference external" href="http://onegeology-geonetwork.brgm.fr/geonetwork3/srv/eng/catalog.search#/home">http://onegeology-geonetwork.brgm.fr/geonetwork3/srv/eng/catalog.search#/home</a>”&gt;http://onegeology-geonetwork.brgm.fr/geonetwork3/srv/eng/catalog.search#/home</p>
<p>If BRGM have any technical issues with the proposed service they will raise these issues with the helpdesk, and the helpdesk will in turn discuss theses issues with the service provider, if required.</p>
<p>When the service is fit for registration BRGM will email the OneGeology secretariat, your OneGeology service will now be officially registered and its layers are now visible in the OneGeology Portal.</p>
<p>As the reference information stored in the OneGeology portal and catalogue comes from your service directly it is highly recommended if you need to make major changes to information held in your service, to modify your service first and then ask the helpdesk to have your service updated.</p>
<p>If you have any queries please contact <a class="reference external" href="mailto:onegeologyhelp&#37;&#52;&#48;bgs&#46;ac&#46;uk">onegeologyhelp<span>&#64;</span>bgs<span>&#46;</span>ac<span>&#46;</span>uk</a></p>
</div>
<div class="section" id="service-types">
<span id="service-provision-service-types"></span><h2>Service Types<a class="headerlink" href="#service-types" title="Permalink to this headline">¶</a></h2>
<p>This guidance covers setting up some different kinds of service which provide different levels of access to your data and different functionality.</p>
<dl class="glossary simple">
<dt id="term-Simple-WMS">Simple WMS<a class="headerlink" href="#term-Simple-WMS" title="Permalink to this term">¶</a></dt><dd><p>This may just show the map image in its correct location through a GetMap request. The map colours may be data provider specific or standard. This kind of service can be set up with only a georegistered image file as data source. A GetFeatureInfo enabled WMS will also provide the ability to query any point on the map and retrieve a set of properties for that point in text, HTML, XML or other formats. A vector data file or spatial database would be required to support GetFeatureInfo responses.</p>
</dd>
<dt id="term-SLD-enabled-WMS">SLD enabled WMS<a class="headerlink" href="#term-SLD-enabled-WMS" title="Permalink to this term">¶</a></dt><dd><p>This allows the map to be styled depending on values of some data underlying the WMS. The OneGeology Portal can ask an SLD enabled WMS to highlight units of particular ages or lithologies if it has underlying data with the GeoSciML-Lite age and lithology fields and using either IUGS-CGI vocabularies or INSPIRE vocabularies. An SLD enabled WMS would usually use a vector data file or spatial database as a data source.</p>
</dd>
<dt id="term-Simple-feature-WFS">Simple feature WFS<a class="headerlink" href="#term-Simple-feature-WFS" title="Permalink to this term">¶</a></dt><dd><p>This often goes together with the SLD enabled WMS. The features may be created to reflect whatever data fields exist in the source data table or there may be some level of standardisation of some or more of the fields and the values they can contain. OneGeology currently deals specifically with two simple feature standards: GeoSciML-Lite and ERML-Lite. Setting up a simple feature WFS will enable many clients to query and download your data. A simple feature WFS would usually use a vector data file or spatial database as a data source.</p>
</dd>
<dt id="term-Complex-feature-WFS">Complex feature WFS<a class="headerlink" href="#term-Complex-feature-WFS" title="Permalink to this term">¶</a></dt><dd><p>This can supply data for spatial features with complex properties that may have complex structure, multiple values, alternative value types etc. Using a standard schema for these features and standard vocabularies for categorical properties potentially enables interoperable sophisticated application processing of data from different providers. The OneGeology Portal can currently query services using the GeoSciML schema and associated vocabularies from the IUGS-CGI or INSPIRE. A complex feature WFS would usually use a spatial database as a data source.</p>
</dd>
<dt id="term-WCS">WCS<a class="headerlink" href="#term-WCS" title="Permalink to this term">¶</a></dt><dd><p>This is a more recent addition to OneGeology and the Portal currently can handle raster grids that can be returned in an image format only. Other applications might be able to consume other grid data formats. A WCS could use a variety of grid data formats, image formats, raster or array database as a data source.</p>
</dd>
</dl>
</div>
<div class="section" id="data-formats">
<h2>Data formats<a class="headerlink" href="#data-formats" title="Permalink to this headline">¶</a></h2>
<p>We can put data sources we deal with under the following headings in ascending order of sophistication.</p>
<ul class="simple">
<li><p>Paper map. This will need to be scanned to create a digital image and geographically registered to be usable online. At this level it won’t be possible to query the information in any way but it can be made available worldwide for anyone who can read the map to see it set in its correct geographical location relative to other data. Hopefully the legend can be scanned and then this can also be made available.</p></li>
<li><p>A spatial raster or vector data file with simple properties for each grid point or spatial object. For example Shapefiles, GeoPackage and GeoTIFF.</p></li>
<li><p>Spatially enabled database with possibly multiple table joins to particular spatial data fields.</p></li>
</ul>
</div>
<div class="section" id="data-content">
<h2>Data content<a class="headerlink" href="#data-content" title="Permalink to this headline">¶</a></h2>
<p>The main data theme covered by OneGeology is geological map data showing the locations of geological units, faults and other structures. However, we are increasing the diversity of geologically related themes such as minerals, boreholes, hydrogeology and geoparks.  Currently OneGeology only deals with 2D data.</p>
<p>There are commonly differences in the definition of map units between geologic maps produced by different providers or at different times, because of the discrepancies in mapping interpretation and intention. Resolving such differences is a compilation process that often requires additional field work; this is outside the scope of service deployment. However, there are different levels of harmonisation of data that can help make the data from different providers more usable together. OneGeology promotes a number of standards that cover some of the data themes we deal with.</p>
<ul class="simple">
<li><p>Harmonising age classification and colours used for particular geological ages so that age maps from different providers are visually comparable.</p></li>
<li><p>Harmonising lithology classification and colours used so that lithology maps from different providers are visually comparable.</p></li>
<li><p>Harmonising commodity classification and colours used so that mineral commodity maps from different providers are visually comparable.</p></li>
<li><p>Using GeoSciML-Lite or ERML-Lite simple feature formats to provide summary geological or mineral commodity data in a common format. Using CGI (or INSPIRE) standard vocabulary values for the categorical property values in these formats enables common queries to be made to services from different providers. (In particular the OneGeology Portal can query ages and lithologies from different data providers.)</p></li>
<li><p>Using GeoSciML or EarthResourceML complex feature formats to provide comprehensive geological or mineral commodity data in a common format. Using CGI (or INSPIRE) standard vocabulary values for the categorical property values in these formats enables common queries to be made to services from different providers, although there may be a trade-off in loss of precision compared with using the data provider’s own vocabulary values.</p></li>
</ul>
</div>
<div class="section" id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline">¶</a></h2>
<p>In very broad terms we can describe preparing your data to be served in a OneGeology compatible service as a kind of ETL (Extract, Transform and Load) workflow. The data needs to be taken from its current format, possibly transformed into a different structure with transformed data values and loaded into as suitable data store for use by your chosen OGC web service software. This section contains some useful information to help in different cases but you will need to have some expertise already with suitable tools to manipulate your data.</p>
<p>If you only have data in the form of paper maps and just intend to provide a simple WMS without attribute data see “<a class="reference internal" href="#service-provision-data-preparation-paper-map"><span class="std std-ref">Scanning a paper map</span></a>”.</p>
<p>If you have digital data and wish to make this available as it is and it has a simple format with a list of simple property values for each spatial object then it is likely that the server software we describe later will be able to read your data directly and make it available on the web in a number of standard formats based on the data fields in your source data. If the server software can’t read your data format directly then you may need to convert it but most common GIS formats tend to be supported.</p>
<p>If you have digital data and you wish to supply it in a particular standard interchange format such as one of the GeoSciML or ERML simple or complex feature types then you will need to follow a workflow something like the below:</p>
<ol class="arabic simple">
<li><p>Determine which fields in the source data contain the information that is to be delivered in the interchange format fields. Multiple source fields may be combined into single interchange fields, and a single source field may impact values in multiple interchange fields.</p></li>
<li><p>Determine what steps are necessary to get the content into the interchange format. This may involve some calculation, such as concatenating text from multiple fields to populate the text fields in interchange format. Use of the standard vocabularies for interoperability will likely require mapping vocabulary terms in the source data to identifiers for concepts in the controlled vocabularies.</p></li>
<li><p>Set up a query to generate a table with field names exactly matching the field names in the interchange schema. In some cases it may be convenient to generate the interchange schema table in several steps, populating subsets of the fields each time. It may be useful to generate a table with unique combinations of contact, fault, or geologic unit properties from the source data, and map each combination to corresponding properties in the interchange format.</p></li>
<li><p>The table(s) of unique descriptions can then be joined with the geometry elements of map features to generate the final feature classes for the web service.</p></li>
</ol>
<p>There are many possible approaches to mapping terms from one vocabulary to another. One situation in which a standard process can be defined is that a controlled vocabulary is used to populate a field in the source data, and that field maps directly to a field in the interchange format. For example, consider a source dataset that contains a ‘dominantLithology’ field with the information used to populate the ‘representativeLithology_uri’ for a GeologicUnitView feature. The recommended procedure in this case is:</p>
<ol class="arabic simple">
<li><p>Produce a table of the unique ‘dominantLithology’ values in the source data</p></li>
<li><p>Add columns to this table for the corresponding term name and URI from the CGI or INSPIRE standard lithology vocabulary.</p></li>
<li><p>Determine the best matching value from the CGI standard lithology vocabulary for each unique lithology term.</p></li>
<li><p>Use an SQL query or other data processing system to join the ‘dominantLithology’ field to the corresponding field in the lookup table to update the ‘representativeLithology_uri’ field to the correct standard lithology term URI.</p></li>
</ol>
<p>In general, the most specific term from the interchange vocabulary that completely subsumes (encompasses) the meaning of the term in the source vocabulary should be used. If the source vocabulary has terms that are more specific than the controlled vocabulary, there will be some information lost in this process, but the original source terminology could be preserved in an appropriate text description field. Remember, the primary purpose of the controlled vocabulary fields is for data integration, search criteria, and standardized map legends.</p>
<p>As we don’t know your data structure or vocabularies we cannot give detailed instructions on how to map your data to one of the standard formats. However, the sections on <a class="reference internal" href="#service-provision-data-preparation-lite"><span class="std std-ref">Lite Schemas</span></a> and <a class="reference internal" href="#service-provision-data-preparation-complex"><span class="std std-ref">Complex Feature Data</span></a> describe the feature types and properties covered by GeoSciML and EarthResourceML and which CGI or INSPIRE vocabularies can be used for particular feature properties. This should provide a reference for deciding how to map your source data to one of these standard interchange formats.</p>
</div>
<div class="section" id="scanning-a-paper-map">
<span id="service-provision-data-preparation-paper-map"></span><h2>Scanning a paper map<a class="headerlink" href="#scanning-a-paper-map" title="Permalink to this headline">¶</a></h2>
<div class="section" id="scanning">
<h3>Scanning<a class="headerlink" href="#scanning" title="Permalink to this headline">¶</a></h3>
<p>Your chosen paper map may look something like this one from the Dutch Geological Survey of Dutch Guyana or Suriname:</p>
<div class="figure align-default" id="id91">
<a class="reference internal image-reference" href="_images/paperMap.jpg"><img alt="Example geological map to scan" src="_images/paperMap.jpg" style="width: 600px; height: 528px;" /></a>
<p class="caption"><span class="caption-text">Example geological map to scan</span><a class="headerlink" href="#id91" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="step-1">
<h4>Step 1<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h4>
<p>It is important to find a large scanner in your city, which could cover a whole paper map.  If this scanner is not available at your survey, you may try the Topographical Survey or a large bookshop or book printer.</p>
</div>
<div class="section" id="step-2a">
<h4>Step 2A<a class="headerlink" href="#step-2a" title="Permalink to this headline">¶</a></h4>
<p>If you could use a large scanner, you can scan the whole map at one time.  But remember to scan the geological map portion into a separate file from that for the legend i.e. you will have two files one for the map and one for the legend.  Alternatively, make a copy of an original digital image of the whole map face and cut out the map from the legend.</p>
<p>The preferable output format should be .TIFF as this format keeps most information, but if  you have a slow Personal Computer, you could temporarily work with a JPEG copy.  The file size is than much smaller and it can be accessed and geo-referenced faster.</p>
<p>Good software for cropping (or cutting out) the legend or map from the whole scanned image is <a class="reference external" href="http://www.irfanview.com/">IrfanView</a>, <a class="reference external" href="http://www.adobe.com/uk/products/photoshopfamily.html">Adobe Photoshop</a> or <a class="reference external" href="https://www.gimp.org/">GNU Image Manipulation Program (GIMP)</a>.</p>
<p>Tip: This cropped map is now ready for geo-referencing.</p>
<p>Note, an alternative approach is to georeference the whole scanned image, then use a GIS (such as <a class="reference external" href="https://www.qgis.org/en/site/about/index.html">QGIS</a>) to crop out the map sheet using a polygon mask.  You might use this technique when your original data is a scan of a old map sheet.</p>
</div>
<div class="section" id="step-2b">
<h4>Step 2B<a class="headerlink" href="#step-2b" title="Permalink to this headline">¶</a></h4>
<p>For larger maps, or if you have only a small scanner, the map should be scanned in parts and later stitched together.</p>
<div class="figure align-default" id="id92">
<a class="reference internal image-reference" href="_images/scanningAMap.jpg"><img alt="Orientation of map for scanning" src="_images/scanningAMap.jpg" style="width: 414px; height: 253px;" /></a>
<p class="caption"><span class="caption-text">Orientation of map for scanning</span><a class="headerlink" href="#id92" title="Permalink to this image">¶</a></p>
</div>
<p>If you scan in parts always try to keep the crossings of the horizontal and vertical black lines in each of the four corners.  The straight horizontal and vertical black lines on the map are the altitude and longitude.  Then the stitching and geo-referencing will be much easier.</p>
<p>The output format should be .TIFF as this format keeps most pixel information available.</p>
</div>
<div class="section" id="step-2c">
<h4>Step 2C<a class="headerlink" href="#step-2c" title="Permalink to this headline">¶</a></h4>
<p>If scanners are not available, you could use a good digital camera.  Unfold the map on a well lit place without glare or light reflections.  Sometimes white sheets on the side will diffuse the light and prevent ugly reflections from the sun or from the light-bulb.  Take a picture right above the centre of the map.</p>
<p>Make several pictures with different lighting and shutter speed.  Choose the best colourful result.  Usually the export format is .JPG.</p>
</div>
<div class="section" id="step-3-stitching">
<h4>Step 3 ~ Stitching<a class="headerlink" href="#step-3-stitching" title="Permalink to this headline">¶</a></h4>
<p>For the stitching of map parts many applications or free software are available, such as such as <a class="reference external" href="https://www.gimp.org/">GNU Image Manipulation Program (GIMP)</a>, <a class="reference external" href="http://www.ossim.org/">OSSIM ImageLinker</a>, or <a class="reference external" href="https://www.qgis.org/en/site/about/index.html">QGIS</a>.</p>
</div>
</div>
<div class="section" id="georeferencing-a-scanned-map">
<h3>Georeferencing a scanned map<a class="headerlink" href="#georeferencing-a-scanned-map" title="Permalink to this headline">¶</a></h3>
<p>You have now a .TIFF file or maybe a .JPEG file, which is a representation of your paper map.  This digital file should now be brought into relation with the surface of the earth.  This is called geo-referencing.  For this action you need GIS software.</p>
<p>Commercial GIS software such as ESRI ArcGIS or MapInfo is widely available and ‘no-cost’ GIS software, which also could perform this task, is <a class="reference external" href="https://github.com/52North/IlwisCore/">ILWIS</a> , <a class="reference external" href="http://mapwarper.net//">Geothings Map Warper</a> or <a class="reference external" href="https://www.qgis.org/en/site/about/index.html">QGIS</a>.</p>
<p>Note down the Coordinate system of the paper map, as this is necessary for the following process.  Sometimes paper maps are found and we are not sure what coordinate system was being used as it has not been clearly stated on the paper copy.  Some research may have to be done to estimate the original coordinate system used.  For the Suriname map example it is thought probable that the coordinate system originally used was GCS North American 1927.</p>
<p>It is important to find four or more fixed points in the corner of the picture, from which you know exactly the position.  Reliable points are church towers, railway and roads crossings, canals or bridges.  Be careful with coastal features or rivers as these tend to change slowly in time.  More points are desirable to prevent conical distortions, which often happen with digital cameras.</p>
<div class="figure align-default" id="id93">
<a class="reference internal image-reference" href="_images/crossingPoints.jpg"><img alt="Minimum number and location of control points when geo-rectifying a scanned image." src="_images/crossingPoints.jpg" style="width: 421px; height: 256px;" /></a>
<p class="caption"><span class="caption-text">Minimum number and location of control points when georectifying a scanned image.</span><a class="headerlink" href="#id93" title="Permalink to this image">¶</a></p>
</div>
<p>Usually these are crossing points of an altitude line and a longitude line.</p>
<p>The x and y coordinates of each crossing should be given to the program.</p>
<p>Be careful to use the relevant degree-minutes-seconds or decimal entries for degrees depending on the particular program’s requirements.  After confirming the picture will be warped by the program so it fits now on the world surface.  Please check the accuracy, preferable with a topographical map, as often even the cartographers have made mistakes, or may have deliberately introduced errors for geopolitical or security reasons.  With slight alterations of the fixed points you can try to make a perfect overlap with a topographical map.</p>
</div>
<div class="section" id="image-formats-and-transparency">
<h3>Image formats and transparency<a class="headerlink" href="#image-formats-and-transparency" title="Permalink to this headline">¶</a></h3>
<p>Although your scanned image will be rectangular in shape, nearly all mapped geographic regions will have irregularly shaped boundaries.  Thus it is preferable to make the background parts of your image transparent rather than a solid background colour which will obscure neighbouring regions.  The variety of image formats that are usable with MapServer and their various advantages and disadvantages is a complex subject which we cannot be authoritative about.</p>
<p>We have found 32-bit TIFF (RGB plus alpha layer) or 8-bit palette PNG with a transparent background colour work; you may wish to experiment.</p>
<p>See <a class="reference external" href="http://www.mapserver.org/input/raster.html">MapServer raster data</a> for more information.</p>
</div>
<div class="section" id="the-legend-for-the-scanned-map">
<h3>The legend for the scanned map<a class="headerlink" href="#the-legend-for-the-scanned-map" title="Permalink to this headline">¶</a></h3>
<div class="floatright docutils container">
<div class="figure align-default" id="id94">
<a class="img floatright reference internal image-reference" href="_images/legend.jpg"><img alt="Paper legend" class="img floatright" src="_images/legend.jpg" style="width: 200px; height: 681px;" /></a>
<p class="caption"><span class="caption-text">Detailed legend for scanning</span><a class="headerlink" href="#id94" title="Permalink to this image">¶</a></p>
</div>
</div>
<p>A WMS based on a scanned map will not have the ability to click on a symbolized polygon and see what attributes and therefore what classification it has according to the legend.  A WMS based on GIS digital data polygons and attributes does have this capability and the legend is automatically created from such information by the MapServer software.  However for this scanned map based WMS it is possible to associate the scanned legend file for the map — which in the case of the Suriname example looked like this — with the WMS service by including the following lines in the Metadata section of the MapServer.map configuration file which is discussed later:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">METADATA</span>

<span class="o">...</span>

<span class="s2">&quot;WMS_STYLE&quot;</span> <span class="s2">&quot;default&quot;</span>
<span class="s2">&quot;WMS_STYLE_DEFAULT_LEGENDURL_HEIGHT&quot;</span> <span class="s2">&quot;353&quot;</span>
<span class="s2">&quot;WMS_STYLE_DEFAULT_LEGENDURL_WIDTH&quot;</span> <span class="s2">&quot;253&quot;</span>
<span class="s2">&quot;WMS_STYLE_DEFAULT_LEGENDURL_HREF&quot;</span> <span class="s2">&quot;http://www.dinoservices.nl/TNO_Suriname_Geology/surinameLegend.png&quot;</span>
<span class="s2">&quot;WMS_STYLE_DEFAULT_LEGENDURL_FORMAT&quot;</span> <span class="s2">&quot;image/png&quot;</span>

<span class="o">...</span>
</pre></div>
</div>
<p>Note that the image format should be one that can be directly displayed by a web browser, i.e. JPEG, PNG or GIF.</p>
</div>
</div>
<div class="section" id="lite-schemas">
<span id="service-provision-data-preparation-lite"></span><h2>Lite Schemas<a class="headerlink" href="#lite-schemas" title="Permalink to this headline">¶</a></h2>
<p>GeoSciML-Lite and EarthResourceML-Lite (ERML-Lite) are simplified schemas that take the form of a flat table of attributes (conformant to OGC Simple Features Level-0 profile). These were previously called GeoSciML-Portrayal and EarthResourceML-Portrayal.</p>
<div class="section" id="geosciml-lite">
<span id="service-provision-data-preparation-lite-geosciml"></span><h3>GeoSciML-Lite<a class="headerlink" href="#geosciml-lite" title="Permalink to this headline">¶</a></h3>
<p>The full specification for GeoSciML-Lite is in the <a class="reference external" href="http://docs.opengeospatial.org/is/16-008/16-008.html">GeoSciML standard</a>. OneGeology itself does not currently make direct use of data using these schemas but the age and lithology URI columns in GeologicUnitView are those that an SLD enabled WMS needs to provide for the age and lithology highlighting functionality to work. These schemas do, however, provide a method to exchange simple interoperable data without supporting complex features that may be more easily achievable and that can help qualify for a 4 star accreditation.</p>
<p>There are seven GeoSciML-Lite views descibed in the 4.1 standard, these are:  GeologicUnitView, ShearDisplacmentStructureView, ContactView, BoreholeView, SiteObservationView, GeologicSpecimenView, GeomorphologicUnitView.  Below we lay out what is expected of the views for those features we think that many geological survey organizations will be able to support.</p>
<p>Generally across all GeoSciML-Lite views, missing values should be specified using OGC nil values <em>http://www.opengis.net/def/nil/ogc/0/</em> as below:</p>
<ul class="simple">
<li><p>above detection range (AboveDetectionRange)
- Value was above the detection range of the instrument used to estimate it.</p></li>
<li><p>below detection range (BelowDetectionRange)
- Value was below the detection range of the instrument used to estimate it.</p></li>
<li><p>inapplicable
- There is no value</p></li>
<li><p>missing
- The correct value is not readily available to the sender of this data. Furthermore, a correct value may not exist</p></li>
<li><p>template
- The value will be available later</p></li>
<li><p>unknown
- The correct value is not known to, and not computable by, the sender of this data. However, a correct value probably exists</p></li>
<li><p>withheld
- The value is not divulged</p></li>
</ul>
<p>Alternatively you could use INSPIRE defined void reasons <em>http://inspire.ec.europa.eu/codelist/VoidReasonValue/</em></p>
<p>In the below tables describing the features, <strong>Bold property names indicate required properties.</strong>, <em>whilst properties of type _uri are defined as xs:string in the GeoSciML-Lite 4.1 schema, to be conformant with GML SF-0, the intention is that these strings SHALL BE absolute URI’s.</em></p>
<div class="section" id="contactview-features">
<span id="service-provision-data-preparation-lite-contactview"></span><h4>ContactView features<a class="headerlink" href="#contactview-features" title="Permalink to this headline">¶</a></h4>
<p>These features provide a simplified view of GeoSciML Contact Features. In GeoSciML terms this will be an instance of a MappedFeature with key property values from the associated ContactFeature summarized in text (data type xs:string) fields, and properties suffixed with ‘_uri’ that contain URIs referring to other resources, for example controlled concepts in published vocabularies.</p>
<p><strong>Elements in ContactView mapped feature scheme</strong></p>
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Implementation data type</th>
            <th>Notes</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <td class="rqd">identifier</td>
        <td>xs:string</td>
        <td>Globally unique identifier for the individual feature. Recommended practice is that this identifier be derived from the primary key for the spatial objects in the source data in case information needs to be transferred from the interchange format back to the source database. This identifier is analogous to the identifier for a GeoSciML MappedFeature.</td>
    </tr>
    <tr>
        <td>name</td>
        <td>xs:string</td>
        <td>Display name for the Contact. Examples: &#8216;<i>depositional contact</i>&#8217;, &#8216;<i>unconformity</i>&#8217;, &#8216;<i>Martin-Escabrosa contact</i>&#8217;</td>
    </tr>
    <tr>
        <td>description</td>
        <td>xs:string</td>
        <td>Text description of the contact, may be a generic description of a contact type taken from an entry on a geological map legend, or a more specific description of the particular contact.</td>
    </tr>
    <tr>
        <td>contactType</td>
        <td>xs:string</td>
        <td>Text label specifying the kind of surface separating two geologic units including primary boundaries such as depositional contacts, all kinds of unconformities, intrusive contacts, and gradational contacts, as well as faults that separate geologic units. Ideally this would be the preferred label for the concept identified by contactType_uri</td>
    </tr>
    <tr>
        <td>observationMethod</td>
        <td>xs:string</td>
        <td>Metadata snippet indicating how the spatial extent of the feature was determined. ObservationMethod is a convenience property that provides a quick and dirty approach to observation metadata.</td>
    </tr>
    <tr>
        <td>positionalAccuracy</td>
        <td>xs:string</td>
        <td>Preferred use is a quantitative value defining the radius of an uncertainty buffer around a MappedFeature, e.g. a positionAccuracy of 100 m for a line feature defines a buffer polygon of total width 200 m centered on the line. Some other text description that quantifies position accuracy may be provided, e.g. a term from a controlled vocabulary. Vocabulary used should be described in the dataset metadata.</td>
    </tr>
    <tr>
        <td>source</td>
        <td>xs:string</td>
        <td>Text describing feature specific details and citations to source materials, and if available providing URLs to reference material and publications describing the geologic feature. This could be a short text synopsis of key information that would also be in the metadata record referenced by metadata_uri.</td>
    </tr>
    <tr>
        <td class="rqd">contactType_uri</td>
        <td class="nbtype">xs:string</td>
        <td>URI referring to a controlled concept from a vocabulary defining the Contact types. Mandatory property - if no value is provided then an URI referring to a controlled concept explaining why the value is nil must be provided.</td>
    </tr>
    <tr>
        <td colspan="3" class="CGI">The current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/contacttype</td>
    </tr>
    <tr>
        <td colspan="3" class="INSPIRE">There is no INSPIRE specific controlled vocabulary for contact type.<br />OneGeology-Europe services applied one of the following CGI vocabulary terms:<br />impact_structure_boundary</a>, volcanic_subsicence_zone_boundary, glacial_stationary_line</td>
    </tr>
    <tr>
        <td>specification_uri</td>
        <td class="nbtype">xs:string</td>
        <td>URI referring to the GeoSciML Contact feature that describes the instance in detail. Mandatory property - if no value is provided then an URI referring to a controlled concept explaining why the value is nil must be provided.</td>
    </tr>
    <tr>
        <td>metadata_uri</td>
        <td class="nbtype">xs:string</td>
        <td>URI referring to a formal metadata record describing the provenance of data.</td>
    </tr>
    <tr>
        <td>genericSymbolizer</td>
        <td>xs:string</td>
        <td>Identifier for a symbol from standard (locally or community defined) symbolization scheme for portrayal. There should be an SLD file available defining the symbol associated with each genericSymbolizer value.</td>
    </tr>
    <tr>
        <td class="rqd">shape</td>
        <td>GM_Object</td>
        <td>Geometry defining the extent of the feature of interest. This is the only element with complex content, and must contain a GML geometry that is valid for the Geography Markup Language (GML) simple features profile (OGC 06-049r1.). The shape value will generally be provided by GIS software, and will need no user input.</td>
    </tr>
    <tr>
        <td colspan="2">Other attribute(s)</td>
        <td>A placeholder allowing any user-defined attributes to be delivered in addition to those specified above.</td>
    </tr>
    </tbody>
</table></div>
<div class="section" id="sheardisplacementstructureview-features">
<span id="service-provision-data-preparation-lite-sheardisplacementstructureview"></span><h4>ShearDisplacementStructureView features<a class="headerlink" href="#sheardisplacementstructureview-features" title="Permalink to this headline">¶</a></h4>
<p>These features represent faults and ductile shear zones. In GeoSciML terms they are instances of MappedFeature with key property values from the associated ShearDisplacementStructure feature summarized in text fields (data type xs:string) and fields containing identifiers (URI) for fault type, deformation style, movement type, geologic age, and a formally-encoded (ideally in GeoSciML) specification for interoperability. The latter are the properties suffixed with ‘_uri’ and will contain URIs referring to other resources, for example controlled concepts in published vocabularies.</p>
<p>The concept of ‘Shear displacement structure’ includes all brittle to ductile style faults or ductile shear zones along which displacement has occurred, from a simple, single ‘planar’ brittle or ductile surface to a fault system comprising multiple strands of both brittle and ductile nature. Because this feature class is constrained to have a linear geometry, it is limited to representing shear displacement structures that are considered single surfaces at the scale of portrayal.</p>
<p><strong>Elements in Shear Displacement Structure View feature</strong></p>
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Notes</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="rqd">identifier</td>
            <td>xs:string</td>
            <td>Globally unique identifier for the individual feature. Recommended practice is that this identifier be derived from the primary key for the spatial objects in the source data in case information needs to be transferred from the interchange format back to the source database. This identifier is analogous to the identifier for a GeoSciML MappedFeature.</td>
        </tr>
        <tr>
            <td>name</td>
            <td>xs:string</td>
            <td>Display name for the ShearDisplacementStructure. This may be a generic fault type, e.g. &#8216;<i>thrust fault</i>&#8217;, &#8216;strike-slip fault</i>&#8217;, or a particular fault name, e.g. &#8216;<i>Moine thrust</i>&#8217;, &#8216;san Andreas Fault</i>&#8217;.</td>
        </tr>
        <tr>
            <td>description</td>
            <td>xs:string</td>
            <td>Text description of the ShearDisplacementStructure, typically taken from an entry on a geological map legend.</td>
        </tr>
        <tr>
            <td>faultType</td>
            <td>xs:string</td>
            <td>Type of ShearDisplacementStructure (as defined in GeoSciML).</td>
        </tr>
        <tr>
            <td>movementType</td>
            <td>xs:string</td>
            <td>Summary of the type of movement (e.g. dip-slip, strike-slip) on the ShearDisplacementStructure.</td>
        </tr>
        <tr>
            <td>deformationStyle</td>
            <td>xs:string</td>
            <td>Description of the style of deformation (e.g. brittle, ductile etc) for the ShearDisplacementStructure.</td>
        </tr>
        <tr>
            <td>displacement</td>
            <td>xs:string</td>
            <td>Text summary of displacement across the ShearDisplacementStructure.</td>
        </tr>
        <tr>
            <td>geologicHistory</td>
            <td>xs:string</td>
            <td>Text (possibly formatted with formal syntax) description of the sequence of events that formed and have affected the ShearDisplacementStructure. Events include process and optional environment information.</td>
        </tr>
        <tr>
            <td>observationMethod</td>
            <td>xs:string</td>
            <td>Metadata snippet indicating how the spatial extent of the feature was determined. ObservationMethod is a convenience property that provides a quick and dirty approach to observation metadata when data are reported using a feature view (as opposed to observation view).</td>
        </tr>
        <tr>
            <td>positionalAccuracy</td>
            <td>xs:string</td>
            <td>Preferred use is a quantitative value defining the radius of an uncertainty buffer around a MappedFeature, e.g. a positionAccuracy of 100 m for a line feature defines a buffer polygon of total width 200 m centered on the line. Some other text description that quantifies position accuracy may be provided, e.g. a term from a controlled vocabulary. Vocabulary used should be described in the dataset metadata.</td>
        </tr>
        <tr>
            <td>source</td>
            <td>xs:string</td>
            <td>Text describing feature specific details and citations to source materials, and if available providing URLs to reference material and publications describing the geologic feature. This could be a short text synopsis of key information that would also be in the metadata record referenced by metadata_uri.</td>
        </tr>
        <tr>
            <td class="rqd">faultType_uri</td>
            <td class="nbtype">xs:string</td>
            <td>URI referring to a controlled concept from a vocabulary defining the fault (ShearDisplacementStructure) type. Mandatory property - if no value is provided then an URI referring to a controlled concept explaining why the value is nil must be provided.</td>
        </tr>
        <tr>
            <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/faulttype</td>
        </tr>
        <tr>
            <td colspan="3" class="INSPIRE">The current INSPIRE specific controlled vocabulary is: http://inspire.ec.europa.eu/codelist/FaultTypeValue/</td>
        </tr>
        <tr>
            <td class="rqd">movementType_uri</td>
            <td class="nbtype">xs:string</td>
            <td>URI referring to a controlled concept from a vocabulary defining the ShearDisplacementStructure movement type. Mandatory property - if no value is provided then an URI referring to a controlled concept explaining why the value is nil must be provided.</td>
        </tr>
        <tr>
            <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/faultmovementtype</td>
        </tr>
        <tr>
            <td colspan="3" class="INSPIRE">There is no INSPIRE specific controlled vocabulary for movement type.</td>
        </tr>
        <tr>
            <td class="rqd">deformationStyle_uri</td>
            <td class="nbtype">xs:string</td>
            <td>URI referring to a controlled concept from a vocabulary defining the ShearDisplacementStructure deformation style. Mandatory property - if no value is provided then an URI referring to a controlled concept explaining why the value is nil must be provided.</td>
        </tr>
        <tr>
            <td colspan="3" class="CGI">Current CGI controlled vocabulary URI stem is: http://resource.geosciml.org/classifier/cgi/deformationstyle<br />for concepts see: http://resource.geosciml.org/vocabulary/cgi/201211/deformationstyle.html</td>
        </tr>
        <tr>
            <td colspan="3" class="INSPIRE">There is no INSPIRE specific controlled vocabulary for deformation style</td>
        </tr>
        <tr>
            <td class="rqd">representativeAge_uri</td>
            <td class="nbtype">xs:string</td>
            <td>URI referring to a controlled concept specifying the most representative stratigraphic age interval for the GeologicUnit. This will be defined entirely at the discretion of the data provider and may be a single event selected from the geologic feature&#8217;s geological history or a value summarizing the all or part of the feature&#8217;s history.</td>
        </tr>
        <tr>
            <td class="rqd">representativeOlderAge_uri</td>
            <td class="nbtype">xs:string</td>
            <td>URI referring to a controlled concept specifying the most representative older value in a range of stratigraphic age intervals for the GeologicUnit. This will be defined entirely at the discretion of the data provider and may be a single event selected from the geologic feature&#8217;s geological history or a value summarizing the all or part of the feature&#8217;s history.</td>
        </tr>
        <tr>
            <td class="rqd">representativeYoungerAge_uri</td>
            <td class="nbtype">xs:string</td>
            <td>URI referring to a controlled concept specifying the most representative younger value in a range of stratigraphic age intervals for the GeologicUnit. This will be defined entirely at the discretion of the data provider and may be a single event selected from the geologic feature&#8217;s geological history or a value summarizing the all or part of the feature&#8217;s history.</td>
        </tr>
        <tr>
            <td colspan="3" class="CGI">Current CGI controlled vocabulary are: http://resource.geosciml.org/classifier/ics/ischart and<br />http://resource.geosciml.org/classifier/cgi/stratchart (for OneGeology-Europe Precambrian Epoch definitions for the Fenno-Scandian Shield)</td>
        </tr>
        <tr>
            <td colspan="3" class="INSPIRE">The current INSPIRE specific controlled vocabulary is: http://inspire.ec.europa.eu/codelist/GeochronologicEraValue/</td>
        </tr>
        <tr>
            <td>numericOlderAge</td>
            <td>xs:double</td>
            <td>Older age in numerical representation in Ma.</td>
        </tr>
        <tr>
            <td>numericYoungerAge</td>
            <td>xs:double</td>
            <td>Younger age in numerical representation in Ma.</td>
        </tr>
        <tr>
            <td>specification_uri</td>
            <td class="nbtype">xs:string</td>
            <td>URI referring to the GeoSciML ShearDisplacementStructure feature that describes the instance in detail. Mandatory property - if no value is provided then an URI referring to a controlled concept explaining why the value is nil must be provided.</td>
        </tr>
        <tr>
            <td>metadata_uri</td>
            <td class="nbtype">xs:string</td>
            <td>URI referring to a metadata record describing the provenance of data.</td>
        </tr>
        <tr>
            <td>genericSymbolizer</td>
            <td>xs:string</td>
            <td>Identifier for a symbol from standard (locally or community defined) symbolization scheme for portrayal.</td>
        </tr>
        <tr>
            <td class="rqd">shape</td>
            <td>GM_Object<br />(GM_curve)</td>
            <td>Geometry defining the extent of the feature of interest.</td>
        </tr>
        <tr>
            <td colspan="2">Other attribute(s)</td>
            <td>A placeholder allowing any user-defined attributes to be delivered in addition to those specified above.</td>
        </tr>
    </tbody>
</table></div>
<div class="section" id="geologicunitview-features">
<span id="service-provision-data-preparation-lite-geologicunitview"></span><h4>GeologicUnitView features<a class="headerlink" href="#geologicunitview-features" title="Permalink to this headline">¶</a></h4>
<p>GeologicUnitView features represent outcrops of a particular geologic unit, typically with polygon geometry. The properties of these features provide a simplified view of information associated with GeoSciML GeologicUnit features. A geologic unit in this context is an identifiable body of material within the Earth. GeologicUnitView features are instances of GeoSciML MappedFeature with property values from the associated GeologicUnit specifier summarized in text fields for human data consumers, and with fields containing standard identifiers for geologic unit type, representative lithology, and geologic age. The specification_uri property identifies a description resource specific to the geologic unit cropping out in the extent of the polygon (or other) geometry of the feature. The specification_uri should dereference to yield a formally-encoded representation of the geologic unit, ideally in GeoSciML for interoperability. Properties populated by identifiers are suffixed with ‘_uri’ and contain URIs referring to other resources, for example controlled concepts in published vocabularies.</p>
<p><strong>Elements in GeologicUnitView feature class</strong></p>
<table>
        <thead>
    <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Notes</th>
    </tr>
</thead>
        <tbody>
                <tr>
        <td class="rqd">identifier</td>
        <td>xs:string</td>
        <td>Globally unique identifier for the individual feature. Recommended practice is that this identifier be derived from the primary key for the spatial objects in the source data in case information needs to be transferred from the interchange format back to the source database. This identifier is analogous to the identifier for a GeoSciML MappedFeature.</td>
    </tr>
                <tr>
        <td>name</td>
        <td>xs:string</td>
        <td>Display name for the GeologicUnit; this can be used to put in a geologic unit name, or more likely an abbreviation used to label outcrops of the unit in a map display.</td>
    </tr>
                <tr>
                        <td>description</td>
                        <td>xs:string</td>
                        <td>Text description of the GeologicUnit, typically taken from an entry on a geological map legend.</td>
                </tr>
                <tr>
                        <td>geologicUnitType</td>
                        <td>xs:string</td>
                        <td>Type of GeologicUnit (as defined in GeoSciML).</td>
                </tr>
                <tr>
                        <td>rank</td>
                        <td>xs:string</td>
                        <td>Stratigraphic rank of GeologicUnit (as defined in GeoSciML). Examples: formation, member, group, supergroup.</td>
                </tr>
                <tr>
                        <td>lithology</td>
                        <td>xs:string</td>
                        <td>Text (possibly formatted with formal syntax) description of the GeologicUnit&#8217;s lithology.</td>
                </tr>
                <tr>
                        <td>geologicHistory</td>
                        <td>xs:string</td>
                        <td>Text (possibly formatted with formal syntax) description of the age of the GeologicUnit (where age is a sequence of events and may include process and environment information).</td>
                </tr>
                <tr>
                        <td>numericOlderAge</td>
                        <td>xs:double</td>
                        <td>Older age in numerical representation in Ma.</td>
                </tr>
                <tr>
                        <td>numericYoungerAge</td>
                        <td>xs:double</td>
                        <td>Younger age in numerical representation in Ma.</td>
                </tr>
                <tr>
                        <td>observationMethod</td>
                        <td>xs:string</td>
                        <td>ObservationMethod is a convenience property to provide observation metadata. Example values might include &#8216;<i>field observation by author</i>&#8217;, &#8216;<i>compilation from published maps</i>&#8217;, &#8216;<i>air photo interpretation</i>&#8217;.</td>
                </tr>
                <tr>
                        <td>positionalAccuracy</td>
                        <td>xs:string</td>
                        <td>Preferred use is a quantitative value defining the radius of an uncertainty buffer around a MappedFeature, e.g. a positionAccuracy of 100 m for a line feature defines a buffer polygon of total width 200 m centered on the line. Some other text description that quantifies position accuracy may be provided, e.g. a term from a controlled vocabulary. Vocabulary used should be described in the dataset metadata. For polygon mapped features this is intended for use to indicate the position uncertainty of the contact and fault features bounding the outcrop polygon, which is only necessary if the associated line features are not included with the polygons.</td>
                </tr>
                <tr>
                        <td>source</td>
                        <td>xs:string</td>
                        <td>Text describing feature specific details and citations to source materials, and if available providing URLs to reference material and publications describing the geologic feature. This could be a short text synopsis of key information that would also be in the metadata record referenced by metadata_uri.</td>
                </tr>
                <tr>
        <td class="rqd">geologicUnitType_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>URI referring to a controlled concept from a vocabulary defining the GeologicUnit types. Mandatory property - if no value is provided then an URI referring to a controlled concept explaining why the value is nil must be provided.</td>
                </tr>
                <tr>
        <td colspan="3" class="CGI">The current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/geologicunittype/</td>
                </tr>
                <tr>
        <td colspan="3" class="INSPIRE">The current INSPIRE specific controlled vocabulary is: http://inspire.ec.europa.eu/codelist/GeologicUnitTypeValue/</td>
                </tr>
                <tr>
        <td class="rqd">representativeLithology_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>URI referring to a controlled concept specifying the characteristic or representative lithology of the unit. This may be a concept that defines the supertype of all lithology values present within a GeologicUnit or a concept defining the lithology of the dominant CompositionPart (as defined in GeoSciML) of the unit. This identifier is intended for use as the symbol key for a lithologic map portrayal of the geologic unit features.</td>
                </tr>
                <tr>
        <td colspan="3" class="CGI">The current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/lithology</td>
                </tr>
                <tr>
        <td colspan="3" class="INSPIRE">The current INSPIRE specific controlled vocabulary is: http://inspire.ec.europa.eu/codelist/LithologyValue/</td>
                </tr>
                <tr>
        <td class="rqd">representativeAge_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>URI referring to a controlled concept specifying the most representative stratigraphic age interval for the GeologicUnit. This will be defined entirely at the discretion of the data provider and may be a single event selected from the geologic feature&#8217;s geological history or a value summarizing all or part of the feature&#8217;s history. This identifier is intended for use as a symbol key for a geologic-age-based portrayal of the geologic unit features.</td>
                </tr>
                <tr>
        <td class="rqd">representativeOlderAge_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>URI referring to a controlled concept specifying the most representative older value in a range of stratigraphic age intervals for the GeologicUnit. This will be defined entirely at the discretion of the data provider and may be a single event selected from the geologic feature&#8217;s geological history or a value summarizing all or part of the feature&#8217;s history.</td>
                </tr>
                <tr>
        <td class="rqd">representativeYoungerAge_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>URI referring to a controlled concept specifying the most representative younger value in a range of stratigraphic age intervals for the GeologicUnit. This will be defined entirely at the discretion of the data provider and may be a single event selected from the geologic feature&#8217;s geological history or a value summarizing all or part of the feature&#8217;s history.</td>
                </tr>
                <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary are: http://resource.geosciml.org/classifier/ics/ischart and<br />http://resource.geosciml.org/classifier/cgi/stratchart (for OneGeology-Europe Precambrian Epoch definitions for the Fenno-Scandian Shield)</td>
                </tr>
                <tr>
        <td colspan="3" class="INSPIRE">The current INSPIRE specific controlled vocabulary is: http://inspire.ec.europa.eu/codelist/GeochronologicEraValue/</td>
                </tr>
                <tr>
                        <td>specification_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>URI for a complete description of the geologic unit cropping out within the extent of the feature&#8217;s geometry. Preferred representation is a GeoSciML GeologicUnit feature instance. Mandatory property - if no value is provided then a nil reason URI explaining why the value is nil must be provided</td>
                </tr>
                <tr>
                        <td>metadata_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>URI referring to a metadata record describing the provenance of data</td>
                </tr>
                <tr>
                        <td>genericSymbolizer</td>
                        <td>xs:string</td>
                        <td>Identifier for a symbol from standard (locally or community defined) symbolization scheme for portrayal</td>
                </tr>
                <tr>
        <td class="rqd">shape</td>
                        <td>GM_Object</td>
                        <td>Geometry defining the extent of the feature of interest</td>
                </tr>
                <tr>
        <td colspan="2">Other attribute(s)</td>
                        <td>A placeholder allowing any user-defined attributes to be delivered in addition to those specified above.</td>
                </tr>
        </tbody>
  </table></div>
<div class="section" id="boreholeview-features">
<span id="service-provision-data-preparation-lite-boreholeview"></span><h4>BoreholeView features<a class="headerlink" href="#boreholeview-features" title="Permalink to this headline">¶</a></h4>
<p>BoreholeView is a simplified view of a GeoSciML Borehole. In GeoSciML terms, this will be an instance of a Borehole feature with key property values summarised as labels (unconstrained character strings) or arbitrarily selected classifiers to be used for thematic mapping purposes. The latter are the properties suffixed with “_uri” and will contain URIs referring to controlled concepts in published vocabularies.</p>
<p><strong>Elements in BoreholeView feature class</strong></p>
<table>
        <thead>
    <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Notes</th>
    </tr>
</thead>
        <tbody>
                <tr>
        <td class="rqd">identifier</td>
        <td>xs:string</td>
        <td>Globally unique identifier for the individual feature. Recommended practice is that this identifier be derived from the primary key for the spatial objects in the source data in case information needs to be transferred from the interchange format back to the source database. This identifier is analogous to the identifier for a GeoSciML MappedFeature.</td>
    </tr>
                <tr>
        <td>name</td>
        <td>xs:string</td>
        <td>Display name for the Borehole.</td>
    </tr>
                <tr>
                        <td>description</td>
                        <td>xs:string</td>
                        <td>Text description of the Borehole</td>
                </tr>
                <tr>
                        <td>purpose</td>
                        <td>xs:string</td>
                        <td>The purpose or purposes for which the borehole was drilled. (e.g., mineral exploration, hydrocarbon exploration, hydrocarbon production, groundwater monitoring, geothermal)</td>
                </tr>
                <tr>
                        <td>status</td>
                        <td>xs:string</td>
                        <td>The current status of the borehole (e.g., abandoned, completed, proposed, suspended)</td>
                </tr>
                <tr>
                        <td>drillingMethod</td>
                        <td>xs:string</td>
                        <td>The drilling method, or methods, used for this borehole (e.g., RAB, auger, diamond core drilling, air core drilling, piston)</td>
                </tr>
                <tr>
                        <td>operator</td>
                        <td>xs:string</td>
                        <td>The organisation or agency responsible for commissioning of the borehole (as opposed to the agency which drilled the borehole)</td>
                </tr>
                <tr>
                        <td>driller</td>
                        <td>xs:string</td>
                        <td>The organisation responsible for drilling the borehole (as opposed to commissioning the borehole)</td>
                </tr>
                <tr>
                        <td>drillStartDate</td>
                        <td class="nbtype">xs:string</td>
                        <td>The date of the start of drilling formatted according to ISO8601 (e.g., 2012-03-17)</td>
                </tr>
                <tr>
                        <td>drillEndDate</td>
                        <td class="nbtype">xs:string</td>
                        <td>The date of the end of drilling formatted according to ISO8601 (e.g., 2012-03-28)</td>
                </tr>
                <tr>
                        <td>startPoint</td>
                        <td>xs:string</td>
                        <td>The position relative to the ground surface where the borehole commenced (e.g., open pit floor or wall, underground, natural land surface, sea floor)</td>
                </tr>
                <tr>
                        <td>inclinationType</td>
                        <td>xs:string</td>
                        <td>The type of inclination of the borehole (e.g., vertical, inclined up, inclined down, horizontal)</td>
                </tr>
                <tr>
        <td>boreholeMaterialCustodian</td>
        <td>xs:string</td>
                        <td>The organisation that is the custodian of the material recovered from the borehole</td>
                </tr>
                <tr>
        <td>boreholeLength_m</td>
        <td>xs:string</td>
                        <td>The length of a borehole, in metres, as determined by the data provider. Length may have different sources (e.g., driller’s measurement, logger’s measurement, survey measurement)</td>
                </tr>
    <tr>
        <td>elevation_m</td>
        <td>xs:string</td>
                        <td>The elevation data, in metres, for the borehole (i.e., wellbore) start point. This is a compromise approach to allow for delivery of legacy 2D data without elevation data, and for software that cannot process a 3D GM_Point</td>
                </tr>
    <tr>
        <td>elevation_srs</td>
        <td>xs:string</td>
                        <td>An URI of a spatial reference system of the elevation value. (e.g., mean sea level). Mandatory if elevation_m is populated. The SRS shall be a one dimensional vertical SRS (i.e., EPSG code in the range 5600-5799),<br/>
        For example: http://www.epsg-registry.org/export.htm?gml=urn:ogc:def:crs:EPSG::5711</td>
                </tr>
    <tr>
        <td>positionalAccuracy</td>
        <td>xs:string</td>
                        <td>An estimate of the accuracy of the location of the borehole collar location.  Ideally, this would be a quantitative estimate of accuracy (e.g., 20 metres)</td>
                </tr>
    <tr>
        <td>source</td>
        <td>xs:string</td>
                        <td> describes details and citations to source materials for the borehole and, if available, providing URLs to reference material and publications describing the borehole. This could be a short text synopsis of key information that would also be in the metadata record referenced by metadata_uri</td>
                </tr>
                <tr>
        <td>parentBorehole_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI referring to one or more representations of a parent borehole (e.g., a parent well of a sidetrack wellbore)<br />If present, parentBorehole_uri SHOULD resolve to a representation of a GeoSciML borehole.<br />
        **If the borehole does not have any parent, this field shall be empty**</td>
                </tr>
                <tr>
                        <td>metadata_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI referring to a metadata record describing the provenance of data</td>
                </tr>
                <tr>
                        <td>genericSymbolizer</td>
                        <td>xs:string</td>
                        <td>Identifier for a symbol from standard (locally or community defined) symbolization scheme for portrayal</td>
                </tr>
                <tr>
        <td class="rqd">shape</td>
                        <td>GM_Object</td>
                        <td>Geometry defining the extent of the feature of interest</td>
                </tr>
                <tr>
        <td colspan="2">Other attribute(s)</td>
                        <td>A placeholder allowing any user-defined attributes to be delivered in addition to those specified above</td>
                </tr>
        </tbody>
  </table></div>
</div>
<div class="section" id="earthresourceml-lite">
<span id="service-provision-data-preparation-lite-earthresourceml"></span><h3>EarthResourceML-Lite<a class="headerlink" href="#earthresourceml-lite" title="Permalink to this headline">¶</a></h3>
<p>EarthResourceML-Lite is a model and schema for simple map services (eg, WMS and WFS Simple Features). It is an abridged version of the full EarthResourceML model and can be used to deliver simplified views on mineral occurrences and their commodities, mines, mining activities and mine waste products.</p>
<p>There are six EarthResourceML-Lite views descibed in the 2.0 standard, these are:  MineView, CommodityResourceView, MineralOccurrenceView, MiningActivityView, MiningWasteView, and ProcessingPlantView.  Below we lay out what is expected of the views for those features we think that many geological survey organizations will be able to support.</p>
<p>For full details of the ERML-Lite schema see: <a class="reference external" href="http://schemas.earthresourceml.org/earthresourceml-lite/2.0/erml-lite.xsd">http://schemas.earthresourceml.org/earthresourceml-lite/2.0/erml-lite.xsd</a></p>
<p>For full documentation of all the views see <a class="reference external" href="http://www.earthresourceml.org/earthresourceml-lite/2.0.1/documentation/">http://www.earthresourceml.org/earthresourceml-lite/2.0.1/documentation/</a></p>
<div class="section" id="mineraloccurrenceview-features">
<span id="service-provision-data-preparation-lite-mineraloccurrenceview"></span><h4>MineralOccurrenceView features<a class="headerlink" href="#mineraloccurrenceview-features" title="Permalink to this headline">¶</a></h4>
<table>
        <thead>
    <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Notes</th>
    </tr>
</thead>
        <tbody>
                <tr>
        <td class="rqd">identifier</td>
        <td>xs:string</td>
        <td>A unique identifier (ideally an URI) to identify this Mineral Occurrence mapped feature</td>
    </tr>
                <tr>
        <td>name</td>
        <td>xs:string</td>
        <td>Name of the Mineral Occurrence, if applicable</td>
    </tr>
                <tr>
                        <td class="rqd">mineralOccurrenceType</td>
                        <td>xs:string</td>
                        <td>The type of mineral occurrence. Examples may include prospect, occurrence, mineral deposit, ore deposit, field, district, lode. Ideally terms should be sourced from the MineralOccurrenceType controlled vocabulary</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/mineral-occurrence-type</td>
                </tr>
                <tr>
                        <td class="rqd">commodity</td>
                        <td>xs:string</td>
                        <td>The commodity or commodities found at an EarthResource. Multiple commodities terms should be concatenated if required. Ideally terms should be sourced from the CommodityCode controlled vocabulary</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/commodity-code</td>
                </tr>
                <tr>
                        <td>mineName</td>
                        <td>xs:string</td>
                        <td>The name of a mine associated with the Mineral Occurrence, if applicable</td>
                </tr>
                <tr>
                        <td>geologicHistory</td>
                        <td>xs:string</td>
                        <td>A brief description of the age and mineralisation history of the mineral occurrence</td>
                </tr>
                <tr>
                        <td>hostGeologicUnit</td>
                        <td>xs:string</td>
                        <td>Name or description of the host geologic unit</td>
                </tr>
                <tr>
                        <td>mineralDepositModel</td>
                        <td>xs:string</td>
                        <td>Systematically arranged information describing the interpreted mineralisation model or classification for the mineral occurrence. Ideally, terms should be sourced from a controlled vocabulary. May be empirical (descriptive) or theoretical (genetic). (eg, Porphyry Cu, IOCG, VHMS, Epithermal vein)</td>
                </tr>
                <tr>
                        <td>mineralOccurrenceShape</td>
                        <td>xs:string</td>
                        <td>Shape of the mineral occurrence (eg, lenticular, pipe, tabular). Ideally terms should be sourced from the EarthResourceShape controlled vocabulary</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/earth-resource-shape</td>
                </tr>
                <tr>
                        <td>explorationActivityType</td>
                        <td>xs:string</td>
                        <td>The type of exploration activity eg, geological mapping, drilling, geophysical surveys, geochemical mapping. Ideally terms should be sourced from the ExplorationActivityType controlled vocabulary</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/exploration-activity-type</td>
                </tr>
                <tr>
                        <td>explorationActivityDuration</td>
                        <td>xs:string</td>
                        <td>Period, or extent in time, of any exploration activity. eg; 1987-1989</td>
                </tr>
                <tr>
                        <td>explorationResult</td>
                        <td>xs:string</td>
                        <td>The result of the exploration activity eg, mineralised zone identified, geochemical anomaly. Ideally terms should be sourced from the ExplorationResult controlled vocabulary</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/exploration-result</td>
                </tr>
                <tr>
        <td>observationMethod</td>
        <td>xs:string</td>
                        <td>Description of the method that was used to identify the location of the Mineral Occurrence. Ideally terms should be sourced from the FeatureObservationMethod controlled vocabulary</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/mappedfeatureobservationmethod</td>
                </tr>
                <tr>
        <td>positionalAccuracy</td>
        <td>xs:string</td>
                        <td>Text description of the accuracy of the feature location. (eg, accurate, approximate, diagrammatic, indefinite, unknown, 5 metres, 1 kilometre)</td>
                </tr>
    <tr>
        <td>source</td>
        <td>xs:string</td>
                        <td>A reference for the source(s) of information for the Mineral Occurrence</td>
                </tr>
    <tr>
        <td class="rqd">mineralOccurrenceType_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify the commodity. Ideally should link to the CommodityCode controlled vocabulary term</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/mineral-occurrence-type</td>
                </tr>
    <tr>
        <td class="rqd">representativeCommodity_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify the major commodity or commodity group for the Mineral Occurrence. Ideally should link to the CommodityCode controlled vocabulary</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/commodity-code</td>
                </tr>
    <tr>
        <td>mine_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify an associated Mine.</td>
                </tr>
                <tr>
        <td>hostGeologicUnit_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify the host geologic unit. Ideally, a link to a GeoSciML GeologicUnit or GeologicUnitView. feature</td>
                </tr>
                <tr>
                        <td>mineralDepositModel_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify the interpreted mineral deposit model classification for the mineral occurrence. Should link to a controlled vocabulary term</td>
                </tr>
                <tr>
                        <td>representativeAge_uri</td>
                        <td class="nbtype">xs:string</td>
                        <td>An URI referring to a GeologicalTimescale controlled concept specifying the most representative geologic age interval for the mineralisation. This will be defined entirely at the discretion of the data provider and may be a single event selected from the mineral occurrence's geologic history or a value summarising the all or part of its history</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/ics/ischart</td>
                </tr>
    <tr>
                        <td>representativeOlderAge_uri</td>
                        <td class="nbtype">xs:string</td>
                        <td>An URI referring to a GeologicalTimescale controlled concept specifying the oldest interpreted age limit for the mineralisation</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/ics/ischart</td>
                </tr>
    <tr>
                        <td>representativeYoungerAge_uri</td>
                        <td class="nbtype">xs:string</td>
                        <td>An URI referring to a GeologicalTimescale controlled concept specifying the youngest interpreted age limit for the mineralisation</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/ics/ischart</td>
                </tr>
    <tr>
                        <td>specification_uri</td>
                        <td class="nbtype">xs:string</td>
                        <td>An URI to identify a full EarthResourceML description of the Mineral Occurrence feature</td>
                </tr>
                <tr>
        <td class="rqd">shape</td>
                        <td>gml:GeometryPropertyType</td>
                        <td>Geometry defining the location or extent of the mineral occurrence. Only one geometry type may be used in a single MineralOccurrenceView feature service</td>
                </tr>
                <tr>
        <td colspan="2">Other attribute(s)</td>
                        <td>A placeholder allowing any user-defined attributes to be delivered in addition to those specified above</td>
                </tr>
        </tbody>
  </table></div>
<div class="section" id="commodityresourceview-features">
<span id="service-provision-data-preparation-lite-commodityresourceview"></span><h4>CommodityResourceView features<a class="headerlink" href="#commodityresourceview-features" title="Permalink to this headline">¶</a></h4>
<table>
        <thead>
    <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Notes</th>
    </tr>
</thead>
        <tbody>
                <tr>
        <td class="rqd">identifier</td>
        <td>xs:string</td>
        <td>A unique identifier (ideally an URI) to identify this Commodity Resource mapped feature</td>
    </tr>
                <tr>
        <td class="rqd">commodity</td>
        <td>xs:string</td>
        <td>A commodity found in an EarthResource. Other commodity values at the EarthResource should be listed in separate instances. Ideally terms should be sourced from the CommodityCode controlled vocabulary.</td>
    </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/commodity-code</td>
                </tr>
                <tr>
                        <td>commodityRank</td>
                        <td>xs:string</td>
                        <td>The importance of a commodity compared to other commodities that occur in the mineral deposit. Several commodities may be of interest in a deposit. This classification is based on the potential or endowment: reserves + resources. eg 'primary commodity', 'secondary commodity', 'by-product'</td>
                </tr>
                <tr>
                        <td>commodityImportance</td>
                        <td>xs:string</td>
                        <td>The size ranking of the commodity resource in comparison to the worldwide distribution of mineral deposits. Commodity rank is based on the total endowment in an EarthResource, i.e. (cumulated) past production + reserves (not including past production) + resources, or if the deposit has never been exploited, reserves + resources. A statistical comparison with a large set of deposits throughout the world enables the determination of the deposit as class A (very large), B (large), or C (medium-sized) for a particular commodity. The rank of a commodity resource is thus not based on political or economic considerations</td>
                </tr>
                <tr>
                        <td>mineralOccurrenceName</td>
                        <td>xs:string</td>
                        <td>Name of an associated mineral occurrence</td>
                </tr>
                <tr>
                        <td>mineName</td>
                        <td>xs:string</td>
                        <td>The name of a mine associated with the commodity resource, if applicable</td>
                </tr>
                <tr>
                        <td>totalEndowment</td>
                        <td>xs:string</td>
                        <td>Endowment refers to that quantity of a mineral in accumulations (deposits) meeting specified physical characteristics such as quality, size and depth. Usually includes all resources and reserves, as a commodity's total endowment does not have to have prospects for eventual economic extraction. It includes the total amount of a commodity originally introduced to a particular location during the deposit forming processes - and thus can include resources, reserves, past production and mining and metallurgical losses. Text string datatype so units of measure can be included in value. eg, 1.57 Mt @ 3.0 g/t Au</td>
                </tr>
                <tr>
                        <td>totalReserves</td>
                        <td>xs:string</td>
                        <td>The economically mineable part of a Measured and/or Indicated mineral resource. It includes diluting materials and allowances for losses, which may occur when the material is mined. ‘Marketable Coal Reserves’ maybe reported in conjunction with, but not instead of, reports of Ore (Coal) Reserves. ‘Saleable product’ (e.g. for industrial minerals) can be reported in conjunction with ore reserve. Synonyms: Ore Reserve; Coal Reserve (s); Diamond (or gemstone) Ore Reserve; Mineral Reserves (not preferred, should be stated that used to mean the same as JORC’s Ore Reserve); Mineable production estimates. Text string data type so units of measure can be included in value. eg, 1.23 Mt @ 3.0 g/t Au</td>
                </tr>
                <tr>
                        <td>reservesCategory</td>
                        <td>xs:string</td>
                        <td>The category of reserves (eg, measured, indicated). Should be a EarthResourceReserveCategory controlled vocabulary term</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/reserve-assessment-category</td>
                </tr>
                <tr>
                        <td>totalResources</td>
                        <td>xs:string</td>
                        <td>Total amount and grade of a concentration or occurrence of material of intrinsic economic interest in or on the Earth's crust in such form, quality and quantity that there are reasonable prospects for eventual economic extraction. eg, 1.57 Mt @ 3.0 g/t Au</td>
                </tr>
                <tr>
                        <td>resourcesCategory</td>
                        <td>xs:string</td>
                        <td>The category of resources (eg, indicated, inferred). Should be a EarthResourceResourceCategory controlled vocabulary term.</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/resource-assessment-category</td>
                </tr>
                <tr>
                        <td>classificationMethodUsed</td>
                        <td>xs:string</td>
                        <td>The classification method used to calculate the measurement of ore. Should be a MineralResourceReportingClassificationMethod controlled vocabulary term</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/classification-method-used</td>
                </tr>
                <tr>
        <td>observationMethod</td>
        <td>xs:string</td>
                        <td>Description of the method that was used to identify the location of the commodity occurrence. Ideally, terms should be sourced from a controlled vocabulary. (eg, global positioning system, published map, field observation, downhole survey, aerial photography, field survey).</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/mappedfeatureobservationmethod</td>
                </tr>
                <tr>
        <td>positionalAccuracy</td>
        <td>xs:string</td>
                        <td>Text description of the accuracy of the feature location. (eg, accurate, approximate, diagrammatic, indefinite, unknown, 5 metres, 1 kilometre)</td>
                </tr>
    <tr>
        <td>source</td>
        <td>xs:string</td>
                        <td>A reference for the source(s) of information for the commodity description.</td>
                </tr>
    <tr>
        <td class="rqd">commodityClassifier_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify the commodity. Ideally should link to the CommodityCode controlled vocabulary term</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/commodity-code</td>
                </tr>
    <tr>
        <td>mineralOccurrence_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify an associated Mineral Occurrence</td>
                </tr>
    <tr>
        <td>mine_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify an associated Mine.</td>
                </tr>
                <tr>
        <td>reservesCategory_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify the reserve category. Should link to a EarthResourceReserveCategory controlled vocabulary term</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/reserve-assessment-category</td>
                </tr>
                <tr>
                        <td>resourcesCategory_uri</td>
        <td class="nbtype">xs:string</td>
                        <td>An URI to identify the resource category. Should link to a EarthResourceQuantityAssessmentCategory controlled vocabulary term</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/resource-assessment-category</td>
                </tr>
                <tr>
                        <td>classificationMethodUsed_uri</td>
                        <td class="nbtype">xs:string</td>
                        <td>An URI to identify the classification method used to calculate the measurement of ore. Should link to a MineralResourceReporting ClassificationMethod controlled vocabulary term</td>
                </tr>
    <tr>
        <td colspan="3" class="CGI">Current CGI controlled vocabulary is: http://resource.geosciml.org/classifier/cgi/classification-method-used</td>
                </tr>
    <tr>
                        <td>specification_uri</td>
                        <td class="nbtype">xs:string</td>
                        <td>An URI to identify a full EarthResourceML description of the commodity resource feature</td>
                </tr>
                <tr>
        <td class="rqd">shape</td>
                        <td>gml:GeometryPropertyType</td>
                        <td>Geometry defining the location or extent of the commodity resource. Only one geometry type may be used in a single CommodityResourceView feature service</td>
                </tr>
                <tr>
        <td colspan="2">Other attribute(s)</td>
                        <td>A placeholder allowing any user-defined attributes to be delivered in addition to those specified above</td>
                </tr>
        </tbody>
  </table></div>
</div>
</div>
<div class="section" id="complex-feature-data">
<span id="service-provision-data-preparation-complex"></span><h2>Complex Feature Data<a class="headerlink" href="#complex-feature-data" title="Permalink to this headline">¶</a></h2>
<p>GeoSciML is an application-neutral encoding format for geosciences information. It is based on Geography Markup Language v3.2 (GML) (ISO 19136:2007) for representation of features and geometry. GeoSciML was developed by the CGI (Commission for the Management and Application of Geoscience Information), a Commission of the International Union of Geological Sciences (IUGS). Following a memorandum of understanding between IUGS and the Open Geospatial Consortium (OGC), GeoSciML v4.1 was published in 2017 as an OGC standard (<a class="reference external" href="http://www.opengeospatial.org/standards/geosciml">http://www.opengeospatial.org/standards/geosciml</a>). Future releases will be managed by the OGC GeoSciML Standards Working Group (SWG).</p>
<p>GeoSciML has a wide scope allowing the encoding of most information depicted on geological maps, as well as information about boreholes and laboratory analyses. This cookbook, however, concentrates on just those parts of GeoSciML necessary for (i) encoding the INSPIRE Geology application schema and (ii) delivering geological age and lithology information through OneGeology  services.</p>
<p>The INSPIRE geology data specification (D2.8.II.4 Data Specification on Geology –
Draft Technical Guidelines) describes the geological information that needs to
be made available through INSPIRE conformant web services. INSPIRE services can
be encoded using GeoSciML v4.1 in order to achieve maximum global
interoperability and to enable the INSPIRE geology data specification to be
extended to include other geosciences information. A mapping between the INSPIRE
specification and GeoSciML v4.1 is given in Annex 1. Note that the INSPIRE
Geology Data Specification also includes application schema for hydrogeology
and geophysics which are not covered by this cookbook.</p>
<p>Geological age and lithology are used as the basis for querying and portrayal in
OneGeology and this cookbook covers the parts of GeoSciML required to be
delivered as part of a 5 star OneGeology service.</p>
<p>To facilitate semantic interoperability it is important to use shared vocabularies. The CGI has developed suitable vocabularies for many GeoSciML properties and these are available from the GeoSciML resources website (<a class="reference external" href="http://resource.geosciml.org/">http://resource.geosciml.org/</a>). For INSPIRE the vocabularies that must be used are included in the data specification and are available from the INSPIRE registry (<a class="reference external" href="http://inspire.ec.europa.eu/registry/">http://inspire.ec.europa.eu/registry/</a>). The OneGeology portal can query services using either CGI or INSPIRE vocabularies.Both sets of vocabularies use http URIs as concept identifiers.</p>
<p>This cookbook is designed to assist users map their data to the GeoSciML data model. In most cases users with digital geoscience data will have their own formalised model of some type, although this will not always be the case. Where a formalised user data model exists then the process of mapping data to GeoSciML will largely involve mapping features/entities in the user model to their equivalents in the GeoSciML logical data model. Where no such user model exists then mapping must be carried out direct from the data.</p>
<p>To carry out the mapping, from either a model or direct from data, requires staff with geoscientific knowledge, familiarity with the user’s own data and data model, and an understanding of the UML formalisation used in documenting GeoSciML. These staff are likely to be geoscientists, possibly those who were involved in developing the organisation’s own data model, and it is these people who are seen as the main users of this cookbook.</p>
<p>Materials and documentation on GeoSciML have been produced by the CGI  and OGC and are available “as is” for download from <a class="reference external" href="http://www.geosciml.org/">http://www.geosciml.org/</a> and <a class="reference external" href="http://www.opengeospatial.org/standards/geosciml">http://www.opengeospatial.org/standards/geosciml</a>.</p>
<p>The supporting materials most relevant to this cookbook include:</p>
<ul class="simple">
<li><p>Full documentation of the GeoSciML model. This is generated automatically from the GeoSciML UML diagrams and draws on the scope notes in those diagrams. This full documentation, however, does not include any best practice guidance</p></li>
<li><p>An Enterprise Architect version of the UML for the CGI packages</p></li>
<li><p>GeoSciML examples</p></li>
</ul>
<p>There are also XML Schema documents which enable validation of the GeoSciML instance documents that you produce from your mapped data. These are listed at <a class="reference external" href="http://schemas.opengis.net/gsml/4.1/">http://schemas.opengis.net/gsml/4.1/</a>. For the parts covered by this cookbook you will need <a class="reference external" href="http://schemas.opengis.net/gsml/4.1/geoSciMLBasic.xsd">http://schemas.opengis.net/gsml/4.1/geoSciMLBasic.xsd</a> and, if you are providing borehole data, <a class="reference external" href="http://schemas.opengis.net/gsml/4.1/borehole.xsd">http://schemas.opengis.net/gsml/4.1/borehole.xsd</a>. You can also find some Schematron files which provide extra validation for the INSPIRE profile of GeoSciML. <a class="reference external" href="http://schemas.geosciml.org/geosciml/4.1/geoSciMLBasic_inspire_mandatory.sch">http://schemas.geosciml.org/geosciml/4.1/geoSciMLBasic_inspire_mandatory.sch</a> checks that all properties required by INSPIRE have been provided and <a class="reference external" href="http://schemas.geosciml.org/geosciml/4.1/geoSciML_inspire_vocabularies.sch">http://schemas.geosciml.org/geosciml/4.1/geoSciML_inspire_vocabularies.sch</a> checks that the appropriate INSPIRE vocabulary terms have been used.</p>
<p>There are six packages in GeoSciML. Two are required for INSPIRE services: GeoSciML-Basic and Borehole. Only GeoSciML-Basic is required for a 5 star OneGeology service. This section will describe those parts of these packages which are the minimum requirement for conformance with the INSPIRE geology application schema. The parts required for a One Geology service are a subset of the INSPIRE ones and are highlighted as they are covered.</p>
<p>In GeoSciML most properties are optional. For a
OneGeology service you may decide whether to omit or include properties that
are not specified below as required. If you wish to provide explicit reasons
for some missing values you can include the relevant property, add an
xsi:nil=”true” attribute and use a nilReason attribute to specify the
reason the value is not being supplied. Unless your service is also an INSPIRE
service, one of the nilReasons defined in ISO 19136:2007 section 8.2.3.1 should
be used:</p>
<ul class="simple">
<li><p><strong>inapplicable</strong> - there is no value</p></li>
<li><p><strong>missing</strong> - the correct value is not readily available to the sender of this data. Furthermore, a correct value may not exist</p></li>
<li><p><strong>template</strong> - the value will be available later</p></li>
<li><p><strong>unknown</strong> - the correct value is not known to, and not computable by, the sender of this data. However, a correct value probably exists</p></li>
<li><p><strong>withheld</strong> - the value is not divulged</p></li>
</ul>
<p>However, for INSPIRE services all attributes in the
data specification should be provided. ‘Voidable’ does not mean ‘optional’ in
INSPIRE. Where no value is provided for an INSPIRE voidable attribute then a nilReason
must be provided. One of the nilReasons defined in the INSPIRE <a class="reference external" href="http://inspire.ec.europa.eu/codelist/VoidReasonValue/">VoidReasonValue</a>
codelist should be used:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unpopulated">http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unpopulated</a> - The characteristic is not part of the dataset maintained by the data provider. However, the characteristic may exist in the real world.</p></li>
<li><p><a class="reference external" href="http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unknown">http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unknown</a> - the correct value for the specific spatial object is not known to, and not computable by, the data provider. However, a correct value may exist.</p></li>
<li><p><a class="reference external" href="http://inspire.ec.europa.eu/codelist/VoidReasonValue/Withheld">http://inspire.ec.europa.eu/codelist/VoidReasonValue/Withheld</a> - the characteristic may exist, but it is confidential and not divulged by the data provider.</p></li>
</ul>
<p>This doesn’t apply to attributes that exist in
GeoSciML but that aren’t part of the INSPIRE data specification. Where no value
is provided for these they may have any nilReason permitted by GeoSciML or may
simply be omitted if permitted by GeoSciML. Figure 1 shows examples of how to provide nil
values.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlb:geologicUnitType</span> <span class="na">xsi:nil=</span><span class="s">&quot;true&quot;</span> <span class="na">nilReason=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unknown&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;gsmlb:rank</span> <span class="na">xsi:nil=</span><span class="s">&quot;true&quot;</span> <span class="na">nilReason=</span><span class="s">&quot;inapplicable&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Figure 1 Examples of encoding nil values</p>
<p>As GeoSciML is a GML schema all objects must have a
value for the mandatory gml:id attribute. This provides an identifier for the
XML element representing the object, and must be unique within the XML
document. XML elements representing a particular object, for example a specific
GeologicUnit, need only be described once in the document. Subsequent
occurrences can reference the element using the gml:id. The gml:id attribute
should not be used for the global identifier of the object, it is simply an
identifier within the XML document.</p>
<p>Vocabulary concepts should be encoded by reference.
This enables information about the concept, such as a full description, to be
accessed from the relevant vocabulary service. The general pattern is that the
href attribute provides the URI of the concept and the title attribute provides
a human readable label for it.</p>
<p>An example of encoding the INSPIRE Geology application
schema in GeoSciML is given in Annex 2. This example is structured as a GeologicCollection
with one of each type of INSPIRE feature included. It is designed to illustrate
GeoSciML encoding rather than illustrate what a real INSPIRE service might look
like.</p>
<p>An example of a response that would be suitable for a
OneGeology 5 star WFS is given in Annex 3.</p>
<div class="section" id="mapped-feature-and-geologic-feature">
<h3>Mapped Feature and Geologic Feature<a class="headerlink" href="#mapped-feature-and-geologic-feature" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id95">
<img alt="_images/image001.jpg" src="_images/image001.jpg" />
<p class="caption"><span class="caption-text">Figure 2: INSPIRE UML class diagram for GeologicFeature, MappedFeature, GeologicEvent and ThematicClass</span><a class="headerlink" href="#id95" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id96">
<img alt="_images/image002.jpg" src="_images/image002.jpg" />
<p class="caption"><span class="caption-text">Figure 3: UML context diagram for GeoSciML GeologicFeature</span><a class="headerlink" href="#id96" title="Permalink to this image">¶</a></p>
</div>
<p>The INSPIRE UML class diagram for GeologicFeature, MappedFeature, GeologicEvent and ThematicClass is shown in Figure 2 and the UML of the equivalent GeoSciML classes in Figure 3.</p>
<p>The MappedFeature and GeologicFeature objects are at the core of GeoSciML. A MappedFeature can be considered an occurrence, such as a polygon on a geologic map, of a real world GeologicFeature the full extent of which is unknown. It is independent of geometry, so the same GeologicFeature can have different MappedFeature instances, representing mapped polygons at different scales or a modelled volume for example. Each MappedFeature, however, can be specified by only one GeologicFeature. The specification association, from MappedFeature to GeologicFeature, is required by INSPIRE. An INSPIRE service provides a collection of MappedFeatures. A OneGeology service provides a collection of MappedFeatures specified by GeologicUnit features.</p>
<p>GeologicFeature is the abstract parent class for GeologicUnit, GeologicStructure, GeomorphologicFeature and GeologicEvent. This section will describe those properties which apply to all GeologicFeatures, but these will always be encoded as part of one of the specialist child classes. The INSPIRE GeologicFeature class has two associations, themeClass and geologicHistory. The themeClass association should be encoded using the GeoSciML classifier association, which will be explained in section 2.6, and geologicHistory should be encoded using the GeoSciML geologicHistory property which has GeologicEvent values, explained in section 2.2.</p>
<div class="section" id="mapped-feature-mapping-frame">
<h4>Mapped Feature - mapping frame<a class="headerlink" href="#mapped-feature-mapping-frame" title="Permalink to this headline">¶</a></h4>
<p>The INSPIRE
mappingFrame property is equivalent to the GeoSciML mappingFrame. Each
MappedFeature has a mappingFrame property constrained by a vocabulary term that
indicates the spatial reference frame within which the MappedFeatures have been
observed, such as a surface of mapping. Values should be drawn from the
MappingFrameValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/MappingFrameValue">http://inspire.ec.europa.eu/codelist/MappingFrameValue</a>). At
the time of writing an equivalent CGI vocabulary has been drafted but not yet
published.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlb:mappingFrame</span>
  <span class="na">xlink:href=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/MappingFrameValue/topOfBedrock&quot;</span>
  <span class="na">xlink:title=</span><span class="s">&quot;top of bedrock&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Figure 4: Example of the encoding of sampling frame</p>
</div>
<div class="section" id="mapped-feature-geometry-shape">
<h4>Mapped Feature - geometry (shape)<a class="headerlink" href="#mapped-feature-geometry-shape" title="Permalink to this headline">¶</a></h4>
<p>The geometry of each MappedFeature is provided by the shape association to GM_Object. Figure 5 gives an example of encoding a polygon. This property is (obviously) required for a OneGeology service and should have Polygon values.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlb:shape&gt;</span>
     <span class="nt">&lt;gml:Polygon</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::4326&quot;</span> <span class="na">gml:id=</span><span class="s">&quot;LOCAL_ID_0&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;gml:exterior&gt;</span>
             <span class="nt">&lt;gml:LinearRing&gt;</span>
                 <span class="nt">&lt;gml:posList</span> <span class="na">srsDimension=</span><span class="s">&quot;2&quot;</span> <span class="na">count=</span><span class="s">&quot;8&quot;</span><span class="nt">&gt;</span>55.0760921318516
-3.31719604609088 55.0833753209835 -3.31853455922777 55.0825574334633
-3.31921378657955 55.0801997429522 -3.31978309699423 55.0768616358466
-3.3194575613054 55.0741365291192 -3.31966903508197 55.0756843873373
-3.31747948721346 55.0760921318516 -3.31719604609088<span class="nt">&lt;/gml:posList&gt;</span>
              <span class="nt">&lt;/gml:LinearRing&gt;</span>
          <span class="nt">&lt;/gml:exterior&gt;</span>
      <span class="nt">&lt;/gml:Polygon&gt;</span>
  <span class="nt">&lt;/gsmlb:shape&gt;</span>
</pre></div>
</div>
<p>Figure 5: Example of the encoding of MappedFeature geometry (shape)</p>
</div>
<div class="section" id="geologic-feature-inspireid">
<h4>Geologic Feature - inspireId<a class="headerlink" href="#geologic-feature-inspireid" title="Permalink to this headline">¶</a></h4>
<p>The INSPIRE inspireId
property is of type Identifier and provides the persistent identifier used for
the object by the data provider, for example the code from a stratigraphic
lexicon in the case of a GeologicUnit. In GeoSciML this should be encoded using
gml:identifier which requires both the identifier value, equivalent to
Identifier.localId, and the codespace, equivalent to Identifier.namespace,
identifying the data source (Figure 6).</p>
</div>
<div class="section" id="geologic-feature-name">
<h4>Geologic Feature - name<a class="headerlink" href="#geologic-feature-name" title="Permalink to this headline">¶</a></h4>
<p>The INSPIRE name property
provides the name of the GeologicFeature, for example the expansion of the code
provided by inspireId. It should be encoded using gml:name (Figure 6). If the feature does not have a name use “Unnamed feature”.</p>
<p>Figure 6:
Example of the encoding of identifier and name for a GeologicUnit</p>
</div>
</div>
<div class="section" id="geologic-age">
<h3>Geologic Age<a class="headerlink" href="#geologic-age" title="Permalink to this headline">¶</a></h3>
<p>In INSPIRE the geologicHistory association
from GeologicFeature to GeologicEvent is the way in which geologic age is
described (Figure 2). This applies to
all types of GeologicFeature: GeologicUnit, GeologicStructure and
GeomorphologicFeature. In GeoSciML age is modeled similarly, although
GeologicEvent is itself a type of GeologicFeature and may have further
geologicHistory properties. At least one GeologicEvent needs to be provided per
GeologicUnit. The OneGeology Portal has a query tool which will retrieve units
of a specified age or ages. The interpretation of the results of this particular
query tool will be clear if you were to provide only a single GeologicEvent for
each GeologicUnit and consider this event represents the formation of the unit.</p>
<div class="figure align-default" id="id97">
<img alt="_images/image003.jpg" src="_images/image003.jpg" />
<p class="caption"><span class="caption-text">Figure 7: UML summary diagram for GeoSciML GeologicEvent</span><a class="headerlink" href="#id97" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="geologic-event-name">
<h4>Geologic Event - name<a class="headerlink" href="#geologic-event-name" title="Permalink to this headline">¶</a></h4>
<p>The INSPIRE name property
provides the name of the GeologicEvent, for example ‘Hercynian Orogeny’. Only
major events such as orogenies are likely to have names and other events should
be recorded as ‘Unnamed event’. The field should be encoded using gml:name.</p>
</div>
<div class="section" id="geologic-event-youngernamedage-and-oldernamedage">
<h4>Geologic Event - youngerNamedAge and olderNamedAge<a class="headerlink" href="#geologic-event-youngernamedage-and-oldernamedage" title="Permalink to this headline">¶</a></h4>
<p>In INSPIRE it is necessary to
provide geologic age expressed using a geochronologic era defined according to
a geologic time scale. Geochronologic era names must be drawn from the GeochronologicEraValue
vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/GeochronologicEraValue">http://inspire.ec.europa.eu/codelist/GeochronologicEraValue</a>), which is based on the International Commission for
Stratigraphy (ICS) international stratigraphic chart supplemented with a more
detailed chronology for parts of the Precambrian and Quaternary. Both the
olderNamedAge and the youngerNamedAge attributes should be populated, giving
the age of the start and end of the GeologicEvent respectively. It may be that the
GeologicEvent age is fully enclosed by a single geochronologic era, in which
case the olderNamedAge and the youngerNamedAge attributes should both be
populated with the same value.</p>
<p>These properties are required
for OneGeology services. If the service is not also an INSPIRE service the
values must be drawn from  the CGI vocabulary <a class="reference external" href="http://resource.geosciml.org/classifier/ics/ischart/Eras">http://resource.geosciml.org/classifier/ics/ischart/Eras</a>
which is based on the International Commission
for Stratigraphy (ICS) international stratigraphic chart or the supplement <a class="reference external" href="http://resource.geosciml.org/vocabulary/timescale/1GE_PCExtension.rdf">http://resource.geosciml.org/vocabulary/timescale/1GE_PCExtension.rdf</a>
which contains a more detailed chronology for parts of the Precambrian.</p>
</div>
<div class="section" id="geologic-event-eventprocess">
<h4>Geologic Event - eventProcess<a class="headerlink" href="#geologic-event-eventprocess" title="Permalink to this headline">¶</a></h4>
<p>The eventProcess property
describes one or more processes that took place during the event to modify the
related GeologicFeature. For an INSPIRE service it should be encoded using
terms drawn from the EventProcessValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/EventProcessValue">http://inspire.ec.europa.eu/codelist/EventProcessValue</a>). If it is provided for a non-INSPIRE OneGeology
service the CGI Event process vocabulary (<a class="reference external" href="http://resource.geosciml.org/classifier/cgi/eventprocess">http://resource.geosciml.org/classifier/cgi/eventprocess</a>)
should be used.</p>
</div>
<div class="section" id="geologic-event-eventenvironment">
<h4>Geologic Event - eventEnvironment<a class="headerlink" href="#geologic-event-eventenvironment" title="Permalink to this headline">¶</a></h4>
<p>The eventEnvironment property
describes the environment within which the event took place. It is of type ‘Category’ which
provides the resolvable URI for the vocabulary containing the eventEnvironment
concepts in the codeSpace attribute, the URI identifier for the
eventEnvironment concept in the identifier attribute, and a human readable
version of the concept in the label attribute. For an INSPIRE service the
codeSpace should have the URI for the
EventEnvironmentValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/EventEnvironmentValue">http://inspire.ec.europa.eu/codelist/EventEnvironmentValue</a>) and the values in the identifier should be taken
from this vocabulary. If it is provided for a non-INSPIRE OneGeology service values
from the CGI Event environment vocabulary (<a class="reference external" href="http://resource.geosciml.org/classifier/cgi/eventenvironment">http://resource.geosciml.org/classifier/cgi/eventenvironment</a>)
should be used for identifier and the URI <a class="reference external" href="http://resource.geosciml.org/classifierscheme/cgi/2016.01/eventenvironment">http://resource.geosciml.org/classifierscheme/cgi/2016.01/eventenvironment</a> for the codeSpace.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlb:eventEnvironment&gt;</span>
 <span class="nt">&lt;swe:Category</span>
  <span class="na">definition=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/EventEnvironmentValue&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;swe:identifier&gt;</span>http://inspire.ec.europa.eu/codelist/EventEnvironmentValue/riverPlainSystemSetting<span class="nt">&lt;/swe:identifier&gt;</span>
  <span class="nt">&lt;swe:label&gt;</span>river plain system setting<span class="nt">&lt;/swe:label&gt;</span>
  <span class="nt">&lt;swe:codeSpace</span>
   <span class="na">xlink:href=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/EventEnvironmentValue&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/swe:Category&gt;</span>
<span class="nt">&lt;/gsmlb:eventEnvironment&gt;</span>
</pre></div>
</div>
<p>Figure 8: Example of encoding eventEnvironment</p>
</div>
</div>
<div class="section" id="geologic-unit-and-earth-material">
<h3>Geologic Unit and Earth Material<a class="headerlink" href="#geologic-unit-and-earth-material" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id98">
<img alt="_images/image004.jpg" src="_images/image004.jpg" />
<p class="caption"><span class="caption-text">Figure 9: INSPIRE UML class diagram for GeologicUnit</span><a class="headerlink" href="#id98" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id99">
<img alt="_images/image005.jpg" src="_images/image005.jpg" />
<p class="caption"><span class="caption-text">Figure 10: UML context diagram for GeoSciML GeologicUnit</span><a class="headerlink" href="#id99" title="Permalink to this image">¶</a></p>
</div>
<p>The INSPIRE UML class diagram
for GeologicUnit is shown in Figure 9 and the UML of the GeoSciML GeologicUnit package in Figure 10. GeologicUnit is a specialisation of GeologicFeature.  In INSPIRE only the geologicUnitType property is required, along with the
association to compositionPart, and as can be seen this is modelled in an
identical way in GeoSciML.</p>
<div class="section" id="geologic-unit-geologic-unit-type">
<h4>Geologic Unit - geologic unit type<a class="headerlink" href="#geologic-unit-geologic-unit-type" title="Permalink to this headline">¶</a></h4>
<p>The only GeologicUnit attribute that is mandatory for
INSPIRE is geologicUnitType. This indicates the type of the geologic unit, for
example a lithostratigraphic unit or a lithologic unit. Values must be drawn
from the GeologicUnitTypeValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/GeologicUnitTypeValue">http://inspire.ec.europa.eu/codelist/GeologicUnitTypeValue</a>). If
it is provided for a non-INSPIRE OneGeology service the CGI Geologic unit type
vocabulary (<a class="reference external" href="http://resource.geosciml.org/classifier/cgi/geologicunittype">http://resource.geosciml.org/classifier/cgi/geologicunittype</a>)
should be used.</p>
</div>
<div class="section" id="geologic-unit-composition">
<h4>Geologic Unit - composition<a class="headerlink" href="#geologic-unit-composition" title="Permalink to this headline">¶</a></h4>
<p>The composition association from GeologicUnit to
CompositionPart provides the means for describing the lithology of the
GeologicUnit. In INSPIRE a GeologicUnit must have at least one CompositionPart,
but can have several where the GeologicUnit is composed of several different
lithologies. For each CompositionPart values for three attributes must be
provided: role, material and proportion. The requirements are the same for a
OneGeology service.</p>
</div>
<div class="section" id="composition-part-role">
<h4>Composition Part - role<a class="headerlink" href="#composition-part-role" title="Permalink to this headline">¶</a></h4>
<p>Role
defines the relationship of the compositionPart to the GeologicUnit as a whole,
e.g. vein, interbedded constituent, layers, dominant constituent. Values should
be drawn from the CompositionPartRoleValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/CompositionPartRoleValue">http://inspire.ec.europa.eu/codelist/CompositionPartRoleValue</a>). If it is
provided for a non-INSPIRE OneGeology service the CGI Geologic unit part role
vocabulary (<a class="reference external" href="http://resource.geosciml.org/classifier/cgi/geologicunitpartrole">http://resource.geosciml.org/classifier/cgi/geologicunitpartrole</a>)
should be used.</p>
</div>
<div class="section" id="composition-part-proportion">
<h4>Composition Part - proportion<a class="headerlink" href="#composition-part-proportion" title="Permalink to this headline">¶</a></h4>
<p>The proportion attribute
defines the proportion of the GeologicUnit as a whole that the CompositionPart
comprises. It is expressed as two fractions giving the upper and lower limits
of the range within which the CompositionPart proportion is considered to lie. It
can be serialised with an swe:QuantityRange element in both INSPIRE and
GeoSciML. However, GeoSciML also provides the gsmlb:GSML_QuantityRange element
which can be substituted here. The latter expresses the limits both as a space
separated tuple compatible with SWE and in separate elements which enables
querying in a WFS. A OneGeology service must use the gsmlb:GSML_QuantityRange
element.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlb:proportion&gt;</span>
 <span class="nt">&lt;gsmlb:GSML_QuantityRange&gt;</span>
  <span class="nt">&lt;swe:uom</span> <span class="na">code=</span><span class="s">&quot;%&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://unitsofmeasure/ucum.html#para-29&quot;</span>
   <span class="na">xlink:title=</span><span class="s">&quot;percent&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;swe:value&gt;</span>5.0 50.0<span class="nt">&lt;/swe:value&gt;</span>
  <span class="nt">&lt;gsmlb:lowerValue&gt;</span>5.0<span class="nt">&lt;/gsmlb:lowerValue&gt;</span>
  <span class="nt">&lt;gsmlb:upperValue&gt;</span>50.0<span class="nt">&lt;/gsmlb:upperValue&gt;</span>
 <span class="nt">&lt;/gsmlb:GSML_QuantityRange&gt;</span>
<span class="nt">&lt;/gsmlb:proportion&gt;</span>
</pre></div>
</div>
<p>Figure
11 Example of the encoding of proportion</p>
</div>
<div class="section" id="composition-part-material">
<h4>Composition Part - material<a class="headerlink" href="#composition-part-material" title="Permalink to this headline">¶</a></h4>
<p>The material attribute provides
the lithology of the CompositionPart and is of type LithologyValue (a codelist)
in INSPIRE (Figure 9) whereas in GeoSciML it is modelled as a CompoundMaterial (Figure 12). CompoundMaterial is a specialisation of EarthMaterial and the parent class of RockMaterial. The RockMaterial.lithology property is the equivalent of
INSPIRE CompositionPart.material.</p>
<div class="figure align-default" id="id100">
<img alt="_images/image007.png" src="_images/image007.png" />
<p class="caption"><span class="caption-text">Figure 12: UML context diagram for GeoSciML RockMaterial</span><a class="headerlink" href="#id100" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="rock-material-lithology">
<h4>Rock Material -lithology<a class="headerlink" href="#rock-material-lithology" title="Permalink to this headline">¶</a></h4>
<p>The lithology attribute
provides the lithology of the CompositionPart. GeoSciML allows multiple
lithologies for each CompositionPart, but in INSPIRE each CompositionPart
should be restricted to a single lithology, although, as indicated in section 2.3.2, a
GeologicUnit can have multiple CompositionParts. Values for lithology should be
drawn from the LithologyValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/LithologyValue">http://inspire.ec.europa.eu/codelist/LithologyValue</a>). This attribute is required for a OneGeology service
and the same restriction on having a single lithology per CompositionPart
applies. For a non-INSPIRE OneGeology service the CGI Simple lithology
vocabulary (<a class="reference external" href="http://resource.geosciml.org/classifier/cgi/lithology">http://resource.geosciml.org/classifier/cgi/lithology</a>) must be used.</p>
</div>
</div>
<div class="section" id="geologic-structure">
<h3>Geologic Structure<a class="headerlink" href="#geologic-structure" title="Permalink to this headline">¶</a></h3>
<p>GeologicStructure is an abstract specialization of
GeologicFeature and in INSPIRE only two types of GeologicStructure are
required, ShearDisplacementStructure (faults) and Fold (Figure 13).</p>
<div class="figure align-default" id="id101">
<img alt="_images/image008.jpg" src="_images/image008.jpg" />
<p class="caption"><span class="caption-text">Figure 13: INSPIRE UML class diagram for GeologicStructure</span><a class="headerlink" href="#id101" title="Permalink to this image">¶</a></p>
</div>
<p>The GeoSciML modelling of
ShearDisplacementStructure is shown in Figure 14, and of Fold in Figure 15.</p>
<div class="figure align-default" id="id102">
<img alt="_images/image009.png" src="_images/image009.png" />
<p class="caption"><span class="caption-text">Figure 14: UML context diagram for GeoSciML ShearDisplacementStructure</span><a class="headerlink" href="#id102" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id103">
<img alt="_images/image010.png" src="_images/image010.png" />
<p class="caption"><span class="caption-text">Figure 15: UML context diagram for GeoSciML Fold</span><a class="headerlink" href="#id103" title="Permalink to this image">¶</a></p>
</div>
<p>As can be seen in Figure 13, the only properties required by INSPIRE are faultType for ShearDisplacementStructure, and profileType for Fold.</p>
<div class="section" id="shear-displacement-structure-faulttype">
<h4>Shear Displacement Structure - faultType<a class="headerlink" href="#shear-displacement-structure-faulttype" title="Permalink to this headline">¶</a></h4>
<p>The faultType property
describes the type of ShearDispacementStructure and should be populated with a
value drawn from the FaultTypeValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/FaultTypeValue">http://inspire.ec.europa.eu/codelist/FaultTypeValue</a>). For a non-INSPIRE OneGeology service the CGI Fault
Type vocabulary (<a class="reference external" href="http://resource.geosciml.org/classifier/cgi/faulttype">http://resource.geosciml.org/classifier/cgi/faulttype</a>)
should be used.</p>
</div>
<div class="section" id="fold-profiletype">
<h4>Fold - profileType<a class="headerlink" href="#fold-profiletype" title="Permalink to this headline">¶</a></h4>
<p>The profileType property describes
the type of fold defined according to its geometry and the younging direction
of the strata. It should be populated using values from the
FoldProfileTypeValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/FoldProfileTypeValue">http://inspire.ec.europa.eu/codelist/FoldProfileTypeValue</a>). There isn’t currently an equivalent CGI vocabulary.</p>
</div>
</div>
<div class="section" id="geomorphologic-feature">
<h3>Geomorphologic Feature<a class="headerlink" href="#geomorphologic-feature" title="Permalink to this headline">¶</a></h3>
<p>Figure 16 shows the INSPIRE UML class diagram for geomorphology, and Figure 17 the equivalent GeoSciML modeling. As can be seen
these are modeled in an identical way. GeomorphologicFeature is an abstract
specialization of GeologicFeature with two sub-types, AnthropogenicGeomorphologicFeature
and NaturalGeomorphologicFeature.</p>
<div class="figure align-default" id="id104">
<img alt="_images/image011.jpg" src="_images/image011.jpg" />
<p class="caption"><span class="caption-text">Figure 16: INSPIRE UML class diagram for GeomorphologicFeature</span><a class="headerlink" href="#id104" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id105">
<img alt="_images/image012.jpg" src="_images/image012.jpg" />
<p class="caption"><span class="caption-text">Figure 17: UML context diagram for GeoSciML GeomorphologicFeature</span><a class="headerlink" href="#id105" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="natural-geomorphologic-feature-naturalgeomorphologicfeaturetype">
<h4>Natural Geomorphologic Feature - NaturalGeomorphologicFeatureType<a class="headerlink" href="#natural-geomorphologic-feature-naturalgeomorphologicfeaturetype" title="Permalink to this headline">¶</a></h4>
<p>The
NaturalGeomorphologicFeatureType property describes the type of
NaturalGeomorphologicFeature and should be populated with a value drawn from
the NaturalGeomorphologicFeatureTypeValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/NaturalGeomorphologicFeatureTypeValue">http://inspire.ec.europa.eu/codelist/NaturalGeomorphologicFeatureTypeValue</a>). There isn’t currently an equivalent CGI vocabulary.</p>
</div>
<div class="section" id="natural-geomorphologic-feature-activity">
<h4>Natural Geomorphologic Feature - activity<a class="headerlink" href="#natural-geomorphologic-feature-activity" title="Permalink to this headline">¶</a></h4>
<p>The activity property
describes the level of activity of a NaturalGeomorphologicFeature and should be
populated with a value from the GeomorphologicActivityValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/GeomorphologicActivityValue">http://inspire.ec.europa.eu/codelist/GeomorphologicActivityValue</a>). There isn’t currently an equivalent CGI vocabulary.</p>
</div>
<div class="section" id="anthropogenic-geomorphologic-feature-anthropogenicgeomorphologicfeaturetype">
<h4>Anthropogenic Geomorphologic Feature - AnthropogenicGeomorphologicFeatureType<a class="headerlink" href="#anthropogenic-geomorphologic-feature-anthropogenicgeomorphologicfeaturetype" title="Permalink to this headline">¶</a></h4>
<p>The
AnthopogenicGeomorphologicFeatureType property describes the type of
AnthropogenicGeomorphologicFeature and should be populated with a value drawn
from the AnthropogenicGeomorphologicFeatureTypeValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/AnthropogenicGeomorphologicFeatureTypeValue">http://inspire.ec.europa.eu/codelist/AnthropogenicGeomorphologicFeatureTypeValue</a>). There isn’t currently an equivalent CGI vocabulary.</p>
</div>
</div>
<div class="section" id="thematic-class">
<h3>Thematic Class<a class="headerlink" href="#thematic-class" title="Permalink to this headline">¶</a></h3>
<p>The INSPIRE Thematic Class datatype (Figure 2) is designed to enable information on thematic maps to be delivered. Thematic maps commonly take a standard
geological map and reclassify it using some vocabulary of concepts, for example
a standard lithostratigraphic map might be reclassified into ‘engineering
geology units’ based on various generalized physical properties of the
lithostratigraphic units. This doesn’t involve any new mapping, although it may
lead to units being merged together.</p>
<p>There is no standard for thematic maps and therefore
each data provider must provide their own vocabulary for classifying a
particular map for a particular theme.</p>
<div class="section" id="geologic-feature-classifier">
<h4>Geologic Feature - classifier<a class="headerlink" href="#geologic-feature-classifier" title="Permalink to this headline">¶</a></h4>
<p>There is no direct
equivalent of Thematic Class in GeoSciML but it can nevertheless be encoded in
GeoSciML using the classifier association from GeologicFeature to ControlledConcept
(Figure 3). This provides the URI of the relevant value in the thematic
classification vocabulary being used.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlb:GeologicUnit</span> <span class="na">gml:id=</span><span class="s">&quot;INV-SDSM&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;gml:identifier</span> <span class="na">codeSpace=</span><span class="s">&quot;http://data.bgs.ac.uk/&quot;</span><span class="nt">&gt;</span>http://data.bgs.ac.uk/id/Lexicon/NamedRockUnit/INV<span class="nt">&lt;/gml:identifier&gt;</span>
<span class="nt">&lt;gml:name&gt;</span>INVERCLYDE GROUP<span class="nt">&lt;/gml:name&gt;</span>
<span class="nt">&lt;gsmlb:geologicHistory&gt;</span> [37 lines]
<span class="c">&lt;!--  --&gt;</span>
<span class="c">&lt;!-- Example of a thematic classification of a GeologicUnit --&gt;</span>
<span class="c">&lt;!--  --&gt;</span>
<span class="nt">&lt;gsmlb:classifier</span>
 <span class="na">xlink:href=</span><span class="s">&quot;http://data.bgs.ac.uk/ref/EngineeringGeologyTheme/strongSandstone&quot;</span>
 <span class="na">xlink:title=</span><span class="s">&quot;Engineering Geology theme: Strong Sandstone&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Figure 18:  Example of encoding a GeologicUnit with a
thematic classifier</p>
</div>
<div class="section" id="borehole">
<h4>Borehole<a class="headerlink" href="#borehole" title="Permalink to this headline">¶</a></h4>
<p>The INSPIRE UML class diagram for Borehole is shown in 19 and the UML of the GeoSciML Borehole package in Figure 20. Although the modelling of boreholes in GeoSciML is more complex it includes everything required for INSPIRE which can therefore be encoded with
GeoSciML. One of the main differences is that in GeoSciML Borehole is modelled
as a type of SamplingCurve, drawn from the OGC Observations &amp; Measurements
model.</p>
<p>The
logElement association from Borehole to BoreholeInterval is the means by which
the borehole log is encoded. There should be one BoreholeInterval (logElement)
for every discrete unit described down the borehole. A borehole encoded as a
series of logElements can be seen as a ‘vertical geological map’ with each BoreholeInterval
specified by a GeologicFeature in the same way as polygons on the map. It is
also possible in GeoSciML to encode the borehole as a series of observations,
using the OGC Observations &amp; Measurements model, but as this isn’t a
requirement for INSPIRE it won’t be described further here.</p>
<div class="figure align-default" id="id106">
<img alt="_images/image014.jpg" src="_images/image014.jpg" />
<p class="caption"><span class="caption-text">Figure 19: INSPIRE UML class diagram for Borehole</span><a class="headerlink" href="#id106" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id107">
<img alt="_images/image015.jpg" src="_images/image015.jpg" />
<p class="caption"><span class="caption-text">Figure 20: UML for the GeoSciML Borehole package</span><a class="headerlink" href="#id107" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="borehole-inspireid">
<h4>Borehole - inspireId<a class="headerlink" href="#borehole-inspireid" title="Permalink to this headline">¶</a></h4>
<p>The INSPIRE inspireId
property is of type Identifier and provides the persistent identifier used for
the borehole by the data provider. In GeoSciML this should be encoded using
gml:identifier which requires both the identifier value, equivalent to
Identifier.localId, and the codespace, equivalent to Identifier.namespace,
identifying the data source (Figure 6).</p>
</div>
<div class="section" id="borehole-sampledfeature">
<h4>Borehole - sampledFeature<a class="headerlink" href="#borehole-sampledfeature" title="Permalink to this headline">¶</a></h4>
<p>This property isn’t required
by INSPIRE but is mandatory for SamplingFeature and thus Borehole in GeoSciML.
In a typical borehole being encoded the sampledFeatures will be the features,
such as GeologicUnits, which the borehole penetrates and which specify the log elements
(see section 2.7.9). There should be one sampledFeature encoded for each
distinct feature sampled by the borehole. The positions where these features
are intersected by the borehole may be described in the log. Each feature only
needs to be described fully once and then can be referenced with an internal
xlink:href using the gml:id value of the feature. No extra information is
therefore required to encode this property.</p>
</div>
<div class="section" id="borehole-downholegeometry">
<h4>Borehole - downholeGeometry<a class="headerlink" href="#borehole-downholegeometry" title="Permalink to this headline">¶</a></h4>
<p>This should be encoded using
the SF_SpatialSamplingFeature shape association to GM_Object to provide a
LineString with the 3D geometry of the borehole (Figure 21). Where the borehole is vertical the X and Y co-ordinates will be the same for all positions. The LineString should be given an identifier using
gml:id for use in referencing the log elements (section 2.7.8)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;sams:shape&gt;</span>
   <span class="nt">&lt;gml:LineString</span> <span class="na">gml:id=</span><span class="s">&quot;bh.ns94se5.shape&quot;</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG:6.15:7405&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;gml:posList</span> <span class="na">srsDimension=</span><span class="s">&quot;3&quot;</span> <span class="na">count=</span><span class="s">&quot;7&quot;</span><span class="nt">&gt;</span>-30.7111 134.2059 321. -30.7112 134.2058 315.
       -30.7113 134.2057 303. -30.7114 134.2056 296.
       -30.7115 134.2055 272. -30.7116 134.2054 271.
       -30.7117 134.2053 270.<span class="nt">&lt;/gml:posList&gt;</span>
   <span class="nt">&lt;/gml:LineString&gt;</span>
 <span class="nt">&lt;/sams:shape&gt;</span>
</pre></div>
</div>
<p>Figure 21: Example of encoding
the downhole geometry of a borehole</p>
</div>
<div class="section" id="borehole-location-and-elevation">
<h4>Borehole - location and elevation<a class="headerlink" href="#borehole-location-and-elevation" title="Permalink to this headline">¶</a></h4>
<p>The referenceLocation
association from borehole to OriginPosition allows the encoding of both
location and elevation. Location should be encoded as a two dimensional point
and elevation as a one dimensional value (Figure 22).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlbh:referenceLocation&gt;</span>
  <span class="nt">&lt;gsmlbh:OriginPosition</span> <span class="na">gml:id=</span><span class="s">&quot;op1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;gsmlbh:location&gt;</span>
      <span class="nt">&lt;gml:Point</span> <span class="na">gml:id=</span><span class="s">&quot;pt1&quot;</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG:6.15:27700&quot;</span> <span class="na">srsDimension=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;gml:pos&gt;</span>-30.7 134.2<span class="nt">&lt;/gml:pos&gt;</span>
      <span class="nt">&lt;/gml:Point&gt;</span>
    <span class="nt">&lt;/gsmlbh:location&gt;</span>
    <span class="nt">&lt;gsmlbh:elevation</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG:6.15:5701&quot;</span> <span class="na">srsDimension=</span><span class="s">&quot;1&quot;</span>
      <span class="nt">&gt;</span>321.0<span class="nt">&lt;/gsmlbh:elevation&gt;</span>
  <span class="nt">&lt;/gsmlbh:OriginPosition&gt;</span>
<span class="nt">&lt;/gsmlbh:referenceLocation&gt;</span>
</pre></div>
</div>
<p>Figure 22: Example of encoding
the location and elevation of a borehole</p>
</div>
<div class="section" id="borehole-purpose">
<h4>Borehole - purpose<a class="headerlink" href="#borehole-purpose" title="Permalink to this headline">¶</a></h4>
<p>The purpose property
describes the purpose for which the Borehole was drilled and should be
populated with a value from the BoreholePurposeValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/BoreholePurposeValue">http://inspire.ec.europa.eu/codelist/BoreholePurposeValue</a>). In GeoSciML this property is inside
indexData/BoreholeDetails. There isn’t currently an equivalent CGI vocabulary.</p>
</div>
<div class="section" id="borehole-boreholelength">
<h4>Borehole - boreholeLength<a class="headerlink" href="#borehole-boreholelength" title="Permalink to this headline">¶</a></h4>
<p>The boreholeLength records
the total length down the borehole and should be encoded as a Quantity value,
which requires the units of measurement to be recorded along with the value (Figure 23). The unit of measure should reference the URI of an OGC definition. Again this is found inside the indexData/BoreholeDetails element.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlbh:indexData&gt;</span>
 <span class="nt">&lt;gsmlbh:BoreholeDetails&gt;</span>
  <span class="nt">&lt;gsmlbh:purpose</span>
   <span class="na">xlink:href=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/BoreholePurposeValue/geologicalSurvey&quot;</span>
   <span class="na">xlink:title=</span><span class="s">&quot;geological Survey&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;gsmlbh:boreholeLength&gt;</span>
   <span class="nt">&lt;swe:Quantity&gt;</span>
    <span class="nt">&lt;swe:uom</span> <span class="na">code=</span><span class="s">&quot;m&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.opengis.net/def/uom/OGC/1.0/metre&quot;</span>
     <span class="na">xlink:title=</span><span class="s">&quot;metre&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;swe:value&gt;</span>51.0<span class="nt">&lt;/swe:value&gt;</span>
   <span class="nt">&lt;/swe:Quantity&gt;</span>
  <span class="nt">&lt;/gsmlbh:boreholeLength&gt;</span>
 <span class="nt">&lt;/gsmlbh:BoreholeDetails&gt;</span>
<span class="nt">&lt;/gsmlbh:indexData&gt;</span>
</pre></div>
</div>
<p>Figure 23: Example of encoding
the purpose and boreholeLength</p>
</div>
<div class="section" id="borehole-interval-mappingframe">
<h4>Borehole Interval - mappingFrame<a class="headerlink" href="#borehole-interval-mappingframe" title="Permalink to this headline">¶</a></h4>
<p>The BoreholeInterval in
GeoSciML v4.1 does not have a mappingFrame / samplingFrame property as this
will always be the borehole to which it belongs. Thus, although in the INSPIRE
geology theme Schema the property is encoded by referencing the gml:id of the
borehole, for GeoSciML nothing needs specifying explicitly.</p>
</div>
<div class="section" id="boreholeinterval-geometry-shape">
<h4>BoreholeInterval - geometry (shape)<a class="headerlink" href="#boreholeinterval-geometry-shape" title="Permalink to this headline">¶</a></h4>
<p>The geometry of the BoreholeInterval
is the one dimensional linear segment down the borehole that the BoreholeInterval
refers to. The reference system is the geometry of the borehole, which can be
referenced using the gml:id of the borehole shape property (Figure 21). An example of encoding BoreholeInterval geometry is given in Figure 24.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlbh:shape&gt;</span>
 <span class="nt">&lt;gml:LineString</span> <span class="na">gml:id=</span><span class="s">&quot;ls1&quot;</span> <span class="na">srsName=</span><span class="s">&quot;#bh.ns94se5.shape&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;gml:posList</span> <span class="na">srsDimension=</span><span class="s">&quot;1&quot;</span> <span class="na">count=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>0.0 2.0<span class="nt">&lt;/gml:posList&gt;</span>
 <span class="nt">&lt;/gml:LineString&gt;</span>
<span class="nt">&lt;/gsmlbh:shape&gt;</span>
</pre></div>
</div>
<p>Figure 24: Example of encoding BoreholeInterval
geometry</p>
</div>
<div class="section" id="boreholeinterval-specification">
<h4>BoreholeInterval - specification<a class="headerlink" href="#boreholeinterval-specification" title="Permalink to this headline">¶</a></h4>
<p>A BoreholeInterval is
specified by a GeologicFeature in exactly the same way as described in section
2.1 for MappedFeature. The encoding of a GeologicFeature specifying a
MappedInterval is therefore identical to that described above for
MappedFeatures and won’t be repeated here.</p>
</div>
<div class="section" id="boreholeinterval-mappedintervalbegin-mappedintervalend">
<h4>BoreholeInterval - mappedIntervalBegin &amp; mappedIntervalEnd<a class="headerlink" href="#boreholeinterval-mappedintervalbegin-mappedintervalend" title="Permalink to this headline">¶</a></h4>
<p>The mappedIntervalBegin and
mappedIntervalEnd properties hold the one dimensional co-ordinates of the start
and end of the mappedInterval, as measured down the borehole, encoded as
Quantity values (Figure 25). This information duplicates that held in the shape property, but
queries such as ‘find all MappedIntervals within 10m of the surface’ are
difficult to implement with current technology using the shape property and the
mappedIntervalBegin and mappedIntervalEnd properties have been introduced to
address this problem.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlbh:mappedIntervalBegin&gt;</span>
  <span class="nt">&lt;swe:Quantity&gt;</span>
    <span class="nt">&lt;swe:uom</span> <span class="na">code=</span><span class="s">&quot;m&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.opengis.net/def/uom/OGC/1.0/metre&quot;</span>
      <span class="na">xlink:title=</span><span class="s">&quot;metre&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;swe:value&gt;</span>0.0<span class="nt">&lt;/swe:value&gt;</span>
  <span class="nt">&lt;/swe:Quantity&gt;</span>
<span class="nt">&lt;/gsmlbh:mappedIntervalBegin&gt;</span>
<span class="nt">&lt;gsmlbh:mappedIntervalEnd&gt;</span>
  <span class="nt">&lt;swe:Quantity&gt;</span>
    <span class="nt">&lt;swe:uom</span> <span class="na">code=</span><span class="s">&quot;m&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.opengis.net/def/uom/OGC/1.0/metre&quot;</span>
      <span class="na">xlink:title=</span><span class="s">&quot;metre&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;swe:value&gt;</span>2.0<span class="nt">&lt;/swe:value&gt;</span>
  <span class="nt">&lt;/swe:Quantity&gt;</span>
<span class="nt">&lt;/gsmlbh:mappedIntervalEnd&gt;</span>
</pre></div>
</div>
<p>Figure 25: Example of encoding mappedIntervalBegin and mappedIntervalEnd</p>
</div>
</div>
<div class="section" id="geologic-collection">
<h3>Geologic Collection<a class="headerlink" href="#geologic-collection" title="Permalink to this headline">¶</a></h3>
<p>The GeologicCollection in
INSPIRE is designed to enable features which comprise a higher level object,
such as a geological map or a borehole exploration programme, to be grouped
together. This enables information such as metadata to be provided for the collection
of features as a whole. It is not necessary to use a GeologicCollection where
features do not form part of such a higher level object. The INSPIRE UML class
diagram for GeologicCollection is shown in Figure 26.</p>
<div class="figure align-default" id="id108">
<img alt="_images/image019.jpg" src="_images/image019.jpg" />
<p class="caption"><span class="caption-text">Figure 26: INSPIRE UML class diagram for GeologicCollection</span><a class="headerlink" href="#id108" title="Permalink to this image">¶</a></p>
</div>
<p>In GeoSciML collections are
modelled with the GSML feature (Figure 28).</p>
<p>Where features are not part
of a GSML collection each individual feature is a member of a
wfs:FeatureCollection. GSML is a GML feature so where a GSML collection is
being delivered it is the GSML collection which is a member of the
wfs:FeatureCollection and individual features are members of the GSML
collection (Figure 27).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;wfs:member&gt;</span>
  <span class="nt">&lt;gsmlb:GSML</span> <span class="na">gml:id=</span><span class="s">&quot;col1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;gml:metaDataProperty&gt;</span> [81 lines]
    <span class="nt">&lt;gml:identifier</span> <span class="na">codeSpace=</span><span class="s">&quot;http://data.bgs.ac.uk&quot;</span><span class="nt">&gt;</span>http://data.bgs.ac.uk/id/625KGeologyMap<span class="nt">&lt;/gml:identifier&gt;</span>
    <span class="nt">&lt;gml:name&gt;</span>BGS 1:625 000 Digital Geological Map<span class="nt">&lt;/gml:name&gt;</span>
    <span class="nt">&lt;gsmlb:collectionType</span>
     <span class="na">xlink:href=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/CollectionTypeValue/geologicalMap&quot;</span>
     <span class="na">xlink:title=</span><span class="s">&quot;geological map&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;gsmlb:member&gt;</span>
    <span class="nt">&lt;gsmlb:MappedFeature</span> <span class="na">gml:id=</span><span class="s">&quot;mf.16&quot;</span><span class="nt">&gt;</span>
      ....
</pre></div>
</div>
<p>Figure 27: Example of encoding a GSML collection as a member
of a wfs:FeatureCollection and a MappedFeature as a member of the GSML
collection</p>
<div class="figure align-default" id="id109">
<img alt="_images/image020.jpg" src="_images/image020.jpg" />
<p class="caption"><span class="caption-text">Figure 28: UML class diagram for GeoSciML Collection package</span><a class="headerlink" href="#id109" title="Permalink to this image">¶</a></p>
</div>
<p>The INSPIRE reference,
beginLifespanVersion and endLifespanVersion properties can all be implemented
in GeoSciML using the standard gml:metaDataProperty to contain elements from
the ISO 19139 metadata schema. The use of MD_Metadata also requires certain
other mandatory properties to be encoded which are not required by the INSPIRE
data specification.</p>
<div class="section" id="geologic-collection-inspireid">
<h4>Geologic Collection - inspireId<a class="headerlink" href="#geologic-collection-inspireid" title="Permalink to this headline">¶</a></h4>
<p>The INSPIRE inspireId
property is of type Identifier and provides the persistent identifier used for
the GeologicCollection by the data provider. In GeoSciML this should be encoded
using gml:identifier which requires both the identifier value, equivalent to Identifier.localId,
and the codespace, equivalent to Identifier.namespace, identifying the data
source (Figure 28).</p>
</div>
<div class="section" id="geologiccollection-name">
<h4>GeologicCollection - name<a class="headerlink" href="#geologiccollection-name" title="Permalink to this headline">¶</a></h4>
<p>The INSPIRE name property
provides the name of the GeologicCollection. It should be encoded using
gml:name (Figure 28).</p>
</div>
<div class="section" id="geologic-collection-collectiontype">
<h4>Geologic Collection - collectionType<a class="headerlink" href="#geologic-collection-collectiontype" title="Permalink to this headline">¶</a></h4>
<p>The collectionType
property describes the type of collection and should be populated with a value
from the CollectionTypeValue vocabulary (<a class="reference external" href="http://inspire.ec.europa.eu/codelist/CollectionTypeValue">http://inspire.ec.europa.eu/codelist/CollectionTypeValue</a>) (Figure 28). At the time of writing an equivalent CGI vocabulary has been drafted but not yet published.</p>
</div>
<div class="section" id="geologic-collection-member">
<h4>Geologic Collection - member<a class="headerlink" href="#geologic-collection-member" title="Permalink to this headline">¶</a></h4>
<p>In INSPIRE there are four
types of feature which can be members of a GeologicCollection: MappedFeature;
Borehole; GeophObject; and GeophObjectSet (Figure 26). GeophObject and GeophObjectSet are features in the geophysics application schema and won’t be discussed further here. In GeoSciML the member
association from GSML to GSMLItem allows the members of a GSML collection to be
any of the types in the GSMLItem union class. The types of member of an INSPIRE
GeologicCollection can be mapped to these: MappedFeature maps to mappedItem and
Borehole to samplingFeatureItem (Figure 28). Figure 27 shows the encoding of a MappedFeature as a member of a GSML collection.</p>
</div>
<div class="section" id="md-metadata-contact">
<h4>MD_Metadata - contact<a class="headerlink" href="#md-metadata-contact" title="Permalink to this headline">¶</a></h4>
<p>Although the MD_Metadata
contact property is not required by INSPIRE it is mandatory for MD_Metadata. It
identifies the organisation providing the metadata and its role with respect to
the metadata. It is of type CI_ResponsibleParty which requires the encoding of
the organisationName and role properties, the latter with values drawn from the
CI_RoleCode vocabulary (<a class="reference external" href="http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_RoleCode">http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_RoleCode</a>). Figure 29 gives an example of the encoding of contact.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gmd:contact&gt;</span>
    <span class="nt">&lt;gmd:CI_ResponsibleParty&gt;</span>
       <span class="nt">&lt;gmd:organisationName&gt;</span>
          <span class="nt">&lt;gco:CharacterString&gt;</span>British Geological Survey (BGS)<span class="nt">&lt;/gco:CharacterString&gt;</span>
       <span class="nt">&lt;/gmd:organisationName&gt;</span>
       <span class="nt">&lt;gmd:role&gt;</span>
          <span class="nt">&lt;gmd:CI_RoleCode</span> <span class="na">codeList=</span><span class="s">&quot;http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_RoleCode&quot;</span>
                 <span class="na">codeListValue=</span><span class="s">&quot;owner&quot;</span><span class="nt">&gt;</span>owner<span class="nt">&lt;/gmd:CI_RoleCode&gt;</span>
       <span class="nt">&lt;/gmd:role&gt;</span>
    <span class="nt">&lt;/gmd:CI_ResponsibleParty&gt;</span>
<span class="nt">&lt;/gmd:contact&gt;</span>
</pre></div>
</div>
<p>Figure 29: Example of encoding MD_Metadata.contact</p>
</div>
<div class="section" id="md-metadata-datestamp">
<h4>MD_Metadata - dateStamp<a class="headerlink" href="#md-metadata-datestamp" title="Permalink to this headline">¶</a></h4>
<p>Although the MD_Metadata
dateStamp property is not required by INSPIRE it is mandatory for MD_Metadata.
It provides the date when the metadata was created and should follow the format
defined in ISO8601. An example of encoding dateStamp is given in Figure 30.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gmd:dateStamp&gt;</span>
  <span class="nt">&lt;gco:Date&gt;</span>2011-03-08<span class="nt">&lt;/gco:Date&gt;</span>
<span class="nt">&lt;/gmd:dateStamp&gt;</span>
</pre></div>
</div>
<p>Figure 30: Example of encoding MD_Metadata.dateStamp</p>
</div>
<div class="section" id="geologic-collection-reference">
<h4>Geologic Collection - reference<a class="headerlink" href="#geologic-collection-reference" title="Permalink to this headline">¶</a></h4>
<p>The reference property is of
type DocumentCitation which requires the provision of a name, shortName, date
and link (URL). The first three of these properties can be encoded using the
MD_DataIdentification.citation property which is of type CI_Citation.</p>
</div>
<div class="section" id="documentcitation-name">
<h4>DocumentCitation - name<a class="headerlink" href="#documentcitation-name" title="Permalink to this headline">¶</a></h4>
<p>The DocumentCitation.name
property can be encoded with CI_Citation.title (Figure 31). This property duplicates the information encoded in gml:name (section 2.8.2).</p>
</div>
<div class="section" id="documentcitation-shortname">
<h4>DocumentCitation - shortName<a class="headerlink" href="#documentcitation-shortname" title="Permalink to this headline">¶</a></h4>
<p>The
DocumentCitation.shortName property can be encoded with
CI_Citation.alternateTitle (Figure 31). This property is optional in INSPIRE and should be used where the GeologicCollection has a well recognised short name.</p>
</div>
<div class="section" id="document-citation-date">
<h4>Document Citation - date<a class="headerlink" href="#document-citation-date" title="Permalink to this headline">¶</a></h4>
<p>The DocumentCitation.date
refers to the date cited in the reference, such as publication date or revision
date. It can be encoded with CI_Citation.date (Figure 31) which is of type CI_Date requiring both the date and the dateType to be
provided. The dateType property identifies what the date is referring to and
should be encoded using a value drawn from the CI_DateTypeCode vocabulary (<a class="reference external" href="http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_DateTypeCod">http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_DateTypeCod</a>).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gmd:CI_Citation&gt;</span>
  <span class="nt">&lt;gmd:title&gt;</span>
    <span class="nt">&lt;gco:CharacterString&gt;</span>BGS 1:625 000 Digital Geological Map<span class="nt">&lt;/gco:CharacterString&gt;</span>
  <span class="nt">&lt;/gmd:title&gt;</span>
  <span class="nt">&lt;gmd:alternateTitle&gt;</span>
    <span class="nt">&lt;gco:CharacterString&gt;</span>BGS 625k Map<span class="nt">&lt;/gco:CharacterString&gt;</span>
  <span class="nt">&lt;/gmd:alternateTitle&gt;</span>
  <span class="nt">&lt;gmd:date&gt;</span>
    <span class="nt">&lt;gmd:CI_Date&gt;</span>
      <span class="nt">&lt;gmd:date&gt;</span>
        <span class="nt">&lt;gco:Date&gt;</span>2008<span class="nt">&lt;/gco:Date&gt;</span>
      <span class="nt">&lt;/gmd:date&gt;</span>
      <span class="nt">&lt;gmd:dateType&gt;</span>
        <span class="nt">&lt;gmd:CI_DateTypeCode</span> <span class="na">codeList=</span><span class="s">&quot;http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_DateTypeCode&quot;</span>
          <span class="na">codeListValue=</span><span class="s">&quot;revision&quot;</span><span class="nt">&gt;</span>revision<span class="nt">&lt;/gmd:CI_DateTypeCode&gt;</span>
      <span class="nt">&lt;/gmd:dateType&gt;</span>
    <span class="nt">&lt;/gmd:CI_Date&gt;</span>
  <span class="nt">&lt;/gmd:date&gt;</span>
  <span class="nt">&lt;gmd:date&gt;</span>
<span class="nt">&lt;/gmd:CI_Citation&gt;</span>
</pre></div>
</div>
<p>Figure 31: Example of encoding DocumentCitation using CI_Citation</p>
</div>
<div class="section" id="documentcitation-link">
<h4>DocumentCitation - link<a class="headerlink" href="#documentcitation-link" title="Permalink to this headline">¶</a></h4>
<p>The DocumentCitation.link
property is defined as providing an online link to the document (not to the
citation of the document), and so should provide the URL of the
GeologicCollection. This can be encoded using the MD_Metadata.dataSetURI property (Figure 32).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gmd:dataSetURI&gt;</span>
 <span class="nt">&lt;gmx:Anchor</span> <span class="na">href=</span><span class="s">&quot;http://www.bgs.ac.uk/products/digitalmaps/digmapgb_625.html&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/gmd:dataSetURI&gt;</span>
</pre></div>
</div>
<p>Figure 32: Example of encoding DocumentCitation.link using MD_Metadata.dataSetURI</p>
</div>
<div class="section" id="geologic-collection-beginlifespanversion-endlifespanversion">
<h4>Geologic Collection - beginLifespanVersion &amp; endLifespanVersion<a class="headerlink" href="#geologic-collection-beginlifespanversion-endlifespanversion" title="Permalink to this headline">¶</a></h4>
<p>The beginLifespanVersion and
endLifespanVersion properties can both be encoded using the CI_Citation.date
property (section 2.8.7.3), but
with different values for the dateType property. The date should be encoded
using the format defined in ISO8601. In the revised version of ISO19115 the
CI_DateTypeCode vocabulary has been significantly extended and beginLifespanVersion
should have a dateType code value of validityBegins and endLifespanVersion
should have a dateType code value of validityEnds (Figure 33). The endLifespanVersion property should not be encoded if the GeologicCollection is still valid.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gmd:date&gt;</span>
  <span class="nt">&lt;gmd:CI_Date&gt;</span>
    <span class="nt">&lt;gmd:date&gt;</span>
      <span class="nt">&lt;gco:Date&gt;</span>2008<span class="nt">&lt;/gco:Date&gt;</span>
    <span class="nt">&lt;/gmd:date&gt;</span>
    <span class="nt">&lt;gmd:dateType&gt;</span>
      <span class="nt">&lt;gmd:CI_DateTypeCode</span> <span class="na">codeList=</span><span class="s">&quot;http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_DateTypeCode&quot;</span>
        <span class="na">codeListValue=</span><span class="s">&quot;validityBegins&quot;</span><span class="nt">&gt;</span>validityBegins<span class="nt">&lt;/gmd:CI_DateTypeCode&gt;</span>
    <span class="nt">&lt;/gmd:dateType&gt;</span>
  <span class="nt">&lt;/gmd:CI_Date&gt;</span>
<span class="nt">&lt;/gmd:date&gt;</span>
<span class="nt">&lt;gmd:date&gt;</span>
  <span class="nt">&lt;gmd:CI_Date&gt;</span>
    <span class="nt">&lt;gmd:date&gt;</span>
      <span class="nt">&lt;gco:Date&gt;</span>2013<span class="nt">&lt;/gco:Date&gt;</span>
    <span class="nt">&lt;/gmd:date&gt;</span>
    <span class="nt">&lt;gmd:dateType&gt;</span>
      <span class="nt">&lt;gmd:CI_DateTypeCode</span> <span class="na">codeList=</span><span class="s">&quot;http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_DateTypeCode&quot;</span>
        <span class="na">codeListValue=</span><span class="s">&quot;validityEnds&quot;</span><span class="nt">&gt;</span>validityEnds<span class="nt">&lt;/gmd:CI_DateTypeCode&gt;</span>
    <span class="nt">&lt;/gmd:dateType&gt;</span>
  <span class="nt">&lt;/gmd:CI_Date&gt;</span>
<span class="nt">&lt;/gmd:date&gt;</span>
</pre></div>
</div>
<p>Figure 33:
Example of encoding beginLifespanVersion and endLifespanVersion using
CI_Citation.date</p>
</div>
<div class="section" id="md-dataidentification-abstract">
<h4>MD_DataIdentification - abstract<a class="headerlink" href="#md-dataidentification-abstract" title="Permalink to this headline">¶</a></h4>
<p>Although the
MD_DataIdentification abstract property is not required by INSPIRE it is
mandatory for MD_DataIdentification. It should be populated with a text description
of the GeologicCollection (Figure 34).</p>
</div>
<div class="section" id="md-dataidentification-language">
<h4>MD_DataIdentification - language<a class="headerlink" href="#md-dataidentification-language" title="Permalink to this headline">¶</a></h4>
<p>Although the
MD_DataIdentification language property is not required by INSPIRE it is
mandatory for MD_DataIdentification. It identifies the language(s) used in the
GeologicCollection and should be encoded using the language codes defined in
ISO639-2 (Figure 34).</p>
<p>If the dataset has no natural
language the special code of “zxx” of the ISO 639-2/B reserved for
“no linguistic content; not applicable” shall be used.</p>
</div>
<div class="section" id="md-dataidentification-topiccategory">
<h4>MD_DataIdentification - topicCategory<a class="headerlink" href="#md-dataidentification-topiccategory" title="Permalink to this headline">¶</a></h4>
<p>Although the
MD_DataIdentification topicCategory property is not required by INSPIRE it is
mandatory for MD_DataIdentification where the metadata is referring to a
dataset. A GeologicCollection can be considered a dataset. MD_DataIdentification
topicCategory should be populated with a value from the MD_TopicCategory_Code
vocabulary (<a class="reference external" href="http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#MD_TopicCategoryCode">http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#MD_TopicCategoryCode</a>) (Figure 34).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gmd:abstract&gt;</span>
  <span class="nt">&lt;gco:CharacterString&gt;</span>The data shows polygonal and selected linear geological information, sourced
    from published BGS 1:625 000 scale maps of Great Britain.  However, geological units are identified
    using the most up-to-date nomenclature that may differ from that on the printed maps. The maps are
    generally based on published material at 1:50 000 scale and compiled using techniques of selection,
    generalisation and exaggeration. The geology is fitted to a relevant topographic base at the time
    of production. Full UK coverage is available. The data is available in vector format. BGS licensing
    terms and conditions apply to external use of the data. The data can be used free of charge for
    non commercial use and is downloadable from the website.<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="nt">&lt;/gmd:abstract&gt;</span>
<span class="nt">&lt;gmd:language&gt;</span>
    <span class="nt">&lt;gmd:LanguageCode</span>
     <span class="na">codeList=</span><span class="s">&quot;http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#LanguageCode&quot;</span>
     <span class="na">codeListValue=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>English<span class="nt">&lt;/gmd:LanguageCode&gt;</span>
<span class="nt">&lt;/gmd:language&gt;</span>
<span class="nt">&lt;gmd:topicCategory&gt;</span>
  <span class="nt">&lt;gmd:MD_TopicCategoryCode&gt;</span>geoscientificInformation<span class="nt">&lt;/gmd:MD_TopicCategoryCode&gt;</span>
<span class="nt">&lt;/gmd:topicCategory&gt;</span>
</pre></div>
</div>
<p>Figure 34: Example of encoding MD_Identification.abstract, MD_Identification.language and
MD_Identification.topicCategory</p>
</div>
</div>
</div>
<div class="section" id="onegeology-profile">
<span id="service-provision-onegeology-profile"></span><h2>OneGeology Profile<a class="headerlink" href="#onegeology-profile" title="Permalink to this headline">¶</a></h2>
<p>A OneGeology service will be an OGC WMS, WFS or WCS. OneGeology defines a profile of these services for two reasons. The first is to make certain parts of the OneGeology Portal work with the services. The second is to make the services as widely usable and findable as possible by ensuring that they all provide some basic metadata such as contact details for further information. Currently, a OneGeology WFS needs to be associated with one or more layers from a OneGeology WMS which portray the data as an image.</p>
<p>Each of the OGC service types shares some common characteristics. They will each have a service URL. They each respond to a GetCapabilities request by returning a GetCapabilities response that contains administrative and technical metadata about the service.</p>
<p>The OGC standards specify different kinds of metadata that a service should provide, some for the correct operation of the service and some to help human users of the service understand what is being provided. Some of the metadata applies to a whole service being provided at a particular service URL and some is specific to particular layers, coverages or features being provided by that service. This means that separate services need to be set up for each distinct set of service level metadata.</p>
<p>In the profile we make a distinction between the organization that owns or has copyright to provide the data (whom we term the ‘data owner’, or ‘data provider’) and the organization that serves that data over a web service (whom we term the ‘service provider’). These may be different in the case that a “buddy organisation” is serving the data on behalf of a data owner. As we require the contact details for the data owner to be put in the service metadata then there must be a distinct service for each data owner. If a particular data owner wishes to provide information in more than one language then there will need to be separate services with the service metadata in each language. If a data owner is providing similar data for different scales or geographical extent then this may be all provided within one service or from distinct services depending on what is most convenient.</p>
<p>For example, at the time of writing The British Geological Survey is hosting its own data, and is acting as a buddy to host data for the Afghanistan Geological Survey, and for the Namibian Geological Survey, and for the Falkland Island Government, and for Geoscience Australia for Antarctica data, each of these is only available in English language versions.  The British Geological Survey is also hosting a single language (French) service for Burkina Faso.  The net result is that BGS, acting in the role of service provider, is serving six separate services (six separate service URLs).</p>
<p>In some cases you may already have OGC services set up for other purposes than OneGeology or you may not wish to maintain a separate set of services just for OneGeology. In this case there are two possibilities. Ideally you can add metadata to your services that satisfies both OneGeology and your other requirements. If not, then in many cases, it may be possible to prepare static GetCapabilities response documents with OneGeology specific service metadata and the subset of layers, coverages or features that you wish to be registered with OneGeology. This will point to the main service URLs for retrieval of the individual layers, coverages or features. Some metadata such as layer names can’t be different in the static document from the main service. We haven’t come up with a general solution for this so you will need to contact us to discuss possibilities on an individual basis.</p>
<p>The service must comply with one of the following OGC standard specifications.</p>
<ul class="simple">
<li><p>A WMS must comply with the <a class="reference external" href="http://portal.opengeospatial.org/files/?artifact_id=1081&amp;version=1&amp;format=pdf">WMS 1.1.1</a> or <a class="reference external" href="http://portal.opengeospatial.org/files/?artifact_id=14416">WMS 1.3.0</a> specification. (This documentation now concentrates on the later version specification.)</p></li>
<li><p>An SLD enabled WMS must comply with the relevant parts of the <a class="reference external" href="http://portal.opengeospatial.org/files/?artifact_id=22364">SLD 1.1.0</a> specification.</p></li>
<li><p>A WFS must comply with the <a class="reference external" href="http://portal.opengeospatial.org/files/?artifact_id=39967">WFS 2.0.0</a> or <a class="reference external" href="http://docs.opengeospatial.org/is/09-025r2/09-025r2.html">2.0.2</a> specification</p></li>
<li><p>A WCS must comply with <a class="reference external" href="https://portal.opengeospatial.org/files/09-110r4">WCS 2.0.0</a> or higher specification. At the moment you also need to be able to supply a <a class="reference external" href="https://portal.opengeospatial.org/files/05-076">WCS 1.0.0</a> GetCapabilities response for metadata harvesting. This could be achieved by supporting the older WCS version or by just creating a static response document that complies to the format.</p></li>
</ul>
<div class="section" id="ogc-service-level-metadata">
<h3>OGC service level metadata<a class="headerlink" href="#ogc-service-level-metadata" title="Permalink to this headline">¶</a></h3>
<p>WMS, WFS, and WCS services all provide metadata about the service through their response to a GetCapabilities request. OneGeology places some requirements on this metadata, some to help the Portal operate and some as good practice to enable users to search for services, know how they can use the data and get further information. The different service types have similar but not identical structures for their GetCapabilities responses; differences will be pointed out below. In particular, the WCS 2.0 standard changed the structure considerably, moving coverage specific metadata to DescribeCoverage requests so, for the moment, we need a WCS 1.0.0 structure document to enable us to harvest coverage specific metadata easily.</p>
<div class="section" id="service-title">
<span id="service-provision-onegeology-profile-service-title"></span><h4>Service title<a class="headerlink" href="#service-title" title="Permalink to this headline">¶</a></h4>
<p>The service title isn’t used by the OneGeology Portal but it does appear in the catalogue of services so it is worth using a title that will be helpful to users browsing a catalogue. We recommend that you follow the previous OneGeology <a class="reference external" href="/wmsCookbook/2_2.html">WMS service title</a> requirements if your service fits into the scheme described there but they are no longer a requirement if, for example, your service is being used for other non-OneGeology purposes as well.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 9%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>XPath</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WMS</p></td>
<td><p>1.3.0</p></td>
<td><p>/WMS_Capabilities/Service/Title</p></td>
</tr>
<tr class="row-odd"><td><p>WFS</p></td>
<td><p>2.0.0</p></td>
<td><p>/wfs:WFS_Capabilities/ows:ServiceIdentification/ows:Title</p></td>
</tr>
<tr class="row-even"><td><p>WCS</p></td>
<td><p>1.0.0</p></td>
<td><p>/wcs:WCS_Capabilities/wcs:Service/wcs:label</p></td>
</tr>
<tr class="row-odd"><td><p>WCS</p></td>
<td><p>2.0.1</p></td>
<td><p>/wcs:Capabilities/ows:ServiceIdentification/ows:Title</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="service-abstract">
<span id="service-provision-onegeology-profile-service-abstract"></span><h4>Service abstract<a class="headerlink" href="#service-abstract" title="Permalink to this headline">¶</a></h4>
<p>Information about the service and general information about the map data served in the layers. You may also use this to field to describe the data owner organization, and its goals within OneGeology etc. You can also include in this section information about the scale layering of your service, and any other information that is not automatically extracted / viewable by the OneGeology Portal (or indeed any other client software). We can’t enforce definite rules on the content but this is important for users of your data.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 9%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>XPath</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WMS</p></td>
<td><p>1.3.0</p></td>
<td><p>/WMS_Capabilities/Service/Abstract</p></td>
</tr>
<tr class="row-odd"><td><p>WFS</p></td>
<td><p>2.0.0</p></td>
<td><p>/wfs:WFS_Capabilities/ows:ServiceIdentification/ows:Abstract</p></td>
</tr>
<tr class="row-even"><td><p>WCS</p></td>
<td><p>1.0.0</p></td>
<td><p>/wcs:WCS_Capabilities/wcs:Service/wcs:description</p></td>
</tr>
<tr class="row-odd"><td><p>WCS</p></td>
<td><p>2.0.1</p></td>
<td><p>/wcs:Capabilities/ows:ServiceIdentification/ows:Abstract</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="fees">
<span id="service-provision-onegeology-profile-fees"></span><h4>Fees<a class="headerlink" href="#fees" title="Permalink to this headline">¶</a></h4>
<p>Any fees required to use the WMS services and data contained within. If there are no fees you are recommended to explicitly state this using the word “none”.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 9%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>XPath</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WMS</p></td>
<td><p>1.3.0</p></td>
<td><p>/WMS_Capabilities/Service/Fees</p></td>
</tr>
<tr class="row-odd"><td><p>WFS</p></td>
<td><p>2.0.0</p></td>
<td><p>/wfs:WFS_Capabilities/ows:ServiceIdentification/ows:Fees</p></td>
</tr>
<tr class="row-even"><td><p>WCS</p></td>
<td><p>1.0.0</p></td>
<td><p>/wcs:WCS_Capabilities/wcs:Service/wcs:fees</p></td>
</tr>
<tr class="row-odd"><td><p>WCS</p></td>
<td><p>2.0.1</p></td>
<td><p>/wcs:Capabilities/ows:ServiceIdentification/ows:Fees</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="access-constraints">
<span id="service-provision-onegeology-profile-access-constraints"></span><h4>Access constraints<a class="headerlink" href="#access-constraints" title="Permalink to this headline">¶</a></h4>
<p>Information about who is allowed to use the data served by the WMS, and for what purpose they can use it for. Remember your WMS is available to any application that is able to access the Internet, not just through the OneGeology Portal.</p>
<p>For clarity to any potential users, it is recommended (within the OGC specifications) that you explicitly state when there are no access constraints on the using the service using the word “none”.</p>
<p>Note too that there is no “AccessConstraints” metadata applicable at the layer level. If you need to define different access constraints for different layers in your service you will need to define these differences in the service level metadata. It may be more convenient to have separate services where different access constraints apply.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 8%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>XPath</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WMS</p></td>
<td><p>1.3.0</p></td>
<td><p>/WMS_Capabilities/Service/AccessConstraints</p></td>
</tr>
<tr class="row-odd"><td><p>WFS</p></td>
<td><p>2.0.0</p></td>
<td><p>/wfs:WFS_Capabilities/ows:ServiceIdentification/ows:AccessConstraints</p></td>
</tr>
<tr class="row-even"><td><p>WCS</p></td>
<td><p>1.0.0</p></td>
<td><p>/wcs:WCS_Capabilities/wcs:Service/wcs:accessConstraints</p></td>
</tr>
<tr class="row-odd"><td><p>WCS</p></td>
<td><p>2.0.1</p></td>
<td><p>/wcs:Capabilities/ows:ServiceIdentification/ows:AccessConstraints</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="keywords">
<span id="service-provision-onegeology-profile-keywords"></span><h4>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h4>
<p>A list of keywords or short phrases that users of the OneGeology Portal and other catalogue services could use to search/discover your services. You must include the keyword OneGeology.</p>
<p>We would like you to also supply two special &#64; style ‘Metadata keywords’ (MD_DATE&#64;value and MD_LANG&#64;value) that will be used to populate the OneGeology catalogue of services, and which help make the GetCapabilities response ISO19115 core compliant.</p>
<p>MD_DATE&#64; is used to add a date for when the information in the GetCapabilites file for the service was last updated, (for MapServer services this would be the same as a change to the .map configuration file). For example the exemplar BGS_Bedrock_and_Superficial_Geology service has a MD_DATE&#64; keyword of MD_DATE&#64;2011-06-15</p>
<p>MD_LANG&#64; is used to add the language (using the ISO 639-3 three letter codes) that the GetCapabilites file is populated with. This may be different from the language that the service returns its data in. For example the exemplar BGS_Bedrock_and_Superficial_Geology service has a MD_LANG&#64; keyword of MD_LANG&#64;ENG</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 8%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>XPath</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WMS</p></td>
<td><p>1.3.0</p></td>
<td><p>/WMS_Capabilities/Service/KeywordList/Keyword</p></td>
</tr>
<tr class="row-odd"><td><p>WFS</p></td>
<td><p>2.0.0</p></td>
<td><p>/wfs:WFS_Capabilities/ows:ServiceIdentification/ows:Keywords/ows:Keyword</p></td>
</tr>
<tr class="row-even"><td><p>WCS</p></td>
<td><p>1.0.0</p></td>
<td><p>/wcs:WCS_Capabilities/wcs:Service/wcs:keywords/wcs:keyword</p></td>
</tr>
<tr class="row-odd"><td><p>WCS</p></td>
<td><p>2.0.1</p></td>
<td><p>/wcs:Capabilities/ows:ServiceIdentification/ows:Keywords/ows:Keyword</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="contact-information">
<span id="service-provision-onegeology-profile-contact-information"></span><h4>Contact information<a class="headerlink" href="#contact-information" title="Permalink to this headline">¶</a></h4>
<p>In addition to the required organisation name we recommend that you add additional contact information that will enable a user to get in touch with a named person who can act as a contact for any enquiries by post, email or phone. The different service types and versions provide slightly different structured fields for including this information under fairly self-explanatory element names. The below XPaths give the parent elements within which you can find different elements for email, phone etc. Don’t forget these are for an international audience, e.g. include country code in telephone numbers.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 9%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>XPath</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WMS</p></td>
<td><p>1.3.0</p></td>
<td><p>/WMS_Capabilities/Service/ContactInformation</p></td>
</tr>
<tr class="row-odd"><td><p>WFS</p></td>
<td><p>2.0.0</p></td>
<td><p>/wfs:WFS_Capabilities/ows:ServiceProvider/ows:ServiceContact</p></td>
</tr>
<tr class="row-even"><td><p>WCS</p></td>
<td><p>1.0.0</p></td>
<td><p>/wcs:WCS_Capabilities/wcs:Service/wcs:responsibleParty</p></td>
</tr>
<tr class="row-odd"><td><p>WCS</p></td>
<td><p>2.0.1</p></td>
<td><p>/wcs:Capabilities/ows:ServiceProvider/ows:ServiceContact</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="data-provider">
<span id="service-provision-onegeology-profile-data-provider"></span><h4>Data provider<a class="headerlink" href="#data-provider" title="Permalink to this headline">¶</a></h4>
<p>The full name of the data owner organization not service provider, where these are different, such as in buddied services. In the case of services that also supply non-OneGeology data, the contact should be able to put an enquirer in touch with whoever is responsible for the OneGeology data.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 7%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>XPath</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WMS</p></td>
<td><p>1.3.0</p></td>
<td><p>/WMS_Capabilities/Service/ContactInformation/ContactPersonPrimary/ContactOrganization</p></td>
</tr>
<tr class="row-odd"><td><p>WFS</p></td>
<td><p>2.0.0</p></td>
<td><p>/wfs:WFS_Capabilities/ows:ServiceProvider/ows:ProviderName</p></td>
</tr>
<tr class="row-even"><td><p>WCS</p></td>
<td><p>1.0.0</p></td>
<td><p>/wcs:WCS_Capabilities/wcs:Service/wcs:responsibleParty/wcs:organisationName</p></td>
</tr>
<tr class="row-odd"><td><p>WCS</p></td>
<td><p>2.0.1</p></td>
<td><p>/wcs:Capabilities/ows:ServiceProvider/ows:ProviderName</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="online-resource">
<span id="service-provision-onegeology-profile-online-resource"></span><h4>Online resource<a class="headerlink" href="#online-resource" title="Permalink to this headline">¶</a></h4>
<p>A link to the data owner organization web site, or web site with information about the data owner organization. Note this online resource is intended to provide additional information on the provider of the data and is NOT intended to be the same as the online resource attribute referenced in the Capability section of the response. (E.g. NOT the same as the resource cited in /WMS_Capabilities/Capability/Request/GetCapabilities/DCPType/HTTP/Get/OnlineResource in a 1.3.0 response.)</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 9%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>XPath</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WMS</p></td>
<td><p>1.3.0</p></td>
<td><p>/WMS_Capabilities/Service/OnlineResource</p></td>
</tr>
<tr class="row-odd"><td><p>WFS</p></td>
<td><p>2.0.0</p></td>
<td><p>/wfs:WFS_Capabilities/ows:ServiceProvider/ows:ProviderSite</p></td>
</tr>
<tr class="row-even"><td><p>WCS</p></td>
<td><p>1.0.0</p></td>
<td><p>WCS 1.0.0 no suitable element.</p></td>
</tr>
<tr class="row-odd"><td><p>WCS</p></td>
<td><p>2.0.1</p></td>
<td><p>/wcs:Capabilities/ows:ServiceProvider/ows:ProviderSite</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="layer-coverage-feature-metadata">
<h2>Layer / Coverage / Feature metadata<a class="headerlink" href="#layer-coverage-feature-metadata" title="Permalink to this headline">¶</a></h2>
<p>Depending on which service type you are serving the actual data sets that you are supplying will be delivered as a number of layers (WMS), coverages (WCS) or features (WFS). Each of these can have their own specific metadata. The OneGeology portal allows the selection of WMS layers and WCS coverages to view and presents selected aspects of the layer/coverage metadata in its layer list. These metadata are also used to arrange layers/coverages under geographical areas and under themes and enable searching for layers/coverages including searching on some aspects of their functionality.</p>
<p>WFS are a bit different. In the Portal we do not list registered WFS separately but attach them to one or more WMS layers that portray some aspect of one or more of the features of the WFS. In OneGeology we are most focussed on WFS that supply features conforming to particular community standards whether simple feature standards like GeoSciML-Lite and ERML-Lite or complex feature standards like GeoSciML and ERML. In these cases the number of feature types available from a WFS is limited by the number of feature types in the community standards and you would normally be serving data for one data set from each WFS endpoint. (If you serve more than one data set from a given endpoint the client will need to know how to formulate a query that will only retrieve features from a particular data set.) Although the metadata are not presented directly in the Portal it is still recommended to add useful metadata for searching in the catalogue and for presentation in other WFS clients. If you don’t yet have a suitable mapping from your data to a full community schema you may still be able to use your server software to generate automatically a simple feature WFS corresponding to a given WMS layer based on the same underlying dataset. In this case the features won’t strictly conform to any community schema but may still have some common field names that allow a certain level of interoperability.</p>
<div class="section" id="wms-layer-and-wcs-coverage-naming">
<span id="service-provision-onegeology-profile-layer-names"></span><h3>WMS layer and WCS coverage naming<a class="headerlink" href="#wms-layer-and-wcs-coverage-naming" title="Permalink to this headline">¶</a></h3>
<p>The OneGeology Portal allows selection of WMS layers and WCS coverages for display from a list and so it is important to have a naming convention that ensures unique titles for each of these layers and coverages. This convention has been designed to give readable, informative titles.</p>
<p>Both WMS and WCS have names which are used by software to select which layers/coverages are returned and human readable titles which are used for presenting in a client interface. The former do not need to be human readable and some server software may not allow much control over their format. The latter are the way layers and coverages are presented to a user for selection so it is important that they are understandable and informative. Thus OneGeology has a naming convention which we require for the human readable titles. It can also be friendly to make the machine readable names understandable for testing or writing custom clients so, although we don’t make it a requirement, we do recommend that you follow the conventions below for the machine readable names as well if you can.</p>
<p>The titles should contain the following components which are explained in more detail below: <strong>[Geographical extent]</strong> of the data in the layer, then <strong>[Data owner organization]</strong> (not service provider), then <strong>[Language code]</strong> (if more than one language being provided), then <strong>[Scale]</strong>, then <strong>[Theme]</strong>.</p>
<div class="section" id="geographic-extent">
<h4>Geographic extent<a class="headerlink" href="#geographic-extent" title="Permalink to this headline">¶</a></h4>
<p>The first piece of information is the Geographic extent.  Geographic extent should begin wherever practically possible with the Country of the layer extent, even if the layer only covers part of a country, or if the layer covers all of one country (use that as the country code) and some of the surrounding landmass or sea area.  Country information is codified using the <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3">ISO 3166-1 three-letter country codes</a></p>
<p>When the layer covers an area such as a defined region, state or province within a country, you should state the country code first and then the provincial information.  Provincial information should wherever practically possible be codified using the <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_3166-2">ISO 3166-2 codes</a></p>
<p>For example:</p>
<ul class="simple">
<li><p>The US state of Kentucky would use US-KY</p></li>
<li><p>The semi-autonomous region of Flanders (Northern Belgium) would use BE-VLG</p></li>
</ul>
<p>Note, the ISO 3166-2 codes use a 2 letter country code then hyphen then provincial code.</p>
<p>If you are using your own provincial code (known within your county perhaps but not codified by ISO), you should use the three letter ISO country code, then a space (not a hyphen), and then your provincial code.</p>
<p>The OneGeology Portal divides countries and regions using the United Nations (UN) “World macro regions and components” listing. If you are serving regional data wider than country level, you should use the <a class="reference external" href="http://unstats.un.org/unsd/methods/m49/m49regin.htm">UN regions</a> where possible.</p>
<p>Where the layer coverage doesn’t correspond to a country and/or when no ISO code or UN region exists to describe the coverage, you should use a short geographic name such as “World”.</p>
</div>
<div class="section" id="data-owner">
<h4>Data owner<a class="headerlink" href="#data-owner" title="Permalink to this headline">¶</a></h4>
<p>Geographic extent information is followed by the data owner organization code (not service provider), the same as recommended for the service title.</p>
</div>
<div class="section" id="language">
<h4>Language<a class="headerlink" href="#language" title="Permalink to this headline">¶</a></h4>
<p>If you need to include language in your layer you should use the same ISO 639-1 two-letter language code <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes">(https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes)</a> as recommended for the service title and include it <em>after</em> the data owner organization code .</p>
</div>
<div class="section" id="scale">
<h4>Scale<a class="headerlink" href="#scale" title="Permalink to this headline">¶</a></h4>
<p>Scale comes next and is shortened using SI symbols:</p>
<ul class="simple">
<li><p>“M” for Million (upper case)</p></li>
<li><p>“k” for thousand (lower case)</p></li>
</ul>
<p>Such that a 1:1 000 000 scale map would be represented in the layer title as 1:1M and a 1:625 000 scale map would be represented in the layer title as 1:625k.  In the layer names we shorten this further by removing the “1:” portion so that a 1:1 000 000 scale map is represented as 1M and a 1:625 000 scale map is represented as 625k.</p>
<p>Additionally, if the map scale is represented in the layer title as 1:1.5M we can lose the decimal point in the layer name by using 1500k.  <strong>Note</strong>, you do not have to use the 1500k format over the 1.5M format, rather we offer this format as an alternative, if your server software has an issue with dots in the layer name.</p>
</div>
<div class="section" id="theme">
<h4>Theme<a class="headerlink" href="#theme" title="Permalink to this headline">¶</a></h4>
<p>The theme is the geological description of the data contained in the layer.  As with the service title theme, the layer title theme should be a descriptive phrase in the service language.  For English services the layers will most commonly have titles such as “Bedrock Age”, “Bedrock Lithology” etc.</p>
<p>As mentioned above the layer names are for the consumption of the WMS software.  It is important that within the OneGeology Portal the layer names are unique.  The data owner is responsible to guarantee that there is no layer name duplication in all the layers they provide.</p>
<p>When we first started defining the rules for the OneGeology Portal we discovered that MapServer had a 20 character maximum limit on LAYER names (though this limit no longer applies), to get over this issue we defined a set of two and three letter codes to describe the most common layer themes to be used in the layer names, these are described below:</p>
<p>BA — Bedrock Age</p>
<p>BLT — Bedrock Lithology</p>
<p>BLS — Bedrock Lithostratigraphy</p>
<p>SLT — Superficial Lithology</p>
<p>SLS — Superficial Lithostratigraphy</p>
<p>MSF — Major Structural Features</p>
<p>This list is not exclusive, so please create your own if need be.</p>
<p>Note, if you decide to use ESRI ArcGIS server (versions 9.3.1 and below) you will not be able to conform to this layer naming convention, because the software auto-names the map layers 0, 1, 2…  This problem will be dealt with in the OneGeology Registry through the use of auto-generated unique id’s for each registered service layer, this is necessary as in a Catalogue like that for OneGeology one cannot have two layers having the same name i.e. both being named layer name 0.</p>
<p>This issue has been resolved in ESRI ArcGIS server 10</p>
</div>
<div class="section" id="layer-title-examples">
<h4>Layer title examples<a class="headerlink" href="#layer-title-examples" title="Permalink to this headline">¶</a></h4>
<p>GBR BGS 1:625k Bedrock Age</p>
<p>FRA BRGM 1:1M Formations géologiques - France Continentale</p>
<p>FRA BRGM 1:1M Formations géologiques - Guyanne</p>
<p>Note, it is acceptable to replace the ISO country code with a more readable name in the layer title</p>
</div>
<div class="section" id="layer-name-examples">
<h4>Layer name examples<a class="headerlink" href="#layer-name-examples" title="Permalink to this headline">¶</a></h4>
<p>Remember that older versions of MapServer had a limit of 20 Characters for LAYER names; though this restriction no longer applies.</p>
<p>FRA_BRGM_1M_GeoUnits</p>
<p>GBR_BGS_625k_BA</p>
<p>World_25M_GeolUnits</p>
<p>Europe_BGR_5M_BLS</p>
<p>US-KY_KGS_24k_Faults</p>
</div>
<div class="section" id="inspire-layer-naming-considerations">
<h4>INSPIRE layer naming considerations<a class="headerlink" href="#inspire-layer-naming-considerations" title="Permalink to this headline">¶</a></h4>
<p>If your service falls under the INSPIRE naming conventions, then both the layer name and the layer title are fixed according to the legislation. For example the <a class="reference external" href="http://inspire.ec.europa.eu/documents/Data_Specifications/INSPIRE_DataSpecification_GE_v3.0.pdf">D2.8.II.4 Data Specification on Geology–Technical Guidelines</a> tell us (section 11.1 ~ Layers to be provided by INSPIRE view services) that any layer to do with lithology or age must have the name <em>GE.GeologicUnit</em> and title <em>Geologic Units</em>.  See the <a class="reference external" href="https://themes.jrc.ec.europa.eu/discussion/view/13952/layer-naming">layer-naming</a> discussion on the INSPIRE Thematic Clusters Geology forum for fuller details.</p>
<p>To have a multiple layer geology service that adheres to the INSPIRE naming rules we believe the only option is for you to configure group layering. In such a situation, the layer name and title rules set out above relate to the grouped (or sub layers).  Whereas the INSPIRE name and title relate to the group (or parent) layer. If your INSPIRE service is only serving layers of one type, one way of applying group layering would be to use the WMS root layer name and title (not service name and title) as the grouping layer.</p>
</div>
</div>
<div class="section" id="summary-of-layer-coverage-feature-metadata">
<h3>Summary of layer/coverage/feature metadata<a class="headerlink" href="#summary-of-layer-coverage-feature-metadata" title="Permalink to this headline">¶</a></h3>
<p>For WMS layers and WCS coverages the machine readable name and human readable name should follow the conventions above. For WFS, if the data is being put out following a standard community schema then the machine readable name will be fixed according to the schema and a reasonable human readable name will probably be defined by the schema as well. If it is a simple WFS mirroring a WMS layer dataset then the names can match the WMS layer names.These go in the below places in the capabilities response.</p>
<div class="section" id="machine-readable-name">
<h4>Machine readable name<a class="headerlink" href="#machine-readable-name" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/Name (1.3.0)</p></li>
<li><p>/wcs:WCS_Capabilities/wcs:ContentMetadata/wcs:CoverageOfferingBrief/wcs:name (1.0.0)</p></li>
<li><p>/wcs:Capabilities/wcs:Contents/wcs:CoverageSummary/wcs:CoverageId (2.0)</p></li>
<li><p>/wfs:WFS_Capabilities/wfs:FeatureTypeList/wfs:FeatureType/wfs:Name (2.0.x)</p></li>
</ul>
</div>
<div class="section" id="human-readable-name">
<h4>Human readable name<a class="headerlink" href="#human-readable-name" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/Title (1.3.0)</p></li>
<li><p>/wcs:WCS_Capabilities/wcs:ContentMetadata/wcs:CoverageOfferingBrief/wcs:label (1.0.0)</p></li>
<li><p>/wcs:Capabilities/wcs:Contents/wcs:CoverageSummary/ows:Title (2.0)</p></li>
<li><p>/wfs:WFS_Capabilities/wfs:FeatureTypeList/wfs:FeatureType/wfs:Title (2.0.x)</p></li>
</ul>
</div>
<div class="section" id="abstract">
<span id="service-provision-onegeology-profile-layer-abstract"></span><h4>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h4>
<p>You must provide a description of your layer/coverage data. You may wish to include other metadata, such as information about your organization and other data you make available. You may also wish to include a statement on access constraints. For features following a standard community Schema this may not be so relevant at the feature level in that a service will be providing data for a certain data set and the abstract description of the features will be just the general description of that feature type in the schema.</p>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/Abstract (1.3.0)</p></li>
<li><p>/wcs:WCS_Capabilities/wcs:ContentMetadata/wcs:CoverageOfferingBrief/wcs:description (1.0.0)</p></li>
<li><p>/wcs:Capabilities/wcs:Contents/wcs:CoverageSummary/ows:Abstract (2.0)</p></li>
<li><p>/wfs:WFS_Capabilities/wfs:FeatureTypeList/wfs:FeatureType/wfs:Abstract (2.0.x)</p></li>
</ul>
</div>
<div class="section" id="service-provision-onegeology-profile-layer-keywords">
<span id="id28"></span><h4>Keywords<a class="headerlink" href="#service-provision-onegeology-profile-layer-keywords" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/KeywordList/Keyword (1.3.0)</p></li>
<li><p>/WCS_Capabilities/ContentMetadata/CoverageOfferingBrief/keywords/keyword (1.0.0)</p></li>
<li><p>/wcs:Capabilities/wcs:Contents/wcs:CoverageSummary/ows:Keywords/ows:Keyword (2.0.x)</p></li>
</ul>
<p>The Keyword “OneGeology” must be present to be able to search for services and layers with this keyword. OneGeologyEurope participants should also include relevant keywords chosen from the keyword list created for that project and listed in <a class="reference external" href="https://onegeology.github.io/documentation/appendices.html#appendix-i-onegeology-english-keyword-dictionary-picklist">Appendix I</a>. The main purpose of these keywords is to make your services discoverable by a user searching in a catalogue of services, so a clearly formed but limited list of geosciences domain specific is ideal and all OneGeology global participants may also want to consider using items from this proposed OneGeology-Europe list, which has been formed by looking at many such lists available around the world including the European GEMET thesaurus found at: <a class="reference external" href="http://www.eionet.europa.eu/gemet/en/themes/">http://www.eionet.europa.eu/gemet/en/themes/</a>.</p>
<p>The following broad concepts are good starting points</p>
<p><a class="reference external" href="http://www.eionet.europa.eu/gemet/en/concept/2405">http://www.eionet.europa.eu/gemet/en/concept/2405</a> (earth science)</p>
<p><a class="reference external" href="http://www.eionet.europa.eu/gemet/en/concept/3648">http://www.eionet.europa.eu/gemet/en/concept/3648</a> (geological process)</p>
<p>Each keyword (or short phrase) must be contained within its own &lt;keyword&gt; element.</p>
<p>In addition to this we also require you to add a number of special ‘Cataloguing keywords’ to help the OneGeology Portal and catalogue services better index your layers.  These special keywords have a term then an ‘&#64;’ symbol and then your value for the term, as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Continent</span><span class="p">:</span>                          <span class="n">continent</span><span class="nd">@value</span>       <span class="n">Required</span>
<span class="n">Subcontinent</span><span class="p">:</span>                       <span class="n">subcontinent</span><span class="nd">@value</span>    <span class="n">Conditional</span>
<span class="n">Geographic</span> <span class="n">area</span> <span class="p">(</span><span class="n">usually</span> <span class="n">country</span><span class="p">):</span>  <span class="n">geographicarea</span><span class="nd">@value</span>  <span class="n">Required</span>
<span class="n">State</span><span class="p">(</span><span class="n">Region</span> <span class="ow">or</span> <span class="n">province</span><span class="p">):</span>          <span class="n">subarea</span><span class="nd">@value</span>         <span class="n">Conditional</span>
<span class="n">Data</span> <span class="n">provider</span><span class="p">:</span>                      <span class="n">dataprovider</span><span class="nd">@value</span>    <span class="n">Required</span>
<span class="n">Service</span> <span class="n">provider</span><span class="p">:</span>                   <span class="n">serviceprovider</span><span class="nd">@value</span> <span class="n">Required</span>
</pre></div>
</div>
<p>The geographicarea&#64;value represents a verbalization of the code that starts a layer name. For most layers geographicarea&#64;value will be a country; this INCLUDES layers that only show a sub-region or state within a country.</p>
<p>The values for Continent, Subcontinent and Country must be taken from the United Nations (UN) list: <a class="reference external" href="http://unstats.un.org/unsd/methods/m49/m49regin.htm">http://unstats.un.org/unsd/methods/m49/m49regin.htm</a> used by the OneGeology Portal.</p>
<p>Conditional keywords are required if they apply. E.g. If the geographic area is a state or province then the subarea keyword is required.</p>
<p>In addition we would like that you also supply the following two special ‘Metadata keywords’ for each layer. These keywords help make the GetCapabilities response ISO19115 core compliant.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Layer</span> <span class="p">(</span><span class="n">Data</span> <span class="nb">set</span><span class="p">)</span> <span class="n">date</span><span class="p">:</span>              <span class="n">DS_DATE</span><span class="nd">@value</span>
<span class="n">Layer</span> <span class="p">(</span><span class="n">Data</span> <span class="nb">set</span><span class="p">)</span> <span class="n">topic</span> <span class="n">category</span><span class="p">:</span>    <span class="n">DS_TOPIC</span><span class="nd">@value</span>        <span class="p">(</span><span class="n">one</span> <span class="ow">or</span> <span class="n">more</span> <span class="k">as</span> <span class="n">appropriate</span><span class="p">)</span>
</pre></div>
</div>
<p>The topic category is taken from the ISO 19119 topic category listing.  A good reference to the categories and what they represent is found at: <a class="reference external" href="https://gcmd.nasa.gov/add/difguide/iso_topics.html">https://gcmd.nasa.gov/add/difguide/iso_topics.html</a>. We anticipate that most layers would have a DS_TOPIC&#64;geoscientificinformation keyword.</p>
<p>So for example, the layer “AFG AGS 1:1M Bedrock Age” would include the following keywords:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;KeywordList&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>OneGeology<span class="nt">&lt;/Keyword&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>Afghanistan<span class="nt">&lt;/Keyword&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>continent@Asia<span class="nt">&lt;/Keyword&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>subcontinent@South-central Asia<span class="nt">&lt;/Keyword&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>geographicarea@Afghanistan<span class="nt">&lt;/Keyword&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>serviceprovider@British Geological Survey<span class="nt">&lt;/Keyword&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>dataprovider@Afghanistan Geological Survey<span class="nt">&lt;/Keyword&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>DS_TOPIC@geoscientificinformation<span class="nt">&lt;/Keyword&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>DS_DATE@2008-12-03<span class="nt">&lt;/Keyword&gt;</span>
 <span class="nt">&lt;Keyword&gt;</span>thematic@geology<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;/KeywordList&gt;</span>
</pre></div>
</div>
<p>Note, that we have the country twice, once as one of the OneGeology Portal special keywords, and once as the country only; this is because we recognize that the service may be consumed (and catalogued) by services other than OneGeology. We don’t include a subarea&#64; keyword in this list because that would not be appropriate in this instance.</p>
<p>To help classify your service in the portal according to the thematic keyword list (as detailed in <a class="reference external" href="https://onegeology.github.io/documentation/appendices.html#appendix-i-onegeology-english-keyword-dictionary-picklist">Appendix I</a>), you should also use one or more <em>thematic&#64;value keywords</em>.</p>
<p><strong>Please note</strong> services using GeoSciML-Lite also require the following keyword: <strong>Geosciml_portrayal_age_or_litho_queryable</strong> (GeoSciML-Lite was previously called GeoSciML-Portrayal.)</p>
<p>For those WMS layers with an associated GeoSciML WFS that you would like to query using the OneGeology Portal thematic analysis tool, you will need to add the appropriate <strong>GeoSciML32_wfs_age_or_litho_queryable</strong> or <strong>GeoSciML4_wfs_age_or_litho_queryable</strong> keyword.</p>
</div>
</div>
<div class="section" id="wms-specific-metadata">
<h3>WMS Specific Metadata<a class="headerlink" href="#wms-specific-metadata" title="Permalink to this headline">¶</a></h3>
<p>The following sections were defined for the earlier WMS only specific OneGeology profile and haven’t yet been considered for updating to other service types.</p>
<div class="section" id="extent">
<span id="service-provision-onegeology-profile-layer-extent"></span><h4>Extent<a class="headerlink" href="#extent" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/EX_GeographicBoundingBox (1.3.0)</p></li>
</ul>
<p>In WMS version 1.3.0 four elements each describing a single bounding limit (always in the order: west, east, south, north). The purpose of these extent values is to facilitate geographic searches; values may be approximate.</p>
</div>
<div class="section" id="spatial-coordinate-reference-system">
<span id="service-provision-onegeology-profile-layer-crs"></span><h4>Spatial/Coordinate reference system<a class="headerlink" href="#spatial-coordinate-reference-system" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/CRS (1.3.0)</p></li>
</ul>
<p>A list of one or more horizontal ’Spatial Reference Systems’ that the layer can handle (will accept requests in and return results based upon those SRS).  In WMS 1.1.1, the returned image is always projected using a pseudo-Plate Carrée projection that plots Longitude along the X-axis and Latitude along the Y-axis.</p>
<p>For example, the exemplar service lists the following Spatial Reference Systems: EPSG:4326, EPSG:3857, CRS:84, EPSG:27700, EPSG:4258</p>
<p>The portal now supports the projection systems below, including two suitable for INSPIRE compliance:</p>
<blockquote>
<div><dl class="simple">
<dt>EPSG:3031</dt><dd><p>Antarctic Polar Stereographic (WGS84) <a class="reference external" href="http://epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::3031">urn:ogc:def:crs:EPSG::3031</a></p>
</dd>
<dt>EPSG:3034</dt><dd><p>Lambert Conformal Conic (ETRS89) <a class="reference external" href="http://epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::3034">urn:ogc:def:crs:EPSG::3034</a> (suitable for INSPIRE compliance)</p>
</dd>
<dt>EPSG:3413</dt><dd><p>NSIDC Sea Ice Polar Stereographic North (WGS84) <a class="reference external" href="http://epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::3413">urn:ogc:def:crs:EPSG::3413</a></p>
</dd>
<dt>EPSG:3857</dt><dd><p>Web Mercator (WGS84) <a class="reference external" href="http://epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::3857">urn:ogc:def:crs:EPSG::3857</a></p>
</dd>
<dt>EPSG:4258</dt><dd><p>2D Latitude / Longitude (ETRS89) <a class="reference external" href="http://epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::4258">urn:ogc:def:crs:EPSG::4258</a> (suitable for INSPIRE compliance)</p>
</dd>
<dt>EPSG:4326</dt><dd><p>2D Latitude / Longitude (WGS84) <a class="reference external" href="http://epsg-registry.org/export.htm?wkt=urn:ogc:def:crs:EPSG::4326">urn:ogc:def:crs:EPSG::4326</a></p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="boundingbox">
<span id="service-provision-onegeology-profile-layer-bbox"></span><h4>BoundingBox<a class="headerlink" href="#boundingbox" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/BoundingBox (1.3.0)</p></li>
</ul>
<p>The BoundingBox attributes indicate the edges of the bounding box in units of the specified spatial reference system, for example, the exemplar service provides the following BoundingBox information for the GBR BGS 1:625k bedrock lithology layer:</p>
<p><strong>Example WMS 1.3.0 response</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:4326&quot;</span> <span class="na">minx=</span><span class="s">&quot;49.8638&quot;</span> <span class="na">miny=</span><span class="s">&quot;-8.64846&quot;</span> <span class="na">maxx=</span><span class="s">&quot;60.8612&quot;</span> <span class="na">maxy=</span><span class="s">&quot;1.76767&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:3857&quot;</span> <span class="na">minx=</span><span class="s">&quot;-962742&quot;</span> <span class="na">miny=</span><span class="s">&quot;6.42272e+006&quot;</span> <span class="na">maxx=</span><span class="s">&quot;196776&quot;</span> <span class="na">maxy=</span><span class="s">&quot;8.59402e+006&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;CRS:84&quot;</span> <span class="na">minx=</span><span class="s">&quot;-8.64846&quot;</span> <span class="na">miny=</span><span class="s">&quot;49.8638&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1.76767&quot;</span> <span class="na">maxy=</span><span class="s">&quot;60.8612&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:27700&quot;</span> <span class="na">minx=</span><span class="s">&quot;-77556.4&quot;</span> <span class="na">miny=</span><span class="s">&quot;-4051.91&quot;</span> <span class="na">maxx=</span><span class="s">&quot;670851&quot;</span> <span class="na">maxy=</span><span class="s">&quot;1.23813e+006&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:4258&quot;</span> <span class="na">minx=</span><span class="s">&quot;49.8638&quot;</span> <span class="na">miny=</span><span class="s">&quot;-8.64846&quot;</span> <span class="na">maxx=</span><span class="s">&quot;60.8612&quot;</span> <span class="na">maxy=</span><span class="s">&quot;1.76767&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p><strong>Please note the x,y axes order for the geographic coordinate systems EPSG:4258 and EPSG:4326. In WMS version 1.3.0 the x-axis is the first axis in the CRS definition, and the y-axis is the second. So for example EPSG:4326 refers to WGS 84 geographic latitude, then longitude. That is, in this CRS the x axis corresponds to latitude, and the y axis to longitude.  Most EPSG geographic coordinate reference systems follow this (x=lat,y=lon) pattern.</strong></p>
</div>
<div class="section" id="dataurl-optional">
<span id="service-provision-onegeology-profile-layer-data-url"></span><h4>DataURL (optional)<a class="headerlink" href="#dataurl-optional" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/DataURL (1.3.0)</p></li>
</ul>
<p>This may be used to provide further information about all the digital data offered by the data provider, though it is primarily used to provide a link to non-standards compliant metadata for the layer in question.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;DataURL&gt;</span>
<span class="nt">&lt;Format&gt;</span>text/html<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;OnlineResource</span>
  <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span>
  <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span>
  <span class="na">xlink:href=</span><span class="s">&quot;http://www.bgs.ac.uk/discoverymetadata/13480426.html&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/DataURL&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="metadataurl-optional">
<span id="service-provision-onegeology-profile-layer-metadata-url"></span><h4>MetadataURL (optional)<a class="headerlink" href="#metadataurl-optional" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/MetadataURL (1.3.0)</p></li>
</ul>
<p>You <strong>should</strong> supply one or more on-line resources offering detailed, standardized (either as “FGDC:1998” or “ISO 19115:2003”) metadata about the layer data. If your metadata is not available in either of these standards you <strong>MUST</strong> instead use a DataURL.</p>
<p>The core ISO 19115:2003 metadata required to be compliant is shown under <a class="reference internal" href="#service-provision-onegeology-profile-core-metadata"><span class="std std-ref">Core TC211/ISO:19115 Metadata</span></a>.  Note, there are no formatting requirements; this information could be provided as xml or html or text or pdf etc as long as it accessible on the web.</p>
<p><strong>Example WMS 1.3.0 response</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;MetadataURL</span> <span class="na">type=</span><span class="s">&quot;ISO 19115:2003&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;Format&gt;</span>application/xml; charset=UTF-8<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;OnlineResource</span>
  <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span>
  <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span>
  <span class="na">xlink:href=</span><span class="s">&quot;http://metadata.bgs.ac.uk/geonetwork/srv/en/csw?</span>
<span class="s">    service=CSW&amp;</span>
<span class="s">    version=2.0.2&amp;</span>
<span class="s">    request=GetRecordById&amp;</span>
<span class="s">    id=ac9f8250-3ae5-49e5-9818-d14264a4fda4&amp;&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/MetadataURL&gt;</span>
</pre></div>
</div>
<p>Please note: the defined attribute value to indicate ISO 19115:2003 metadata is “ISO 19115:2003” in WMS version 1.3.0 as opposed to “TC211” in version 1.1.1. In version 1.3.0, communities may <strong>ALSO</strong> define their own attributes. We <strong>RECOMMEND</strong> that if you can change this attribute for different WMS version GetCapabilities responses you should use “ISO 19115:2003” for your WMS 1.3.0 response. If you can only configure one response type then you <strong>MUST</strong> use “TC211”.</p>
</div>
<div class="section" id="legend-url">
<span id="service-provision-onegeology-profile-layer-legend-url"></span><h4>Legend url<a class="headerlink" href="#legend-url" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/WMS_Capabilities/Capability/Layer/Layer/Style/LegendURL (1.3.0)</p></li>
</ul>
<p>We require you to have some sort of legend to accompany your map data. In many cases your server software will create this for you automatically using the inbuilt SLD capability. If your WMS server is not SLD capable, or if you have a complex legend, you may add the LegendURL manually in your GetCapabilities response document.  See below <a class="reference internal" href="#style-examples"><span class="std std-ref">Layer styling information</span></a>.</p>
</div>
<div class="section" id="layer-styling-information">
<span id="style-examples"></span><h4>Layer styling information<a class="headerlink" href="#layer-styling-information" title="Permalink to this headline">¶</a></h4>
<p>The examples below show the styling portion of the GetCapabilities response.  The first shows that the legend will be generated on-the-fly using an SLD GetLegendGraphic request. The second shows a simple request to a static image, generated in advance by the map service provider.</p>
<p>Example style information from a MapServer version 5.6.5 WMS version 1.3.0. GetCapabilities response.  The legend will be created automatically by MapServer and served using an SLD GetLegendGraphic operation.  Note the OnlineResource URL now includes an sld_version parameter.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Style&gt;</span>
    <span class="nt">&lt;Name&gt;</span>default<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;Title&gt;</span>default<span class="nt">&lt;/Title&gt;</span>
    <span class="nt">&lt;LegendURL</span> <span class="na">width=</span><span class="s">&quot;328&quot;</span> <span class="na">height=</span><span class="s">&quot;3013&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Format&gt;</span>image/png<span class="nt">&lt;/Format&gt;</span>
        <span class="nt">&lt;OnlineResource</span>
            <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span>
            <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span>
            <span class="na">xlink:href=</span><span class="s">&quot;http://ogc.bgs.ac.uk/cgi-bin/BGS_GSN_Bedrock_Geology/wms?</span>
<span class="s">            version=1.3.0&amp;amp;</span>
<span class="s">            service=WMS&amp;amp;</span>
<span class="s">            request=GetLegendGraphic&amp;amp;</span>
<span class="s">            sld_version=1.1.0&amp;amp;</span>
<span class="s">            layer=NAM_GSN_1M_BLS&amp;amp;</span>
<span class="s">            format=image/png&amp;amp;</span>
<span class="s">            STYLE=default&amp;amp;&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/LegendURL&gt;</span>
<span class="nt">&lt;/Style&gt;</span>
</pre></div>
</div>
<p>Example style information from an ArcGIS server WMS version 1.3.0. GetCapabilities response.  A detailed static legend is provided.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Style&gt;</span>
<span class="nt">&lt;Name&gt;</span>default<span class="nt">&lt;/Name&gt;</span>
<span class="nt">&lt;Title&gt;</span>US-KY KGS 1:500K Kentucky Geologic Formations<span class="nt">&lt;/Title&gt;</span>
<span class="nt">&lt;LegendURL</span> <span class="na">width=</span><span class="s">&quot;100&quot;</span> <span class="na">height=</span><span class="s">&quot;588&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;Format&gt;</span>image/png<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;OnlineResource</span>
  <span class="na">xlink:href=</span><span class="s">&quot;http://.../.../KGS_Geology_and_Faults_MapServer/wms/default2.png&amp;amp;&quot;</span>
  <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span>
  <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/LegendURL&gt;</span>
<span class="nt">&lt;/Style&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="wms-getfeatureinfo-response">
<span id="service-provision-onegeology-profile-layer-getfeatureinfo"></span><h4>WMS GetFeatureInfo response<a class="headerlink" href="#wms-getfeatureinfo-response" title="Permalink to this headline">¶</a></h4>
<p>Depending on the data you have available for each layer and depending on your WMS software, you may be able to configure what is returned in response to GetFeatureInfo requests on each layer, either to format the look of the data returned or to restrict the data attributes returned.</p>
<p>Ideally the response should include a field for age/lithology/lithostratigraphy as appropriate for each layer.  You may choose to include other information you consider useful but please try to exclude data fields that only have meaning internal to your organization.</p>
<p>Preferably it should be possible to retrieve the information in at least text/html and text/plain formats.</p>
</div>
</div>
<div class="section" id="core-tc211-iso-19115-metadata">
<span id="service-provision-onegeology-profile-core-metadata"></span><h3>Core TC211/ISO:19115 Metadata<a class="headerlink" href="#core-tc211-iso-19115-metadata" title="Permalink to this headline">¶</a></h3>
<p>This section has been added to allow you to understand what metadata you need to supply, if you choose to supply additional metadata about a layer as an online resource <strong>AND</strong> if you want to use the MetadataURL to reference that resource.  If you wish to supply an online resource to layer metadata, that doesn’t conform to the minimum standard set out below (or FGDC:1998) then you cannot use the MetadataURL; we recommend that you use the DataURL.  If you also wish to supply a URL to your web site, to highlight all your data products (for example), then you can use the SERVICE level online resource URL; in MapServer you do this by specifying the WMS_SERVICE_ONLINERESOURCE (or OWS_SERVICE_ONLINERESOURCE) keyword.</p>
<p>For example in our exemplar service we have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OWS_SERVICE_ONLINERESOURCE</span> <span class="s2">&quot;http://www.bgs.ac.uk/products/digitalmaps/digmapgb.html&quot;</span>
</pre></div>
</div>
<p>Note that TC211/ISO:19115:2003 is not itself a format, but a standard for defining formats and profiles.  To comply with the ISO:19115:2003 metadata standard a data format (or profile) must define a core set of metadata elements as shown below.  Note, for the purposes of the OneGeology Portal if you are showing your metadata (when accessed using the MetadataURL) in an HTML/text or pdf page it is sufficient to provide only Mandatory metadata, and Conditional metadata (where appropriate).</p>
<table cellpadding="5" cellspacing="0" class="borderedTable">
<colgroup ><col width="50%" /></colgroup>
<thead>
<tr><th colspan="2"><p>Mandatory (M): The metadata entity or metadata element shall be documented</p>
<p>Conditional (C):  The metadata entity or metadata element shall be documented if another entity or element has been documented, or if a condition is or isn’t met elsewhere.</p>
<p>Optional (O): Provided to allow users to document their data more fully.</p></th></tr>
</thead>
<tbody>
  <tr>
    <td>**Dataset title** (M)
      <p>A unique title (within your metadata records) for your data.</p></td>
    <td>**Spatial representation type** (O)
      <p>The method used to represent geographic information in the dataset. i.e., vector, grid, TIN etc.</p></td>
  </tr>
  <tr>
    <td>**Dataset reference date** (M)</td>
    <td>**Reference system** (O)</td>
  </tr>
  <tr>
    <td>**Dataset responsible party** (O)</td>
    <td>**Lineage** (O) </td>
  </tr>
  <tr>
    <td>**Geographic location** of the dataset (by four coordinates or by geographic identifier) (C)
      <p>If the metadata applies to a data set which is spatially referenced (such as a OneGeology WMS) this is required.</p></td>
    <td>**On-line resource **(O) </td>
  </tr>
  <tr>
    <td>**Dataset language** (M)
      <p>Language(s) used within the dataset. Required even if the resource does not include any textual information; defaults to the Metadata language.</p></td>
    <td>**Metadata file identifier** (O)
      <p>Unique identifier for this metadata file</p></td>
  </tr>
  <tr>
    <td>**Dataset character set** (C)
      <p>Full name of the character encoding used for the data set.  You must supply this character set if you are not using the ISO/IEC 10646-1 character set and if your character set is not defined by the document encoding.</p></td>
    <td>**Metadata standard name** (O)
      <p>Name of the metadata standard (including profile name) used</p></td>
  </tr>
  <tr>
    <td>**Dataset topic category** (M)
      <p>Main theme(s) of the data set described using the most appropriate term defined in the standard; for OneGeology services these are likely to be one or more from: ‘*geoscientificInformation*’, ‘*economy*’ (for layers showing mineral resources), or ‘*imageryBaseMapsEarthCover*’</p></td>
    <td>**Metadata standard version** (O)
      <p>Version (profile) of the metadata standard used</p></td>
  </tr>
  <tr>
    <td>**Spatial resolution of the dataset** (O)
      <p>Scale or factor which provides a general understanding of the density of the spatial data in the dataset.</p></td>
    <td>**Metadata language** (C)
      <p>Language used to document the metadata. You must supply the metadata language if it is not defined by the document encoding.</p>
      <p>Note for INSPIRE GEMINI metadata you must always supply the metadata language.</p></td>
  </tr>
  <tr>
    <td>**Abstract defining the dataset** (M)
      <p>Brief narrative summary of the content of the resource.</p></td>
    <td>**Metadata character set** (C)
      <p>Full name of the character encoding used for the metadata set. You must supply this character set in your metadata if you are not using the `ISO/IEC 10646-1 character set <https://en.wikipedia.org/wiki/Universal_Character_Set>`_ (https://en.wikipedia.org/wiki/Universal_Character_Set) AND if your character set is not defined by the document encoding.  Note as most XML and HTML pages provide a character set as part of their own metadata, it is likely that you will not need to explicitly state this for your own layer metadata</p></td>
  </tr>
  <tr>
    <td>**Distribution format** (O) </td>
    <td>**Metadata point of contact** (M)
      <p>Party responsible for the metadata information</p></td>
  </tr>
  <tr>
    <td>**Additional extent information for the dataset** (vertical and temporal) (O)</td>
    <td>**Metadata date stamp** (M)</td>
  </tr>
  </tbody>
</table><p>OneGeology Europe participants should note that conformance of an ISO 19115 metadata set to the ISO 19115 Core does not guarantee conformance to INSPIRE metadata, see the INSPIRE technical guidelines document <a class="reference external" href="http://inspire.ec.europa.eu/documents/Metadata/MD_IR_and_ISO_20131029.pdf">MD_IR_and_ISO_v1_2_20100616</a> for further details.</p>
</div>
</div>
<div class="section" id="id34">
<h2>GeoSciML<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h2>
<p>GeoSciML (GeoScience Markup Language) is a GML (Geography Markup Language) application language for geoscience.</p>
<p><strong>The design, build and deployment of information technologies that enable and advance geoscience information management, analysis and delivery will require systems that are interoperable following international agreed standards that are relevant to the geosciences.</strong></p>
<p>It is an XML schema for data exchange over the Internet that incorporates the ability to represent geography (geometries e.g. polygons, lines and points using the OGC’s GML specification) as part of the features that are being exchanged. The range of features being offered for exchange are defined by the domain or subject area of geoscience or the geological sciences.</p>
<p>GeoSciML accommodates the short-term goal of representing geoscience information associated with geological maps and observations, as well as being extensible in the long-term to other geoscience data. It draws from many geoscience data model efforts, and from these establishes a common suite of feature types based on geological criteria (units, structures, fossils) or artefacts of geological investigations (specimens, sections, measurements). Supporting objects are also considered (timescale, lexicons, etc), so that they can be used as classifiers for the primary objects.</p>
<p>GeoSciML is based on <a class="reference external" href="http://www.w3c.org">W3C</a>, OGC, <a class="reference external" href="http://www.seegrid.csiro.au/twiki/bin/view/CGIModel/WebHome">CGI Data Model</a>  and ultimately <a class="reference external" href="http://www.iso.org">ISO</a> international standards for data exchange over the Internet. GeoSciML is being designed under the umbrella of the <a class="reference external" href="http://www.iugs.org/">IUGS Commission</a> on the Management and Application of Geoscience Information (CGI) and its <a class="reference external" href="http://cgi-iugs.org/tech_collaboration/interoperability_working_group.html">CGI Interoperability Working Group</a>.</p>
<p>For further detailed information on the development of GeoSciML, see <a class="reference external" href="http://www.cgi-iugs.org/tech_collaboration/geosciml.html">http://www.cgi-iugs.org/tech_collaboration/geosciml.html</a></p>
<div class="align-center figure" id="id110">
<a class="reference internal image-reference" href="_images/geosciml.gif"><img alt="GeoSciML Data Model" src="_images/geosciml.gif" style="width: 417px; height: 249px;" /></a>
<p class="caption"><span class="caption-text">GeoSciML Data Model</span><a class="headerlink" href="#id110" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="web-services">
<h2>Web Services<a class="headerlink" href="#web-services" title="Permalink to this headline">¶</a></h2>
<p>How to setup web services to serve data to OneGeology. We provide a basic explanation of how to do it easily.</p>
<div class="section" id="cookbook-example-data">
<span id="service-provision-data-preparation-exampledata"></span><h3>Cookbook example data<a class="headerlink" href="#cookbook-example-data" title="Permalink to this headline">¶</a></h3>
<p>In order to help you test setting up services with data that we know work before you try using your own data we supply a number of example data sets that can be used to set up different kinds of services.</p>
<div class="section" id="geopackage">
<h4>GeoPackage<a class="headerlink" href="#geopackage" title="Permalink to this headline">¶</a></h4>
<p>This is a relatively recent standard format for exchanging vector and raster GIS data in a single file. It can potentially be used for quite complex data structures. The example contains two files that could be used for a Simple WMS with GetFeatureInfo response and a Simple Feature WFS. They can also serve as the basis of an SLD enabled WMS and the GeologicUnitView.gpkg file has the fields that are used for highlighting queries in the OneGeology Portal age and lithology tool. As this format doesn’t have the restrictions on field length of Shapefiles the examples are able to use the same names as specified in the GeoSciML-Lite GeologicUnitView and ShearDisplacementView feature types. Field values have been populated with appropriate values from INSPIRE vocabularies so that these examples can be used to produce a simple feature WFS returning standards conformant GeoSciML-Lite features. Download from <a class="reference external" href="ftp://ftp.bgs.ac.uk/pubload/OneGeology/exampledata/geopackagegeoscimllite.zip">ftp://ftp.bgs.ac.uk/pubload/OneGeology/exampledata/geopackagegeoscimllite.zip</a>.</p>
</div>
<div class="section" id="postgis-data">
<h4>PostGIS data<a class="headerlink" href="#postgis-data" title="Permalink to this headline">¶</a></h4>
<p>This data set can be used as a basis for WMS with GetFeatureInfo, SLD enabled WMS usable in OneGeology Portal, Simple Feature WFS conforming to GeoSciML Lite schema and Complex Feature WFS conforming to GeoSciML schema. A PostGIS database could also store raster data but the example dataset does not. PostGIS is more suitable for production services than Image files or Shapefiles and is more capable for providing data and as a basis for services conforming to standard application schemas.</p>
<p>It is assumed that you have <a class="reference internal" href="#service-provision-data-preparation-postgis"><span class="std std-ref">installed the PostGIS software</span></a> and that you have a spatially enabled database (the default installation will create one called postgis). The following will all be working within this spatially enabled database.</p>
<p>Download the latest version of the database dump file wfscookbook.YYYY-MM-DD.backup from <a class="reference external" href="ftp://ftp.bgs.ac.uk/pubload/OneGeology/wfscookbook/">ftp://ftp.bgs.ac.uk/pubload/OneGeology/wfscookbook/</a>. (Each version will have its release date in place of YYYY-MM-DD.)</p>
<p>Create a separate schema for the example data. The schema name is used in the commands below so, if you change it from <code class="docutils literal notranslate"><span class="pre">wfscookbook</span></code> you will need to change these accordingly</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">wfscookbook</span> <span class="k">AUTHORIZATION</span> <span class="n">postgres</span><span class="p">;</span>
</pre></div>
</div>
<p>Import the data from the database dump file downloaded above. If you have installed the pgAdmin graphical administration tool you can use the menu option <span class="menuselection">Tools ‣ Restore…</span>. If you are using the command line you can use the command <strong class="command">pg_restore --host localhost --port 5432 --username &quot;postgres&quot; --dbname &quot;postgis&quot; --no-password --no-owner --no-privileges --no-tablespaces --schema wfscookbook --verbose wfscookbook.backup</strong> (assuming you are using the default ‘postgis’ named database.  You should create a database user with read-only access to these tables for the WFS software to use when accessing them.</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">ows_reader</span> <span class="n">LOGIN</span> <span class="k">PASSWORD</span> <span class="s1">&#39;your_password&#39;</span>
 <span class="k">VALID</span> <span class="k">UNTIL</span> <span class="s1">&#39;infinity&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span> <span class="k">ON</span> <span class="k">ROLE</span> <span class="n">ows_reader</span>
<span class="k">IS</span> <span class="s1">&#39;A role with read only access to data used in web services.&#39;</span><span class="p">;</span>
<span class="k">grant</span> <span class="n">usage</span> <span class="k">on</span> <span class="k">schema</span> <span class="n">wfscookbook</span> <span class="k">to</span> <span class="n">ows_reader</span><span class="p">;</span>
<span class="k">grant</span> <span class="k">select</span> <span class="k">on</span> <span class="k">table</span> <span class="n">geometry_columns</span> <span class="k">to</span> <span class="n">ows_reader</span><span class="p">;</span>
<span class="k">grant</span> <span class="k">select</span> <span class="k">on</span> <span class="k">table</span> <span class="n">spatial_ref_sys</span> <span class="k">to</span> <span class="n">ows_reader</span><span class="p">;</span>
<span class="k">grant</span> <span class="k">select</span> <span class="k">on</span> <span class="k">all</span> <span class="k">tables</span> <span class="k">in</span> <span class="k">schema</span> <span class="n">wfscookbook</span> <span class="k">to</span> <span class="n">ows_reader</span><span class="p">;</span>
</pre></div>
</div>
<p>If you have problems with the above steps which are difficult to resolve you may find that setting <code class="docutils literal notranslate"><span class="pre">log_statement=all</span></code> in <code class="docutils literal notranslate"><span class="pre">postgresql.conf</span></code>, reloading the server and then monitoring the log file is helpful for debugging them.</p>
<div class="section" id="installing-postgis">
<span id="service-provision-data-preparation-postgis"></span><h5>Installing PostGIS<a class="headerlink" href="#installing-postgis" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference external" href="http://www.postgis.net/install">PostGIS Installation</a> page contains instructions on how to install PostGIS for different operating systems. We have used both the <a class="reference external" href="https://www.enterprisedb.com/downloads/postgres-postgresql-downloads">Enterprise DB Windows Installer</a> on Windows and the <a class="reference external" href="https://yum.postgresql.org/">PostgreSQL Yum repository</a> on CentOS.</p>
</div>
</div>
<div class="section" id="image-with-world-file">
<h4>Image with world file<a class="headerlink" href="#image-with-world-file" title="Permalink to this headline">¶</a></h4>
<p>This is an image file with associated worldfile to locate it in geographic coordinates. This is the type of file that you might have if you only have paper maps which you have to scan to use. It is suitable for setting up a simple WMS without any useful GetFeatureInfo response or the ability to be styled by an SLD. Download from <a class="reference external" href="ftp://ftp.bgs.ac.uk/pubload/OneGeology/exampledata/georeferencedimage.zip">ftp://ftp.bgs.ac.uk/pubload/OneGeology/exampledata/georeferencedimage.zip</a>.</p>
</div>
<div class="section" id="shapefile">
<h4>Shapefile<a class="headerlink" href="#shapefile" title="Permalink to this headline">¶</a></h4>
<p>ESRI Shapefile is a very common vector GIS format. The example could be used for a Simple WMS with GetFeatureInfo response and a Simple Feature WFS. It could also serve as the basis of an SLD enabled WMS but it doesn’t have the fields that are used in the OneGeology Portal age and lithology tool so wouldn’t work with that unless those fields were added. Also, because of the 10 character limit on length of Shapefile field names your server software will need to be able map shorter field names to the longer ones expected by the Portal. The field name length restriction also means that a simple feature WFS can’t be made to conform to specific standard Schemas like GeoSciML Lite unless your server software can map the names to the longer standard property names. Download from <a class="reference external" href="ftp://ftp.bgs.ac.uk/pubload/OneGeology/exampledata/shapefileunharmonised.zip">ftp://ftp.bgs.ac.uk/pubload/OneGeology/exampledata/shapefileunharmonised.zip</a>.</p>
<p>OneGeology does not recommend using Shapefiles as the data source for your services but, if you already have your data in this format, it can be used as a data source with some restrictions.</p>
<p>If you wish to set up a <a class="reference internal" href="#term-SLD-enabled-WMS"><span class="xref std std-term">SLD enabled WMS</span></a> or <a class="reference internal" href="#term-Simple-feature-WFS"><span class="xref std std-term">Simple feature WFS</span></a> using the standard fields needed for age and lithology highlighting in the Portal or following one of the standard ‘Lite’ schemas then the 10 character limit on field names in Shapefiles means your server will need to map shorter Shapefile field names to the longer expected field names in the standards. We provide some <a class="reference internal" href="#service-provision-data-preparation-short-names"><span class="std std-ref">Recommended ESRI shapefile definitions for GeoSciML-Lite</span></a> for some GeoSciML-Lite features that are reasonably readable and would enable using common mapping files to produce services using the full names.</p>
<p>Another consideration might be that, if the coordinate system of your Shapefile is not EPSG:4326 and your service is predominantly to be used in the OneGeology Portal, then your server will have to do a lot of on-the-fly coordinate conversion. To ameliorate this you can <a class="reference external" href="/wmsCookbook/appendixA.html">convert the coordinate system of your Shapefile</a>. The tools referred to in the previous link are available from <a class="reference external" href="http://www.gdal.org">http://www.gdal.org</a> if you haven’t done the MS4W download that it assumes.</p>
<div class="section" id="recommended-esri-shapefile-definitions-for-geosciml-lite">
<span id="service-provision-data-preparation-short-names"></span><h5>Recommended ESRI shapefile definitions for GeoSciML-Lite<a class="headerlink" href="#recommended-esri-shapefile-definitions-for-geosciml-lite" title="Permalink to this headline">¶</a></h5>
<p>Because the field names in GeoSciML-Lite are longer than 10 characters, you will not be able to have the full attribute (column) name for many of the properties if your portrayal data is loaded into an ESRI shapefile. To prevent truncated names, we are providing a recommended Shapefile implementation with shorter field names. Field names are abbreviated to try and leave characters that convey the full name of the field; lower camel case typographic has been used, except that fields that contain URI’s end with ‘_uri’.</p>
<table class="colwidths-auto docutils align-left" id="id111">
<caption><span class="caption-text">Recommended shapefile definition for ContactView</span><a class="headerlink" href="#id111" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>XML field Name</p></th>
<th class="head"><p>Shapefile field name</p></th>
<th class="head"><p>Shapefile data type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>identifier</p></td>
<td><p>identifier</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>name</p></td>
<td><p>name</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>description</p></td>
<td><p>descriptio</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>contactType</p></td>
<td><p>contactTyp</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>observationMethod</p></td>
<td><p>obsvMethod</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>positionalAccuracy</p></td>
<td><p>posAccur</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>source</p></td>
<td><p>source</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>contactType_uri</p></td>
<td><p>conTyp_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>specification_uri</p></td>
<td><p>spec_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>metadata_uri</p></td>
<td><p>metada_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>genericSymbolizer</p></td>
<td><p>genericSym</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>shape</p></td>
<td><p>SHAPE</p></td>
<td><p>ESRI geometry</p></td>
</tr>
</tbody>
</table>
<div class="linefeed">
<!-- Force a line -->&nbsp;
</div><table class="colwidths-auto docutils align-left" id="id112">
<caption><span class="caption-text">Recommended shapefile definition for ShearDisplacementStructureView</span><a class="headerlink" href="#id112" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>XML field Name</p></th>
<th class="head"><p>Shapefile field name</p></th>
<th class="head"><p>Shapefile data type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>identifier</p></td>
<td><p>identifier</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>name</p></td>
<td><p>name</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>description</p></td>
<td><p>descriptio</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>faultType</p></td>
<td><p>faultType</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>movementType</p></td>
<td><p>movmntType</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>deformationStyle</p></td>
<td><p>defrmStyle</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>displacement</p></td>
<td><p>displacmnt</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>geologicHistory</p></td>
<td><p>geolHistry</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>observationMethod</p></td>
<td><p>obsvMethod</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>positionalAccuracy</p></td>
<td><p>posAccur</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>source</p></td>
<td><p>source</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>faultType_uri</p></td>
<td><p>fltTyp_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>movementType_uri</p></td>
<td><p>movTyp_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>deformationStyle_uri</p></td>
<td><p>defStl_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>representativeAge_uri</p></td>
<td><p>repAge_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>representativeOlderAge_uri</p></td>
<td><p>oldAge_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>representativeYoungerAge_uri</p></td>
<td><p>yngAge_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>specification_uri</p></td>
<td><p>spec_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>metadata_uri</p></td>
<td><p>metada_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>genericSymbolizer</p></td>
<td><p>genericSym</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>shape</p></td>
<td><p>SHAPE</p></td>
<td><p>ESRI geometry</p></td>
</tr>
</tbody>
</table>
<div class="linefeed">
<!-- Force a line -->&nbsp;
</div><table class="colwidths-auto docutils align-left" id="id113">
<caption><span class="caption-text">Recommended shapefile definition for GeologicUnitView</span><a class="headerlink" href="#id113" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>XML field Name</p></th>
<th class="head"><p>Shapefile field name</p></th>
<th class="head"><p>Shapefile data type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>identifier</p></td>
<td><p>identifier</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>name</p></td>
<td><p>name</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>description</p></td>
<td><p>descriptio</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>geologicUnitType</p></td>
<td><p>geoUnitTyp</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>rank</p></td>
<td><p>rank</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>lithology</p></td>
<td><p>lithology</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>geologicHistory</p></td>
<td><p>geolHistry</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>observationMethod</p></td>
<td><p>obsvMethod</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>positionalAccuracy</p></td>
<td><p>posAccur</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>source</p></td>
<td><p>source</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>geologicUnitType_uri</p></td>
<td><p>uniTyp_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>representativeLithology_uri</p></td>
<td><p>repLth_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>representativeAge_uri</p></td>
<td><p>repAge_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>representativeOlderAge_uri</p></td>
<td><p>oldAge_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>representativeYoungerAge_uri</p></td>
<td><p>yngAge_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>specification_uri</p></td>
<td><p>spec_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>metadata_uri</p></td>
<td><p>metada_uri</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p>genericSymbolizer</p></td>
<td><p>genericSym</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>shape</p></td>
<td><p>SHAPE</p></td>
<td><p>ESRI geometry</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="geotiff">
<h4>GeoTIFF<a class="headerlink" href="#geotiff" title="Permalink to this headline">¶</a></h4>
<p>GeoTIFF is a raster format with geographic registration included. The example has been obtained from the <a class="reference external" href="http://portal.emodnet-bathymetry.eu/RGB">EMODNET Portal for Bathymetry</a> and has RGB bands suitable for display as an image although other GeoTIFF’s could have more and not necessarily image bands. This could be used for a WMS but is included primarily to test WCS setup. Download from <a class="reference external" href="ftp://ftp.bgs.ac.uk/pubload/OneGeology/exampledata/geotiff.zip">ftp://ftp.bgs.ac.uk/pubload/OneGeology/exampledata/geotiff.zip</a>.</p>
</div>
</div>
</div>
<div class="section" id="setting-up-a-server">
<h2>Setting up a Server<a class="headerlink" href="#setting-up-a-server" title="Permalink to this headline">¶</a></h2>
<p>There are a wide variety of proprietary and open source software packages that can be used to provide the OGC web services of interest to OneGeology. We cannot possibly describe them all but this section gives guidance on how to use some with which we do have experience to set up your OneGeology services. If you are interested and able to provide similar guidance for a software package not listed below then please get in touch to discuss adding your documentation here. Currently the only software we have successfully used to provide <em>all</em> the service types relevant for OneGeology is GeoServer.</p>
<p>To start with there are some links to downloadable example data sets which you can use to experiment with setting up the servers before you try getting your own data into an appropriate format.</p>
<p>At the end there is an additional section on setting up the Apache HTTPD server to act as a reverse proxy which may be useful if you need to provide a unified web address and port for accessing your OneGeology and possibly other web services.</p>
</div>
<div class="section" id="using-geoserver">
<h2>Using GeoServer<a class="headerlink" href="#using-geoserver" title="Permalink to this headline">¶</a></h2>
<p>GeoServer has extensive <a class="reference external" href="http://docs.geoserver.org/stable/en/user/index.html">documentation</a> which you should refer to in addition to this cookbook. References will be made to relevant parts rather than repeating too much of what is already there. There is also the <a class="reference external" href="http://geoserver.org/comm/">geoserver-users mailing list</a>.</p>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>This section describes how to set up the different kinds of OneGeology compliant service described in <a class="reference internal" href="#service-provision-service-types"><span class="std std-ref">Service Types</span></a> using free and open source GeoServer software. GeoServer can be used to provide <em>all</em> the types of service that OneGeology service providers might need. There are also INSPIRE specific instructions on making your services INSPIRE compliant where relevant. This is entirely optional for OneGeology so you can ignore the INSPIRE sections if this is not of interest to you.</p>
<p>If you are going to use a PostGIS database as a data source you will also need to read <a class="reference internal" href="#service-provision-data-preparation-postgis"><span class="std std-ref">Installing PostGIS</span></a>.</p>
<p>Accompanying this guidance are some example data sets and GeoServer configuration that allow you to set up working services which you may find helpful to adapt for use with your own data.</p>
<div class="section" id="pre-requisites-system-requirements">
<h4>Pre-requisites / System Requirements<a class="headerlink" href="#pre-requisites-system-requirements" title="Permalink to this headline">¶</a></h4>
<p>The guidance is technical and some assumptions are made about the reader’s background knowledge:</p>
<ul class="simple">
<li><p>The reader is, or is working closely with, an expert in the geological data to be served.</p></li>
<li><p>The reader has some familiarity with setting up web servers and preferably Java servlet containers.</p></li>
<li><p>The reader is able to install software on their machine and can follow the appropriate installation instructions for GeoServer documented on the GeoServer website.</p></li>
</ul>
<p>To set up production services you will need server equipment to run GeoServer. Estimating the level of hardware resources required to support a responsive service is a complex task depending on the amount of your data, its complexity and the demand that will be placed on your service by users. It is out of the scope of this document to give advice on these issues but you can find some assistance from the GeoServer web site and mailing list. To test setting up a service using the example in this guide a modern PC with Intel Core or equivalent processor and 4Gb RAM should certainly be adequate and you can probably get away with less.</p>
<p>The software required includes Java, a Java servlet container such as Apache Tomcat, and GeoServer itself. If you use one of the GeoServer packages that include Jetty then you won’t need to install a servlet container separately. There are a lot of different versions and all these software packages are continuously updated. You may have conditions specific to your site which make particular versions preferable. For example, you may already have your data in a different database system such as Oracle Spatial rather than PostGIS. It isn’t possible to cover all possible set ups here.</p>
<p>Further pre-requisites required only for particular service types are described under the appropriate section.</p>
</div>
<div class="section" id="software-installation">
<h4>Software Installation<a class="headerlink" href="#software-installation" title="Permalink to this headline">¶</a></h4>
<p>The software used here all has extensive documentation and support forums and mailing lists. Here we will just point you to the appropriate places to download the software and get installation instructions.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://geoserver.org/release/stable">Download</a> and install GeoServer following whichever one of the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/installation/index.html">installation paths</a> in the GeoServer manual suits your situation best. If you already have a servlet container application such as <a class="reference external" href="http://tomcat.apache.org/">Apache Tomcat</a> set up or you are familiar with how to set one up then you will probably wish to download the web archive (WAR) and deploy that in your servlet container. If you are not comfortable with configuring a servlet container then you will probably wish to use one of the installer programs.</p></li>
<li><p>Run GeoServer at least once to check the installation has worked. If, for example, you are testing in a local instance of Tomcat on your own machine with default settings you should be able to visit <a class="reference external" href="http://localhost:8080/geoserver">http://localhost:8080/geoserver</a> and click on the <span class="guilabel">Layer Preview</span> link to check that the example services shipped with GeoServer work properly. You will have to modify the preceding URL appropriately if you have deployed GeoServer on a different machine or port.</p></li>
</ul>
<div class="figure align-default">
<img alt="_images/geoserver_welcome.jpeg" src="_images/geoserver_welcome.jpeg" />
</div>
</div>
<div class="section" id="app-schema-plugin-installation">
<span id="service-provision-server-setup-geoserver-install-app-schema"></span><h4>App-schema Plugin Installation<a class="headerlink" href="#app-schema-plugin-installation" title="Permalink to this headline">¶</a></h4>
<p>You will need to install the app-schema plugin if you wish to set up a complex feature WFS or if you are setting up a simple feature WFS using one of the OneGeology recommended “Lite” schemas. If not, you can skip this step.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://geoserver.org/release/stable">Download</a>  and install the app-schema plugin <code class="docutils literal notranslate"><span class="pre">geoserver-*-app-schema-plugin.zip</span></code> following the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/installation.html">application schema installation instructions</a>. Follow the instructions at <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/wfs-service-settings.html">WFS service settings</a>.</p></li>
<li><p>Check you can restart GeoServer without any errors being thrown.</p></li>
</ul>
</div>
<div class="section" id="inspire-plugin-installation">
<h4>INSPIRE Plugin Installation<a class="headerlink" href="#inspire-plugin-installation" title="Permalink to this headline">¶</a></h4>
<p>If you are providing an INSPIRE download service you will need to provide the extra INSPIRE mandated metadata in the WFS GetCapabilities response. This is optional for OneGeology.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://geoserver.org/release/stable">Download</a> and install the INSPIRE plugin <code class="docutils literal notranslate"><span class="pre">geoserver-*-inspire-plugin.zip</span></code> following the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/extensions/inspire/index.html">INSPIRE plugin installation instructions</a>.</p></li>
</ul>
</div>
<div class="section" id="database">
<h4>Database<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></h4>
<p>If you already have your data in a relational database system you will want to check the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/database/index.html">Working with Databases</a> section of the GeoServer manual to see if your database is supported by GeoServer and follow the instructions for installation of any extensions that may be needed for this support. PostGIS support is built into the core GeoServer download.</p>
<p>If you want to try the example data or don’t have a supported database system you should <a class="reference internal" href="#service-provision-data-preparation-postgis"><span class="std std-ref">install PostGIS</span></a>.</p>
<p>You may use a database on the same machine as GeoServer or you can have it on a separate machine which is accessible over a network from your GeoServer machine.</p>
</div>
<div class="section" id="assumptions">
<h4>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h4>
<p>You will need to have Java installed on the machine on which you are going to install GeoServer. See the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/production/java.html#production-java">Java Considerations</a> section of the GeoServer manual for the current recommendations. If you want to try other versions of Java you may need to do extra work and be prepared to enter into technical discussions on the geoserver-users email list in order to get it working with these.</p>
<p>Ideally you will be familiar with deploying applications in a servlet container application such as <a class="reference external" href="http://tomcat.apache.org/">Apache Tomcat</a>. If not, you can use one of the all-in-one installers that packages GeoServer already deployed in the <a class="reference external" href="https://www.eclipse.org/jetty/">Jetty</a> servlet container. Note that Tomcat and Jetty are the two most tested servlet containers used with GeoServer so, although you should be able to use others, there may be extra work involved and you may need to get advice from the geoserver-users email list.</p>
<ul class="simple">
<li><p>You have a basic familiarity with relational databases</p></li>
<li><p>You are able to install applications such as Apache Tomcat, GeoServer, PostGIS (if you are using that as a database) etc. on a server with your chosen operating system using their project documentation.</p></li>
</ul>
</div>
</div>
<div class="section" id="common-setup">
<h3>Common Setup<a class="headerlink" href="#common-setup" title="Permalink to this headline">¶</a></h3>
<div class="section" id="logging-in">
<h4>Logging in<a class="headerlink" href="#logging-in" title="Permalink to this headline">¶</a></h4>
<p>The Web Administration Interface is a browser-based tool for administering the server software remotely. To deploy a web service in the GeoServer environment, log in to the Web Administration Interface for the GeoServer instance you will be using to deploy your data as a web service. To access this tool, open a web browser and enter the web address into the navigation bar. GeoServer is usually installed such that the administrative interface can be accessed at a URL with the following address pattern:</p>
<p><strong>http://&lt;host&gt;:&lt;port&gt;/geoserver/web/</strong>, <strong>&lt;port&gt;</strong> is usually <strong>8080</strong>, and &lt;host&gt; is the name or IP address of the server.</p>
<p>If you are testing in a local instance of Tomcat on your own machine with default settings this would be <a class="reference external" href="http://localhost:8080/geoserver/web/">http://localhost:8080/geoserver/web/</a></p>
<p>The default account settings for GeoServer are as follows:</p>
<ul class="simple">
<li><p>Username: admin</p></li>
<li><p>Password: geoserver</p></li>
</ul>
<p>For security reasons, it is recommended that you change your password to something more secure as soon as possible. You will see warnings about changing your passwords and links to where to change them when you first log in. There is an overview of the web administration interface in the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/webadmin/index.html">GeoServer manual</a>.</p>
</div>
<div class="section" id="editing-contact-information-metadata">
<h4>Editing contact information metadata<a class="headerlink" href="#editing-contact-information-metadata" title="Permalink to this headline">¶</a></h4>
<p>Within the GeoServer Web Administration Interface, click <strong>Contact Information</strong>, under <a class="reference external" href="http://docs.geoserver.org/latest/en/user/webadmin/index.html#about-status">About &amp; Status</a>. This brings you to a Contact Information form in which you can provide contact information for your GeoServer instance. The information entered here becomes part of service-level metadata for the web service that is accessed by the OGC GetCapabilities request. Consequently, Contact Information entered here should be as precise and comprehensive as possible.</p>
<p>This form allows you to enter the <a class="reference internal" href="#service-provision-onegeology-profile-contact-information"><span class="std std-ref">Contact information</span></a> and <a class="reference internal" href="#service-provision-onegeology-profile-data-provider"><span class="std std-ref">Data provider</span></a> required by the OneGeology profile.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The information entered here is presented differently in the GetCapabilities responses for different types and versions of service.</p>
</div>
</div>
<div class="section" id="workspaces">
<h4>Workspaces<a class="headerlink" href="#workspaces" title="Permalink to this headline">¶</a></h4>
<p>In GeoServer <a class="reference external" href="https://docs.geoserver.org/latest/en/user/data/webadmin/workspaces.html">workspaces</a> are used for organising data. For each workspace there are also <a class="reference external" href="https://docs.geoserver.org/latest/en/user/configuration/virtual-services.html">virtual services</a> created at different service URLs. So if you have an instance of GeoServer available at <a class="reference external" href="http://example.com/geoserver">http://example.com/geoserver</a> there will be a global service URL at <a class="reference external" href="http://example.com/geoserver/ows">http://example.com/geoserver/ows</a> and, if you have a workspce called ws1, there will also be a virtual service URL at <a class="reference external" href="http://example.com/geoserver/ws1/ows">http://example.com/geoserver/ws1/ows</a>. This allows some flexibility and control over making different data sets and services available for different purposes to different users. To start with we suggest you <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/webadmin/workspaces.html#add-a-workspace">create a new workspace</a> for your data and, if you are using any of the example data that accompany this guide then create a separate workspace for that as well. The URI you choose is not crucially important, we suggest you pick something under a domain you control to ensure uniqueness but it doesn’t have to be a resolvable URI that responds if someone puts it in a browser. You can read the GeoServer documentation if you want to organise things further. However, note that, if you are going to supply simple or complex features through a WFS using standard application schemas such as GeoSciML this constrains how you set up your workspaces; see the relevant sections for more detail.</p>
<div class="figure align-default" id="id114">
<a class="reference internal image-reference" href="_images/EditWS1.jpg"><img alt="Edit a GeoServer Workspace" src="_images/EditWS1.jpg" style="width: 1036px; height: 451px;" /></a>
<p class="caption"><span class="caption-text">Edit a GeoServer Workspace</span><a class="headerlink" href="#id114" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="example-data">
<h3>Example Data<a class="headerlink" href="#example-data" title="Permalink to this headline">¶</a></h3>
<p>To help you set up your services we provide <a class="reference internal" href="#service-provision-data-preparation-exampledata"><span class="std std-ref">Cookbook example data</span></a> that you can use to get some working services running. It enables you to get some initial experience setting up a service. Your own services may be set up by customising the examples or you may use them to get some understanding of what is involved when setting up your own service. The following sections on how to set up different types of service say which of the example data sets can be used to test setting up those services.</p>
</div>
<div class="section" id="simple-wms">
<span id="service-provision-server-setup-geoserver-simple-wms"></span><h3>Simple WMS<a class="headerlink" href="#simple-wms" title="Permalink to this headline">¶</a></h3>
<p>First you need to enable the WMS service. If you select <span class="guilabel">WMS</span> under the <span class="guilabel">Services</span> section of the left hand menu panel you will be presented with a screen like that below.</p>
<div class="figure align-default" id="id115">
<a class="reference internal image-reference" href="_images/WMS-serviceProp1.jpg"><img alt="Editing GeoServer WMS service properties (1)" src="_images/WMS-serviceProp1.jpg" style="width: 1014px; height: 536px;" /></a>
<p class="caption"><span class="caption-text">Editing GeoServer WMS service properties (1)</span><a class="headerlink" href="#id115" title="Permalink to this image">¶</a></p>
</div>
<p>Check the <span class="guilabel">Enable WMS</span> box and also we recommend that you select the <span class="guilabel">strict CITE compliance</span> option. At the top of the page you can add various items of the service metadata required by the <a class="reference internal" href="#service-provision-onegeology-profile"><span class="std std-ref">OneGeology Profile</span></a> including <a class="reference internal" href="#service-provision-onegeology-profile-service-title"><span class="std std-ref">Service title</span></a>, <a class="reference internal" href="#service-provision-onegeology-profile-service-abstract"><span class="std std-ref">Service abstract</span></a>, <a class="reference internal" href="#service-provision-onegeology-profile-fees"><span class="std std-ref">Fees</span></a>, <a class="reference internal" href="#service-provision-onegeology-profile-access-constraints"><span class="std std-ref">Access constraints</span></a>, <a class="reference internal" href="#service-provision-onegeology-profile-keywords"><span class="std std-ref">Keywords</span></a> and <a class="reference internal" href="#service-provision-onegeology-profile-online-resource"><span class="std std-ref">Online resource</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The contents of Maintainer field aren’t actually included in any part of the WMS GetCapabilities response</p>
</div>
<p>In the middle of the page you can configure a limited list of SRS for the service; it is recommended that you use this option otherwise you will get the full list of GeoServer supported coordinate reference systems (about 5800), which makes the <strong>capabilities</strong> document slow to parse.  Remember you must support EPSG:4326 for the portal.</p>
<div class="figure align-default" id="id116">
<a class="reference internal image-reference" href="_images/WMS-serviceProp2.jpg"><img alt="Editing GeoServer WMS service properties (2)" src="_images/WMS-serviceProp2.jpg" style="width: 852px; height: 489px;" /></a>
<p class="caption"><span class="caption-text">Editing GeoServer WMS service properties (2)</span><a class="headerlink" href="#id116" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="inspire-extended-capabilities">
<h4>INSPIRE Extended Capabilities<a class="headerlink" href="#inspire-extended-capabilities" title="Permalink to this headline">¶</a></h4>
<p>If you are providing an INSPIRE view service you will need to provide the extra INSPIRE mandated metadata in the WMS GetCapabilities response. GeoServer enables you to configure a scenario 1 style extended capabilities section. All INSPIRE specific requirements are optional for OneGeology use but will work as OneGeology services.</p>
<p>As described in the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/extensions/inspire/using.html">plugin documentation</a> you should find a section in the WMS service settings of the administration interface where you can choose a language and enter a service metadata URL. For guidance on what to enter in these settings see the <a class="reference external" href="https://inspire.ec.europa.eu/documents/technical-guidance-implementation-inspire-view-services-1">Technical Guidance for the implementation of INSPIRE View Services</a>.</p>
<p>Check that the GetCapabilities responses contain your edited values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The plugin GUI only has two non-empty values for the Service Metadata Type: “Online ISO 19139 ServiceMetadata document” sets the MIME type to <code class="docutils literal notranslate"><span class="pre">application/vnd.iso.19139+xml</span></code>, “CSW GetRecord by ID request” sets the MIME type to <code class="docutils literal notranslate"><span class="pre">application/vnd.ogc.csw.GetRecordByIdResponse_xml</span></code>. If neither of these correspond to the actual MIME type of your metadata resource you could omit this element by choosing the blank option or work around it by manually editing the wfs.xml file inside the GeoServer data directory as documented in issue <a class="reference external" href="https://osgeo-org.atlassian.net/browse/GEOS-5157">GEOS-5157</a> . As it isn’t clear what a client would do with this information anyway, leaving it blank seems to be a good option.</p>
</div>
</div>
<div class="section" id="configuring-a-data-store">
<h4>Configuring a data store<a class="headerlink" href="#configuring-a-data-store" title="Permalink to this headline">¶</a></h4>
<p>The next step is to use the Stores menu option to set up any sources of data for our service.</p>
<p>On the left side of the GeoServer <a class="reference external" href="http://docs.geoserver.org/latest/en/user/webadmin/index.html">Web administration interface</a>, under the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/webadmin/index.html#data">Data</a> section, click <span class="guilabel">Stores</span>. This will bring you to the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/webadmin/stores.html">Stores</a> page. Once there, click <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/webadmin/stores.html#add-a-store">Add New Store</a>, then choose the type of data source you wish to configure from the list of options.</p>
<p>GeoServer can use a variety of data sources as the basis of a WMS including many of those listed in the GeoServer <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/index.html">Data management</a> section. In the <a class="reference internal" href="#service-provision-data-preparation-exampledata"><span class="std std-ref">Cookbook example data</span></a> the image file, shapefile, GeoPackage, GeoTIFF and PostGIS database all are suitable. You can look up how to set each of these up from the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/raster/worldimage.html">WorldImage</a>, <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/vector/shapefile.html">Shapefile</a>, <a class="reference external" href="https://docs.geoserver.org/latest/en/user/data/vector/geopkg.html">GeoPackage</a>, <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/raster/geotiff.html">GeoTIFF</a> and <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/database/postgis.html">PostGIS</a> sections of the GeoServer documentation.</p>
<p>Having set up one or more data sources you will need to create WMS layers that display that data.</p>
</div>
<div class="section" id="adding-layers-to-a-workspace">
<span id="gs-wms-add-layers"></span><h4>Adding layers to a workspace<a class="headerlink" href="#adding-layers-to-a-workspace" title="Permalink to this headline">¶</a></h4>
<p>Having created a workspace and specified one or more data sources for your service, you will now associate this data with layers offered by the service in your workspace.</p>
<p>On the left side of the GeoServer <a class="reference external" href="http://docs.geoserver.org/latest/en/user/webadmin/index.html">Web administration interface</a>, under the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/webadmin/index.html#data">Data</a> section, click <span class="guilabel">Layers</span>. This will bring you to the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/webadmin/layers.html">Layers</a> page. Once there, click <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/webadmin/layers.html#add-a-layer">Add a new layer</a>, then choose the data source you wish to display as a layer from the drop down box.</p>
<p>Depending on the type of data source you have chosen there may be one or more resources listed that can be published as layers. For example, a shapefile data source would only have one resource listed but a database source could have several depending on the tables and views in the database. Select the resource for the data you want to display and click <span class="guilabel">Publish</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the resource has already been published the action will change to <span class="guilabel">Publish again</span>. You can create more than one layer from the same resource if you want to display it in different ways.</p>
</div>
<p>You will now be on the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/webadmin/layers.html#data-webadmin-layers-edit-data">Edit Layer</a> page. This page has a large number of configuration options spread across different tabs. We will just describe a subset of them here.</p>
</div>
<div class="section" id="the-data-tab-of-the-edit-layer-page">
<h4>The Data tab of the Edit Layer page<a class="headerlink" href="#the-data-tab-of-the-edit-layer-page" title="Permalink to this headline">¶</a></h4>
<p>The <span class="guilabel">Data</span> tab allows you to specify various items of layer metadata covered by the <a class="reference internal" href="#service-provision-onegeology-profile"><span class="std std-ref">OneGeology Profile</span></a> so it is very important to enter this information carefully for each layer in your web service. In particular you can configure the <a class="reference internal" href="#service-provision-onegeology-profile-layer-names"><span class="std std-ref">Name and Title</span></a>, <a class="reference internal" href="#service-provision-onegeology-profile-layer-abstract"><span class="std std-ref">Abstract</span></a>, <a class="reference internal" href="#service-provision-onegeology-profile-layer-bbox"><span class="std std-ref">BoundingBox</span></a>, <a class="reference internal" href="#service-provision-onegeology-profile-layer-crs"><span class="std std-ref">Spatial/Coordinate reference system</span></a>, <a class="reference internal" href="#service-provision-onegeology-profile-layer-keywords"><span class="std std-ref">Keywords</span></a> and <a class="reference internal" href="#service-provision-onegeology-profile-layer-metadata-url"><span class="std std-ref">MetadataURL (optional)</span></a> or <a class="reference internal" href="#service-provision-onegeology-profile-layer-data-url"><span class="std std-ref">DataURL (optional)</span></a>.</p>
<p>GeoServer can compute the bounding box of your data from the data itself or you can enter the limits yourself manually if you think that is more appropriate for your dataset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GeoServer may not be able to determine the coordinate reference system for some data sources. In this case you will need to enter the correct value in the <span class="guilabel">Declared SRS</span> box and choose <span class="guilabel">Force declared</span> for the <span class="guilabel">SRS handling</span> option. For example the image with world file from the example data has this problem as the coordinate reference system isn’t included in the world file.</p>
</div>
<p>For further information on the other settings on this tab see the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/webadmin/layers.html#edit-layer-data">GeoServer documentation</a>.</p>
</div>
<div class="section" id="the-publishing-tab-of-the-edit-layer-page">
<h4>The Publishing tab of the Edit Layer page<a class="headerlink" href="#the-publishing-tab-of-the-edit-layer-page" title="Permalink to this headline">¶</a></h4>
<p>After populating the fields in the <span class="guilabel">Data</span> tab, click the <span class="guilabel">Publishing</span> tab.</p>
<p>This is where you will <a class="reference external" href="http://docs.geoserver.org/latest/en/user/data/webadmin/layers.html#wms-settings">select the styles</a> that can be used with your layer that will affect, for example, what colour different formations are shown in. This part of the interface only allows you to select the styles that can be used for your layer from a fixed list of available styles. If you want to set up your own styling GeoServer has <a class="reference external" href="http://docs.geoserver.org/latest/en/user/styling/index.html#styling">extensive customisable styling capabilities</a>. This is a complex area so here we just point out that you can <a class="reference external" href="http://docs.geoserver.org/latest/en/user/styling/webadmin/index.html#add-a-style">upload an SLD file</a> to add to the list of available styles and you can <a class="reference external" href="https://github.com/OneGeology/styles">download some pre-made SLD files</a>. These pre-made SLD files will colour your layers according to some standard colour schemes if your data includes appropriate age or lithology fields coded using CGI or INSPIRE standard vocabularies.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have a pure image data source such as the one in the example data we recommend you use the default GeoServer <span class="guilabel">generic</span> style. Some styles can interfere with the image rendering (e.g. the <span class="guilabel">giant_polygon</span> style will result in a grey rectangle over your image area). You will probably also want to uncheck the <span class="guilabel">Queryable</span> Layer Settings checkbox as the information returned from image pixels in response to a GetFeatureInfo request is unlikely to be useful to clients.</p>
</div>
</div>
<div class="section" id="creating-group-layers">
<h4>Creating group layers<a class="headerlink" href="#creating-group-layers" title="Permalink to this headline">¶</a></h4>
<p>In some situations it is desirable to create a group layer, for example you may want to do this to comply with INSPIRE layer naming regulations to create a layer called GE.GeologicUnit to group all of your layers that are spatial objects of type GeologicUnit.</p>
<p>On the left side of the GeoServer <strong>Web Administration Interface</strong>, under <strong>Data</strong>, click <strong>Layer Groups</strong>. This will bring up the <strong>Layer Groups</strong> page.  Click the add new layer group link to add a new group layer; this opens a New Layer Group page.</p>
<div class="figure align-default" id="id117">
<a class="reference internal image-reference" href="_images/GS-LayerGroups.jpg"><img alt="Create or edit a Group layer" src="_images/GS-LayerGroups.jpg" style="width: 854px; height: 296px;" /></a>
<p class="caption"><span class="caption-text">Create or edit a Group layer</span><a class="headerlink" href="#id117" title="Permalink to this image">¶</a></p>
</div>
<p>Add the name, title, and abstract.  If you are following INSPIRE regulations note the name and title must be EXACTLY as in the technical guidelines.  You may enter anything in the abstract, though we suggest you provide as much information about the grouping as possible.  Select the workspace you want to use and enter the layers that you want to group; the layers must already be available in the workspace.  The layers will display on top of each other so when adding layers you may wish to chose a layer order, for example if you want to group layers that are point features on top of polygon features.  Note the drawing order is the inverse of what will appear, that is the first drawn layer will appear at the bottom of the resultant map image.</p>
<p>Now select the default projection system for the group and then click the Generate Bounds button, this will generate a bounding box based on the extents of all your listed layers, though you may add the bounding box manually if you wish.  To ensure that a user can see which layers are included in the group, you will also need to choose the <em>Named Tree</em> Mode (and not use the default Single mode).</p>
<div class="figure align-default" id="id118">
<a class="reference internal image-reference" href="_images/GS-LayerGroupsProp1.jpg"><img alt="Group layer properties" src="_images/GS-LayerGroupsProp1.jpg" style="width: 787px; height: 742px;" /></a>
<p class="caption"><span class="caption-text">Group layer properties</span><a class="headerlink" href="#id118" title="Permalink to this image">¶</a></p>
</div>
<p>The output of a grouped layer is shown below (excerpt from a GetCapabilities response).</p>
<div class="figure align-default" id="id119">
<a class="reference internal image-reference" href="_images/GS-LayerGroupsOut1.jpg"><img alt="Group layer output" src="_images/GS-LayerGroupsOut1.jpg" style="width: 899px; height: 572px;" /></a>
<p class="caption"><span class="caption-text">Group layer output</span><a class="headerlink" href="#id119" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="sld-enabled-wms">
<span id="service-provision-server-setup-geoserver-sld-wms"></span><h3>SLD enabled WMS<a class="headerlink" href="#sld-enabled-wms" title="Permalink to this headline">¶</a></h3>
<p>You don’t have to configure anything special in GeoServer to have an SLD enabled WMS but for the purposes of having your layers work with the OneGeology Portal <a class="reference internal" href="portal.html#use-portal-thematic-analysis"><span class="std std-ref">Analysis tools</span></a> highlighting functionality your data will need to have the <code class="docutils literal notranslate"><span class="pre">representativeAge_uri</span></code> and <code class="docutils literal notranslate"><span class="pre">representativeLithology_uri</span></code> fields described in <a class="reference internal" href="#service-provision-data-preparation-lite-geologicunitview"><span class="std std-ref">GeologicUnitView features</span></a> using appropriate CGI or INSPIRE vocabulary URIs.</p>
<p>If required you may disable this functionality in the Service metadata, by checking a box in the Dynamic styling section</p>
</div>
<div class="section" id="simple-feature-wfs">
<span id="service-provision-server-setup-geoserver-simple-wfs"></span><h3>Simple Feature WFS<a class="headerlink" href="#simple-feature-wfs" title="Permalink to this headline">¶</a></h3>
<p>With GeoServer if you have configured a data store and layer as described in the <a class="reference internal" href="#service-provision-server-setup-geoserver-simple-wms"><span class="std std-ref">Simple WMS</span></a> section and the data store is of a suitable type (not, for example, a pure image format or raster format) then you will already have done all the substantive work to create a simple feature WFS serving features with the same name as your layer name and with property elements named according to the fields in the underlying data store. In the <a class="reference internal" href="#service-provision-data-preparation-exampledata"><span class="std std-ref">Cookbook example data</span></a> the shapefile, GeoPackage and PostGIS database all are suitable. To complete setting up the WFS service metadata select <span class="guilabel">WFS</span> from under the <span class="guilabel">Services</span> section at the left of the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/webadmin/index.html">web administration interface</a>. The service metadata here is very similar to that described for setting up a <a class="reference internal" href="#service-provision-server-setup-geoserver-simple-wms"><span class="std std-ref">Simple WMS</span></a> so refer to that for what to enter. WFS specific settings are described in the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/services/wfs/webadmin.html">GeoServer documentation</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Having WFS enabled will mean that users can download your data (for example, <a class="reference internal" href="portal.html#use-qgis-simple-wfs"><span class="std std-ref">Using QGIS to access simple feature WFS</span></a>. If you <strong>don’t want this</strong> then you should uncheck the <span class="guilabel">Enable WFS</span> checkbox. This can only be done at the global level or per workspace. You can’t enable and disable WFS for specific layers.</p>
</div>
<p>If you want to promote interoperability while still having a simple data structure you could consider conforming to a standard schema such as GeoSciML-Lite or EarthResourceML-Lite and using standard IUGS-CGI or INSPIRE vocabularies for the applicable properties. Depending on your data source, it may be possible to produce features close to a simple feature application schema but there are a few issues that can make it difficult to produce schema valid output. You need to be able to make the names in the fields of your data source correspond to the names of properties in the output application schema. This will not be possible for a Shapefile where there is a 10 character limit on the length of field names and you may not be able to control the case of field names for some databases or you may not have access to alter your database or create appropriate views. Even when you can control the field names and case we have found problems where field names such as “name” and “description” will get assigned to gml:name properties when you might want them in the application schema namespace.</p>
<p>If you can’t get schema valid features by manipulating your data source then you will need to <a class="reference internal" href="#service-provision-server-setup-geoserver-simple-app-schema"><span class="std std-ref">use the GeoServer Application Schema</span></a> extension. This is significantly more difficult to set up and the performance is also lower so you may wish to evaluate whether you can get <em>close enough</em> to the standard schema to be useful.</p>
<div class="section" id="using-application-schemas-extension">
<span id="service-provision-server-setup-geoserver-simple-app-schema"></span><h4>Using application schemas extension<a class="headerlink" href="#using-application-schemas-extension" title="Permalink to this headline">¶</a></h4>
<p>If you want your simple feature WFS to conform to a standard schema such as GeoSciML-Lite or EarthResourceML-Lite and your data store isn’t sufficiently configurable then you will need to use the GeoServer Application Schema extension. The below documentation assumes you are using a Shapefile data store which will necessitate using this method because Shapefile field names are restricted to 10 characters in length whereas the Lite schemas have fields with longer names.</p>
<p>The Application Schema extension is not included by default so you need to follow the <a class="reference internal" href="#service-provision-server-setup-geoserver-install-app-schema"><span class="std std-ref">App-schema Plugin Installation</span></a> instructions. Once the extension is installed, you will need to create a mapping file, and restart GeoServer to enable the new configuration.</p>
</div>
<div class="section" id="create-mapping-file">
<h4>Create mapping file<a class="headerlink" href="#create-mapping-file" title="Permalink to this headline">¶</a></h4>
<p>The mapping file is an XML file that maps fields from the data source into the fields of the XML output schema. The example mapping file, below, uses field names in a shapefile that are the automatically truncated names generated by ESRI software mapping from the long field names to the valid Shapefile field names. If other field names are used in the shapefile (e.g. the recommended abbreviations in <a class="reference external" href="http://onegeology.org/wmsCookbook/appendixK.html">Appendix K</a>), the strings in the sourceExpression/OCQL elements should be modified appropriately.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;as:AppSchemaDataAccess</span>
<span class="na">xmlns:as=</span><span class="s">&quot;http://www.geotools.org/app-schema&quot;</span>
<span class="na">xmlns:ogc=</span><span class="s">&quot;http://www.opengis.net/ogc&quot;</span>
<span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
<span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.geotools.org/app-schema</span>
<span class="s">http://ogc.bgs.ac.uk/mapping/AppSchemaDataAccess.xsd&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;namespaces&gt;</span>
  <span class="nt">&lt;Namespace&gt;</span>
    <span class="nt">&lt;prefix&gt;</span>gsmlp<span class="nt">&lt;/prefix&gt;</span>
    <span class="nt">&lt;uri&gt;</span>http://xmlns.geosciml.org/geosciml-portrayal/2.0<span class="nt">&lt;/uri&gt;</span>
  <span class="nt">&lt;/Namespace&gt;</span>
  <span class="nt">&lt;Namespace&gt;</span>
    <span class="nt">&lt;prefix&gt;</span>gml<span class="nt">&lt;/prefix&gt;</span>
    <span class="nt">&lt;uri&gt;</span>http://www.opengis.net/gml<span class="nt">&lt;/uri&gt;</span>
  <span class="nt">&lt;/Namespace&gt;</span>
<span class="nt">&lt;/namespaces&gt;</span>
<span class="nt">&lt;sourceDataStores&gt;</span>
  <span class="nt">&lt;DataStore&gt;</span>
    <span class="nt">&lt;id&gt;</span>shapefile<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;parameters&gt;</span>
      <span class="nt">&lt;Parameter&gt;</span>
        <span class="nt">&lt;name&gt;</span>url<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>
          file:/home/geoserver/downloads/shapefiles/GeologicUnitView.shp
        <span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/Parameter&gt;</span>
      <span class="nt">&lt;Parameter&gt;</span>
        <span class="nt">&lt;name&gt;</span>memory mapped buffer<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>false<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/Parameter&gt;</span>
      <span class="nt">&lt;Parameter&gt;</span>
        <span class="nt">&lt;name&gt;</span>create spatial index<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/Parameter&gt;</span>
      <span class="nt">&lt;Parameter&gt;</span>
        <span class="nt">&lt;name&gt;</span>charset<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>ISO-8859-1<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/Parameter&gt;</span>
    <span class="nt">&lt;/parameters&gt;</span>
  <span class="nt">&lt;/DataStore&gt;</span>
<span class="nt">&lt;/sourceDataStores&gt;</span>
<span class="nt">&lt;targetTypes&gt;</span>
  <span class="nt">&lt;FeatureType&gt;</span>
    <span class="nt">&lt;schemaUri&gt;</span>
      http://schemas.usgin.org/files/geologic-units/2.0/GeoSciML.xsd
    <span class="nt">&lt;/schemaUri&gt;</span>
  <span class="nt">&lt;/FeatureType&gt;</span>
<span class="nt">&lt;/targetTypes&gt;</span>
<span class="nt">&lt;typeMappings&gt;</span>
  <span class="nt">&lt;FeatureTypeMapping&gt;</span>
    <span class="nt">&lt;sourceDataStore&gt;</span>shapefile<span class="nt">&lt;/sourceDataStore&gt;</span>
    <span class="nt">&lt;sourceType&gt;</span>GeologicUnitView<span class="nt">&lt;/sourceType&gt;</span>
    <span class="nt">&lt;targetElement&gt;</span>gsmlp:GeologicUnitView<span class="nt">&lt;/targetElement&gt;</span>
    <span class="nt">&lt;attributeMappings&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:GeologicUnitView<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;idExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>getId()<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/idExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:identifier<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>identifier<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:name<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>name<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:description<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>descriptio<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:geologicUnitType<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>geologicUn<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:rank<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>rank<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:lithology<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>lithology<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:geologicHistory<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>geologicHi<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:observationMethod<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>observatio<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:positionalAccuracy<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>positional<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:source<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>source<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:geologicUnitType_uri<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>geologic_1<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:representativeLithology_uri<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>representa<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:representativeAge_uri<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>represen_1<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:representativeOlderAge_uri<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>represen_2<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:representativeYoungerAge_uri<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>represen_3<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:specification_uri<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>specificat<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:metadata_uri<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>metadata_u<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:genericSymbolizer<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>genericSym<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
      <span class="nt">&lt;AttributeMapping&gt;</span>
        <span class="nt">&lt;targetAttribute&gt;</span>gsmlp:shape<span class="nt">&lt;/targetAttribute&gt;</span>
        <span class="nt">&lt;sourceExpression&gt;</span>
          <span class="nt">&lt;OCQL&gt;</span>the_geom<span class="nt">&lt;/OCQL&gt;</span>
        <span class="nt">&lt;/sourceExpression&gt;</span>
      <span class="nt">&lt;/AttributeMapping&gt;</span>
    <span class="nt">&lt;/attributeMappings&gt;</span>
  <span class="nt">&lt;/FeatureTypeMapping&gt;</span>
<span class="nt">&lt;/typeMappings&gt;</span>
<span class="nt">&lt;/as:AppSchemaDataAccess&gt;</span>
</pre></div>
</div>
<p>Create this mapping file with the prefix and namespace binding, the connection parameters (data source here is a shapefile), the online location of the schema (XSD), and the field mapping.</p>
<p>You can find more documentation on the mapping file at <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/mapping-file.html">http://docs.geoserver.org/stable/en/user/data/app-schema/mapping-file.html</a> and information on configuring different kinds of data store at  <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/data-stores.html">http://docs.geoserver.org/stable/en/user/data/app-schema/data-stores.html</a>.</p>
<p>Place the file in the GeoServer file location of the datastore. This will be somewhere like <code class="samp docutils literal notranslate"><span class="pre">data/workspaces/</span><em><span class="pre">workspace</span></em><span class="pre">/</span><em><span class="pre">store</span></em><span class="pre">/</span></code> where <cite>workspace</cite> is the name of your workspace, and <cite>store</cite> is the name of your data store.</p>
</div>
<div class="section" id="edit-datastore-xml-file">
<h4>Edit datastore.xml file<a class="headerlink" href="#edit-datastore-xml-file" title="Permalink to this headline">¶</a></h4>
<p>This file is located in the same Data Store directory. To enable application-schemas, this file must indicate that the shapefile is no longer used for field names, but the mapping file instead. Example datastore.xml, after editing:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dataStore&gt;</span>
  <span class="nt">&lt;id&gt;</span>DataStoreInfoImpl--49e58162:140a6f913de:-8000<span class="nt">&lt;/id&gt;</span>
  <span class="nt">&lt;name&gt;</span>ShearDisplacementStructureView<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
  <span class="nt">&lt;workspace&gt;</span>
    <span class="nt">&lt;id&gt;</span>WorkspaceInfoImpl--1739a454:14097568969:-7fe9<span class="nt">&lt;/id&gt;</span>
  <span class="nt">&lt;/workspace&gt;</span>
  <span class="nt">&lt;connectionParameters&gt;</span>
    <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;dbtype&quot;</span><span class="nt">&gt;</span>app-schema<span class="nt">&lt;/entry&gt;</span>
    <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;url&quot;</span><span class="nt">&gt;</span>
    file:workspaces/gsmlp/ShearDisplacementStructureView/ShearDisplacementStructureViewAZGS.xml
    <span class="nt">&lt;/entry&gt;</span>
    <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;namespace&quot;</span><span class="nt">&gt;</span>http://xmlns.geosciml.org/geosciml-portrayal/2.0<span class="nt">&lt;/entry&gt;</span>
  <span class="nt">&lt;/connectionParameters&gt;</span>
  <span class="nt">&lt;__default&gt;</span>false<span class="nt">&lt;/__default&gt;</span>
<span class="nt">&lt;/dataStore&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="complex-feature-wfs">
<span id="service-provision-server-setup-geoserver-complex-wfs"></span><h3>Complex Feature WFS<a class="headerlink" href="#complex-feature-wfs" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This documentation describes setting up complex features by manually editing configuration files for the app-schema extension. Since it was written the <a class="reference external" href="https://www.wetransform.to/products/halestudio/">Hale Studio</a> graphical data transformation engine has been given the capability to create GeoServer app-schema configuration files. We recommend that you investigate this tool.</p>
</div>
<p>This section describes selected parts of the configuration files from the example set. This should give you a good overview of the configuration files needed and what the different parts do. They produce valid GeoSciML v3.2, v4.1 and INSPIRE Annex II Geology theme features and so, hopefully will provide a good starting point to adapt for your own services. However, the mapping for your service from your source data may require some features not used in the example. For these cases you should refer to the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/index.html">Working with Application Schemas</a> section of the GeoServer manual which contains comprehensive documentation on the different kinds of mapping from source to output XML that are possible. (It uses GeoSciML v2 based examples.)</p>
<p>Because a single <code class="docutils literal notranslate"><span class="pre">gsmlb:GeologicUnit</span></code> can be observed at several distinct locations on the Earth’s surface, several <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code> features may point via their <code class="docutils literal notranslate"><span class="pre">gsmlb:specification</span></code> property to the same <code class="docutils literal notranslate"><span class="pre">gsmlb:GeologicUnit</span></code>.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;wfs:FeatureCollection</span> <span class="nt">&gt;</span>
 <span class="nt">&lt;wfs:member&gt;</span>
  <span class="nt">&lt;gsmlb:MappedFeature</span> <span class="na">gml:id=</span><span class="s">&quot;bgsn_digmap20111213000014089_625k&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;gsmlb:mappingFrame</span>
    <span class="na">xlink:href=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/MappingFrameValue/topOfBedrock&quot;</span>
    <span class="na">xlink:title=</span><span class="s">&quot;top of bedrock&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;gsmlb:specification&gt;</span>
    <span class="nt">&lt;gsmlb:GeologicUnit</span> <span class="na">gml:id=</span><span class="s">&quot;SYG-CYCS&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;gml:description&gt;</span>STRATHCLYDE GROUP - SEDIMENTARY ROCK CYCLES, STRATHCLYDE GROUP
      TYPE<span class="nt">&lt;/gml:description&gt;</span>
     <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/gsmlb:GeologicUnit&gt;</span>
   <span class="nt">&lt;/gsmlb:specification&gt;</span>
   <span class="nt">&lt;gsmlb:shape&gt;</span>
    <span class="nt">&lt;gml:MultiSurface</span> <span class="na">gml:id=</span><span class="s">&quot;gsmlb.shape.bgsn_digmap20111213000014089_625k&quot;</span>
     <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::27700&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;gml:surfaceMember&gt;</span>
      <span class="nt">&lt;gml:Polygon</span> <span class="na">gml:id=</span><span class="s">&quot;gsmlb.shape.bgsn_digmap20111213000014089_625k.1&quot;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;gml:exterior&gt;</span>
        <span class="nt">&lt;gml:LinearRing&gt;</span>
         <span class="nt">&lt;gml:posList&gt;</span>277851.8129999998 693998.524000001 277823.5400000005 693969.0079999991
          277654.64600000007 693696.0569999999 277576.6949999996 693449.1019999995 277550.7119999993
          693280.1319999992 277537.7199999998 693085.1679999997 276992.0639999996 693202.1460000003
          277018.0469999999 693566.081000001 277134.9740000011 693839.0320000002 277251.8999999991
          694098.9850000012 277851.8129999998 693998.524000001<span class="nt">&lt;/gml:posList&gt;</span>
        <span class="nt">&lt;/gml:LinearRing&gt;</span>
       <span class="nt">&lt;/gml:exterior&gt;</span>
      <span class="nt">&lt;/gml:Polygon&gt;</span>
     <span class="nt">&lt;/gml:surfaceMember&gt;</span>
    <span class="nt">&lt;/gml:MultiSurface&gt;</span>
   <span class="nt">&lt;/gsmlb:shape&gt;</span>
  <span class="nt">&lt;/gsmlb:MappedFeature&gt;</span>
 <span class="nt">&lt;/wfs:member&gt;</span>
 <span class="nt">&lt;wfs:member&gt;</span>
  <span class="nt">&lt;gsmlb:MappedFeature</span> <span class="na">gml:id=</span><span class="s">&quot;bgsn_digmap20111213000014090_625k&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;gsmlb:mappingFrame</span>
    <span class="na">xlink:href=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/MappingFrameValue/topOfBedrock&quot;</span>
    <span class="na">xlink:title=</span><span class="s">&quot;top of bedrock&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;gsmlb:specification&gt;</span>
    <span class="nt">&lt;gsmlb:GeologicUnit</span> <span class="na">gml:id=</span><span class="s">&quot;CRMF-MDCB&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;gml:description&gt;</span>CRAWFORD GROUP AND MOFFAT SHALE GROUP (UNDIFFERENTIATED) - MUDSTONE, CHERT AND
      SMECTITE-CLAYSTONE<span class="nt">&lt;/gml:description&gt;</span>
     <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/gsmlb:GeologicUnit&gt;</span>
   <span class="nt">&lt;/gsmlb:specification&gt;</span>
   <span class="nt">&lt;gsmlb:shape&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
   <span class="nt">&lt;/gsmlb:shape&gt;</span>
  <span class="nt">&lt;/gsmlb:MappedFeature&gt;</span>
 <span class="nt">&lt;/wfs:member&gt;</span>
 <span class="nt">&lt;wfs:member&gt;</span>
  <span class="nt">&lt;gsmlb:MappedFeature</span> <span class="na">gml:id=</span><span class="s">&quot;bgsn_digmap20111213000014092_625k&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;gsmlb:mappingFrame</span>
    <span class="na">xlink:href=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/MappingFrameValue/topOfBedrock&quot;</span>
    <span class="na">xlink:title=</span><span class="s">&quot;top of bedrock&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;gsmlb:specification&gt;</span>
    <span class="nt">&lt;gsmlb:GeologicUnit</span> <span class="na">gml:id=</span><span class="s">&quot;TRIA-SCON&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;gml:description&gt;</span>TRIASSIC ROCKS (UNDIFFERENTIATED) - SANDSTONE AND CONGLOMERATE,
      INTERBEDDED<span class="nt">&lt;/gml:description&gt;</span>
     <span class="c">&lt;!-- ... --&gt;</span>
   <span class="nt">&lt;/gsmlb:specification&gt;</span>
   <span class="nt">&lt;gsmlb:shape&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
   <span class="nt">&lt;/gsmlb:shape&gt;</span>
  <span class="nt">&lt;/gsmlb:MappedFeature&gt;</span>
 <span class="nt">&lt;/wfs:member&gt;</span>
 <span class="nt">&lt;wfs:member&gt;</span>
  <span class="nt">&lt;gsmlb:MappedFeature</span> <span class="na">gml:id=</span><span class="s">&quot;bgsn_digmap20111213000014096_625k&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;gsmlb:mappingFrame</span>
    <span class="na">xlink:href=</span><span class="s">&quot;http://inspire.ec.europa.eu/codelist/MappingFrameValue/topOfBedrock&quot;</span>
    <span class="na">xlink:title=</span><span class="s">&quot;top of bedrock&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;gsmlb:specification</span> <span class="na">xlink:href=</span><span class="s">&quot;#TRIA-SCON&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;gsmlb:shape&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
   <span class="nt">&lt;/gsmlb:shape&gt;</span>
  <span class="nt">&lt;/gsmlb:MappedFeature&gt;</span>
 <span class="nt">&lt;/wfs:member&gt;</span>
<span class="nt">&lt;/wfs:FeatureCollection&gt;</span>
</pre></div>
</div>
<p>Versions of the cookbook example set and configurations since 2016-08-17 also include <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code> features pointing to <code class="docutils literal notranslate"><span class="pre">gsmlb:ShearDisplacementStructure</span></code> (faults).</p>
<div class="section" id="obtaining-example-configuration">
<h4>Obtaining example configuration<a class="headerlink" href="#obtaining-example-configuration" title="Permalink to this headline">¶</a></h4>
<p>Download the latest version of the example configuration files in data_625k.YYYY-MM-DD.zip from <a class="reference external" href="ftp://ftp.bgs.ac.uk/pubload/OneGeology/wfscookbook/">ftp://ftp.bgs.ac.uk/pubload/OneGeology/wfscookbook/</a> and expand it to a spare location on your server. Copy the files from this expanded directory to the matching locations in your GeoServer data directory. The main configuration files are inside the <code class="docutils literal notranslate"><span class="pre">workspaces</span></code> directory. The contents of the <code class="docutils literal notranslate"><span class="pre">demo</span></code> directory are some example requests which are documented below. Overwrite any files that already exist, although there shouldn’t be any in a fresh installation (apart from the containing directories). Note that the web interface does not yet support app-schema store for layer administration so you will have to edit these files directly when configuring your service.</p>
<p>Copy the latest version of one of the files app-schema.cgi.YYYY-MM-DD.properties or app-schema.inspire.YYYY-MM-DD.properties from <a class="reference external" href="ftp://ftp.bgs.ac.uk/pubload/OneGeology/wfscookbook/">ftp://ftp.bgs.ac.uk/pubload/OneGeology/wfscookbook/</a> to <code class="docutils literal notranslate"><span class="pre">WEB-INF/classes/app-schema.properties</span></code> depending on whether you wish to use CGI or INSPIRE vocabularies for property values. (Don’t forget to rename the file, removing the <cite>.inspire</cite> or <cite>.cgi</cite> and datestamp parts.)</p>
<p>Edit the database connection parameters appropriately for your installation of PostgreSQL. If you want to use a JNDI data connection configured in your servlet container then you will also need to edit the appropriate places in the <code class="docutils literal notranslate"><span class="pre">datastore.xml</span></code> files described in a subsequent section. So it will be easier for initial testing just to enter the host, database, user and password parameters.</p>
<p>Perform any configuration required by your servlet container, and then start the servlet.</p>
<p>One configuration item you may need to change is to increase the memory available for Java. The method depends on how you have installed GeoServer but if you get <code class="docutils literal notranslate"><span class="pre">java.lang.OutOfMemoryError:</span> <span class="pre">Java</span> <span class="pre">heap</span> <span class="pre">space</span></code> errors with the request below you will need to increase the memory with a directive such as <code class="docutils literal notranslate"><span class="pre">-Xmx256M</span></code>. The details of tuning memory and other options of the Java Virtual Machine are complex and not dealt with in this cookbook. Some information is in the GeoServer User Manual under the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/production/index.html">Running in a Production Environment</a> section.</p>
<p>If you have used the Windows Installer you can apply this by editing the file <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files</span> <span class="pre">(x86)\GeoServer</span> <span class="pre">2.4.5\wrapper\wrapper.conf</span></code> (The exact file location will depend on where you installed GeoServer and which version you are using.) Find the line <code class="docutils literal notranslate"><span class="pre">wrapper.java.maxmemory=128</span></code> and increase the value 128 (or whatever it happens to be) to something like 256.</p>
<p>If you are running in Apache Tomcat on Windows you can use the “Configure Tomcat” program that the Tomcat Windows installer provides. In the “Java” tab you can put a maximum memory value such as 256 (MB) in the Maximum Memory pool field.</p>
<ul class="simple">
<li><p>The first time GeoServer starts with the tutorial configuration, it will download all the schema (XSD) files it needs and store them in the <code class="docutils literal notranslate"><span class="pre">app-schema-cache</span></code> folder in the data directory. <strong>You must be connected to the internet for this to work.</strong></p></li>
</ul>
</div>
<div class="section" id="complex-feature-test-requests">
<h4>Complex Feature Test requests<a class="headerlink" href="#complex-feature-test-requests" title="Permalink to this headline">¶</a></h4>
<p>When GeoServer is running, test app-schema WFS in a web browser. You can query the feature types using these links. (Change <code class="docutils literal notranslate"><span class="pre">localhost:8080</span></code> in the examples below if you have deployed it at a different location.):</p>
<ul class="simple">
<li><p><a class="reference external" href="http://localhost:8080/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;namespaces=xmlns(gsmlb,http%3A%2F%2Fwww.opengis.net%2Fgsml%2F4.1%2FGeoSciML-Basic)&amp;typeNames=gsmlb:MappedFeature&amp;count=25">http://localhost:8080/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;namespaces=xmlns(gsmlb,http%3A%2F%2Fwww.opengis.net%2Fgsml%2F4.1%2FGeoSciML-Basic)&amp;typeNames=gsmlb:MappedFeature&amp;count=25</a></p></li>
<li><p><a class="reference external" href="http://localhost:8080/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;namespaces=xmlns(gsmlb,http%3A%2F%2Fwww.opengis.net%2Fgsml%2F4.1%2FGeoSciML-Basic)&amp;typeNames=gsmlb:GeologicUnit&amp;count=25">http://localhost:8080/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;namespaces=xmlns(gsmlb,http%3A%2F%2Fwww.opengis.net%2Fgsml%2F4.1%2FGeoSciML-Basic)&amp;typeNames=gsmlb:GeologicUnit&amp;count=25</a></p></li>
</ul>
<p>From GeoServer 2.7 there is also support for WFS 2.0 paged queries such as below. The performance has been tuned so that you should be able to retrieve a small subset range of features anywhere within a large set of features matching a particular query.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://localhost:8080/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;namespaces=xmlns(gsmlb,http%3A%2F%2Fwww.opengis.net%2Fgsml%2F4.1%2FGeoSciML-Basic)&amp;typeNames=gsmlb:MappedFeature&amp;count=10&amp;startindex=9">http://localhost:8080/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;namespaces=xmlns(gsmlb,http%3A%2F%2Fwww.opengis.net%2Fgsml%2F4.1%2FGeoSciML-Basic)&amp;typeNames=gsmlb:MappedFeature&amp;count=10&amp;startindex=9</a> - Get features 10 to 20 (startindex is 0 for first feature)</p></li>
<li><p><a class="reference external" href="http://localhost:8080/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;namespaces=xmlns(gsmlb,http%3A%2F%2Fwww.opengis.net%2Fgsml%2F4.1%2FGeoSciML-Basic)&amp;typeNames=gsmlb:MappedFeature&amp;count=10&amp;startindex=9999">http://localhost:8080/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;namespaces=xmlns(gsmlb,http%3A%2F%2Fwww.opengis.net%2Fgsml%2F4.1%2FGeoSciML-Basic)&amp;typeNames=gsmlb:MappedFeature&amp;count=10&amp;startindex=9999</a> - Get features 10000 to 10010</p></li>
</ul>
<p>(At the time of writing the response is not fully WFS 2.0 compliant as the returned collection only returns a link to retrieve the previous set of results, not to the next set of results. However, a client that can formulate the paged queries should be able to work these out itself.)</p>
<p>You can also obtain WFS responses by using the <a class="reference external" href="http://localhost:8080/geoserver/web/?wicket:bookmarkablePage=:org.geoserver.web.demo.DemoRequestsPage">Demo requests</a> page in the GeoServer web interface. You can select some of the example age and lithology queries that are supplied with the example data directory from the request drop-down list or put <code class="docutils literal notranslate"><span class="pre">http://localhost:8080/geoserver/ows</span></code> into the service URL section and try pasting in your own queries. Some of the examples are reproduced below with their names as listed on the demo queries page.</p>
<div class="figure align-default">
<img alt="_images/geoserver_demo_requests.jpeg" src="_images/geoserver_demo_requests.jpeg" />
</div>
<p>A query for mapped features showing outcrops of geologic units of a particular age</p>
<p><code class="docutils literal notranslate"><span class="pre">WFS_getFeature1GCgiAge.xml</span></code> (Use <code class="docutils literal notranslate"><span class="pre">WFS_getFeature1GInspireAge.xml</span></code> if you have chosen the INSPIRE configuration.)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;wfs:GetFeature</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
 <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd&quot;</span>
 <span class="na">xmlns:wfs=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span> 
 <span class="na">xmlns:fes=</span><span class="s">&quot;http://www.opengis.net/fes/2.0&quot;</span>
 <span class="na">xmlns:gsmlb=</span><span class="s">&quot;http://www.opengis.net/gsml/4.1/GeoSciML-Basic&quot;</span>
 <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span>
 <span class="na">service=</span><span class="s">&quot;WFS&quot;</span> <span class="na">version=</span><span class="s">&quot;2.0.0&quot;</span> <span class="na">count=</span><span class="s">&quot;100&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;wfs:Query</span> <span class="na">typeNames=</span><span class="s">&quot;gsmlb:MappedFeature&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;fes:Filter&gt;</span>
   <span class="nt">&lt;fes:Or&gt;</span>
    <span class="nt">&lt;fes:PropertyIsEqualTo&gt;</span>
     <span class="nt">&lt;fes:ValueReference&gt;</span>gsmlb:specification/gsmlb:GeologicUnit/gsmlb:geologicHistory/gsmlb:GeologicEvent/gsmlb:youngerNamedAge/@xlink:href<span class="nt">&lt;/fes:ValueReference&gt;</span>
     <span class="nt">&lt;fes:Literal&gt;</span>http://resource.geosciml.org/classifier/ics/ischart/LowerDevonian<span class="nt">&lt;/fes:Literal&gt;</span>
    <span class="nt">&lt;/fes:PropertyIsEqualTo&gt;</span>
    <span class="nt">&lt;fes:PropertyIsEqualTo&gt;</span>
     <span class="nt">&lt;fes:ValueReference&gt;</span>gsmlb:specification/gsmlb:GeologicUnit/gsmlb:geologicHistory/gsmlb:GeologicEvent/gsmlb:youngerNamedAge/@xlink:href<span class="nt">&lt;/fes:ValueReference&gt;</span>
     <span class="nt">&lt;fes:Literal&gt;</span>http://resource.geosciml.org/classifier/ics/ischart/Emsian<span class="nt">&lt;/fes:Literal&gt;</span>
    <span class="nt">&lt;/fes:PropertyIsEqualTo&gt;</span>
    <span class="nt">&lt;fes:PropertyIsEqualTo&gt;</span>
     <span class="nt">&lt;fes:ValueReference&gt;</span>gsmlb:specification/gsmlb:GeologicUnit/gsmlb:geologicHistory/gsmlb:GeologicEvent/gsmlb:youngerNamedAge/@xlink:href<span class="nt">&lt;/fes:ValueReference&gt;</span>
     <span class="nt">&lt;fes:Literal&gt;</span>http://resource.geosciml.org/classifier/ics/ischart/Lochkovian<span class="nt">&lt;/fes:Literal&gt;</span>
    <span class="nt">&lt;/fes:PropertyIsEqualTo&gt;</span>
    <span class="nt">&lt;fes:PropertyIsEqualTo&gt;</span>
     <span class="nt">&lt;fes:ValueReference&gt;</span>gsmlb:specification/gsmlb:GeologicUnit/gsmlb:geologicHistory/gsmlb:GeologicEvent/gsmlb:youngerNamedAge/@xlink:href<span class="nt">&lt;/fes:ValueReference&gt;</span>
     <span class="nt">&lt;fes:Literal&gt;</span>http://resource.geosciml.org/classifier/ics/ischart/Pragian<span class="nt">&lt;/fes:Literal&gt;</span>
    <span class="nt">&lt;/fes:PropertyIsEqualTo&gt;</span>
   <span class="nt">&lt;/fes:Or&gt;</span>
  <span class="nt">&lt;/fes:Filter&gt;</span>
 <span class="nt">&lt;/wfs:Query&gt;</span>
<span class="nt">&lt;/wfs:GetFeature&gt;</span>
</pre></div>
</div>
<p>A OneGeology query for mapped features showing outcrops of geological units with particular lithologies</p>
<p><code class="docutils literal notranslate"><span class="pre">WFS_getFeature1GCgiLith.xml</span></code> (Use <code class="docutils literal notranslate"><span class="pre">WFS_getFeature1GInspireLith.xml</span></code> if you have chosen the INSPIRE configuration.)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;wfs:GetFeature</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
 <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd&quot;</span>
 <span class="na">xmlns:wfs=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span> 
 <span class="na">xmlns:fes=</span><span class="s">&quot;http://www.opengis.net/fes/2.0&quot;</span>
 <span class="na">xmlns:gsmlb=</span><span class="s">&quot;http://www.opengis.net/gsml/4.1/GeoSciML-Basic&quot;</span>
 <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span>
 <span class="na">service=</span><span class="s">&quot;WFS&quot;</span> <span class="na">version=</span><span class="s">&quot;2.0.0&quot;</span> <span class="na">count=</span><span class="s">&quot;100&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;wfs:Query</span> <span class="na">typeNames=</span><span class="s">&quot;gsmlb:MappedFeature&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;fes:Filter&gt;</span>
   <span class="nt">&lt;fes:Or&gt;</span>
    <span class="nt">&lt;fes:PropertyIsEqualTo&gt;</span>
     <span class="nt">&lt;fes:ValueReference&gt;</span>gsmlb:specification/gsmlb:GeologicUnit/gsmlb:composition/gsmlb:CompositionPart/gsmlb:material/gsmlb:RockMaterial/gsmlb:lithology/@xlink:href<span class="nt">&lt;/fes:ValueReference&gt;</span>
     <span class="nt">&lt;fes:Literal&gt;</span>http://resource.geosciml.org/classifier/cgi/lithology/limestone<span class="nt">&lt;/fes:Literal&gt;</span>
    <span class="nt">&lt;/fes:PropertyIsEqualTo&gt;</span>
    <span class="nt">&lt;fes:PropertyIsEqualTo&gt;</span>
     <span class="nt">&lt;fes:ValueReference&gt;</span>gsmlb:specification/gsmlb:GeologicUnit/gsmlb:composition/gsmlb:CompositionPart/gsmlb:material/gsmlb:RockMaterial/gsmlb:lithology/@xlink:href<span class="nt">&lt;/fes:ValueReference&gt;</span>
     <span class="nt">&lt;fes:Literal&gt;</span>http://resource.geosciml.org/classifier/cgi/lithology/chalk<span class="nt">&lt;/fes:Literal&gt;</span>
    <span class="nt">&lt;/fes:PropertyIsEqualTo&gt;</span>
    <span class="nt">&lt;fes:PropertyIsEqualTo&gt;</span>
     <span class="nt">&lt;fes:ValueReference&gt;</span>gsmlb:specification/gsmlb:GeologicUnit/gsmlb:composition/gsmlb:CompositionPart/gsmlb:material/gsmlb:RockMaterial/gsmlb:lithology/@xlink:href<span class="nt">&lt;/fes:ValueReference&gt;</span>
     <span class="nt">&lt;fes:Literal&gt;</span>http://resource.geosciml.org/classifier/cgi/lithology/travertine<span class="nt">&lt;/fes:Literal&gt;</span>
    <span class="nt">&lt;/fes:PropertyIsEqualTo&gt;</span>
   <span class="nt">&lt;/fes:Or&gt;</span>
  <span class="nt">&lt;/fes:Filter&gt;</span>
 <span class="nt">&lt;/wfs:Query&gt;</span>
<span class="nt">&lt;/wfs:GetFeature&gt;</span>
</pre></div>
</div>
<p>A bounding box query to retrieve mapped features with shapes that overlap the specified bounding box</p>
<p><code class="docutils literal notranslate"><span class="pre">WFS_getFeature1GBBOX.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;wfs:GetFeature</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
 <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd</span>
<span class="s"> http://www.opengis.net/gml/3.2 http://schemas.opengis.net/gml/3.2.1/gml.xsd&quot;</span>
 <span class="na">xmlns:wfs=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span> 
 <span class="na">xmlns:fes=</span><span class="s">&quot;http://www.opengis.net/fes/2.0&quot;</span>
 <span class="na">xmlns:gsmlb=</span><span class="s">&quot;http://www.opengis.net/gsml/4.1/GeoSciML-Basic&quot;</span>
 <span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml/3.2&quot;</span>
 <span class="na">service=</span><span class="s">&quot;WFS&quot;</span> <span class="na">version=</span><span class="s">&quot;2.0.0&quot;</span> <span class="na">count=</span><span class="s">&quot;100&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;wfs:Query</span> <span class="na">typeNames=</span><span class="s">&quot;gsmlb:MappedFeature&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;fes:Filter&gt;</span>
   <span class="nt">&lt;fes:BBOX&gt;</span>
    <span class="nt">&lt;fes:ValueReference&gt;</span>gsmlb:shape<span class="nt">&lt;/fes:ValueReference&gt;</span>
    <span class="nt">&lt;gml:Envelope</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::4326&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;gml:lowerCorner&gt;</span>56.08643859340388 -4.0004826736994445<span class="nt">&lt;/gml:lowerCorner&gt;</span>
     <span class="nt">&lt;gml:upperCorner&gt;</span>56.165510496146474 -3.8381055732299343<span class="nt">&lt;/gml:upperCorner&gt;</span>
    <span class="nt">&lt;/gml:Envelope&gt;</span>
   <span class="nt">&lt;/fes:BBOX&gt;</span>
  <span class="nt">&lt;/fes:Filter&gt;</span>
 <span class="nt">&lt;/wfs:Query&gt;</span>
<span class="nt">&lt;/wfs:GetFeature&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>App-schema cannot be configured using the web interface, you will need to edit the configuration files directly. You will see the configured workspaces and stores appear in the web interface but not the layers (features). The properties that can be edited in the web interface are very limited.</p>
</div>
</div>
<div class="section" id="id56">
<h4>INSPIRE Extended Capabilities<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h4>
<p>If you are providing an INSPIRE download service you will need to provide the extra INSPIRE mandated metadata in the WFS GetCapabilities response. GeoServer enables you to configure a scenario 1 style extended capabilities section. All INSPIRE specific requirements are optional for OneGeology use but will work as OneGeology services.</p>
<p>As described in the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/extensions/inspire/using.html">plugin documentation</a> you should find a section in the WFS service settings of the administration interface where you can choose a language, enter a service metadata URL and type and add one or more spatial dataset identifiers. For guidance on what to enter in these settings see the <a class="reference external" href="https://inspire.ec.europa.eu/documents/technical-guidance-implementation-inspire-download-services">Technical Guidance for the implementation of INSPIRE Download Services</a>.</p>
<p>Check that the GetCapabilities responses contain your edited values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The plugin GUI only has two non-empty values for the Service Metadata Type: “Online ISO 19139 ServiceMetadata document” sets the MIME type to <code class="docutils literal notranslate"><span class="pre">application/vnd.iso.19139+xml</span></code>, “CSW GetRecord by ID request” sets the MIME type to <code class="docutils literal notranslate"><span class="pre">application/vnd.ogc.csw.GetRecordByIdResponse_xml</span></code>. If neither of these correspond to the actual MIME type of your metadata resource you could omit this element by choosing the blank option or work around it by manually editing the wfs.xml file inside the GeoServer data directory as documented in issue <a class="reference external" href="https://osgeo-org.atlassian.net/browse/GEOS-5157">GEOS-5157</a> . As it isn’t clear what a client would do with this information anyway, leaving it blank seems to be a good option.</p>
</div>
</div>
<div class="section" id="inspire-pre-defined-dataset-download">
<h4>INSPIRE Pre-defined Dataset Download<a class="headerlink" href="#inspire-pre-defined-dataset-download" title="Permalink to this headline">¶</a></h4>
<p>If you decide that you are going to provide an INSPIRE pre-defined dataset download service direct from your WFS rather than pre-generating the full datasets and just providing links to the download through ATOM then you can do this by creating a Stored Query such as the one below. The example data directory includes the CreateStoredQuery command in the Demos examples.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;wfs:CreateStoredQuery</span>
 <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
 <span class="na">xsi:schemaLocation=</span>
  <span class="s">&quot;http://www.opengis.net/wfs/2.0</span>
<span class="s">   http://schemas.opengis.net/wfs/2.0/wfs.xsd&quot;</span>
 <span class="na">xmlns:gsmlb=</span><span class="s">&quot;http://www.opengis.net/gsml/4.1/GeoSciML-Basic&quot;</span>
 <span class="na">xmlns:fes=</span><span class="s">&quot;http://www.opengis.org/fes/2.0&quot;</span>
 <span class="na">xmlns:wfs=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span>
 <span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml/3.2&quot;</span>
 <span class="na">xmlns:xsd=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
 <span class="na">service=</span><span class="s">&quot;WFS&quot;</span>
 <span class="na">version=</span><span class="s">&quot;2.0.0&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;wfs:StoredQueryDefinition</span>
  <span class="na">id=</span><span class="s">&#39;http://inspire.ec.europa.eu/operation/download/GetSpatialDataSet&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;wfs:Parameter</span> <span class="na">name=</span><span class="s">&#39;CRS&#39;</span> <span class="na">type=</span><span class="s">&#39;xsd:string&#39;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;wfs:Parameter</span> <span class="na">name=</span><span class="s">&#39;DataSetIdCode&#39;</span> <span class="na">type=</span><span class="s">&#39;xsd:string&#39;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;wfs:Parameter</span> <span class="na">name=</span><span class="s">&#39;DataSetIdNamespace&#39;</span> <span class="na">type=</span><span class="s">&#39;xsd:string&#39;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;wfs:Parameter</span> <span class="na">name=</span><span class="s">&#39;Language&#39;</span> <span class="na">type=</span><span class="s">&#39;xsd:string&#39;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;wfs:Parameter</span> <span class="na">name=</span><span class="s">&quot;count&quot;</span> <span class="na">type=</span><span class="s">&quot;xsd:integer&quot;</span><span class="nt">&gt;&lt;/wfs:Parameter&gt;</span>
  <span class="nt">&lt;wfs:QueryExpressionText</span>
   <span class="na">returnFeatureTypes=</span><span class="s">&#39;gsmlb:MappedFeature&#39;</span>
   <span class="na">language=</span><span class="s">&#39;urn:ogc:def:queryLanguage:OGC-WFS::WFS_QueryExpression&#39;</span>
   <span class="na">isPrivate=</span><span class="s">&#39;false&#39;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;wfs:Query</span> <span class="na">typeNames=</span><span class="s">&#39;gsmlb:MappedFeature&#39;</span> <span class="na">srsName=</span><span class="s">&quot;${CRS}&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;/wfs:Query&gt;</span>
  <span class="nt">&lt;/wfs:QueryExpressionText&gt;</span>
 <span class="nt">&lt;/wfs:StoredQueryDefinition&gt;</span>
<span class="nt">&lt;/wfs:CreateStoredQuery&gt;</span>
</pre></div>
</div>
<p>This can then be invoked with a request like:</p>
<blockquote>
<div><p><a class="reference external" href="http://localhost:8080/geoserver/ows?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;storedquery_id=http://inspire.ec.europa.eu/operation/download/GetSpatialDataSet&amp;DataSetIdCode=13603180&amp;DataSetIdNamespace=http://data.bgs.ac.uk/id/dataHolding/&amp;CRS=urn:ogc:def:crs:EPSG::4326&amp;Language=eng&amp;count=20&amp;">http://localhost:8080/geoserver/ows?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;storedquery_id=http://inspire.ec.europa.eu/operation/download/GetSpatialDataSet&amp;DataSetIdCode=13603180&amp;DataSetIdNamespace=http://data.bgs.ac.uk/id/dataHolding/&amp;CRS=urn:ogc:def:crs:EPSG::4326&amp;Language=eng&amp;count=20&amp;</a></p>
</div></blockquote>
</div>
<div class="section" id="app-schema-properties">
<h4>app-schema.properties<a class="headerlink" href="#app-schema-properties" title="Permalink to this headline">¶</a></h4>
<p>This file (in the <code class="docutils literal notranslate"><span class="pre">WEB-INF/classes</span></code> directory) is not strictly required but is very useful for storing certain configuration parameters that will be re-used in different parts of the other configuration files and for storing configuration parameters like database usernames and passwords outside of the GeoServer data directory so that the latter can be copied freely. The <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/property-interpolation.html">Property Interpolation</a> section of the GeoServer manual contains more information on how properties can be set and used in other parts of the configuration files. In the reference configuration files this contains database connection parameters, some commonly used URI values and the setting to turn on <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/joining.html">joining</a>. In fact with current versions of GeoServer (certainly pre-dating v2.4.5) joining is turned on by default and is the recommended setting. There may be some limited situations as described in the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/joining.html">joining documentation</a>, however, when you need to switch this off. The cookbook example also uses property interpolation to set database column name prefixes to choose whether to use columns that include CGI URI values or INSPIRE URI values.</p>
</div>
<div class="section" id="data-directory">
<h4>Data directory<a class="headerlink" href="#data-directory" title="Permalink to this headline">¶</a></h4>
<p>The example configuration files can be copied into an existing GeoServer data directory so that you can get a working service to try out up and running as quickly as possible. The parts relevant for configuration of a complex feature WFS are contained in the <code class="docutils literal notranslate"><span class="pre">workspaces</span></code> directory described in the next section. Other parts of your service configuration like service metadata, security etc. can be set up using the web interface. Thus, when you come to set up your own service, you will probably start with the default GeoServer data directory, configure service metadata etc. in the web interface, and copy the complex feature configuration files from the reference <code class="docutils literal notranslate"><span class="pre">data/workspaces</span></code> directory to your own data directory for editing there.</p>
</div>
<div class="section" id="workspace-layout">
<h4>Workspace layout<a class="headerlink" href="#workspace-layout" title="Permalink to this headline">¶</a></h4>
<p>The files for configuring complex feature output are contained in the <code class="docutils literal notranslate"><span class="pre">data/workspaces</span></code> directory. Inside this directory there is a sub-directory for each namespace of features you will be serving and other namespaces that these features may use somewhere in their content. In the example this includes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>workspaces
├── base
├── gco
├── ge
├── gmd
├── gml
├── gsml
├── gsmlb
├── gsmlem
├── gsmlga
├── gsmlgs
├── gsmlgu
├── gsmlu
├── swe
└── xlink
</pre></div>
</div>
<p>These cover all the namespaces used by features in the example data set. If you use different application schemas or even additional GeoSciML packages such as boreholes, you will need to create similar directories for the namespaces used in those schemas. The <code class="docutils literal notranslate"><span class="pre">gsmlb</span></code> directory contains mappings to create MappedFeature, GeologicUnit and ShearDisplacementStructure features using the GeoSciML v4.1 Basic package. The <code class="docutils literal notranslate"><span class="pre">ge</span></code> and <code class="docutils literal notranslate"><span class="pre">base</span></code> directories contain mappings to create features conforming to the <a class="reference internal" href="#inspire-geology-schema"><span class="std std-ref">INSPIRE Geology Theme Schema</span></a>. The other <code class="docutils literal notranslate"><span class="pre">gsml*</span></code> directories contain mappings using the older (and more complex) GeoSciML v3.2. The remaining directories are for namespaces that are imported by the others.</p>
<p>The example configuration defines 2 feature types to be served by the WFS. Their configurations are stored in data store sub-directories of the appropriate namespace directory and are named according to the pattern <code class="docutils literal notranslate"><span class="pre">prefix_Feature</span></code> for a feature <code class="docutils literal notranslate"><span class="pre">prefix::Feature</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>workspaces
├── base
├── gco
├── ge
├── gmd
├── gml
├── gsml
├── gsmlb
│   └── gsmlb_GeologicUnit
│   └── gsmlb_MappedFeature
│   └── gsmlb_ShearDisplacementStructure
├── gsmlem
├── gsmlga
├── gsmlgs
├── gsmlgu
├── gsmlu
├── swe
└── xlink
</pre></div>
</div>
<p>Each of the data store directories contains files similar to the following example for <code class="docutils literal notranslate"><span class="pre">gsmlb::MappedFeature</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gsmlb_MappedFeature
├── AppSchemaDataAccess.xsd
├── datastore.xml
├── gsmlb_MappedFeature
│   └── featuretype.xml
└── gsmlb_MappedFeature.xml
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">AppSchemaDataAccess.xsd</span></code> file isn’t used for the configuration, it is just provided as a convenience when you are editing a mapping file such as <code class="docutils literal notranslate"><span class="pre">gsmlb_MappedFeature.xml</span></code> to allow a validating XML editor to give you hints that you have the structure of the file correct. The following sections will describe the <code class="docutils literal notranslate"><span class="pre">datastore.xml</span></code> file which creates an application schema data store and specifies the mapping file described in the section after which contains the substantive portion of the configuration mapping source data fields to output in the complex feature types.</p>
</div>
<div class="section" id="datastore-xml">
<h4>datastore.xml<a class="headerlink" href="#datastore-xml" title="Permalink to this headline">¶</a></h4>
<p>Each data store configuration file <code class="docutils literal notranslate"><span class="pre">datastore.xml</span></code> specifies the location of a mapping file and triggers its loading as an app-schema data source. This file should not be confused with the source data store, which is specified inside the mapping file.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code> the file is <code class="docutils literal notranslate"><span class="pre">workspaces/gsmlb/gsmlb_MappedFeature/datastore.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dataStore&gt;</span>
 <span class="nt">&lt;id&gt;</span>gsmlb_MappedFeature_datastore<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;name&gt;</span>gsmlb_MappedFeature<span class="nt">&lt;/name&gt;</span>
 <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
 <span class="nt">&lt;workspace&gt;</span>
  <span class="nt">&lt;id&gt;</span>gsmlb_workspace<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;/workspace&gt;</span>
 <span class="nt">&lt;connectionParameters&gt;</span>
  <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;namespace&quot;</span><span class="nt">&gt;</span>http://www.opengis.net/gsml/4.1/GeoSciML-Basic<span class="nt">&lt;/entry&gt;</span>
  <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;url&quot;</span><span class="nt">&gt;</span>file:workspaces/gsmlb/gsmlb_MappedFeature/gsmlb_MappedFeature.xml<span class="nt">&lt;/entry&gt;</span>
  <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;dbtype&quot;</span><span class="nt">&gt;</span>app-schema<span class="nt">&lt;/entry&gt;</span>
 <span class="nt">&lt;/connectionParameters&gt;</span>
<span class="nt">&lt;/dataStore&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ensure that there is no whitespace inside an <code class="docutils literal notranslate"><span class="pre">entry</span></code> element.</p>
</div>
<p>For other feature types the pattern is the same where you replace the names and ids appropriately and change the namespace if necessary. The url entry is a file: URI pointing to the location of the mapping file relative to the GeoServer data directory. The dbtype entry will always be app-schema to define complex feature types.</p>
</div>
<div class="section" id="mapping-files">
<h4>Mapping files<a class="headerlink" href="#mapping-files" title="Permalink to this headline">¶</a></h4>
<p>Configuration of app-schema feature types is performed in mapping files e.g.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">workspaces/gsmlb/gsmlb_GeologicUnit/gsmlb_GeologicUnit.xml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">workspaces/gsmlb/gsmlb_MappedFeature/gsmlb_MappedFeature.xml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">workspaces/gsmlb/gsmlb_ShearDisplacementStructure/gsmlb_ShearDisplacementStructure.xml</span></code></p></li>
</ul>
</div>
<div class="section" id="namespaces">
<h4>Namespaces<a class="headerlink" href="#namespaces" title="Permalink to this headline">¶</a></h4>
<p>Each mapping file contains namespace prefix definitions. The below extract is from <code class="docutils literal notranslate"><span class="pre">gsmlb_MappedFeature.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;namespaces&gt;</span>
 <span class="nt">&lt;Namespace&gt;</span>
  <span class="nt">&lt;prefix&gt;</span>gml<span class="nt">&lt;/prefix&gt;&lt;uri&gt;</span>http://www.opengis.net/gml/3.2<span class="nt">&lt;/uri&gt;</span>
 <span class="nt">&lt;/Namespace&gt;</span>
 <span class="nt">&lt;Namespace&gt;</span>
  <span class="nt">&lt;prefix&gt;</span>gsmlb<span class="nt">&lt;/prefix&gt;&lt;uri&gt;</span>http://www.opengis.net/gsml/4.1/GeoSciML-Basic<span class="nt">&lt;/uri&gt;</span>
 <span class="nt">&lt;/Namespace&gt;</span>
 <span class="nt">&lt;Namespace&gt;</span>
  <span class="nt">&lt;prefix&gt;</span>swe<span class="nt">&lt;/prefix&gt;&lt;uri&gt;</span>http://www.opengis.net/swe/2.0<span class="nt">&lt;/uri&gt;</span>
 <span class="nt">&lt;/Namespace&gt;</span>
 <span class="nt">&lt;Namespace&gt;</span>
  <span class="nt">&lt;prefix&gt;</span>xlink<span class="nt">&lt;/prefix&gt;&lt;uri&gt;</span>http://www.w3.org/1999/xlink<span class="nt">&lt;/uri&gt;</span>
 <span class="nt">&lt;/Namespace&gt;</span>
 <span class="nt">&lt;Namespace&gt;</span>
  <span class="nt">&lt;prefix&gt;</span>xsi<span class="nt">&lt;/prefix&gt;&lt;uri&gt;</span>http://www.w3.org/2001/XMLSchema-instance<span class="nt">&lt;/uri&gt;</span>
 <span class="nt">&lt;/Namespace&gt;</span>
<span class="nt">&lt;/namespaces&gt;</span>
</pre></div>
</div>
<p>Only those namespace prefixes used in the mapping file need to be declared although you may find it easier just to put all the namespaces used by your target schema in all of them.</p>
</div>
<div class="section" id="source-data-store">
<h4>Source data store<a class="headerlink" href="#source-data-store" title="Permalink to this headline">¶</a></h4>
<p>The data for this tutorial is contained in the PostGIS database set up in the previous section.</p>
<p>For this example, each feature type uses an identical source data store configuration. The <code class="docutils literal notranslate"><span class="pre">Parameter</span></code> elements contain values for various database connection parameters. Here we are using <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/property-interpolation.html">property interpolation</a> so that these don’t have to get changed in each mapping file if they change and so that the configuration files can be shared without exposing password information. The values of the interpolated variables (which have the form <code class="docutils literal notranslate"><span class="pre">${name}</span></code>) should be defined in the <code class="docutils literal notranslate"><span class="pre">WEB-INF/classes/app-schema.properties</span></code> file. An example which you can use as a template to fill in with your own values is at <a class="reference external" href="ftp://ftp.bgs.ac.uk/pubload/OneGeology/wfscookbook/app-schema.inspire.YYYY-MM-DD.properties">ftp://ftp.bgs.ac.uk/pubload/OneGeology/wfscookbook/app-schema.inspire.YYYY-MM-DD.properties</a>. (Updated versions will have different dates instead of YYYY-MM-DD. The example service can be configured to use INSPIRE vocabulary values or IUGS-CGI vocabulary values by setting appropriate variables in this file.)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;sourceDataStores&gt;</span>
 <span class="nt">&lt;DataStore&gt;</span>
  <span class="nt">&lt;id&gt;</span>datastore<span class="nt">&lt;/id&gt;</span>
  <span class="nt">&lt;parameters&gt;</span>
   <span class="nt">&lt;Parameter&gt;</span>
    <span class="nt">&lt;name&gt;</span>dbtype<span class="nt">&lt;/name&gt;&lt;value&gt;</span>${cgi.dbtype}<span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/Parameter&gt;</span>
   <span class="c">&lt;!--</span>
<span class="c">   &lt;Parameter&gt;</span>
<span class="c">    &lt;name&gt;jndiReferenceName&lt;/name&gt;&lt;value&gt;${cgi.jndi}&lt;/value&gt;</span>
<span class="c">   &lt;/Parameter&gt;</span>
<span class="c">   --&gt;</span>
   <span class="nt">&lt;Parameter&gt;</span>
    <span class="nt">&lt;name&gt;</span>host<span class="nt">&lt;/name&gt;&lt;value&gt;</span>${cgi.host}<span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/Parameter&gt;</span>
   <span class="nt">&lt;Parameter&gt;</span>
    <span class="nt">&lt;name&gt;</span>port<span class="nt">&lt;/name&gt;&lt;value&gt;</span>${cgi.port}<span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/Parameter&gt;</span>
   <span class="nt">&lt;Parameter&gt;</span>
    <span class="nt">&lt;name&gt;</span>database<span class="nt">&lt;/name&gt;&lt;value&gt;</span>${cgi.database}<span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/Parameter&gt;</span>
   <span class="nt">&lt;Parameter&gt;</span>
    <span class="nt">&lt;name&gt;</span>user<span class="nt">&lt;/name&gt;&lt;value&gt;</span>${cgi.user}<span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/Parameter&gt;</span>
   <span class="nt">&lt;Parameter&gt;</span>
    <span class="nt">&lt;name&gt;</span>passwd<span class="nt">&lt;/name&gt;&lt;value&gt;</span>${cgi.passwd}<span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/Parameter&gt;</span>
   <span class="nt">&lt;Parameter&gt;</span>
    <span class="nt">&lt;name&gt;</span>schema<span class="nt">&lt;/name&gt;&lt;value&gt;</span>${cgi.schema}<span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/Parameter&gt;</span>
   <span class="nt">&lt;Parameter&gt;</span>
    <span class="nt">&lt;name&gt;</span>Expose primary keys<span class="nt">&lt;/name&gt;&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
   <span class="nt">&lt;/Parameter&gt;</span>
  <span class="nt">&lt;/parameters&gt;</span>
 <span class="nt">&lt;/DataStore&gt;</span>
<span class="nt">&lt;/sourceDataStores&gt;</span>
</pre></div>
</div>
<p>See <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/data-stores.html">http://docs.geoserver.org/stable/en/user/data/app-schema/data-stores.html</a> for a description of how to use other types of data store.</p>
</div>
<div class="section" id="target-types">
<h4>Target types<a class="headerlink" href="#target-types" title="Permalink to this headline">¶</a></h4>
<p>The XML Schemas which are required to define a feature type and its properties are specified in the <code class="docutils literal notranslate"><span class="pre">targetTypes</span></code> section. The type of the output feature is defined in <code class="docutils literal notranslate"><span class="pre">targetElement</span></code> in the <code class="docutils literal notranslate"><span class="pre">typeMapping</span></code> section. The below example is from <code class="docutils literal notranslate"><span class="pre">gsmlb_MappedFeature.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;targetTypes&gt;</span>
 <span class="nt">&lt;FeatureType&gt;</span>
  <span class="nt">&lt;schemaUri&gt;</span>
   http://schemas.opengis.net/gsml/4.1/geoSciMLBasic.xsd
  <span class="nt">&lt;/schemaUri&gt;</span>
 <span class="nt">&lt;/FeatureType&gt;</span>
<span class="nt">&lt;/targetTypes&gt;</span>
</pre></div>
</div>
<p>In this case the schema is published, but because the OASIS XML Catalog is used for schema resolution, a private or modified schema in the catalog can be used if desired.</p>
</div>
<div class="section" id="mappings">
<h4>Mappings<a class="headerlink" href="#mappings" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">typeMappings</span></code> element begins with configuration elements. From <code class="docutils literal notranslate"><span class="pre">gsmlb_MappedFeature.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;typeMappings&gt;</span>
 <span class="nt">&lt;FeatureTypeMapping&gt;</span>
  <span class="nt">&lt;sourceDataStore&gt;</span>datastore<span class="nt">&lt;/sourceDataStore&gt;</span>
  <span class="nt">&lt;sourceType&gt;</span>mapped_feature_gu<span class="nt">&lt;/sourceType&gt;</span>
  <span class="nt">&lt;targetElement&gt;</span>gsmlb:MappedFeature<span class="nt">&lt;/targetElement&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The mapping starts with <code class="docutils literal notranslate"><span class="pre">sourceDataStore</span></code>, which gives the arbitrary identifier used above to name the source of the input data in the <code class="docutils literal notranslate"><span class="pre">sourceDataStores</span></code> section.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sourceType</span></code> gives the name of the source simple feature type. In this case it is the simple feature type <code class="docutils literal notranslate"><span class="pre">mapped_feature_gu</span></code>, sourced from the table of the same name in the PostGIS database set up in the previous chapter. In versions of the cookbook example configuration since 2016-08-16 this has been changed to point to the view <code class="docutils literal notranslate"><span class="pre">mapped_feature_all</span></code> which includes both outcrop polygons of geologic units and linear fault traces.</p></li>
<li><p>When working with databases <code class="docutils literal notranslate"><span class="pre">sourceType</span></code> is the name of a table or view. Database identifiers must be lowercase for PostGIS or uppercase for Oracle Spatial.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">targetElement</span></code> is the name of the output complex feature type.</p></li>
</ul>
</div>
<div class="section" id="gml-id-mapping">
<h4>gml:id mapping<a class="headerlink" href="#gml-id-mapping" title="Permalink to this headline">¶</a></h4>
<p>The first mapping sets the <code class="docutils literal notranslate"><span class="pre">gml:id</span></code> to be the feature id specified in the source simple feature property which comes from the database column of the same name.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;AttributeMapping&gt;</span>
 <span class="nt">&lt;targetAttribute&gt;</span>gsmlb:MappedFeature<span class="nt">&lt;/targetAttribute&gt;</span>
 <span class="nt">&lt;idExpression&gt;&lt;OCQL&gt;</span>uuid<span class="nt">&lt;/OCQL&gt;&lt;/idExpression&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">targetAttribute</span></code> is the XPath to the element for which the mapping applies, in this case, the top-level feature type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">idExpression</span></code> is a special form that can only be used to set the <code class="docutils literal notranslate"><span class="pre">gml:id</span></code> on a feature. In the tutorial database we have a column <code class="docutils literal notranslate"><span class="pre">uuid</span></code> suitable for use as a <code class="docutils literal notranslate"><span class="pre">gml:id</span></code> attribute value. If your database doesn’t have such a column you may be able to use the special function <code class="docutils literal notranslate"><span class="pre">getId()</span></code> here instead. This will synthesise an id from the table or view name, a dot “.”, and the primary key of the table. If this is not desirable, any other field or CQL expression can be used, if it evaluates to an <a class="reference external" href="http://www.w3.org/TR/1999/REC-xml-names-19990114/#NT-NCName">NCName</a>. In versions of the cookbook example configuration since 2016-08-16 this uses the column <code class="docutils literal notranslate"><span class="pre">mf_id</span></code>.</p></li>
</ul>
<p>The above would generate output like</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlb:MappedFeature</span> <span class="na">gml:id=</span><span class="s">&quot;bgsn_digmap20111213000014089_625k&quot;</span><span class="nt">&gt;</span>
...
</pre></div>
</div>
</div>
<div class="section" id="inspireid-mapping">
<h4>inspireId mapping<a class="headerlink" href="#inspireid-mapping" title="Permalink to this headline">¶</a></h4>
<p>A common property that many INSPIRE themes will have is an inspireId. An example mapping for this property is contained in the <code class="docutils literal notranslate"><span class="pre">workspaces/ge/ge_GeologicUnit/ge_GeologicUnit.xml</span></code> file. The relevant section is reproduced below</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;AttributeMapping&gt;</span>
 <span class="nt">&lt;targetAttribute&gt;</span>ge:inspireId/base:Identifier/base:localId<span class="nt">&lt;/targetAttribute&gt;</span>
 <span class="nt">&lt;sourceExpression&gt;&lt;OCQL&gt;</span>bgs_namedrockunit_uri<span class="nt">&lt;/OCQL&gt;&lt;/sourceExpression&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
<span class="nt">&lt;AttributeMapping&gt;</span>
 <span class="nt">&lt;targetAttribute&gt;</span>ge:inspireId/base:Identifier/base:namespace<span class="nt">&lt;/targetAttribute&gt;</span>
 <span class="nt">&lt;sourceExpression&gt;&lt;OCQL&gt;</span>&#39;http://data.bgs.ac.uk/&#39;<span class="nt">&lt;/OCQL&gt;&lt;/sourceExpression&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="ordinary-mapping">
<h4>Ordinary mapping<a class="headerlink" href="#ordinary-mapping" title="Permalink to this headline">¶</a></h4>
<p>Most mappings consist of a target and source. Here is a simple property with a text value from <code class="docutils literal notranslate"><span class="pre">gsmlb_GeologicUnit.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;AttributeMapping&gt;</span>
 <span class="nt">&lt;targetAttribute&gt;</span>gml:description<span class="nt">&lt;/targetAttribute&gt;</span>
 <span class="nt">&lt;sourceExpression&gt;</span>
  <span class="nt">&lt;OCQL&gt;</span>description<span class="nt">&lt;/OCQL&gt;</span>
 <span class="nt">&lt;/sourceExpression&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>In this case, the value of <code class="docutils literal notranslate"><span class="pre">gml:description</span></code> is just the value of the <code class="docutils literal notranslate"><span class="pre">description</span></code> column in the <code class="docutils literal notranslate"><span class="pre">geol_unit</span></code> table.</p></li>
<li><p>For a database, the field name is the name of the column (the table/view is set in <code class="docutils literal notranslate"><span class="pre">sourceType</span></code> above). Database identifiers must be lowercase for PostGIS or uppercase for Oracle Spatial.</p></li>
<li><p>CQL expressions can be used to calculate content. Use caution because queries on CQL-calculated values prevent the construction of efficient SQL queries.</p></li>
<li><p>Source expressions can be CQL literals, which are single-quoted.</p></li>
</ul>
<p>The above would generate output like</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gml:description&gt;</span>STRATHCLYDE GROUP - SEDIMENTARY ROCK CYCLES,
 STRATHCLYDE GROUP TYPE<span class="nt">&lt;/gml:description&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="client-properties">
<h4>Client properties<a class="headerlink" href="#client-properties" title="Permalink to this headline">¶</a></h4>
<p>In addition to the element content, a mapping can set values of XML attributes on property elements. These are called “client properties” in GeoServer terminology. Here is one from <code class="docutils literal notranslate"><span class="pre">gsmlb_CompositionPart.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;AttributeMapping&gt;</span>
 <span class="nt">&lt;targetAttribute&gt;</span>gsmlb:material/gsmlb:RockMaterial/gsmlb:lithology<span class="nt">&lt;/targetAttribute&gt;</span>
 <span class="nt">&lt;ClientProperty&gt;&lt;name&gt;</span>xlink:href<span class="nt">&lt;/name&gt;&lt;value&gt;</span>${dic.col.prefix}lithology_uri<span class="nt">&lt;/value&gt;&lt;/ClientProperty&gt;</span>
 <span class="nt">&lt;ClientProperty&gt;&lt;name&gt;</span>xlink:title<span class="nt">&lt;/name&gt;&lt;value&gt;</span>${dic.col.prefix}lithology_label<span class="nt">&lt;/value&gt;&lt;/ClientProperty&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This mapping leaves the content of the <code class="docutils literal notranslate"><span class="pre">gsmlb:lithology</span></code> element empty but sets an <code class="docutils literal notranslate"><span class="pre">xlink:href</span></code> attribute to the value of the <code class="docutils literal notranslate"><span class="pre">${dic.col.prefix}lithology_uri</span></code> column and an <code class="docutils literal notranslate"><span class="pre">xlink:title</span></code> attribute to the value of the <code class="docutils literal notranslate"><span class="pre">${dic.col.prefix}lithology_label</span></code> column. Note that in this case the property attributes being set are nested two levels below the parent <code class="docutils literal notranslate"><span class="pre">gsmlb:CompositionPart</span></code>. Note also that we are using property interpolation here to select the exact name of the database column to be used based on a variable set in the app-schema.properties file. This was useful so the example dataset can be configured to use vocabularies from different authorities but is less likely to be useful for your services.</p></li>
<li><p>As can be seen from this example, multiple <code class="docutils literal notranslate"><span class="pre">ClientProperty</span></code> mappings can be set.</p></li>
</ul>
<p>This would generate output like</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gsmlb:lithology</span>
 <span class="na">xlink:href=</span>
  <span class="s">&quot;http://resource.geosciml.org/classifier/cgi/lithology/clastic_mudstone&quot;</span>
 <span class="na">xlink:title=</span><span class="s">&quot;Mudstone&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="feature-chaining">
<h4>Feature chaining<a class="headerlink" href="#feature-chaining" title="Permalink to this headline">¶</a></h4>
<p>In feature chaining, one feature type is used as a property of an enclosing feature type, by value or by reference. The following examples show the parts of the <code class="docutils literal notranslate"><span class="pre">gsmlb_MappedFeature.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">gsmlb_GeologicUnit.xml</span></code> mapping files that put the gsmlb:GeologicUnit elements inside the gsmlb:specification properties of gsmlb:MappedFeature elements. In versions of the cookbook example since 2016-08-16 the below mapping has been commented out to be replaced by a more complex example described in the next section on Polymorphism.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">gsmlb_MappedFeature.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;AttributeMapping&gt;</span>
 <span class="nt">&lt;targetAttribute&gt;</span>gsmlb:specification<span class="nt">&lt;/targetAttribute&gt;</span>
 <span class="nt">&lt;sourceExpression&gt;</span>
  <span class="nt">&lt;OCQL&gt;</span>lex_rcs<span class="nt">&lt;/OCQL&gt;</span>
  <span class="nt">&lt;linkElement&gt;</span>gsmlb:GeologicUnit<span class="nt">&lt;/linkElement&gt;</span>
  <span class="nt">&lt;linkField&gt;</span>FEATURE_LINK<span class="nt">&lt;/linkField&gt;</span>
 <span class="nt">&lt;/sourceExpression&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">gsmlb_GeologicUnit.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;AttributeMapping&gt;</span>
 <span class="nt">&lt;targetAttribute&gt;</span>FEATURE_LINK<span class="nt">&lt;/targetAttribute&gt;</span>
 <span class="nt">&lt;sourceExpression&gt;&lt;OCQL&gt;</span>lex_rcs<span class="nt">&lt;/OCQL&gt;&lt;/sourceExpression&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>In this case from the mapping for <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code>, we specify a mapping for its <code class="docutils literal notranslate"><span class="pre">gsmlb:specification</span></code> property.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">linkElement</span></code> specifies which feature (or other complex type) should be used as the value of the property.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">link_specification</span></code> field of the source <code class="docutils literal notranslate"><span class="pre">gsmlb_MappedFeature</span></code> simple feature is use as the “foreign key”, which maps to the special <code class="docutils literal notranslate"><span class="pre">FEATURE_LINK</span></code> field in each <code class="docutils literal notranslate"><span class="pre">gsmlb:GeologicUnit</span></code>.</p></li>
<li><p>The mapping of the special <code class="docutils literal notranslate"><span class="pre">FEATURE_LINK</span></code> attribute in <code class="docutils literal notranslate"><span class="pre">gsmlb_GeologicUnit.xml</span></code> to the foreign key field of the underlying table means that every <code class="docutils literal notranslate"><span class="pre">gsmlb:GeologicUnit</span></code> with <code class="docutils literal notranslate"><span class="pre">lex_rcs</span></code> equal to the <code class="docutils literal notranslate"><span class="pre">lex_rcs</span></code> of the <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code> under construction is included as a <code class="docutils literal notranslate"><span class="pre">gsmlb:specification</span></code> property of the <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code> (by value).</p></li>
</ul>
<p>Feature chaining has been used to construct the property <code class="docutils literal notranslate"><span class="pre">gsmlb:specification</span></code> of <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code>. This property is a <code class="docutils literal notranslate"><span class="pre">gsmlb:GeologicUnit</span></code>. The WFS response for <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code> combines the output of both feature types into a single response. The first <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code> has a <code class="docutils literal notranslate"><span class="pre">gsmlb:specification</span></code> property value of the <code class="docutils literal notranslate"><span class="pre">gsmlb:GeologicUnit</span></code> with the same <code class="docutils literal notranslate"><span class="pre">lex_rcs</span></code> code. The next time a mapped feature with the same <code class="docutils literal notranslate"><span class="pre">lex_rcs</span></code> code appears, rather than including the whole geologic unit inline again the property has an xlink:href attribute pointing to the first occurrence. The relationships between the feature instances are data driven.</p>
</div>
<div class="section" id="polymorphism">
<h4>Polymorphism<a class="headerlink" href="#polymorphism" title="Permalink to this headline">¶</a></h4>
<p>In versions of the cookbook example since 2016-08-16 the above mapping with <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature</span></code>’s pointing to <code class="docutils literal notranslate"><span class="pre">gsmlb:GeologicUnit</span></code>’s has been extended so that <code class="docutils literal notranslate"><span class="pre">gsmlb:MappedFeature/gsmlb:specification</span></code> can contain or point to either a <code class="docutils literal notranslate"><span class="pre">gsmlb:GeologicUnit</span></code> as above or a <code class="docutils literal notranslate"><span class="pre">gsmlb:ShearDisplacementStructure</span></code> (representing a fault). Setting up an attribute to have different forms like this is described in the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/polymorphism.html">Polymorphism</a> section of the GeoServer manual. The cookbook example implements this by having a column <code class="docutils literal notranslate"><span class="pre">feature_type</span></code> in the <code class="docutils literal notranslate"><span class="pre">mapped_feature_all</span></code> view which indicates whether a row is related to an entry in the <code class="docutils literal notranslate"><span class="pre">geol_unit</span></code> table (for <code class="docutils literal notranslate"><span class="pre">gsmlb:GeologicUnit</span></code> features) or the <code class="docutils literal notranslate"><span class="pre">fault</span></code> table (for <code class="docutils literal notranslate"><span class="pre">gsmlb:ShearDisplacementStructure</span></code> features). It then uses the Recode function to switch between which feature type is the <code class="docutils literal notranslate"><span class="pre">linkElement</span></code> based on the value of this column.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;AttributeMapping&gt;</span>
 <span class="nt">&lt;targetAttribute&gt;</span>gsml:specification<span class="nt">&lt;/targetAttribute&gt;</span>
 <span class="nt">&lt;sourceExpression&gt;</span>
  <span class="nt">&lt;OCQL&gt;</span>specification_id<span class="nt">&lt;/OCQL&gt;</span>
  <span class="nt">&lt;linkElement&gt;</span>Recode(feature_type, &#39;gu&#39;, &#39;gsmlb:GeologicUnit&#39;, &#39;sds&#39;, &#39;gsmlb:ShearDisplacementStructure&#39;)<span class="nt">&lt;/linkElement&gt;</span>
  <span class="nt">&lt;linkField&gt;</span>FEATURE_LINK<span class="nt">&lt;/linkField&gt;</span>
 <span class="nt">&lt;/sourceExpression&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="inspire-geology-theme-schema">
<span id="inspire-geology-schema"></span><h4>INSPIRE Geology Theme Schema<a class="headerlink" href="#inspire-geology-theme-schema" title="Permalink to this headline">¶</a></h4>
<p>If you want to produce a service with data conforming to the INSPIRE Geology theme schema you can examine the configuration files in the <code class="docutils literal notranslate"><span class="pre">ge</span></code> and <code class="docutils literal notranslate"><span class="pre">base</span></code> directories which were created by copying those in the <code class="docutils literal notranslate"><span class="pre">gsmlb</span></code> directory and changing the namespaces and schema locations. The only parts which needed adding which couldn’t be adapted from the GeoSciML configuration files were those adding mappings for inspireId properties. It should be fairly simple for you to copy your own mapping files from a GeoSciML configuration to produce an INSPIRE Geology theme schema configuration following a similar process.</p>
</div>
</div>
<div class="section" id="wcs">
<span id="service-provision-server-setup-geoserver-wcs"></span><h3>WCS<a class="headerlink" href="#wcs" title="Permalink to this headline">¶</a></h3>
<div class="section" id="exemplar-data-used-in-this-cookbook">
<h4>Exemplar data used in this cookbook<a class="headerlink" href="#exemplar-data-used-in-this-cookbook" title="Permalink to this headline">¶</a></h4>
<p>For the purposes of this cookbook we will use the Bathymetry Multi-colour 3-Band GeoTiffs supplied by the EMODnet project and available for download from the “Portal for Bathymetry” (<a class="reference external" href="http://portal.emodnet-bathymetry.eu/">http://portal.emodnet-bathymetry.eu/</a>)</p>
</div>
<div class="section" id="metadata-to-be-used-in-configuring-your-service-and-coverages-layers">
<h4>Metadata to be used in configuring your service and coverages (layers)<a class="headerlink" href="#metadata-to-be-used-in-configuring-your-service-and-coverages-layers" title="Permalink to this headline">¶</a></h4>
<p>Your coverage service and coverage (layer) metadata should follow the <a class="reference internal" href="#service-provision-onegeology-profile"><span class="std std-ref">OneGeology Profile</span></a>.</p>
<p>Whilst GeoServer can use a number of data formats as inputs for its WCS services at present you must use GeoTIFFs if you want to provide output in image/png or image/jpeg formats, such that the coverages can be viewed within the portal.</p>
</div>
<div class="section" id="id64">
<h4>Stores<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h4>
<p>The next step is to use the ‘Stores’ menu option to set up a Raster data source for each of our exemplar (EMODnet) GeoTIFFs.    To do this, go to the left hand menu ‘Stores’ option, and click the  ‘Add new store’ link.  Under the Raster Data Sources heading select ‘GeoTIFF - Tagged Image File Format with Geographic information’.  Select the newly created Workspace from the drop down list.</p>
<div class="figure align-default">
<img alt="_images/wcs_fig04.jpg" src="_images/wcs_fig04.jpg" />
</div>
<p>Add a Data Source name (recommended that you omit spaces here) which will become part of the identifier for your data in the service.   Use the Connection Parameters URL to link to the actual data.</p>
<p>In this example we have our EMODnet data on our server at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="mi">1</span><span class="n">Gdata</span>\<span class="n">Emodnet</span>
</pre></div>
</div>
<p>The file protocol URL to access this path is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span><span class="p">:</span><span class="o">//</span><span class="n">C</span><span class="p">:</span>\<span class="mi">1</span><span class="n">Gdata</span>\<span class="n">Emodnet</span>
</pre></div>
</div>
<p>So in this case to access our Tiff the URL is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span><span class="p">:</span><span class="o">//</span><span class="n">C</span><span class="p">:</span>\<span class="mi">1</span><span class="n">Gdata</span>\<span class="n">Emodnet</span>\<span class="n">Aegean</span> <span class="n">Sea</span> <span class="o">-</span> <span class="n">Levantine</span> <span class="n">Sea</span> <span class="p">[</span><span class="n">Multi</span> <span class="n">Colour</span><span class="p">]</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>Remember to enable the data source by ticking the box.</p>
<p>When you save your store you should get an option to Publish your data source as a Layer.</p>
<div class="figure align-default">
<img alt="_images/wcs_fig05.jpg" src="_images/wcs_fig05.jpg" />
</div>
<p>You will need to repeat these steps to create a data source for all of the GeoTIFFs that you wish to make available in your service.</p>
</div>
<div class="section" id="id65">
<h4>Layers<a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h4>
<p>If you didn’t Publish the data as part of the data source configuration, the final step is to create a layer using your data sources.  Select the Layers option in the left hand menu, then find the Workspace:Datasource name combination required from the drop down list.</p>
<div class="figure align-default">
<img alt="_images/wcs_fig06.jpg" src="_images/wcs_fig06.jpg" />
</div>
<p>That’s essentially it, as the information that you can add (as opposed to the information that is auto-populated) in the layer properties is not used in either the GetCapabilities or the DescribeCoverage response.</p>
</div>
<div class="section" id="service-level-metadata">
<h4>Service level metadata<a class="headerlink" href="#service-level-metadata" title="Permalink to this headline">¶</a></h4>
<p>To configure service level metadata, choose the WCS option in the Services section of the Left hand menu.  Then select your workspace from the dropdown list.</p>
<div class="figure align-default">
<img alt="_images/wcs_fig07.jpg" src="_images/wcs_fig07.jpg" />
</div>
<p>To get your service to be available you must tick the Enable WCS option box.</p>
<p>To conform to the OneGeology WCS profile you must also tick the Strict CITE compliance option box.</p>
<p>Online Resource here is a link to your (or any other) web site (not your service), that provides information about your data.</p>
<p>Title must follow the WMS naming conventions</p>
<p>Abstract covers the service in general.  You may also add information about the individual layers.</p>
<p>Fees and Access Constraints for your service, if you have no constraints then you MUST explicitly state this using ‘none’.</p>
<p>Keywords can include a language code and reference a vocabulary.</p>
<p>For example in the example shown below we have a keyword only “OneGeology”, a keyword with vocabulary “infoCoverageAccessService [ISO]”, and a keyword with vocabulary and language code “marine geology (en) [GEMET]” .  The new keyword shown in the form will become (when the Add Keyword button is clicked) “Meeresgeologie (de) [GEMET]”</p>
<p>The GEMET keywords come from <a class="reference external" href="http://www.eionet.europa.eu/gemet/en/themes/">http://www.eionet.europa.eu/gemet/en/themes/</a></p>
<div class="figure align-default">
<img alt="_images/wcs_fig08.jpg" src="_images/wcs_fig08.jpg" />
</div>
<p>Finally you need to configure a limited list of projection systems that your service will provide, REMEMBER the service must support EPSG:4326.</p>
<div class="figure align-default">
<img alt="_images/wcs_fig09.jpg" src="_images/wcs_fig09.jpg" />
</div>
<p>The above list gives the following in the GetCapabilities response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">opengis</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">def</span><span class="o">/</span><span class="n">crs</span><span class="o">/</span><span class="n">EPSG</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">27700</span><span class="o">&lt;/</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">opengis</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">def</span><span class="o">/</span><span class="n">crs</span><span class="o">/</span><span class="n">EPSG</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">3034</span><span class="o">&lt;/</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">opengis</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">def</span><span class="o">/</span><span class="n">crs</span><span class="o">/</span><span class="n">EPSG</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">3413</span><span class="o">&lt;/</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">opengis</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">def</span><span class="o">/</span><span class="n">crs</span><span class="o">/</span><span class="n">EPSG</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">3857</span><span class="o">&lt;/</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">opengis</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">def</span><span class="o">/</span><span class="n">crs</span><span class="o">/</span><span class="n">EPSG</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">4258</span><span class="o">&lt;/</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">opengis</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">def</span><span class="o">/</span><span class="n">crs</span><span class="o">/</span><span class="n">EPSG</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">4326</span><span class="o">&lt;/</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">opengis</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">def</span><span class="o">/</span><span class="n">crs</span><span class="o">/</span><span class="n">EPSG</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">404000</span><span class="o">&lt;/</span><span class="n">wcscrs</span><span class="p">:</span><span class="n">crsSupported</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id66">
<h4>INSPIRE Extended Capabilities<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h4>
<p>If you are providing an INSPIRE download service you will need to provide the extra INSPIRE mandated metadata in the WCS GetCapabilities response. GeoServer enables you to configure a scenario 1 style extended capabilities section. All INSPIRE specific requirements are optional for OneGeology use but will work as OneGeology services.</p>
<p>As described in the <a class="reference external" href="http://docs.geoserver.org/latest/en/user/extensions/inspire/using.html">plugin documentation</a> you should find a section in the WCS service settings of the administration interface where you can choose a language, enter a service metadata URL and type and add one or more spatial dataset identifiers. For guidance on what to enter in these settings see the <a class="reference external" href="https://inspire.ec.europa.eu/id/document/tg/download-wcs">Technical Guidance for the implementation of INSPIRE Download Services using Web Coverage Services (WCS)</a>.</p>
<p>Check that the GetCapabilities responses contain your edited values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The plugin GUI only has two non-empty values for the Service Metadata Type: “Online ISO 19139 ServiceMetadata document” sets the MIME type to <code class="docutils literal notranslate"><span class="pre">application/vnd.iso.19139+xml</span></code>, “CSW GetRecord by ID request” sets the MIME type to <code class="docutils literal notranslate"><span class="pre">application/vnd.ogc.csw.GetRecordByIdResponse_xml</span></code>. If neither of these correspond to the actual MIME type of your metadata resource you could omit this element by choosing the blank option or work around it by manually editing the wfs.xml file inside the GeoServer data directory as documented in issue <a class="reference external" href="https://osgeo-org.atlassian.net/browse/GEOS-5157">GEOS-5157</a> . As it isn’t clear what a client would do with this information anyway, leaving it blank seems to be a good option.</p>
</div>
</div>
<div class="section" id="troubleshooting">
<h4>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h4>
<div class="figure align-default">
<img alt="_images/wcs_fig10.jpg" src="_images/wcs_fig10.jpg" />
</div>
<p>If you start getting error messages when using GeoServer, you will probably need to increase the JAVA permgen space.  This can occur when you are serving lots of raster data. See <a class="reference external" href="http://osgeo-org.1560.x6.nabble.com/Session-times-out-when-adding-new-stores-or-layers-td4910354.html">http://osgeo-org.1560.x6.nabble.com/Session-times-out-when-adding-new-stores-or-layers-td4910354.html</a></p>
</div>
</div>
<div class="section" id="geoserver-troubleshooting">
<h3>GeoServer troubleshooting<a class="headerlink" href="#geoserver-troubleshooting" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>Q: I made a change in the database on my server and now the service is not working</dt><dd><p>A: Try clearing the cache and reloading GeoServer on the Server Status page. If that doesn’t work, try hard restarting the service through Apache Tomcat.</p>
</dd>
<dt>Q: Can I use a replicated Feature Class to create a service on GeoServer?</dt><dd><p>A: No.</p>
</dd>
<dt>Q: I set up my services under three separate workspaces. When I connected to the WMS in ArcCatalog, all the layers appeared as one bundle. Is there a way to separate them out so I can add them individually?</dt><dd><p>A: Yes.</p>
</dd>
</dl>
<p>Though setting up your services under different workspaces seems to imply that they can be accessed as discrete services, GeoServer defaults to providing one capabilities document containing the information for all of the services set up on your instance of GeoServer. To access workspaces individually, you will need customize your Get request to specify the desired workspace.</p>
<p>For example: a Geological Survey might run three services on GeoServer:</p>
<ul class="simple">
<li><p>GeologicUnitView</p></li>
<li><p>FaultView</p></li>
<li><p>ContactView</p></li>
</ul>
<p>To perform a GetCapabilities request for GeologicUnitView, your GetCapabilities request will appear as follows:</p>
<p>http://services.a.survey.gov/geoserver/GeologicUnitView/ows?service=WMS&amp;request=GetCapabilities&amp;</p>
<p>This URL opens the WMS <strong>capabilities document</strong> for the GeologicUnitView workspace only. A generic form of the service endpoint for the request is as follows:</p>
<p>http://[host server]/geoserver/[Workspace Name]/ows?</p>
<dl class="simple">
<dt>Q: Is it possible to configure GeoServer so that I do not need to use PostGIS?</dt><dd><p>A: Try installing the ArcSDE plug-in for GeoServer. To do this, you will need to download the extension from GeoServer’s website. Make sure to match the versions of the extension and GeoServer.  If you can get it to work, you should be able to connect to other SDE databases running on, for instance, MS SQL or Oracle.</p>
</dd>
<dt>Q: All of my data are in Shapefiles. Can I deploy a shapefile as a GeoSciML-Lite service?</dt><dd><p>A: The problem you will run into is the truncation of field names that occurs in shapefiles. Ideally you will have a full version of the data in PostGIS. As mentioned in the above document, to be compliant with GeoSciML-Lite, you will need to make sure there is no truncation in field names; they must be an exact match for the GeoSciML-Lite schema. To map table fields to XML elements with different names you will have to use the <a class="reference external" href="http://docs.geoserver.org/stable/en/user/data/app-schema/index.html">Application Schema extension</a> for GeoServer.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="using-mapserver">
<h2>Using MapServer<a class="headerlink" href="#using-mapserver" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id70">
<h3>Software Installation<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://mapserver.org/">MapServer</a> can be used to provide a number of OGC Web Services (OWS) types, such as the Web Map Service (WMS), Web Feature Service (WFS) and Web Coverage Service (WCS) standards which are the current focus of interest for the OneGeology portal.  In the following sections we run through how to configure MapServer so it can provide any one of these three service types.</p>
<p>MapServer will work both on Windows and Linux operating systems (both 32-bit and 64-bit), and with a web server of your choosing, the permutations are many and we can not cover all of them, below we take you through some common installations, using Apache HTTP as the web server.</p>
<p>The simplest way to set up MapServer on a Windows server is to use the MapServer for Windows (MS4W) installer provided by Gateway Geomatics, this installs a 32-bit version of the Apache HTTP web server and the 32-bit version of MapServer as well as some demo applications.  For those wishing to use a 64-bit version of Apache HTTP web server, we recommend Apache Lounge and GISInternals.  For installation of MapServer on Linux, (with Apache HTTP web server) we recommend Ubuntu and the Personal Package Archives.</p>
</div>
<div class="section" id="installing-ms4w">
<h3>Installing MS4W<a class="headerlink" href="#installing-ms4w" title="Permalink to this headline">¶</a></h3>
<p>All versions of the MS4W software package, including the latest version are available from the <a class="reference external" href="https://ms4w.com/">Gateway Geomatics MS4W</a>  web site.</p>
<p>Two options are available, a downloadable zip of all the appropriate binaries or an installer.  We will use the installer here as it the easiest option for those setting up a OneGeology service for the first time.  The installer is available from the <a class="reference external" href="https://ms4w.com/download.html">Download Packages</a> page. Download the latest setup file, for us this was ms4w-3.2.2-setup.exe, to a temporary location on your server.</p>
<div class="figure align-default">
<img alt="_images/ms4w-setup.png" src="_images/ms4w-setup.png" />
</div>
<p>Run the setup.exe file as an Administrator.  A small dialogue window will pop-up appear detailing the licensing agreement. Please take the time to read the license, and if you accept the conditions click on the <em>I Agree</em> button.</p>
<div class="figure align-default">
<img alt="_images/MS4W-agree-license.png" src="_images/MS4W-agree-license.png" />
</div>
<p>The next screen will offer a selection of installation options.  To run a OneGeology service you only need to accept the default options, but you can choose other options if you wish, such as p.mapper (if you want to use PHP//MapScript), or MapBender, OpenLayers, or GeoMoose, if you want to develop your own client application.</p>
<div class="figure align-default">
<img alt="_images/ms4w-select-options.png" src="_images/ms4w-select-options.png" />
</div>
<p>Once you have made your option selection select <em>Next</em> and choose an installation folder for the MS4W folder.  The default location will be into your <em>C:</em> drive.</p>
<div class="figure align-default">
<img alt="_images/MS4W-default-path.png" src="_images/MS4W-default-path.png" />
</div>
<p><strong>Note</strong> You shouldn’t specify the MS4W folder as this will be created as part of the installation.</p>
<p>Finally, you need to choose a port to run your web service on.  You should use the default port of 80 if at all possible, otherwise other official web server ports are: 591, 8008, and 8080.</p>
<div class="figure align-default">
<img alt="_images/MS4W-default-port.png" src="_images/MS4W-default-port.png" />
</div>
<p>When you have finished click <em>Install</em>  the dialogue will show you the progress of the installation process.  If the installer finds that you are missing the appropriate Microsoft Visual C++ distribution to run MapServer, then it will provide an additional window as part of the installation, providing a license agreement which you need to agree to and <em>Install</em>.</p>
<div class="figure align-default">
<img alt="_images/MS4W-installCpp.png" src="_images/MS4W-installCpp.png" />
</div>
<p>If the installation works correctly you will be taken to a page on your newly installed web server as below:</p>
<div class="figure align-default">
<img alt="_images/MS4W-localhost-post-install.png" src="_images/MS4W-localhost-post-install.png" />
</div>
</div>
<div class="section" id="configuring-the-exemplar-services">
<h3>Configuring the exemplar services<a class="headerlink" href="#configuring-the-exemplar-services" title="Permalink to this headline">¶</a></h3>
<p>Obtain the OneGeology template application in the 20Mbytes approx. sized 1G_WMS-exemplar-data-MS6-update.zip file from the <a class="reference external" href="ftp://ftp.bgs.ac.uk/pubload/OneGeology/">BGS FTP website</a>.</p>
<p>If you are using a web browser clicking on this URL may take you directly to it without requesting a password.  If you prefer to use the older DOS prompt style FTP user interface then as normal with such anonymous ftp services enter anonymous if prompted for a userid and type your email address as the password to allow the FTP manager to monitor who is using the service.</p>
<p>Unzip the OneGeology template application to the same drive and directory level as the MS4W location resulting from the MapServer installation e.g. if you installed MS4W on C:\MS4W then point the unzip extract to C:.  It should create a number of files inside the <em>ms4w</em> directory.  The main part of the two example applications are inside a BGS_Bedrock_and_Superficial_Geology directory (for the shapefile based example) and BGS_Bedrock_Raster_Map directory (for the image file based example) which will be created inside ms4w\apps\cookbookExemplars.</p>
<p>The MapServer executables for the two applications are found in similarly named folders in ms4w\apps\exemplars, and the web server configuration files are found in ms4w\httpd.d</p>
<p>After unzipping the exemplar files, restart your web service.  Now when you browse to localhost/index.html you will get links to the two exemplar services.</p>
</div>
<div class="section" id="configuring-your-own-services-using-the-exemplars-as-examples">
<h3>Configuring your own services using the exemplars as examples<a class="headerlink" href="#configuring-your-own-services-using-the-exemplars-as-examples" title="Permalink to this headline">¶</a></h3>
<div class="section" id="c-ms4w-apache-cgi-bin">
<h4>C:\ms4w\Apache\cgi-bin\<a class="headerlink" href="#c-ms4w-apache-cgi-bin" title="Permalink to this headline">¶</a></h4>
<p>Create a folder inside ms4w\Apache\cgi-bin with a name that follows the OneGeology profile.</p>
<p>It is not within the scope of OneGeology at this stage to address the problem of translating geological terms between different languages so the above service can be in the language you usually use for your data.  However, if you already have your data in other languages, in particular English if that is not your default language, then we would like to encourage you to provide services in these other languages as well.  These should be served from separate services with different URLs.  In MapServer this means making another copy of the above directory and renaming it to use the appropriate language in the directory name.</p>
<p>At this stage you should have a sub-folder structure within c:\ms4w\Apache\cgi-bin like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>\BGS_Bedrock_and_Superficial_Geology
   Holds MapServer cgi libraries for the ‘BGS_Bedrock_and_Superficial_Geology’ shapefile-based exemplar service.
\BGS_Bedrock_Geology
   Holds MapServer cgi libraries for the ‘BGS_Bedrock_Geology’ raster-based exemplar service.
\Your-Organization-code_Your-Service-Theme
   EMPTY
\Your-Organization-code_Your-alternate-language(service)-code_Your-Service-Theme
   EMPTY
</pre></div>
</div>
</div>
<div class="section" id="c-ms4w-apps-cookbookexemplars">
<h4>C:\ms4w\apps\cookbookExemplars<a class="headerlink" href="#c-ms4w-apps-cookbookexemplars" title="Permalink to this headline">¶</a></h4>
<p>Inside the ms4wappscookbookExemplars folder you will find two folders: “BGS_Bedrock_and_Superficial_Geology” and “BGS_Bedrock_Raster_Map”.  These folders contain the exemplar data, and map configuration files.</p>
<p>We will assume you are basing your service on the BGS_Bedrock_and_Superficial_Geology example; substitute with BGS_Bedrock_Raster_Map if that is closer to your requirements.  When you have decided which exemplar service is most suitable for your needs, you should copy that exemplar folder to a new folder that will be your new service.</p>
<p>Note the names of these folders do not have to match the names of the service, but you would be advised to ensure that the folder name gives some hint as to its contents and purpose.  For example we call one of our exemplar folders “BGS_Bedrock_Raster_Map” to indicate that this service application holds a raster map as datasource, rather than a shapefile.</p>
<p>Make more copies with appropriate names if you are also making multiple language services.</p>
<p>Inside this folder there is a wwwroot\index.html file.  This has some example queries which will enable you to test your service when you have set it up.  For these to work for your new service you will need to edit the file and change all occurrences of the string “BGS_Bedrock_and_Superficial_Geology” with the name you have created for your service.</p>
</div>
<div class="section" id="c-ms4w-httpd-d">
<h4>C:\ms4w\httpd.d\<a class="headerlink" href="#c-ms4w-httpd-d" title="Permalink to this headline">¶</a></h4>
<p>Now you will need to create an httpd conf file in the ms4whttpd.dfolder that has the same name as your service; for example, the “BGS_Bedrock_and_Superficial_Geology” exemplar service has a conf file called “httpd_BGS_Bedrock_and_Superficial_Geology_Exemplar.conf” and the “BGS_Bedrock_Geology” exemplar service has a corresponding conf file called “httpd_BGS_Bedrock_Geology.conf”</p>
<p>You need to copy one of the exemplar .conf files and rename it to match the name of your service, you will then need to change the paths in the file to match your service name and folder configuration.</p>
<p>Using the raster exemplar service (as shown below), you will need to change all references to “BGS_Bedrock_Geology” to match the name of your service, and all references to “BGS_Bedrock_Raster_Map” to match the name of your app folder.  Note, you do not need to add the drive letter.</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nb">Alias</span> <span class="sx">/BGS_Bedrock_Geology/</span> <span class="s2">&quot;/ms4w/apps/cookbookExemplars/BGS_Bedrock_Raster_Map/www/&quot;</span>

<span class="nt">&lt;Directory</span> <span class="s">&quot;/ms4w/apps/cookbookExemplars/BGS_Bedrock_Raster_Map/www/&quot;</span><span class="nt">&gt;</span>
    <span class="nb">AllowOverride</span> <span class="k">None</span>
    <span class="nb">Options</span> Indexes FollowSymLinks Multiviews
    <span class="nb">Order</span> allow,deny
    <span class="nb">Allow</span> from <span class="k">all</span>
<span class="nt">&lt;/Directory&gt;</span>

<span class="nb">SetEnvIf</span> Request_URI <span class="s2">&quot;/cgi-bin/exemplars/BGS_Bedrock_Geology/ows&quot;</span> MS_Mapfile=/ms4w/apps/cookbookExemplars/BGS_Bedrock_Raster_Map/onegeology.map
<span class="nb">SetEnvIf</span> Request_URI <span class="s2">&quot;/fcgi-bin/exemplars/BGS_Bedrock_Geology/ows&quot;</span> MS_Mapfile=/ms4w/apps/cookbookExemplars/BGS_Bedrock_Raster_Map/onegeology.map
</pre></div>
</div>
</div>
<div class="section" id="c-ms4w-apache-htdocs">
<h4>C:\ms4w\Apache\htdocs\<a class="headerlink" href="#c-ms4w-apache-htdocs" title="Permalink to this headline">¶</a></h4>
<p>Now you should edit the index.html file in the Apache web root \ms4w\Apache\htdocs\ and add a link to your new service.  Note, the link you use is the value of the Alias (line one of the httpd conf file).</p>
<p>Again make more copies if making multiple language services.</p>
</div>
</div>
<div class="section" id="installing-and-configuring-apache-http-web-server">
<h3>Installing and configuring Apache HTTP web server<a class="headerlink" href="#installing-and-configuring-apache-http-web-server" title="Permalink to this headline">¶</a></h3>
<p>MS4W, as described above, installs both MapServer and the Apache HTTP webserver software.  Other installations of MapServer require configuring of the web server as a separate process.  This section takes you through installing alternate Apache HTTP webserver software, and through the additional configuration you will need to do to create a OneGeology service that follows the same pattern as above.</p>
<div class="section" id="bit-apache-http-server">
<h4>64-bit Apache HTTP server<a class="headerlink" href="#bit-apache-http-server" title="Permalink to this headline">¶</a></h4>
<p>if tyou want to run a 64-bit version of MapServer on Windows such as provided by GISInternals, you will also need to in install a 64-bit version of Apache.</p>
<p>If instead you want to use the latest stable release of Apache-HTTP, that is the version 2.4.n releases (latest is currently 2.4.29), you must instead go to the Apache Lounge site: <a class="reference external" href="http://www.apachelounge.com/download/">http://www.apachelounge.com/download/</a>. There are several options here both in server architecture (32 bit and 64 bit), and server functionality, for you to choose from to fit your needs.</p>
<p>For the purposes of this example we have selected a 64-bit package from Apache Lounge and installed it to our C:drive as C:Apache24.</p>
</div>
<div class="section" id="httpd-d-configuration-files">
<h4>httpd.d configuration files<a class="headerlink" href="#httpd-d-configuration-files" title="Permalink to this headline">¶</a></h4>
<p>For this installation we will now create a httpd.d folder on our D:\ drive, to hold our OneGeology service configuration files, as: D:\WxS\ms\httpd.d\ , and create an http_ file (i.e. ‘httpd_BGS_Bedrock_and_Superficial_Geology_Exemplar.conf’) for our exemplar service as below.</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="c">#===============================================================================================#</span>
<span class="nb">Alias</span> <span class="sx">/BGS_Bedrock_and_Superficial_Geology_Exemplar/</span> <span class="s2">&quot;D:/WxS/ms/apps/cookbookExemplars/BGS_Bedrock_and_Superficial_Geology/wwwroot/&quot;</span>

<span class="nt">&lt;Directory</span> <span class="s">&quot;D:/WxS/ms/apps/cookbookExemplars/BGS_Bedrock_and_Superficial_Geology/wwwroot/&quot;</span><span class="nt">&gt;</span>
    <span class="nb">AllowOverride</span> <span class="k">None</span>
    <span class="nb">Options</span> FollowSymLinks Multiviews
    <span class="nb">Require</span> <span class="k">all</span> granted
<span class="nt">&lt;/Directory&gt;</span>
<span class="c">#===============================================================================================#</span>

<span class="nb">SetEnvIf</span> Request_URI <span class="s2">&quot;/cgi-bin/exemplars/BGS_Bedrock_and_Superficial_Geology/wms&quot;</span> MS_Mapfile=D:/WxS/ms/apps/cookbookExemplars/BGS_Bedrock_and_Superficial_Geology/onegeology.map
</pre></div>
</div>
<p>Note, that there is a change in the way access permissions are handled between versions 2.2.n and 2.4.n of Apache, so if you are copying the existing MS4W httpd_ conf files you will need to change your &lt;Directory&gt; information;  that is, you will need to replace the ‘<em>Order allow,deny</em>’ and ‘<em>Allow from all</em>’ directives with ‘<em>Require all granted</em>’</p>
</div>
<div class="section" id="apache-conf">
<h4>apache.conf<a class="headerlink" href="#apache-conf" title="Permalink to this headline">¶</a></h4>
<p>Finally you will need to add some information to the Apache-HTTP server configuration file (C:Apache24confhttpd.conf) as per the below snippets.</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;IfModule</span> <span class="s">alias_module</span><span class="nt">&gt;</span>
  ...
  <span class="c"># Alias: Maps web paths into filesystem paths and is used to</span>
  <span class="c"># access content that does not live under the DocumentRoot.</span>

  <span class="nb">Alias</span> <span class="sx">/ms_tmp</span> <span class="s2">&quot;D:/WxS/ms/out/tmp&quot;</span>

  <span class="c"># ScriptAlias: This controls which directories contain server scripts.</span>
  <span class="c"># ScriptAliases are essentially the same as Aliases, except that</span>
  <span class="c"># documents in the target directory are treated as applications and</span>
  <span class="c"># run by the server when requested rather than as documents sent to the</span>
  <span class="c"># client.</span>

  <span class="nb">ScriptAlias</span> <span class="sx">/cgi-bin/</span> <span class="s2">&quot;C:/Apache24/cgi-bin/&quot;</span>
  ...
<span class="nt">&lt;/IfModule&gt;</span>
...
<span class="nt">&lt;Directory</span> <span class="s">&quot;C:/Apache24/cgi-bin&quot;</span><span class="nt">&gt;</span>
    <span class="nb">AllowOverride</span> <span class="k">None</span>
    <span class="nb">Options</span> <span class="k">None</span>
    <span class="nb">Require</span> <span class="k">all</span> granted
<span class="nt">&lt;/Directory&gt;</span>
...
<span class="c"># Parse our MapServer Apache conf files</span>
<span class="nb">Include</span> D:/WxS/ms/httpd.d/httpd_*.conf
</pre></div>
</div>
</div>
<div class="section" id="create-alias-configuration-files">
<h4>Create alias configuration files<a class="headerlink" href="#create-alias-configuration-files" title="Permalink to this headline">¶</a></h4>
<p>Next we need to create an alias to our data files and MapServer html templates.  The way you do this varies considerably depending on your Linux version.  In older versions of Ubuntu these aliases are created in the <strong>alias</strong> file located in the <strong>/etc/apache2/conf.d/</strong> directory.  In recent versions you should add these aliases to the <strong>httpd.conf</strong> file in <strong>/etc/apache2/</strong></p>
<p>We need to create information in the style of the contents of the .conf files (found in our unzipped contents ../ms4w/httpd.d/ directory).  We will combine the contents of both .conf files (that deal with the html templates and data content) into our ‘alias’ configuration file.</p>
<p>You may choose any text editor, but probably the easiest to use is nano.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># cd /etc/apache2</span>
<span class="c1"># nano httpd.conf</span>
</pre></div>
</div>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nb">Alias</span> <span class="sx">/BGS_Bedrock_Geology</span> <span class="sx">/usr/local/src/ms4w/apps/cookbookExemplars/BGS_Bedrock_Raster_Map/wwwroot/</span>

<span class="nt">&lt;Directory</span> <span class="s">/usr/local/src/ms4w/apps/cookbookExemplars/BGS_Bedrock_Raster_Map/wwwroot/</span><span class="nt">&gt;</span>
     <span class="nb">AllowOverride</span> <span class="k">None</span>
     <span class="nb">Options</span> Indexes FollowSymLinks Multiviews
     <span class="nb">Order</span> allow,deny
     <span class="nb">Allow</span> from <span class="k">all</span>
<span class="nt">&lt;/Directory&gt;</span>

<span class="nb">Alias</span> <span class="sx">/BGS_Bedrock_and_Superficial_Geology</span> <span class="sx">/usr/local/src/ms4w/apps/cookbookExemplars/BGS_Bedrock_and_Superficial_Geology/wwwroot/</span>

<span class="nt">&lt;Directory</span> <span class="s">/usr/local/src/ms4w/apps/cookbookExemplars/BGS_Bedrock_and_Superficial_Geology/wwwroot/</span><span class="nt">&gt;</span>
     <span class="nb">AllowOverride</span> <span class="k">None</span>
     <span class="nb">Options</span> Indexes FollowSymLinks Multiviews
     <span class="nb">Order</span> allow,deny
     <span class="nb">Allow</span> from <span class="k">all</span>
<span class="nt">&lt;/Directory&gt;</span>
</pre></div>
</div>
<p>^O (to save changes)</p>
<p>ENTER</p>
<p>^X (to exit)</p>
<p>You will probably need to restart the Apache web server at this point:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#/etc/init.d/apache2 restart</span>
</pre></div>
</div>
<p>We can test these using the lynx browser</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#lynx http://127.0.0.1/BGS_Bedrock_and_Superficial_Geology/index.html</span>
</pre></div>
</div>
<p>or using wget:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#cd /tmp</span>
<span class="c1">#wget http://127.0.0.1/BGS_Bedrock_Geology/index.html</span>
<span class="c1">#less index.html</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="installing-gisinternals-packages-for-windows">
<h3>Installing GISInternals packages for Windows<a class="headerlink" href="#installing-gisinternals-packages-for-windows" title="Permalink to this headline">¶</a></h3>
<p>The most recent versions of the GISInternals GDAL and MapServer packages are available online at: <a class="reference external" href="http://www.gisinternals.com">http://www.gisinternals.com</a></p>
<p>In most instances we would recommend using the MS4W packages to install Apache and MapServer to give yourself a Windows implementation of MapServer, but in some instances, for example if you want the latest version of MapServer or if you want to use 64-bit software, you can alternatively use one of the GISinternals packages for your MapServer service.</p>
<p>In this section we will assume you are familiar with configuring a MS4W service and just provide some notes to assist you configure this alternative MapServer on Windows service using Apache-HTTP as your web server.</p>
<p>Once you have a working web service installed, you now need to obtain the corresponding GISInternals binaries, for example in this case we downloaded the zip file <strong>release-1600-x64-gdal-1-9-2-MapServer-6-2-0.zip</strong>, and unzipped onto our C:drive as C:appsgisinternals.</p>
<p>Now we must run the SDKShell.bat batch file to set up some environment variables, for example it adds the following locations to the system PATH:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>C:\apps\gisinternals\bin;
C:\apps\gisinternals\bin\gdal\python\osgeo;
C:\apps\gisinternals\bin\proj\apps;
C:\apps\gisinternals\bin\gdal\apps;
C:\apps\gisinternals\bin\ms\apps;
C:\apps\gisinternals\bin\gdal\csharp;
C:\apps\gisinternals\bin\ms\csharp;
C:\apps\gisinternals\bin\curl;
</pre></div>
</div>
<p>The MapServer executable file (mapserv.exe) is found in the C:appsgisinternalsbinmsapps folder.  As ever, you can check the version by using the -v option in a command window like:</p>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">c:\apps\gisinternals\bin\ms\apps&gt;</span>mapserv.exe -v
<span class="go">MapServer version 7.1-dev OUTPUT=PNG OUTPUT=JPEG OUTPUT=KML SUPPORTS=PROJ SUPPORTS=AGG SUPPORTS=FREETYPE SUPPORTS=CAIRO SUPPORTS=SVG_SYMBOLS SUPPORTS=SVGCAIRO SUPPORTS=ICONV SUPPORTS=FRIBIDI SUPPORTS=WMS_SERVER SUPPORTS=WMS_CLIENT SUPPORTS=WFS_SERVER SUPPORTS=WFS_CLIENT SUPPORTS=WCS_SERVER SUPPORTS=SOS_SERVER SUPPORTS=FASTCGI SUPPORTS=THREADS SUPPORTS=GEOS INPUT=JPEG INPUT=POSTGIS INPUT=OGR INPUT=GDAL INPUT=SHAPEFILE</span>
</pre></div>
</div>
</div>
<div class="section" id="id72">
<h3>Data<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h3>
<p>You may put your OneGeology data for your service (and the Mapfile etc) anywhere on your server, but here we will follow the same pattern as we have for used for the MS4W services.  In this case we have extracted the exemplar shapefile data to a location on our D:drive as:</p>
<ul class="simple">
<li><p>D:\WxS\ms\apps\cookbookExemplars\BGS_Bedrock_and_Superficial_Geology</p>
<ul>
<li><p>data (folder)</p></li>
<li><p>templates (folder)</p></li>
<li><p>wwwroot (folder)</p></li>
<li><p>onegeology.map (file)</p></li>
<li><p>ICSClasses.txt (file)</p></li>
</ul>
</li>
</ul>
<p>You will need to make a few change to the Mapfile from the downloaded exemplar file.  For example you will need to tell MapServer where to find the proj files so that you can reproject your data.  You do this by adding a CONFIG statement at the top of the Mapfile like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">MAP</span>
   <span class="k">CONFIG</span> <span class="s">&quot;PROJ_LIB&quot;</span> <span class="s">&quot;C:/apps/gisinternals/bin/proj/SHARE&quot;</span>
</pre></div>
</div>
<p>You will also need to change the IMAGEPATH statement to point at your chosen temporary file location (within the WEB section of the Mapfile) like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="c">#====================================================================#</span>
<span class="c"># Start of WEB interface definition (including WMS enabling metadata)</span>
<span class="c">#====================================================================#</span>
    <span class="k">WEB</span>
        <span class="k">HEADER</span> <span class="s">&quot;tmpl/query_header.html&quot;</span>
        <span class="k">FOOTER</span> <span class="s">&quot;tmpl/query_footer.html&quot;</span>
        <span class="k">IMAGEPATH</span> <span class="s">&quot;D:/WxS/ms/out/tmp/&quot;</span>
        <span class="k">IMAGEURL</span> <span class="s">&quot;/ms_tmp/&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="mapserver-cgi-bin">
<h3>MapServer cgi-bin<a class="headerlink" href="#mapserver-cgi-bin" title="Permalink to this headline">¶</a></h3>
<p>For this installation we will now create some folders in the Apache-HTTP cgi-bin folder to hold our copy of the mapserv.exe executable (which we will rename as ‘wms’) as:</p>
<ul>
<li><p>C:\Apache24\cgi-bin (folder)</p>
<blockquote>
<div><ul>
<li><p>exemplars (folder)</p>
<blockquote>
<div><ul>
<li><p>BGS_Bedrock_and_Superficial_Geology (folder)</p>
<blockquote>
<div><ul class="simple">
<li><p>wms (file)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>At this stage you will have a working MapServer service such that a request like the below (where we also specify the ‘map’ variable explicitly) will give you a GetCapabilities reponse document.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>http://[your-server-name]/cgi-bin/exemplars/BGS_Bedrock_and_Superficial_Geology/wms?
  service=WMS&amp;
  request=GetCapabilities&amp;
  map=D:/WxS/ms/apps/cookbookExemplars/BGS_Bedrock_and_Superficial_Geology/onegeology.map&amp;
</pre></div>
</div>
</div>
<div class="section" id="installing-mapserver-on-linux-using-ppas">
<h3>Installing MapServer on Linux using PPAs<a class="headerlink" href="#installing-mapserver-on-linux-using-ppas" title="Permalink to this headline">¶</a></h3>
<p>This installation guide will give you simple step-by-step instructions of installing MapServer onto a Linux server and assumes you have an Apache HTTP webserver already running.</p>
<p>Users of Ubuntu/Debian systems should find that they are able to get the latest version of MapServer by adding the following Personal Package Archives to their system’s software sources:</p>
<blockquote>
<div><dl class="simple">
<dt>ppa:ubuntugis/ppa</dt><dd><p>Official stable UbuntuGIS packages</p>
</dd>
<dt>ppa:ubuntugis/ubuntugis-unstable</dt><dd><p>Unstable releases of Ubuntu GIS packages</p>
</dd>
</dl>
</div></blockquote>
<p>For example, the Official stable version PPA can be added like:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo add-apt-repository ppa:ubuntugis/ppa
sudo apt-get update
</pre></div>
</div>
<p>And the MapServer files need to create a OneGeology service can be added like:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt install cgi-mapserver mapserver-bin tinyows
</pre></div>
</div>
<p>The MapServer executable file is called <strong>mapserv</strong> and in our installation is found at //usr//bin//mapserv</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#cp mapserv /usr/lib/cgi-bin/mapserv</span>
</pre></div>
</div>
<p>The mapserv binary created needs to have —rwxr-xr-x permissions to be able to execute</p>
<p>You can check permissions using:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#ls —l mapserv</span>
</pre></div>
</div>
<p>If needed you can change permissions using:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#chmod 755 mapserv</span>
</pre></div>
</div>
<p>To test you have compiled mapserv with all appropriate options you can check the version:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#./mapserv —v</span>
</pre></div>
</div>
<p>You should get an output like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>MapServer version 7.0.4 OUTPUT=PNG OUTPUT=JPEG OUTPUT=KML SUPPORTS=PROJ SUPPORTS=AGG SUPPORTS=FREETYPE SUPPORTS=CAIRO SUPPORTS=SVG_SYMBOLS SUPPORTS=RSVG SUPPORTS=ICONV SUPPORTS=FRIBIDI SUPPORTS=WMS_SERVER SUPPORTS=WMS_CLIENT SUPPORTS=WFS_SERVER SUPPORTS=WFS_CLIENT SUPPORTS=WCS_SERVER SUPPORTS=SOS_SERVER SUPPORTS=FASTCGI SUPPORTS=THREADS SUPPORTS=GEOS INPUT=JPEG INPUT=POSTGIS INPUT=OGR INPUT=GDAL INPUT=SHAPEFILE
</pre></div>
</div>
<p>To test you have mapserv accessible through your web server you can use the ‘lynx’ text browser package (available through apt-get):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#apt-get install lynx</span>
<span class="c1">#lynx http://127.0.0.1/cgi-bin/mapserv</span>
</pre></div>
</div>
<p>Or you could simply use the wget program (which will retrieve the output as a text file):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#cd /tmp</span>
<span class="c1">#wget http://127.0.0.1/cgi-bin/mapserv</span>
<span class="c1">#less mapserv</span>
</pre></div>
</div>
<p>You should get the message “No query information to decode. QUERY_STRING is set but empty”</p>
<p>Congratulations! You have now got MapServer installed and configured to run in your web server.</p>
</div>
<div class="section" id="configuring-mapserver-exemplar-services-on-a-lamp-server">
<h3>Configuring MapServer exemplar services on a LAMP server<a class="headerlink" href="#configuring-mapserver-exemplar-services-on-a-lamp-server" title="Permalink to this headline">¶</a></h3>
<p>We shall now configure the two BGS exemplar services (a shapefile version and a raster version) available from the BGS FTP server.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#cd /usr/local/src</span>
<span class="c1">#wget ftp://ftp.bgs.ac.uk/pubload/OneGeology/1G_WMS-exemplar-data-MS6-update.zip</span>
<span class="c1">#unzip 1G_WMS-exemplar-data-MS6-update.zip</span>
</pre></div>
</div>
<p>We now need to move the contents of the zip file to the correct locations on our server.</p>
<p>First we move our index pages to the root directory of the web server (/var/www/ on Ubuntu).</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#mv ms4w/Apache/htdocs/* /var/www/</span>
</pre></div>
</div>
<div class="section" id="create-a-ows-shell-script">
<h4>Create a ows shell script<a class="headerlink" href="#create-a-ows-shell-script" title="Permalink to this headline">¶</a></h4>
<p>Next we need to create a ‘ows’ shell script for each of our Map Services; which we need to place in an associated directory.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#cd /usr/lib/cgi-bin</span>
<span class="c1">#mkdir --parents exemplars/BGS_Bedrock_Geology</span>
<span class="c1">#nano exemplars/BGS_Bedrock_Geology/ows</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nv">MS_Mapfile</span><span class="o">=</span>/usr/local/src/ms4w/apps/cookbookExemplars/BGS_Bedrock_Raster_Map/onegeology.map
<span class="nb">export</span> MS_Mapfile
<span class="nb">exec</span> /usr/lib/cgi-bin/mapserv
<span class="nb">exit</span> <span class="m">0</span>
</pre></div>
</div>
<p>^O (to save changes)</p>
<p>ENTER</p>
<p>^X (to exit)</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#chmod 755 exemplars/BGS_Bedrock_Geology_Raster/ows</span>
</pre></div>
</div>
<p>and similarly for our shapefile based service</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#mkdir --parents exemplars/BGS_Bedrock_and_Superficial_Geology</span>
<span class="c1">#nano exemplars/BGS_Bedrock_and_Superficial_Geology/ows</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nv">MS_Mapfile</span><span class="o">=</span>/usr/local/src/ms4w/apps/cookbookExemplars/BGS_Bedrock_and_Superficial_Geology/onegeology.map
<span class="nb">export</span> MS_Mapfile
<span class="nb">exec</span> /usr/lib/cgi-bin/mapserv
<span class="nb">exit</span> <span class="m">0</span>
</pre></div>
</div>
<p>^O (to save changes)</p>
<p>ENTER</p>
<p>^X (to exit)</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#chmod 755 exemplars/BGS_Bedrock_and_Superficial_Geology/ows</span>
</pre></div>
</div>
</div>
<div class="section" id="modify-paths-in-the-mapfile">
<h4>Modify paths in the Mapfile<a class="headerlink" href="#modify-paths-in-the-mapfile" title="Permalink to this headline">¶</a></h4>
<p>The final step is to modify the WEB &gt; IMAGEPATH path (to “/var/tmp/”) and the WEB &gt; IMAGEURL path (to “/tmp/”) in each of our onegeology.map files</p>
<p>That’s it!</p>
</div>
</div>
<div class="section" id="alternative-mapserver-configurations">
<h3>Alternative MapServer configurations<a class="headerlink" href="#alternative-mapserver-configurations" title="Permalink to this headline">¶</a></h3>
<p>If you want to use other permutations and get stuck remember you can ask the OneGeology Helpdesk any MapServer configuration issues in relation to your OneGeology services, and we will endeavour to help you.</p>
<p>As well as the OneGeology Helpdesk there are a number of other resources to help guide you in your installation, including:</p>
<dl>
<dt>MS4W documentation</dt><dd><p><a class="reference external" href="https://ms4w.com/documentation.html">https://ms4w.com/documentation.html</a></p>
</dd>
<dt>MapServer documentation</dt><dd><p><a class="reference external" href="http://mapserver.org/documentation.html">http://mapserver.org/documentation.html</a></p>
</dd>
<dt>GIS StackExchange (MapServer questions)</dt><dd><p><a class="reference external" href="https://gis.stackexchange.com/search?q=is%3Aquestion+%5BMapServer%5D">https://gis.stackexchange.com/search?q=is%3Aquestion+%5BMapServer%5D</a></p>
</dd>
<dt>GIS StackExchange (MS4W questions)</dt><dd><p><a class="reference external" href="https://gis.stackexchange.com/search?q=is%3Aquestion+%5Bms4w%5D">https://gis.stackexchange.com/search?q=is%3Aquestion+%5Bms4w%5D</a></p>
</dd>
<dt>StackOverflow (Apache web server questions)</dt><dd><p><a class="reference external" href="https://stackoverflow.com/search?q=is%3Aquestion+%5Bapache%5D">https://stackoverflow.com/search?q=is%3Aquestion+%5Bapache%5D</a></p>
</dd>
<dt>Mailing Lists</dt><dd><p><a class="reference external" href="http://mapserver.org/community/lists.html#mapserver-users">http://mapserver.org/community/lists.html#mapserver-users</a></p>
<p><a class="reference external" href="https://lists.ms4w.com/mailman/listinfo/ms4w-users">https://lists.ms4w.com/mailman/listinfo/ms4w-users</a></p>
</dd>
</dl>
<div class="section" id="mapserver-and-iis">
<h4>MapServer and IIS<a class="headerlink" href="#mapserver-and-iis" title="Permalink to this headline">¶</a></h4>
<p>You may use the IIS web server instead of Apache to run the MapServer CGI.  See the previous cookbook for details of how to do this with IIS version 6.  We haven’t been able to update the cookbook for the latest version of IIS, but the MapServer documentation (<a class="reference external" href="http://mapserver.org/installation/iis.html">IIS Setup for MapServer</a>) gives a good guide for how to do this in general for IIS 7 and up.</p>
</div>
<div class="section" id="compiling-mapserver-on-linux">
<h4>Compiling MapServer on Linux<a class="headerlink" href="#compiling-mapserver-on-linux" title="Permalink to this headline">¶</a></h4>
<p>You may wish to compile your own version of MapServer on a *nix operating system of your own choosing.  We haven’t done this for a while and the guidance in our previous cookbook was very out of date.  There is guidance on the MapServer site that takes you through the process (<a class="reference external" href="http://mapserver.org/installation/unix.html">Compiling on Unix</a>)</p>
</div>
</div>
<div class="section" id="general-configuration">
<h3>General configuration<a class="headerlink" href="#general-configuration" title="Permalink to this headline">¶</a></h3>
<p>MapServer services are configured through the use of Mapfile templates (*.map).  You can use a single Mapfile to configure a service, or you can use a master file that includes other files.  The benefits of using multiple files include ease of maintenance across multiple similar services, and readability.  Here we will use multiple files to show how the various parts of a MapServer (OGC) service need to be configured.  You can configure multiple service types through a single configuration, if desired.</p>
<p>The start of a Mapfile begins with a <strong>MAP</strong> statement and ends with an <strong>END</strong> statement</p>
<p>Comments are shown by lines beginning with a <strong>#</strong> sign</p>
<p>The order of statements in the Mapfile doesn’t matter, here we tend to group alphabetically for readability.</p>
<p>For further details on Mapfile configuration options available see <a class="reference external" href="http://mapserver.org/mapfile/map.html">http://mapserver.org/mapfile/map.html</a></p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">MAP</span>
    <span class="c"># You must supply a NAME for your service, which in OGC services will be the Root Layer Name</span>
    <span class="k">NAME</span> <span class="s">&quot;BGS_EN_Bedrock_and_Superficial_Geology&quot;</span>

    <span class="c"># You may supply some extra configuration details using one or more CONFIG statements</span>
    <span class="k">CONFIG</span> <span class="s">&quot;MS_ERRORFILE&quot;</span> <span class="s">&quot;D:/logs/MapServer/Pub/TFL/ms_error.log&quot;</span>
    <span class="k">CONFIG</span> <span class="s">&quot;PROJ_LIB&quot;</span> <span class="s">&quot;C:/apps/gisinternals/bin/proj/SHARE&quot;</span>
    <span class="k">CONFIG</span> <span class="s">&quot;PGEO_DRIVER_TEMPLATE&quot;</span> <span class="s">&quot;DRIVER=Microsoft Access Driver (*.mdb, *.accdb);DBQ=</span><span class="si">%s</span><span class="s">&quot;</span>
    <span class="k">CONFIG</span> <span class="s">&quot;OGR_SKIP&quot;</span> <span class="s">&quot;ODBC&quot;</span>

    <span class="c"># You may configure the level of DEBUG detail you want from your service</span>
    <span class="k">DEBUG</span> <span class="mi">0</span>

    <span class="c"># You must supply an EXTENT, which defines the extent of the map to be created</span>
    <span class="c"># The EXTENT is specified in min-x, min-y, max-x, max-y order</span>
    <span class="c"># The EXTENT is specified in units of the default service projection</span>
    <span class="k">EXTENT</span> <span class="p">-</span><span class="mf">8.6476</span> <span class="mf">49.8639</span> <span class="mf">1.76943</span> <span class="mf">60.8622</span>

    <span class="c"># You may specify a set of fonts for your service</span>
    <span class="c"># The location of any included file is relative to the location of Mapfile</span>
    <span class="c"># See below section on alternate character set support</span>
    <span class="k">FONTSET</span> <span class="s">&quot;../DefaultMapIncludes/fontset.lst&quot;</span>

    <span class="c"># You may supply information on the output formats you wish to support</span>
    <span class="c"># See http://mapserver.org/mapfile/outputformat.html#outputformat</span>
    <span class="k">INCLUDE</span> <span class="s">&quot;../DefaultMapIncludes/BGS-service-std-output-plus1.map&quot;</span>

    <span class="c"># You must provide information on the styling of the legend</span>
    <span class="k">LEGEND</span>
        <span class="k">IMAGECOLOR</span> <span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span>
        <span class="k">STATUS</span> <span class="nb">ON</span>
        <span class="k">KEYSIZE</span> <span class="mi">18</span> <span class="mi">12</span>
        <span class="k">LABEL</span>
            <span class="k">TYPE</span> <span class="nb">BITMAP</span>
            <span class="k">SIZE</span> <span class="nb">MEDIUM</span>
            <span class="k">COLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">89</span>
        <span class="k">END</span>
    <span class="k">END</span>

    <span class="c"># You may specify the Maximum Size of the map image</span>
    <span class="k">MAXSIZE</span> <span class="mi">3072</span>

    <span class="c"># You must supply the default PROJECTION for the service</span>
    <span class="c"># For OneGeology services this would normally be EPSG:4326</span>
    <span class="k">PROJECTION</span>
       <span class="s">&quot;init=epsg:4326&quot;</span>
    <span class="k">END</span>

    <span class="c"># You may specify the path to the folder holding your shapefile data</span>
    <span class="c"># The path is relative to the location of the mapfile</span>
    <span class="k">SHAPEPATH</span> <span class="s">&quot;data&quot;</span>

    <span class="c"># You must specify the default SIZE of the map image</span>
    <span class="c"># SIZE is specified in Pixels</span>
    <span class="k">SIZE</span> <span class="mi">600</span> <span class="mi">800</span>

    <span class="c"># You must state whether the map is active or not.</span>
    <span class="k">STATUS</span> <span class="nb">ON</span>

    <span class="c"># You can specify the location of a Symbol set that defines symbols used in your styles</span>
    <span class="k">SYMBOLSET</span> <span class="s">&quot;../DefaultMapIncludes/symbols.sym&quot;</span>

    <span class="c"># You must specify the UNITS of the map coordinates</span>
    <span class="k">UNITS</span> <span class="nb">dd</span>

    <span class="k">WEB</span>
        <span class="c">#==================================================================================#</span>
        <span class="c"># The WEB section includes all the general configuration for the WEB service</span>
        <span class="c">#==================================================================================#</span>

        <span class="c"># See below section on the WEB object</span>
    <span class="k">END</span>

    <span class="c"># LAYER specific configuration would follow</span>
    <span class="k">INCLUDE</span> <span class="s">&quot;BedrockLithology.map&quot;</span>
    <span class="p">...</span>

<span class="k">END</span>
</pre></div>
</div>
<p>The <strong>WEB</strong> section of the Mapfile (extract shown below) sets general information for your web service including a general description, contact information, etc.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">WEB</span>
    <span class="c"># The FOOTER template is applied after everything else is sent for a query result</span>
    <span class="k">FOOTER</span> <span class="s">&quot;templates/query_footer.html&quot;</span>
    <span class="c"># The HEADER template is applied before anything else is sent for a query result</span>
    <span class="k">HEADER</span> <span class="s">&quot;templates/query_header.html&quot;</span>

    <span class="c"># IMAGEPATH is the temporary directory for writing temporary files and images</span>
    <span class="k">IMAGEPATH</span> <span class="s">&quot;/ms4w/tmp/ms_tmp/&quot;</span>
    <span class="c"># IMAGEURL Base URL for IMAGEPATH</span>
    <span class="k">IMAGEURL</span> <span class="s">&quot;/ms_tmp/&quot;</span>

    <span class="k">METADATA</span>
        <span class="c">#==================================================================================#</span>
        <span class="c"># The METADATA section is used to populate information into the Web Service metadata response</span>
        <span class="c"># The METADATA detailed here is part of the information found in a GetCapabilities response</span>
        <span class="c">#==================================================================================#</span>
        <span class="c"># OWS_ metadata applies to all available services (WMS, WFS, WCS, SOS...)</span>
        <span class="c"># WCS_ metadata applies to WCS services only. Values will override an OWS setting</span>
        <span class="c"># WFS_ metadata applies to WFS services only. Values will override an OWS setting</span>
        <span class="c"># WMS_ metadata applies to WMS services only. Values will override an OWS setting</span>
        <span class="c">#==================================================================================#</span>

        <span class="c"># See below section on the WEB &gt; METADATA object</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>In any <strong>METADATA</strong> section instead of  the “WMS_” prefix  you may use “OWS_” prefix.  The “OWS_” prefix is used by WMS, WFS, WCS, GML, and other services, so you only have to specify that metadata type once.  If you have “OWS_ABSTRACT” and “WMS_ABSTRACT”, the “OWS_ABSTRACT” will be used by any WFS / WCS service whilst the “WMS_ABSTRACT” will be used by the WMS.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">METADATA</span>
    <span class="s">&quot;OWS_ABSTRACT&quot;</span> <span class="s">&quot;The 1:625k DiGMap data covering the whole of the United Kingdom is available in this OGC web service for all uses - including commercial use subject to the conditions in the Access Constraints section and is being served as a contribution to the OneGeology initiative (www.onegeology.org).&quot;</span>
    <span class="s">&quot;OWS_ACCESSCONSTRAINTS&quot;</span> <span class="s">&quot;The 1:625k DiGMap data is available for free download for your personal, teaching, research, or non-commercial use (as described on http://www.bgs.ac.uk/about/copyright/non_commercial_use.html). Your use of any information provided by the British Geological Survey (BGS) is at your own risk. Neither BGS nor the Natural Environment Research Council (NERC) gives any warranty, condition, or representation as to the quality, accuracy, or completeness of the information or its suitability for any use or purpose. All implied conditions relating to the quality or suitability of the information, and all liabilities arising from the supply of the information (including any liability arising in negligence) are excluded to the fullest extent permitted by law.&quot;</span>
    <span class="s">&quot;OWS_ADDRESS&quot;</span> <span class="s">&quot;Environmental Science Centre&quot;</span>
    <span class="s">&quot;OWS_ADDRESSTYPE&quot;</span> <span class="s">&quot;postal&quot;</span>
    <span class="s">&quot;OWS_CITY&quot;</span> <span class="s">&quot;Keyworth&quot;</span>
    <span class="s">&quot;OWS_CONTACTELECTRONICMAILADDRESS&quot;</span> <span class="s">&quot;enquiries@bgs.ac.uk&quot;</span>
    <span class="s">&quot;OWS_CONTACTFACSIMILETELEPHONE&quot;</span> <span class="s">&quot;+44 (0)115 936 3200&quot;</span>
    <span class="s">&quot;OWS_CONTACTINSTRUCTIONS&quot;</span> <span class="s">&quot;&quot;</span>
    <span class="s">&quot;OWS_CONTACTORGANIZATION&quot;</span> <span class="s">&quot;British Geological Survey&quot;</span>
    <span class="s">&quot;OWS_CONTACTPERSON&quot;</span> <span class="s">&quot;Garry Baker&quot;</span>
    <span class="s">&quot;OWS_CONTACTPOSITION&quot;</span> <span class="s">&quot;&quot;</span>
    <span class="s">&quot;OWS_CONTACTVOICETELEPHONE&quot;</span> <span class="s">&quot;+44 (0)115 936 3100&quot;</span>
    <span class="s">&quot;OWS_COUNTRY&quot;</span> <span class="s">&quot;United Kingdom&quot;</span>

    <span class="c"># The following statement enables all WMS, WFS, WCS operations on all layers in the service</span>
    <span class="c"># The statemant can be overridden by service specific statements, either here or in the LAYERS</span>
    <span class="s">&quot;OWS_ENABLE_REQUEST&quot;</span> <span class="s">&quot;*&quot;</span>

    <span class="s">&quot;OWS_FEES&quot;</span> <span class="s">&quot;none&quot;</span>
    <span class="s">&quot;OWS_HOURSOFSERVICE&quot;</span> <span class="s">&quot;Mon-Fri, 09:00-17:00&quot;</span>
    <span class="c">#===========================================================================#</span>
    <span class="c"># OWS_KEYWORDLIST</span>
    <span class="c"># Put your organisation name and any other information you want to include.</span>
    <span class="c"># You MUST include &quot;OneGeology&quot; as one of the keywords.</span>
    <span class="c"># Do NOT use spaces after the commas in the keyword listing.</span>
    <span class="c">#===========================================================================#</span>
    <span class="s">&quot;OWS_KEYWORDLIST&quot;</span> <span class="s">&quot;OneGeology,geology,map,United Kingdom,bedrock,superficial,lithology,lithostratigraphy,age,MD_LANG@ENG,MD_DATE@2011-06-15&quot;</span>

    <span class="c">#&quot;OWS_ONLINERESOURCE&quot; &quot;http://another-service/or/some-different-path/ows?&quot;</span>
    <span class="s">&quot;OWS_POSTCODE&quot;</span> <span class="s">&quot;NG12 5GG&quot;</span>
    <span class="s">&quot;OWS_ROLE&quot;</span> <span class="s">&quot;PointOfContact&quot;</span>
    <span class="s">&quot;OWS_SERVICE_ONLINERESOURCE&quot;</span> <span class="s">&quot;http://www.bgs.ac.uk/products/digitalmaps/digmapgb.html&quot;</span>
    <span class="s">&quot;OWS_SLD_ENABLED&quot;</span> <span class="s">&quot;TRUE&quot;</span>
    <span class="s">&quot;OWS_STATEORPROVINCE&quot;</span> <span class="s">&quot;Nottinghamshire&quot;</span>
    <span class="c">#===========================================================================#</span>
    <span class="c"># &quot;OWS_SRS&quot; For WCS/WFS you need to list the default projection _FIRST_</span>
    <span class="c">#===========================================================================#</span>
    <span class="s">&quot;OWS_SRS&quot;</span> <span class="s">&quot;EPSG:27700 EPSG:3857 EPSG:4258 EPSG:4326&quot;</span>

    <span class="s">&quot;OWS_TITLE&quot;</span> <span class="s">&quot;BGS Bedrock and Superficial geology&quot;</span>
    <span class="s">&quot;OWS_UPDATESEQUENCE&quot;</span> <span class="s">&quot;2017-02-09T14:00:00Z&quot;</span>

    <span class="s">&quot;WFS_ABSTRACT&quot;</span> <span class="s">&quot;The 1:625k DiGMap data covering the whole of the United Kingdom is available in this OGC WFS service for your personal, non-commercial use only and is being served as a contribution to the OneGeology initiative(www.onegeology.org).  </span><span class="se">\</span>
<span class="s">    The contents of this WFS service are not intended for direct use but are transformed by a mediator layer into separate WFS services which provide data in GeoSciML. This process is described in Chapter 2 of the OneGeology WFS Cookbook available at www.onegeology.org.&quot;</span>
    <span class="s">&quot;WMS_ABSTRACT&quot;</span> <span class="s">&quot;The 1:625k DiGMap data covering the whole of the United Kingdom is available in this OGC WMS service for your personal, non-commercial use only and is being served as a contribution to the OneGeology initiative (www.onegeology.org).</span><span class="se">\</span>
<span class="s">    Separate bedrock geology and superficial deposits layers are available in this service. Layers available for bedrock are lithostratigraphy, age, and lithology. Layers available for superficial deposits layer are lithostratigraphy and lithology. </span><span class="se">\</span>
<span class="s">    For information about more of the British Geological Survey’s maps that are available digitally please visit http://www.bgs.ac.uk/products/digitalmaps/digmapgb.html&quot;</span>

    <span class="c"># INSPIRE WMS must provide a bounding box for all supported projections</span>
    <span class="s">&quot;WMS_BBOX_EXTENDED&quot;</span> <span class="s">&quot;TRUE&quot;</span>

    <span class="c"># You can specify which output formats you want per operation</span>
    <span class="s">&quot;WMS_FEATURE_INFO_MIME_TYPE&quot;</span> <span class="s">&quot;text/html&quot;</span>
    <span class="s">&quot;WMS_GETMAP_FORMATLIST&quot;</span> <span class="s">&quot;image/png,image/jpeg&quot;</span>

    <span class="s">&quot;WMS_KEYWORDLIST_GEMET_ITEMS&quot;</span> <span class="s">&quot;Bathymetry&quot;</span>
    <span class="s">&quot;WMS_KEYWORDLIST_ISO_ITEMS&quot;</span> <span class="s">&quot;infoMapAccessService&quot;</span>
    <span class="s">&quot;WMS_KEYWORDLIST_VOCABULARY&quot;</span> <span class="s">&quot;GEMET,ISO&quot;</span>

    <span class="c">#&quot;WMS_ONLINERESOURCE&quot; &quot;http://another-service/or/some-different-path/wms?&quot;</span>
    <span class="s">&quot;WMS_SRS&quot;</span> <span class="s">&quot;EPSG:4326 EPSG:3857 EPSG:27700 EPSG:4258&quot;</span>
    <span class="s">&quot;WMS_ROOTLAYER_TITLE&quot;</span> <span class="s">&quot;BGS Bedrock and Superficial Geology&quot;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>You may use the “WMS_ONLINERESOURCE” (and “OWS_ONLINERESOURCE” etc) metadata sections to change the service endpoint for your service.  For example, you can do this to force users (clients) to always use the IP version of your service rather than the server name (or vice versa), or to force them to always use the cgi-bin version rather than the fcgi-bin version (or vice versa), or to get them to use a different server.  That is, you can have an initial GetCapabilities response document that itself advertises a different service endpoint for the subsequent GetMap requests.  There are several reasons why you might want to do this; one such reason is when you have an existing service that has multiple layers only some of some of which are conformant to OneGeology and in which the service metadata doesn’t otherwise conform to the OneGeology WMS profile.  In such an example, you can set up a service that has a GetCapabilities document that is conformant to the OneGeology WMS profile and which advertises only some of the layers of the other service through the use of the “WMS_ONLINERESOURCE” metadata.</p>
<p>The SRS specifies the coordinate system (spatial reference system) that the WMS can serve data in.  These are commonly specified using EPSG codes <strong>and must include</strong> <a class="reference external" href="http://epsg.io/4326">EPSG:4326</a> so that all services have at least one coordinate system in common.  We would like if you could specify the Spherical Mercator projection (<a class="reference external" href="http://epsg.io/3857">EPSG:3857</a>) to allow your service to be used in Google Maps.  You may specify other systems that are appropriate for your region if you wish; for example we would expect most European services to support either (or both of) <a class="reference external" href="http://epsg.io/4258">EPSG:4258</a> and <a class="reference external" href="http://epsg.io/3034">EPSG:3034</a> to ensure compliance with INSPIRE coordinate system requirements.</p>
</div>
<div class="section" id="adding-alternate-character-set-support">
<h3>Adding alternate character set support<a class="headerlink" href="#adding-alternate-character-set-support" title="Permalink to this headline">¶</a></h3>
<p>If you are serving a non-English language service, you may need or want to change the font and character sets.</p>
<p>To specify a font set you need to use the FONTSET keyword which references a file that contains the mappings from the font name aliases, which you will use in your Mapfile, to the actual font file names on your computer. See the MAP section above for an example of referencing a fontset file (fontset.lst)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>arial C:\Windows\Fonts\Arial.ttf
arialuni C:\Windows\Fonts\ARIALUNI.TTF
esricaves2 C:\Windows\Fonts\esri_376.ttf
fradm C:\Windows\Fonts\FRADM.TTF
khmer C:\Windows\Fonts\KhmerUI.ttf
msgothic C:\Windows\Fonts\MSGOTHIC.TTC
msmincho C:\Windows\Fonts\MSMINCHO.TTC
opensym C:\Windows\Fonts\opens___.ttf
sc C:\Windows\Fonts\DejaVuSansCondensed.ttf
scb C:\Windows\Fonts\DejaVuSansCondensed-Bold.ttf
sym C:\Windows\Fonts\symbol.ttf
verdana C:\Windows\Fonts\verdana.ttf
</pre></div>
</div>
<p>You only need one font specified in your Mapfile but you may list as many as you like in your fontset file.</p>
<p>The below example shows how you could modify the LABEL section of the LEGEND, to allow you to display Chinese characters.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LEGEND</span>
    <span class="k">OUTLINECOLOR</span> <span class="mi">200</span> <span class="mi">200</span> <span class="mi">200</span>
    <span class="k">KEYSPACING</span> <span class="mi">10</span> <span class="mi">10</span>
    <span class="k">LABEL</span>
        <span class="k">TYPE</span> <span class="nb">truetype</span>
        <span class="k">FONT</span> <span class="s">&quot;msgothic&quot;</span>
        <span class="k">SIZE</span> <span class="mi">8</span>
        <span class="k">ENCODING</span> <span class="s">&quot;UTF-8&quot;</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>The important parts to note in the above example are:</p>
<ul class="simple">
<li><p>TYPE truetype (the default is TYPE bitmap)</p></li>
<li><p>FONT “msgothic” (the font alias we set up in our fontset.lst file)</p></li>
<li><p>SIZE 8 (size should be specified in points, you can’t use words like “small” or “medium” which you do with bitmap fonts.)</p></li>
<li><p>ENCODING “UTF-8” (You must also save your Mapfile in this character set encoding).</p></li>
</ul>
</div>
<div class="section" id="creating-your-own-symbology">
<h3>Creating your own symbology<a class="headerlink" href="#creating-your-own-symbology" title="Permalink to this headline">¶</a></h3>
<p>symbols.sym, is a set of defined symbols that can be used to style your map layers.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">SYMBOLSET</span>
    <span class="k">SYMBOL</span>
        <span class="k">NAME</span> <span class="s">&quot;circle&quot;</span>
        <span class="k">TYPE</span> <span class="nb">ellipse</span>
        <span class="k">FILLED</span> <span class="nb">false</span>
        <span class="k">POINTS</span>
          <span class="mi">1</span> <span class="mi">1</span>
        <span class="k">END</span>
        <span class="k">ANCHORPOINT</span> <span class="mf">0.5</span> <span class="mf">0.5</span>
    <span class="k">END</span>
    <span class="k">SYMBOL</span>
        <span class="k">NAME</span> <span class="s">&quot;circlef&quot;</span>
        <span class="k">TYPE</span> <span class="nb">ellipse</span>
        <span class="k">FILLED</span> <span class="nb">true</span>
        <span class="k">POINTS</span>
          <span class="mi">10</span> <span class="mi">10</span>
        <span class="k">END</span>
        <span class="k">ANCHORPOINT</span> <span class="mf">0.5</span> <span class="mf">0.5</span>
    <span class="k">END</span>
    <span class="k">SYMBOL</span>
        <span class="k">NAME</span> <span class="s">&quot;divides&quot;</span>
        <span class="k">TYPE</span> <span class="nb">TRUETYPE</span>
        <span class="k">FONT</span> <span class="s">&quot;opensym&quot;</span>
        <span class="k">CHARACTER</span> <span class="s">&#39;&amp;#8739;&#39;</span>
        <span class="k">FILLED</span> <span class="nb">true</span>
        <span class="k">ANTIALIAS</span> <span class="nb">true</span>
    <span class="k">END</span>
    <span class="k">SYMBOL</span>
        <span class="k">NAME</span> <span class="s">&quot;v-line&quot;</span>
        <span class="k">TYPE</span> <span class="nb">vector</span>
        <span class="k">FILLED</span> <span class="nb">false</span>
        <span class="k">POINTS</span>
          <span class="mi">0</span>  <span class="mi">0</span>
          <span class="mi">5</span>  <span class="mi">10</span>
          <span class="mi">10</span> <span class="mi">0</span>
        <span class="k">END</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
</div>
<div class="section" id="example-include-files">
<h3>Example include files<a class="headerlink" href="#example-include-files" title="Permalink to this headline">¶</a></h3>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="c"># BGS-Attribution.map</span>
<span class="c"># May be included at SERVICE and/or LAYER metadata level</span>
<span class="s">&quot;WMS_ATTRIBUTION_LOGOURL_FORMAT&quot;</span> <span class="s">&quot;image/gif&quot;</span>
<span class="s">&quot;WMS_ATTRIBUTION_LOGOURL_HREF&quot;</span> <span class="s">&quot;http://ogc.bgs.ac.uk/img/bgs_c_t_275x60.gif&quot;</span>
<span class="s">&quot;WMS_ATTRIBUTION_LOGOURL_HEIGHT&quot;</span> <span class="s">&quot;60&quot;</span>
<span class="s">&quot;WMS_ATTRIBUTION_LOGOURL_WIDTH&quot;</span> <span class="s">&quot;275&quot;</span>
<span class="s">&quot;WMS_ATTRIBUTION_ONLINERESOURCE&quot;</span> <span class="s">&quot;http://www.bgs.ac.uk/&quot;</span>
<span class="s">&quot;WMS_ATTRIBUTION_TITLE&quot;</span> <span class="s">&quot;British Geological Survey (BGS)&quot;</span>

<span class="s">&quot;WMS_AUTHORITYURL_NAME&quot;</span> <span class="s">&quot;BritishGeologicalSurvey&quot;</span>
<span class="s">&quot;WMS_AUTHORITYURL_HREF&quot;</span> <span class="s">&quot;http://data.bgs.ac.uk/ref/BritishGeologicalSurvey&quot;</span>
</pre></div>
</div>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="c"># BGS-service-std-output-plus1.map</span>
<span class="c"># Included at the map level to extend or modify the output formats available to the service</span>
<span class="c"># For example we can use this to enable GeoJSON and zipped shapefie as formats for WFS</span>
<span class="c">#IMAGECOLOR: Background color for the map canvas</span>
<span class="k">IMAGECOLOR</span> <span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span>
<span class="k">IMAGETYPE</span> <span class="nb">png</span>
<span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="nb">png</span>
    <span class="k">DRIVER</span> <span class="s">&quot;AGG/PNG&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;image/png&quot;</span>
    <span class="k">IMAGEMODE</span> <span class="nb">RGBA</span>
    <span class="k">EXTENSION</span> <span class="s">&quot;png&quot;</span>
    <span class="k">TRANSPARENT</span> <span class="nb">ON</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;INTERLACE=ON,TRANSPARENT=ON&quot;</span>
<span class="k">END</span>
<span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;SHAPEZIP&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;OGR/ESRI Shapefile&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;application/shapefile&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;STORAGE=filesystem&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FORM=zip&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FILENAME=shape.zip&quot;</span>
<span class="k">END</span>
<span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;SPATIALITEZIP&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;OGR/SQLITE&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;application/spatialite&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;DSCO:SPATIALITE=YES&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;STORAGE=memory&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FORM=zip&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FILENAME=result.db&quot;</span>
<span class="k">END</span>
<span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;MIDMIF&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;OGR/MapInfo File&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;STORAGE=filesystem&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FORM=multipart&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;DSCO:FORMAT=MIF&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FILENAME=result.mif&quot;</span>
<span class="k">END</span>
<span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;MultiMIDMIF&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;OGR/MapInfo File&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;STORAGE=filesystem&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FORM=multipart&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;DSCO:FORMAT=MIF&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FILENAME=result&quot;</span>
<span class="k">END</span>
<span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;CSV&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;OGR/CSV&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;text/csv&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;LCO:GEOMETRY=AS_WKT&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;STORAGE=filesystem&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FORM=simple&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FILENAME=result.csv&quot;</span>
<span class="k">END</span>
<span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;CSVSTREAM&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;OGR/CSV&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;text/csv; streamed&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;LCO:GEOMETRY=AS_WKT&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;STORAGE=stream&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FORM=simple&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FILENAME=result.csv&quot;</span>
<span class="k">END</span>
<span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;OGRGML&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;OGR/GML&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;text/xml; subtype=gml/2.1.2; driver=ogr&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;STORAGE=memory&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FORM=multipart&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FILENAME=result.gml&quot;</span>
<span class="k">END</span>
<span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;GeoJSON&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;OGR/GEOJSON&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;application/json; subtype=geojson&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;STORAGE=stream&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;FORM=SIMPLE&quot;</span>
<span class="k">END</span>
</pre></div>
</div>
</div>
<div class="section" id="debugging-common-errors">
<h3>Debugging common errors<a class="headerlink" href="#debugging-common-errors" title="Permalink to this headline">¶</a></h3>
<p>This section is added to help you debug common errors in your Mapfile.</p>
<div class="section" id="symbol-definition-error">
<h4>Symbol definition error<a class="headerlink" href="#symbol-definition-error" title="Permalink to this headline">¶</a></h4>
<p>getString(): Symbol definition error.  Parsing error near (<em>matching text</em>):(line <em>line-number</em>)</p>
<p>This error may occur when your layer classes have a name which includes an apostrophe or other quotation mark that matches the quotation marks used to delimit the CLASS name.  For example if your class name is delimited using single quotes such as below and your class name includes a word with a single quote (d’Irma), you will get this error.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">NAME</span> <span class="s">&#39;Formation d&#39;</span><span class="err">Irma</span> <span class="err">:</span> <span class="err">calcaire</span><span class="p">,</span> <span class="err">dolomie</span> <span class="err">à</span> <span class="err">tromatolites</span><span class="p">,</span> <span class="err">argilite</span><span class="s">&#39;</span>
</pre></div>
</div>
<p>You can correct the error by swapping the file name delimiters to double quotes (as below), in the CLASS name causing the problem; you don’t need to change all the delimiters in all the CLASS names in the Mapfile, just the one(s) with the problem.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">NAME</span> <span class="s">&quot;Formation d&#39;Irma : calcaire, dolomie à stromatolites, argilite&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="unknown-identifier">
<h4>Unknown identifier<a class="headerlink" href="#unknown-identifier" title="Permalink to this headline">¶</a></h4>
<p>loadLayer(): Unknown identifier. Parsing error near (<em>matching text</em>):(line <em>line-number</em>)</p>
<p>This error can occur when you are missing an enclosing KEYWORD in the Mapfile.  For example in the below example, the CLASS keyword has been commented out, leaving the STYLE section uncommented; STYLE is now found in an unexpected position in the Mapfile, resulting in an error.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="c">#CLASS</span>
    <span class="k">STYLE</span>
        <span class="k">COLOR</span> <span class="mi">161</span> <span class="mi">8</span> <span class="mi">0</span>
        <span class="k">MINSIZE</span> <span class="mi">1</span>
        <span class="k">MAXSIZE</span> <span class="mi">10</span>
    <span class="k">END</span> <span class="c">#style</span>
<span class="c">#END #class</span>
</pre></div>
</div>
</div>
<div class="section" id="missing-magic-string">
<h4>Missing magic string<a class="headerlink" href="#missing-magic-string" title="Permalink to this headline">¶</a></h4>
<p>When running a GetFeatureInfo request with the info_format set as text/html, you will get an error like the below, if you do not include a magic string in each of your HTML template documents.</p>
<p>Content-type: text/xml isValidTemplate(): Web application error. Missing magic string, <em>template-file</em> doesn’t look like a MapServer template.</p>
<p>You need to add <strong>&lt;!– MapServer Template –&gt;</strong> to the top of ALL templates.</p>
<p>Example the exemplar template query_footer.html is:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- MapServer Template --&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The recently updated exemplar service kits include this NEW requirement, but those updating from older services might miss this.</p>
<p><a class="reference external" href="http://mapserver.org/development/rfc/ms-rfc-56.html">More information on this and related issues.</a></p>
</div>
</div>
<div class="section" id="connecting-to-a-database">
<h3>Connecting to a database<a class="headerlink" href="#connecting-to-a-database" title="Permalink to this headline">¶</a></h3>
<p>If your data is stored in a database you can access it by setting the CONNECTION and CONNECTIONTYPE directives (to specify the connection) and the DATA directive (to specify the data you want to retrieve or query). These directives are put in the LAYER section of your map file.</p>
<p>The below example shows a typical connection to a PostgreSQL/PostGIS database.  Such a connection might be shared across several layers in your service.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTION</span> <span class="s">&quot;user=&#39;your_user_name&#39; password=&#39;your_password&#39; dbname=&#39;m4eu&#39; host=&#39;localhost&#39; port=&#39;5432&#39;&quot;</span>
<span class="k">CONNECTIONTYPE</span> <span class="nb">postgis</span>
</pre></div>
</div>
<p>The below two examples show the types of query that you might want to do to provide your layer.  The first example is a query to retrieve some data from a table based on an attribute value.  The second example is a more straight forward query that you might use when you want to retrieve all the data from a table.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">DATA</span> <span class="s">&quot;shape FROM (SELECT * FROM commodityresourceview_vw WHERE commodity IN (&#39;copper&#39;,&#39;lead&#39;,&#39;tin&#39;,&#39;zinc&#39;)) AS base_metal USING UNIQUE identifier USING srid=4258&quot;</span>
</pre></div>
</div>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">DATA</span> <span class="s">&quot;geom FROM public.metallic_min&quot;</span>
</pre></div>
</div>
<p>If your MapServer software has been compiled to include Oracle Spatial then you can connect and query the database like in the below example.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTION</span> <span class="s">&quot;your_user_name/your_password@your_server_ip:1521/your_database_name&quot;</span>
<span class="k">CONNECTIONTYPE</span> <span class="nb">oraclespatial</span>

<span class="k">DATA</span> <span class="s">&quot;ITEM_SHAPE_WGS84 FROM PUBLISHED.QL_ACD_ITEM_PLY_WEB_UG USING UNIQUE ITEM_INDEX_ID SRID 4326&quot;</span>
</pre></div>
</div>
<p>If you have your data in a file geodatabase, then similarly you could connect like below. Note you may also need to set the CONFIG “PGEO_DRIVER_TEMPLATE” and CONFIG “OGR_SKIP”  directives in the MAP section of the map file, as shown in the General map configuration section.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTION</span> <span class="s">&quot;data2/OGE.mdb&quot;</span>
<span class="k">CONNECTIONTYPE</span> <span class="nb">ogr</span>

<span class="k">DATA</span> <span class="s">&quot;V5_625k_ONEGEOLOGY_FAULTS_AT_SURFACE&quot;</span>
</pre></div>
</div>
<p>For more details on connecting to a database see the <a class="reference external" href="https://mapserver.org/input/index.html">MapServer Data Input pages</a></p>
</div>
<div class="section" id="wms">
<h3>WMS<a class="headerlink" href="#wms" title="Permalink to this headline">¶</a></h3>
<p>We provide two exemplar MapServer services, the first is based on a simple raster file, and is used to illustrate a basic WMS, the second uses a vector datasource (shapefiles) to illustrate how to configure a more advanced WMS (and may also be used for a Simple Feature WFS).</p>
<div class="section" id="raster-image-data-exemplar-layer-configuration">
<h4>Raster image data exemplar (LAYER configuration)<a class="headerlink" href="#raster-image-data-exemplar-layer-configuration" title="Permalink to this headline">¶</a></h4>
<p>An example of adding a PNG layer is included in the BGS_Bedrock_Raster_Map application.  The LAYER section is reproduced below for reference.  This data was simply created as a raster from the bedrock shapefile for the purposes of serving as an example.  In this case we won’t be setting up a response to GetFeatureInfo request; we are just returning a coloured map.  There is more <a class="reference external" href="http://www.mapserver.org/input/raster.html">detailed documentation</a> , in particular as regards efficient serving of large images, using 8-bit vs. 24-bit images, tiling etc.</p>
<p>Example extract from Mapfile below:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&quot;BGS_625k_BAR&quot;</span>
    <span class="k">DATA</span> <span class="s">&quot;bedrock625ll.png&quot;</span>
    <span class="k">DUMP</span> <span class="nb">TRUE</span>

    <span class="k">METADATA</span>
        <span class="s">&quot;WMS_ABSTRACT&quot;</span> <span class="s">&quot;GBR BGS 1:625k Bedrock Age&quot;</span>

        <span class="s">&quot;WMS_DATAURL_FORMAT&quot;</span> <span class="s">&quot;text/html&quot;</span>
        <span class="s">&quot;WMS_DATAURL_HREF&quot;</span> <span class="s">&quot;http://www.bgs.ac.uk/discoverymetadata/13480426.html&quot;</span>

        <span class="s">&quot;WMS_KEYWORDLIST&quot;</span> <span class="s">&quot;OneGeology,bedrock,chronostratigraphy,continent@Europe,subcontinent@Northern Europe,geographicarea@United Kingdom,DS_DATE@2011-06-15,age,dataprovider@British Geological Survey,DS_TOPIC@geoscientificInformation,geology,serviceprovider@British Geological Survey&quot;</span>

        <span class="s">&quot;WMS_METADATAURL_FORMAT&quot;</span> <span class="s">&quot;application/vnd.iso.19139+xml&quot;</span>
        <span class="s">&quot;WMS_METADATAURL_HREF&quot;</span> <span class="s">&quot;http://.../geonetwork/srv/en/csw?SERVICE=CSW&amp;VERSION=2.0.2&amp;REQUEST=GetRecordById&amp;ID=ac9f8250-3ae5-49e5-9818-d14264a4fda4&amp;&quot;</span>
        <span class="s">&quot;WMS_METADATAURL_TYPE&quot;</span> <span class="s">&quot;TC211&quot;</span>

        <span class="s">&quot;WMS_SRS&quot;</span> <span class="s">&quot;EPSG:4326 EPSG:3857 EPSG:27700 EPSG:4258&quot;</span>

        <span class="s">&quot;WMS_STYLE&quot;</span> <span class="s">&quot;default&quot;</span>
        <span class="s">&quot;WMS_STYLE_DEFAULT_LEGENDURL_HEIGHT&quot;</span> <span class="s">&quot;353&quot;</span>
        <span class="s">&quot;WMS_STYLE_DEFAULT_LEGENDURL_WIDTH&quot;</span> <span class="s">&quot;253&quot;</span>
        <span class="s">&quot;WMS_STYLE_DEFAULT_LEGENDURL_FORMAT&quot;</span> <span class="s">&quot;image/png&quot;</span>
        <span class="c"># The legendURL must be accessible externally, so do not use ‘localhost’ or ‘127.0.0.1’</span>
        <span class="s">&quot;WMS_STYLE_DEFAULT_LEGENDURL_HREF&quot;</span> <span class="s">&quot;http://.../BGS_Bedrock_Geology/bedrockAgeLegend.png&quot;</span>

        <span class="s">&quot;WMS_TITLE&quot;</span> <span class="s">&quot;GBR BGS 1:625k Bedrock Age&quot;</span>
    <span class="k">END</span>

    <span class="k">PROCESSING</span> <span class="s">&quot;CLOSE_CONNECTION=DEFER&quot;</span>

    <span class="k">PROJECTION</span>
        <span class="s">&quot;init=EPSG:4326&quot;</span>
    <span class="k">END</span>

    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">TOLERANCE</span> <span class="mi">10</span>
    <span class="k">TYPE</span> <span class="nb">RASTER</span>
<span class="k">END</span>
</pre></div>
</div>
</div>
<div class="section" id="vector-data-exemplar-layer-configuration">
<h4>Vector data exemplar (LAYER configuration)<a class="headerlink" href="#vector-data-exemplar-layer-configuration" title="Permalink to this headline">¶</a></h4>
<p>The example file includes the following shapefile based layers:</p>
<ul class="simple">
<li><p>UK bedrock geology classified by lithology, lithostratigraphy, and age</p></li>
<li><p>UK superficial geology classified by lithology and lithostratigraphy.</p></li>
</ul>
<p>These are typical of the sorts of layer expected for OneGeology but you may have slightly different theme layers and slightly different available classification schemes.  Please consult with the OneGeology helpdesk if you are uncertain about exactly what layers and classifications to serve.</p>
<p>The fields you will need to edit for each <strong>LAYER</strong> section are described below.  The NAME must be unique for each layer.  This is a identifier used by WMS clients to select layers rather than being for human consumption.  It is recommended that the NAME does not contain spaces, special characters, or begin with a number (which could cause problems through interfaces such as OGC services. The OneGeology catalogue service requires that the NAMEs are unique within all the OneGeology layers we have decided some naming conventions as shown in the example.  These are described explicitly in the <a class="reference internal" href="#service-provision-onegeology-profile"><span class="std std-ref">OneGeology Profile</span></a>.</p>
<p>DATA should specify the name of your shapefile.  The HEADER, TEMPLATE, and FOOTER values refer to files with snippets of HTML template which format the results of GetFeatureInfo requests when requested in text/html format.  The examples have been written for the data fields in the example shapefiles; it should be straightforward for you to edit them to match the fields in your shapefiles.  The PROJECTION section should specify the coordinate system that your data is actually in.  This might not be EPSG:4326 if you have your data in some regional projected system.  However, as most OneGeology clients will want to retrieve your data in the EPSG:4326 system we suggest it will be better for performance reasons to convert your data files to EPSG:4326 rather than have MapServer convert them on-the-fly in response to requests.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
     <span class="k">NAME</span> <span class="s">&quot;GBR_BGS_625k_BLT&quot;</span> <span class="c">#Bedrock lithology</span>
     <span class="k">TYPE</span> <span class="nb">POLYGON</span>
     <span class="k">STATUS</span> <span class="nb">ON</span>
     <span class="k">DATA</span> <span class="s">&quot;bedrock625ll&quot;</span>
     <span class="k">TRANSPARENCY</span> <span class="mi">100</span>
     <span class="k">TOLERANCE</span> <span class="mi">0</span>
     <span class="k">TOLERANCEUNITS</span> <span class="nb">pixels</span>
     <span class="k">TRANSFORM</span> <span class="nb">TRUE</span>
     <span class="k">PROCESSING</span> <span class="s">&quot;CLOSE_CONNECTION=DEFER&quot;</span>
     <span class="k">HEADER</span> <span class="s">&quot;tmpl/bedrock_lithology_query_header.html&quot;</span>
     <span class="k">TEMPLATE</span> <span class="s">&quot;tmpl/bedrock_lithology_query_body.html&quot;</span>
     <span class="k">FOOTER</span> <span class="s">&quot;tmpl/bedrock_lithology_query_footer.html&quot;</span>
     <span class="k">PROJECTION</span>
         <span class="s">&quot;init=epsg:4326&quot;</span>
     <span class="k">END</span>
</pre></div>
</div>
<p>In the METADATA section you should edit the following values:</p>
<dl class="simple">
<dt>WMS_TITLE</dt><dd><p>the human readable layer name and should follow the conventions in the OneGeology Profile</p>
</dd>
<dt>WMS_ABSTRACT</dt><dd><p>expands on the title with any extra information you feel would be useful.</p>
</dd>
<dt>WMS_SRS</dt><dd><p>These values specify which coordinate systems your WMS can supply the data in and <strong>MUST</strong> include at least <strong>EPSG:4326</strong>. Other coordinate systems are up to you; for example you may wish to include the EPSG:3857 (spherical mercator) coordinate system, which is used by several web mapping clients such as Bing Maps, Google Maps, and Yahoo maps.</p>
</dd>
<dt>GML_INCLUDE_ITEMS and WMS_INCLUDE_ITEMS</dt><dd><p>These items will depend on the data fields in your shapefile and which ones you wish to make available by a GetFeatureInfo request.  Items should be a comma separated list of field names.  These should be the same as the fields included in the HTML templates above. It is optional to include any information here but obviously if you have fields with geological unit names or ages they would be useful to include. The GML prefix applies to the GML response only and the WMS prefix applies to the plain text response only.</p>
</dd>
<dt>WMS_METADATAURL_HREF and WMS_DATAURL_HREF</dt><dd><p>are supposed to contain URLs for web pages which describe the dataset used for the layer in more detail.  It is possible that you may already have suitable web pages on your organization’s website, or you may wish to create suitable pages to be served by this same server.  These URL’s give users of your WMS service quick and easy links back to your web pages that may describe your available data offerings in more detail. The differences between the metadataurl and dataurl are:</p>
</dd>
<dt>WMS_METADATAURL_HREF</dt><dd><p>the metadataurl must only link to a page which describes your layer data  corresponding to either the TC211/ISO:19115:2003 or FGDC-STD-001-1998 metadata standards.  See  <a class="reference internal" href="#service-provision-onegeology-profile-core-metadata"><span class="std std-ref">Core TC211/ISO:19115 Metadata</span></a> for the core metadata required to be TC211/ISO:19115:2003 compliant</p>
</dd>
<dt>WMS_DATAURL_HREF</dt><dd><p>the dataurl is to be used when you have some layer metadata that doesn’t conform to either of these standards.</p>
</dd>
</dl>
<p>The UK geology layer examples point to some pre-existing web pages on the BGS website which were suitable so that you can get an idea of what you might use for your own data.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">METADATA</span>
    <span class="s">&quot;GML_FEATUREID&quot;</span> <span class="s">&quot;ID&quot;</span>
    <span class="s">&quot;GML_INCLUDE_ITEMS&quot;</span> <span class="s">&quot;RCS_D&quot;</span>

    <span class="s">&quot;OWS_ABSTRACT&quot;</span> <span class="s">&quot;GBR BGS 1:625k scale Bedrock Lithology&quot;</span>
    <span class="s">&quot;OWS_DATAURL_FORMAT&quot;</span> <span class="s">&quot;text/html&quot;</span>
    <span class="s">&quot;OWS_DATAURL_HREF&quot;</span> <span class="s">&quot;http://www.bgs.ac.uk/discoverymetadata/13480426.html&quot;</span>
    <span class="s">&quot;OWS_KEYWORDLIST&quot;</span> <span class="s">&quot;OneGeology,bedrock,lithology,continent@Europe,subcontinent@Northern Europe,geographicarea@United Kingdom,geology,dataprovider@British Geological Survey,DS_TOPIC@geoscientificInformation,serviceprovider@British Geological Survey,DS_DATE@2011-06-15,thematic@Bedrock,thematic@Lithology&quot;</span>
    <span class="s">&quot;OWS_METADATAURL_HREF&quot;</span> <span class="s">&quot;http://.../geonetwork/srv/en/csw?SERVICE=CSW&amp;VERSION=2.0.2&amp;REQUEST=GetRecordById&amp;ID=9df8df52-d788-37a8-e044-0003ba9b0d98&amp;&quot;</span>
    <span class="s">&quot;OWS_METADATAURL_TYPE&quot;</span> <span class="s">&quot;TC211&quot;</span>
    <span class="s">&quot;OWS_TITLE&quot;</span> <span class="s">&quot;GBR BGS 1:625k Bedrock Lithology&quot;</span>

    <span class="s">&quot;WFS_ENCODING&quot;</span> <span class="s">&quot;UTF-8&quot;</span>
    <span class="s">&quot;WFS_GETFEATURE_FORMATLIST&quot;</span> <span class="s">&quot;csv,csvstream,ogrgml,shapezip,midmif,multimidmif,geojson&quot;</span>
    <span class="s">&quot;WFS_METADATAURL_FORMAT&quot;</span> <span class="s">&quot;text/xml&quot;</span>
    <span class="s">&quot;WFS_SRS&quot;</span> <span class="s">&quot;EPSG:4326 EPSG:27700 EPSG:3034 EPSG:3857 EPSG:4258&quot;</span>

    <span class="s">&quot;WMS_FEATURE_INFO_MIME_TYPE&quot;</span> <span class="s">&quot;text/html,application/vnd.ogc.gml,text/plain&quot;</span>
    <span class="s">&quot;WMS_GETMAP_FORMATLIST&quot;</span> <span class="s">&quot;image/png,image/jpeg,image/tiff,application/x-pdf,image/svg+xml&quot;</span>
    <span class="s">&quot;WMS_INCLUDE_ITEMS&quot;</span> <span class="s">&quot;RCS_D&quot;</span>
    <span class="s">&quot;WMS_METADATAURL_FORMAT&quot;</span> <span class="s">&quot;application/xml; charset=UTF-8&quot;</span>
    <span class="s">&quot;WMS_SRS&quot;</span> <span class="s">&quot;CRS:84 EPSG:27700 EPSG:3034 EPSG:3413 EPSG:3857 EPSG:4258 EPSG:4326&quot;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>The CLASS related items are the most complicated.  These sections are setting up the legend and colour scheme of your map polygons, lines and points. You will need a separate item for each rock type or lithology you have in your data.  This will depend on your data and which field in your shapefile (or other datasource) you are going to use for colouring the map.  The example below specifies that the RCS_D field will be used for specifying which colour to use with the CLASSITEM VALUE.  Then for each CLASS section the EXPRESSION specifies the value of RCS_D this colour will apply to and the COLOR and BACKGROUNDCOLOR give the respective RGB colour values.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span> <span class="k">CLASSITEM</span> <span class="s">&#39;RCS_D&#39;</span>
 <span class="k">CLASS</span>
     <span class="k">NAME</span> <span class="s">&#39;ANORTHOSITE&#39;</span>
     <span class="k">EXPRESSION</span> <span class="s">&#39;ANORTHOSITE&#39;</span>
     <span class="c">#RASTERFILL_STYLE_SOLID</span>
     <span class="k">STYLE</span>
         <span class="k">COLOR</span> <span class="mi">237</span> <span class="mi">237</span> <span class="mi">237</span>
         <span class="k">BACKGROUNDCOLOR</span> <span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span>
     <span class="k">END</span> <span class="c">#style</span>
 <span class="k">END</span> <span class="c">#class</span>

<span class="c">#...  more classes needed to assign colours</span>

<span class="c"># for each value of RCS_D</span>
</pre></div>
</div>
<p>Colour codes for the lithostratigraphical and lithology layers are specific to the British Geological Survey, you should use the codes used by your geological survey.  However, for OneGeology it has been agreed, where possible, to serve a chronostratigraphic age layer using the new <a class="reference external" href="https://www.seegrid.csiro.au/wiki/pub/CGIModel/GeologicTime/ISChart2009.pdf">IUGS 2009 colour scheme</a> .  This will give some form of harmonization between the different chronostratigraphic layers served by the contributing geological surveys and this is only possible where such an internationally agreed scheme exists.  In this case the British Geological Survey had to refine, re-allocate, and ‘map’ its internal ages to fit the IUGS 2009 one.  The file ‘ICSClasses.txt’ contains a full list of names and CLASS definitions for the appropriate colours for all the IUGS 2009 colours.  In the Mapfile we have commented out the terms that are not actually used in the BGS map; please do the same for your map.</p>
</div>
<div class="section" id="configuring-html-query-templates">
<h4>Configuring HTML query templates<a class="headerlink" href="#configuring-html-query-templates" title="Permalink to this headline">¶</a></h4>
<p>All templates must include the <strong>&lt;!– MapServer Template –&gt;</strong> statement on the first line of the file.</p>
<p>You may include any HTML and even some JavaScript in your templates, all entities must be properly encoded.</p>
<p>The output of attribute values from the datasource or environment variables are denoted by square brackets, so in the below example we are outputting the value of the RCS_D attribute as part of an HTML table in the bedrock lithology layer of our exemplar service.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- MapServer Template --&gt;</span>
<span class="c">&lt;!-- LAYER QUERY BODY --&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>[RCS_D]<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The following are examples of how we might configure our WMS GetFeatureInfo responses</p>
</div>
</div>
<div class="section" id="debugging-your-requests">
<h3>Debugging your requests<a class="headerlink" href="#debugging-your-requests" title="Permalink to this headline">¶</a></h3>
<p>In this example we are using MapServer environment variables to help us debug the request that was used to generate the response</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- MapServer Template --&gt;</span>
<span class="c">&lt;!-- ERL footer (start)--&gt;</span>
<span class="c">&lt;!-- Request URL: --&gt;</span>
<span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Debug<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;gfiref&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>The <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;http://ogcdev.bgs.ac.uk/cgi-bin/BGS_EN_MINERALS/ows?SERVICE=WMS&amp;amp;VERSION=1.3.0&amp;amp;REQUEST=[REQUEST]&amp;amp;BBOX=[BBOX]&amp;amp;CRS=[CRS]&amp;amp;WIDTH=[WIDTH]&amp;amp;HEIGHT=[HEIGHT]&amp;amp;INFO_FORMAT=text/html&amp;amp;STYLES=&amp;amp;bgcolor=0xFFFFFF&amp;amp;transparent=TRUE&amp;amp;language=eng&amp;amp;FORMAT=image/png&amp;amp;LAYERS=[LAYERS]&amp;amp;QUERY_LAYERS=[QUERY_LAYERS]&amp;amp;I=[I]&amp;amp;J=[J]&amp;amp;&quot;</span><span class="p">&gt;</span>request<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> used to generate this report was:<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;</span>
http://ogcdev.bgs.ac.uk/cgi-bin/BGS_EN_MINERALS/ows?
  SERVICE=WMS<span class="ni">&amp;amp;</span>
  VERSION=1.3.0<span class="ni">&amp;amp;</span>
  REQUEST=[REQUEST]<span class="ni">&amp;amp;</span>
  BBOX=[BBOX]<span class="ni">&amp;amp;</span>
  CRS=[CRS]<span class="ni">&amp;amp;</span>
  WIDTH=[WIDTH]<span class="ni">&amp;amp;</span>
  HEIGHT=[HEIGHT]<span class="ni">&amp;amp;</span>
  INFO_FORMAT=text/html<span class="ni">&amp;amp;</span>
  STYLES=<span class="ni">&amp;amp;</span>
  bgcolor=0xFFFFFF<span class="ni">&amp;amp;</span>
  transparent=TRUE<span class="ni">&amp;amp;</span>
  language=eng<span class="ni">&amp;amp;</span>
  FORMAT=image/png<span class="ni">&amp;amp;</span>
  LAYERS=[LAYERS]<span class="ni">&amp;amp;</span>
  QUERY_LAYERS=[QUERY_LAYERS]<span class="ni">&amp;amp;</span>
  I=[I]<span class="ni">&amp;amp;</span>
  J=[J]<span class="ni">&amp;amp;</span>
  <span class="p">&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Data retrieval tests<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>WFS GetFeature for area of GetMap request<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;http://ogcdev.bgs.ac.uk/cgi-bin/BGS_EN_MINERALS/ows?service=WFS&amp;amp;request=GetFeature&amp;amp;version=2.0.0&amp;amp;typename=erl:CommodityResourceView&amp;amp;CRS=[CRS]&amp;amp;bbox=[BBOX][CRS],&amp;amp;&quot;</span><span class="p">&gt;</span>http://ogcdev.bgs.ac.uk/cgi-bin/BGS_EN_MINERALS/ows?service=WFS<span class="ni">&amp;amp;</span>request=GetFeature<span class="ni">&amp;amp;</span>version=2.0.0<span class="ni">&amp;amp;</span>typename=erl:CommodityResourceView<span class="ni">&amp;amp;</span>CRS=[CRS]<span class="ni">&amp;amp;</span>bbox=[BBOX],[CRS]<span class="ni">&amp;amp;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="c">&lt;!-- ERL footer (end)--&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="handling-fields-for-which-you-have-no-data">
<h3>Handling fields for which you have no data<a class="headerlink" href="#handling-fields-for-which-you-have-no-data" title="Permalink to this headline">¶</a></h3>
<p>As GeoSciML-Lite requires data (or URIs pointing to null value reasons) for data that was not required in the OneGeology-Europe services, you have a few options with MapServer if you don’t have the required data (for example a specification_uri for all features). Option 1 would be to create a column in the data source and populate the rows with null value URIs (such as for example with the value <a class="reference external" href="http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unknown/">http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unknown/</a>). Option 2 would be to populate the missing values within the GetFetaureInfo request template, such as below:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- MapServer Template --&gt;</span>
<span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>identifier<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>[OBJECTID]<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>name<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>[Name]<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>faultType_uri<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>[faultType_uri]<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>positionalAccuracy (m)<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>[PositionalAccuracy]<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>movementType_uri<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- Here we provide an INSPIRE nil reason for the missing movementType_uri --&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unknown<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>deformationStyle_uri<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- Here we provide an INSPIRE nil reason for the missing deformationStyle_uri --&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unknown<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>representativeOlderAge_uri<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>[representativeOlderAge_uri]<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>representativeYoungerAge_uri<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>[representativeYoungerAge_uri]<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>representativeAge_uri<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>[representativeAge_uri]<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>specification_uri<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- Here we supply a link to our Feature (using our Simple Fetaure GeoSciML-Lite WFS).</span>
<span class="c">    This information isn&#39;t in the database and we can update to a full GeoSciML response when available</span>
<span class="c">    In the actual template we have this as a link --&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>http://ogc2.bgs.ac.uk/cgi-bin/BGS_OGE_Bedrock_and_Surface_Geology_in3/ows?service=WFS<span class="ni">&amp;amp;</span>
    request=GetFeature<span class="ni">&amp;amp;</span>version=1.1.0<span class="ni">&amp;amp;</span>FeatureID=GBR_BGS_EN_1M_Surface_Fault.[OBJECTID]<span class="ni">&amp;amp;</span><span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- Here we supply a link to some metadata for our datasource that isn&#39;t in the database</span>
<span class="c">    In the actual template we have this as a link --&gt;</span>
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>http://metadata.bgs.ac.uk/geonetwork/srv/en/iso19139.xml?id=6075<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="using-javascript">
<h3>Using JavaScript<a class="headerlink" href="#using-javascript" title="Permalink to this headline">¶</a></h3>
<p>Here we embed some JavaScript into a response to give a TimeSeries schart for the data point selected</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!--MapServer Template --&gt;</span>
<span class="p">&lt;</span><span class="nt">table</span> <span class="na">summary</span><span class="o">=</span><span class="s">&quot;Query response for Terrafirma 1:5k ground motion WMS layer&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;hasTS&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Terrafirma 1:5000 ground motion report<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tfoot</span><span class="p">&gt;&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Time series data for selected point&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span><span class="c">&lt;!--</span>
<span class="kd">var</span> <span class="p">[</span><span class="nx">Id</span><span class="p">]</span><span class="nx">_tsline</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;1992-05-11&#39;</span><span class="p">,[</span><span class="nx">D19920511</span><span class="p">]],[</span><span class="s1">&#39;1993-02-15&#39;</span><span class="p">,[</span><span class="nx">D19930215</span><span class="p">]],[</span><span class="s1">&#39;1993-03-22&#39;</span><span class="p">,[</span><span class="nx">D19930322</span><span class="p">]],[</span><span class="s1">&#39;1993-05-31&#39;</span><span class="p">,[</span><span class="nx">D19930531</span><span class="p">]],[</span><span class="s1">&#39;1993-08-09&#39;</span><span class="p">,[</span><span class="nx">D19930809</span><span class="p">]],[</span><span class="s1">&#39;1993-10-18&#39;</span><span class="p">,[</span><span class="nx">D19931018</span><span class="p">]],[</span><span class="s1">&#39;1993-11-22&#39;</span><span class="p">,[</span><span class="nx">D19931122</span><span class="p">]],[</span><span class="s1">&#39;1995-04-19&#39;</span><span class="p">,[</span><span class="nx">D19950419</span><span class="p">]],[</span><span class="s1">&#39;1995-05-24&#39;</span><span class="p">,[</span><span class="nx">D19950524</span><span class="p">]],[</span><span class="s1">&#39;1995-05-25&#39;</span><span class="p">,[</span><span class="nx">D19950525</span><span class="p">]],[</span><span class="s1">&#39;1995-06-28&#39;</span><span class="p">,[</span><span class="nx">D19950628</span><span class="p">]],[</span><span class="s1">&#39;1995-06-29&#39;</span><span class="p">,[</span><span class="nx">D19950629</span><span class="p">]],[</span><span class="s1">&#39;1995-08-02&#39;</span><span class="p">,[</span><span class="nx">D19950802</span><span class="p">]],[</span><span class="s1">&#39;1995-08-03&#39;</span><span class="p">,[</span><span class="nx">D19950803</span><span class="p">]],[</span><span class="s1">&#39;1995-09-06&#39;</span><span class="p">,[</span><span class="nx">D19950906</span><span class="p">]],[</span><span class="s1">&#39;1995-10-11&#39;</span><span class="p">,[</span><span class="nx">D19951011</span><span class="p">]],[</span><span class="s1">&#39;1995-10-12&#39;</span><span class="p">,[</span><span class="nx">D19951012</span><span class="p">]],[</span><span class="s1">&#39;1995-12-21&#39;</span><span class="p">,[</span><span class="nx">D19951221</span><span class="p">]],[</span><span class="s1">&#39;1996-02-28&#39;</span><span class="p">,[</span><span class="nx">D19960228</span><span class="p">]],[</span><span class="s1">&#39;1996-02-29&#39;</span><span class="p">,[</span><span class="nx">D19960229</span><span class="p">]],[</span><span class="s1">&#39;1996-04-03&#39;</span><span class="p">,[</span><span class="nx">D19960403</span><span class="p">]],[</span><span class="s1">&#39;1996-04-04&#39;</span><span class="p">,[</span><span class="nx">D19960404</span><span class="p">]],[</span><span class="s1">&#39;1996-05-08&#39;</span><span class="p">,[</span><span class="nx">D19960508</span><span class="p">]],[</span><span class="s1">&#39;1996-05-09&#39;</span><span class="p">,[</span><span class="nx">D19960509</span><span class="p">]],[</span><span class="s1">&#39;1996-06-12&#39;</span><span class="p">,[</span><span class="nx">D19960612</span><span class="p">]],[</span><span class="s1">&#39;1996-07-17&#39;</span><span class="p">,[</span><span class="nx">D19960717</span><span class="p">]],[</span><span class="s1">&#39;1996-08-22&#39;</span><span class="p">,[</span><span class="nx">D19960822</span><span class="p">]],[</span><span class="s1">&#39;1996-10-31&#39;</span><span class="p">,[</span><span class="nx">D19961031</span><span class="p">]],[</span><span class="s1">&#39;1996-12-05&#39;</span><span class="p">,[</span><span class="nx">D19961205</span><span class="p">]],[</span><span class="s1">&#39;1997-01-09&#39;</span><span class="p">,[</span><span class="nx">D19970109</span><span class="p">]],[</span><span class="s1">&#39;1997-02-13&#39;</span><span class="p">,[</span><span class="nx">D19970213</span><span class="p">]],[</span><span class="s1">&#39;1997-03-20&#39;</span><span class="p">,[</span><span class="nx">D19970320</span><span class="p">]],[</span><span class="s1">&#39;1997-04-24&#39;</span><span class="p">,[</span><span class="nx">D19970424</span><span class="p">]],[</span><span class="s1">&#39;1997-05-29&#39;</span><span class="p">,[</span><span class="nx">D19970529</span><span class="p">]],[</span><span class="s1">&#39;1997-08-07&#39;</span><span class="p">,[</span><span class="nx">D19970807</span><span class="p">]],[</span><span class="s1">&#39;1997-09-11&#39;</span><span class="p">,[</span><span class="nx">D19970911</span><span class="p">]],[</span><span class="s1">&#39;1997-10-16&#39;</span><span class="p">,[</span><span class="nx">D19971016</span><span class="p">]],[</span><span class="s1">&#39;1997-11-20&#39;</span><span class="p">,[</span><span class="nx">D19971120</span><span class="p">]],[</span><span class="s1">&#39;1997-12-25&#39;</span><span class="p">,[</span><span class="nx">D19971225</span><span class="p">]],[</span><span class="s1">&#39;1998-01-29&#39;</span><span class="p">,[</span><span class="nx">D19980129</span><span class="p">]],[</span><span class="s1">&#39;1998-03-05&#39;</span><span class="p">,[</span><span class="nx">D19980305</span><span class="p">]],[</span><span class="s1">&#39;1998-04-09&#39;</span><span class="p">,[</span><span class="nx">D19980409</span><span class="p">]],[</span><span class="s1">&#39;1998-05-14&#39;</span><span class="p">,[</span><span class="nx">D19980514</span><span class="p">]],[</span><span class="s1">&#39;1998-06-18&#39;</span><span class="p">,[</span><span class="nx">D19980618</span><span class="p">]],[</span><span class="s1">&#39;1998-07-23&#39;</span><span class="p">,[</span><span class="nx">D19980723</span><span class="p">]],[</span><span class="s1">&#39;1998-08-27&#39;</span><span class="p">,[</span><span class="nx">D19980827</span><span class="p">]],[</span><span class="s1">&#39;1998-10-01&#39;</span><span class="p">,[</span><span class="nx">D19981001</span><span class="p">]],[</span><span class="s1">&#39;1998-11-05&#39;</span><span class="p">,[</span><span class="nx">D19981105</span><span class="p">]],[</span><span class="s1">&#39;1998-12-10&#39;</span><span class="p">,[</span><span class="nx">D19981210</span><span class="p">]],[</span><span class="s1">&#39;1999-02-18&#39;</span><span class="p">,[</span><span class="nx">D19990218</span><span class="p">]],[</span><span class="s1">&#39;1999-03-25&#39;</span><span class="p">,[</span><span class="nx">D19990325</span><span class="p">]],[</span><span class="s1">&#39;1999-07-08&#39;</span><span class="p">,[</span><span class="nx">D19990708</span><span class="p">]],[</span><span class="s1">&#39;1999-08-11&#39;</span><span class="p">,[</span><span class="nx">D19990811</span><span class="p">]],[</span><span class="s1">&#39;1999-08-12&#39;</span><span class="p">,[</span><span class="nx">D19990812</span><span class="p">]],[</span><span class="s1">&#39;1999-09-15&#39;</span><span class="p">,[</span><span class="nx">D19990915</span><span class="p">]],[</span><span class="s1">&#39;1999-09-16&#39;</span><span class="p">,[</span><span class="nx">D19990916</span><span class="p">]],[</span><span class="s1">&#39;1999-10-20&#39;</span><span class="p">,[</span><span class="nx">D19991020</span><span class="p">]],[</span><span class="s1">&#39;1999-10-21&#39;</span><span class="p">,[</span><span class="nx">D19991021</span><span class="p">]],[</span><span class="s1">&#39;1999-11-25&#39;</span><span class="p">,[</span><span class="nx">D19991125</span><span class="p">]],[</span><span class="s1">&#39;1999-12-30&#39;</span><span class="p">,[</span><span class="nx">D19991230</span><span class="p">]],[</span><span class="s1">&#39;2000-02-02&#39;</span><span class="p">,[</span><span class="nx">D20000202</span><span class="p">]],[</span><span class="s1">&#39;2000-02-03&#39;</span><span class="p">,[</span><span class="nx">D20000203</span><span class="p">]],[</span><span class="s1">&#39;2000-03-09&#39;</span><span class="p">,[</span><span class="nx">D20000309</span><span class="p">]],[</span><span class="s1">&#39;2000-04-13&#39;</span><span class="p">,[</span><span class="nx">D20000413</span><span class="p">]],[</span><span class="s1">&#39;2000-11-09&#39;</span><span class="p">,[</span><span class="nx">D20001109</span><span class="p">]],[</span><span class="s1">&#39;2000-12-14&#39;</span><span class="p">,[</span><span class="nx">D20001214</span><span class="p">]],[</span><span class="s1">&#39;2001-10-25&#39;</span><span class="p">,[</span><span class="nx">D20011025</span><span class="p">]],[</span><span class="s1">&#39;2002-10-10&#39;</span><span class="p">,[</span><span class="nx">D20021010</span><span class="p">]],[</span><span class="s1">&#39;2002-12-19&#39;</span><span class="p">,[</span><span class="nx">D20021219</span><span class="p">]],[</span><span class="s1">&#39;2003-05-08&#39;</span><span class="p">,[</span><span class="nx">D20030508</span><span class="p">]],[</span><span class="s1">&#39;2004-01-08&#39;</span><span class="p">,[</span><span class="nx">D20040108</span><span class="p">]],[</span><span class="s1">&#39;2004-07-01&#39;</span><span class="p">,[</span><span class="nx">D20040701</span><span class="p">]],[</span><span class="s1">&#39;2004-10-14&#39;</span><span class="p">,[</span><span class="nx">D20041014</span><span class="p">]],[</span><span class="s1">&#39;2004-12-23&#39;</span><span class="p">,[</span><span class="nx">D20041223</span><span class="p">]],[</span><span class="s1">&#39;2005-01-27&#39;</span><span class="p">,[</span><span class="nx">D20050127</span><span class="p">]]];</span> <span class="c1">//--&gt;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;&lt;/</span><span class="nt">tfoot</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Point ID: <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>[Id]<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
...
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Azimuth: <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>[Azimuth]<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;[Id]_chart1&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;tschart&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Time series chart for selected point&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">th</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Header for time series data&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;gfiTableHeader&quot;</span><span class="p">&gt;</span>Measurements on dates (YYYY-MM-DD) are in mm<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
...
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="c">&lt;!-- D20050127 --&gt;</span>2005-01-27: <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>[D20050127]<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span><span class="c">&lt;!--</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#[Id]_chart1:hidden&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">plot1</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">jqplot</span><span class="p">(</span><span class="s1">&#39;[Id]_chart1&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="nx">Id</span><span class="p">]</span><span class="nx">_tsline</span><span class="p">],</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span><span class="s1">&#39;Time series plot for selected point&#39;</span><span class="p">,</span>
        <span class="nx">axes</span><span class="o">:</span><span class="p">{</span><span class="nx">xaxis</span><span class="o">:</span><span class="p">{</span><span class="nx">renderer</span><span class="o">:</span><span class="nx">$</span><span class="p">.</span><span class="nx">jqplot</span><span class="p">.</span><span class="nx">DateAxisRenderer</span><span class="p">}},</span>
        <span class="nx">series</span><span class="o">:</span><span class="p">[{</span><span class="nx">lineWidth</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span> <span class="nx">markerOptions</span><span class="o">:</span><span class="p">{</span><span class="nx">style</span><span class="o">:</span><span class="s1">&#39;circle&#39;</span><span class="p">}}]</span>
    <span class="p">});</span> <span class="c1">// --&gt;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-group-layering">
<h3>Configuring group layering<a class="headerlink" href="#configuring-group-layering" title="Permalink to this headline">¶</a></h3>
<p>In some situations, for example when you have too many individual layers, or if you have to comply with some strict naming conventions (such as INSPIRE) you may need to consider configuring group layering.  In group layering you nest one set of layers inside another (group) layer, you can still call (e.g. make a GetMap request on) any of the individual grouped layers or you can call all the grouped layers at the same time using the grouping layer.  For example in the below MapServer GetCapabilities response on a service with group layers you could make a GetMap request on the group layer called GE.GeologicFault and would get a map comprising both the grouped layers (GE.GeologicFault_GBR_BGS_EN_1M_Surface and GE.GeologicFault_GBR_BGS_EN_1M_Bedrock), or you could perform a GetMap request on either of the individual layers.</p>
<div class="figure align-default" id="id120">
<a class="reference internal image-reference" href="_images/GroupLayering.jpg"><img alt="Group layering in a GetCapabilities response" src="_images/GroupLayering.jpg" style="width: 1032px; height: 350px;" /></a>
<p class="caption"><span class="caption-text">Group layering in a GetCapabilities response</span><a class="headerlink" href="#id120" title="Permalink to this image">¶</a></p>
</div>
<p>To configure group layering in MapServer first you need to configure a service with all the layers that need to be grouped.  The next step is to add a <strong>GROUP</strong> keyword (with the name of the group layer) into the LAYER section of all the layers you want to be grouped together. Finally, in ONE of the METADATA sections of the layers you want to group you need to add a <strong>WMS_GROUP_TITLE</strong> and a <strong>WMS_GROUP_ABSTRACT</strong> value.  For example in the MapServer service configuration file for the above GetCapabilities response we have the following configuration:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
<span class="hll">    <span class="k">GROUP</span> <span class="s">&quot;GE.GeologicFault&quot;</span>
</span>    <span class="k">NAME</span> <span class="s">&quot;GE.GeologicFault_GBR_BGS_EN_1M_Surface&quot;</span>
    <span class="k">TYPE</span> <span class="nb">LINE</span>
    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">EXTENT</span> <span class="p">-</span><span class="mf">8.01697</span> <span class="mf">49.9678</span> <span class="mf">0.715821</span> <span class="mf">60.8368</span>
    <span class="k">MAXSCALEDENOM</span> <span class="mi">3000000</span>
    <span class="k">CONNECTIONTYPE</span> <span class="nb">ogr</span>
    <span class="k">CONNECTION</span> <span class="s">&quot;data2/OGE.mdb&quot;</span>
    <span class="k">DATA</span> <span class="s">&quot;V5_625k_ONEGEOLOGY_FAULTS_AT_SURFACE&quot;</span>
    <span class="k">PROCESSING</span> <span class="s">&quot;CLOSE_CONNECTION=DEFER&quot;</span>
    <span class="k">OPACITY</span> <span class="mi">100</span>
    <span class="k">TOLERANCE</span> <span class="mi">10</span>
    <span class="k">TOLERANCEUNITS</span> <span class="nb">pixels</span>
    <span class="k">TRANSFORM</span> <span class="nb">TRUE</span>
    <span class="c"># Same template OK for surface and bedrock faults</span>
    <span class="k">HEADER</span> <span class="s">&quot;templ/OGE_1M_bedrock_GeologicStructure_headerGSMLP.html&quot;</span>
    <span class="k">TEMPLATE</span> <span class="s">&quot;templ/OGE_1M_bedrock_GeologicStructure_bodyGSMLP.html&quot;</span>
    <span class="k">FOOTER</span> <span class="s">&quot;templ/OGE_1M_bedrock_GeologicStructure_footerGSMLP.html&quot;</span>
    <span class="k">PROJECTION</span>
        <span class="s">&quot;init=epsg:4326&quot;</span>
    <span class="k">END</span>
    <span class="k">METADATA</span>
        <span class="k">INCLUDE</span> <span class="s">&quot;../DefaultMapIncludes/BGS-Attribution.map&quot;</span>
        <span class="s">&quot;OWS_TITLE&quot;</span> <span class="s">&quot;BGS 1:1 Million surface geologic structure&quot;</span>
        <span class="s">&quot;OWS_ABSTRACT&quot;</span> <span class="s">&quot;BGS surface fault geology originally created for OneGeology Europe&quot;</span>
        <span class="s">&quot;OWS_EXTENT&quot;</span> <span class="s">&quot;-8.01697 49.9678 0.715821 60.8368&quot;</span>
        <span class="s">&quot;OWS_SRS&quot;</span> <span class="s">&quot;CRS:84 EPSG:27700 EPSG:3034 EPSG:4258 EPSG:4326&quot;</span>
        <span class="s">&quot;GML_INCLUDE_ITEMS&quot;</span> <span class="s">&quot;all&quot;</span>
        <span class="s">&quot;GML_FEATUREID&quot;</span> <span class="s">&quot;OBJECTID&quot;</span>
        <span class="s">&quot;OWS_METADATAURL_HREF&quot;</span> <span class="s">&quot;http://www.bgs.ac.uk/discoverymetadata/13480426.html&quot;</span>
        <span class="s">&quot;OWS_METADATAURL_FORMAT&quot;</span> <span class="s">&quot;text/html&quot;</span>
        <span class="s">&quot;OWS_METADATAURL_TYPE&quot;</span> <span class="s">&quot;TC211&quot;</span>
        <span class="s">&quot;OWS_DATAURL_HREF&quot;</span> <span class="s">&quot;http://www.bgs.ac.uk/products/digitalmaps/digmapgb_625.html&quot;</span>
        <span class="s">&quot;OWS_DATAURL_FORMAT&quot;</span> <span class="s">&quot;text/html&quot;</span>
        <span class="s">&quot;OWS_KEYWORDLIST&quot;</span> <span class="s">&quot;OneGeology,continent@Europe,subcontinent@Northern Europe,geographicarea@United Kingdom,serviceprovider@British Geological Survey,dataprovider@British Geological Survey,thematic@Harmonized structure,thematic@Surface geology,DS_TOPIC@geoscientificinformation,DS_DATE@2010,thematic@Structure,thematic@Fault&quot;</span>
        <span class="s">&quot;WFS_SRS&quot;</span> <span class="s">&quot;EPSG:4326 EPSG:27700 EPSG:3034 EPSG:4258&quot;</span>
        <span class="s">&quot;WMS_GROUP_TITLE&quot;</span> <span class="s">&quot;Geologic Faults&quot;</span>
        <span class="s">&quot;WMS_GROUP_ABSTRACT&quot;</span> <span class="s">&quot;MappedFeature (spatial objects whose specification property is of type ShearDisplacementStructure)&quot;</span>
<span class="hll">    <span class="k">END</span>
</span><span class="hll">    <span class="k">INCLUDE</span> <span class="s">&quot;FaultTypeClassesIn3.map&quot;</span>
</span><span class="k">END</span>
<span class="k">LAYER</span>
    <span class="k">GROUP</span> <span class="s">&quot;GE.GeologicFault&quot;</span>
    <span class="k">NAME</span> <span class="s">&quot;GE.GeologicFault_GBR_BGS_EN_1M_Bedrock&quot;</span>
<span class="hll">
</span>    <span class="k">CONNECTION</span> <span class="s">&quot;data2/OGE.mdb&quot;</span>
    <span class="k">CONNECTIONTYPE</span> <span class="nb">ogr</span>

    <span class="k">DATA</span> <span class="s">&quot;V5_625k_ONEGEOLOGY_FAULTS&quot;</span>
    <span class="k">EXTENT</span> <span class="p">-</span><span class="mf">8.09708</span> <span class="mf">49.9678</span> <span class="mf">0.781767</span> <span class="mf">60.8368</span>

    <span class="k">FOOTER</span> <span class="s">&quot;templ/OGE_1M_bedrock_GeologicStructure_footerGSMLP.html&quot;</span>
    <span class="k">HEADER</span> <span class="s">&quot;templ/OGE_1M_bedrock_GeologicStructure_headerGSMLP.html&quot;</span>
    <span class="k">TEMPLATE</span> <span class="s">&quot;templ/OGE_1M_bedrock_GeologicStructure_bodyGSMLP.html&quot;</span>

    <span class="k">MAXSCALEDENOM</span> <span class="mi">3000000</span>

    <span class="k">METADATA</span>
         <span class="k">INCLUDE</span> <span class="s">&quot;../DefaultMapIncludes/BGS-Attribution.map&quot;</span>
         <span class="s">&quot;GML_INCLUDE_ITEMS&quot;</span> <span class="s">&quot;all&quot;</span>
         <span class="s">&quot;GML_FEATUREID&quot;</span> <span class="s">&quot;OBJECTID&quot;</span>
         <span class="s">&quot;OWS_ABSTRACT&quot;</span> <span class="s">&quot;BGS bedrock fault geology  originally created for OneGeology Europe. </span><span class="se">\</span>
<span class="s">         The bedrock fault layer shows faults with superficial deposits (Quaternary and Recent) removed.&quot;</span>
         <span class="s">&quot;OWS_DATAURL_FORMAT&quot;</span> <span class="s">&quot;text/html&quot;</span>
         <span class="s">&quot;OWS_DATAURL_HREF&quot;</span> <span class="s">&quot;http://www.bgs.ac.uk/products/digitalmaps/digmapgb_625.html&quot;</span>
         <span class="s">&quot;OWS_EXTENT&quot;</span> <span class="s">&quot;-8.09708 49.9678 0.781767 60.8368&quot;</span>
         <span class="s">&quot;OWS_KEYWORDLIST&quot;</span> <span class="s">&quot;OneGeology,continent@Europe,subcontinent@Northern Europe,geographicarea@United Kingdom,serviceprovider@British Geological Survey,dataprovider@British Geological Survey,thematic@Harmonized structure,thematic@Bedrock,DS_TOPIC@geoscientificinformation,DS_DATE@2010,thematic@Structure,thematic@Fault&quot;</span>
         <span class="s">&quot;OWS_METADATAURL_FORMAT&quot;</span> <span class="s">&quot;text/html&quot;</span>
         <span class="s">&quot;OWS_METADATAURL_HREF&quot;</span> <span class="s">&quot;http://www.bgs.ac.uk/discoverymetadata/13480426.html&quot;</span>
         <span class="s">&quot;OWS_METADATAURL_TYPE&quot;</span> <span class="s">&quot;TC211&quot;</span>
         <span class="s">&quot;OWS_SRS&quot;</span> <span class="s">&quot;CRS:84 EPSG:27700 EPSG:3034 EPSG:4258 EPSG:4326&quot;</span>
         <span class="s">&quot;OWS_TITLE&quot;</span> <span class="s">&quot;BGS 1:1 Million bedrock geologic structure&quot;</span>
         <span class="s">&quot;WFS_SRS&quot;</span> <span class="s">&quot;EPSG:4326 EPSG:27700 EPSG:3034 EPSG:4258&quot;</span>
    <span class="k">END</span>

    <span class="k">OPACITY</span> <span class="mi">100</span>
    <span class="k">PROCESSING</span> <span class="s">&quot;CLOSE_CONNECTION=DEFER&quot;</span>

    <span class="k">PROJECTION</span>
         <span class="s">&quot;init=epsg:4326&quot;</span>
    <span class="k">END</span>

    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">TOLERANCE</span> <span class="mi">10</span>
    <span class="k">TOLERANCEUNITS</span> <span class="nb">pixels</span>
    <span class="k">TRANSFORM</span> <span class="nb">TRUE</span>
    <span class="k">TYPE</span> <span class="nb">LINE</span>

    <span class="k">INCLUDE</span> <span class="s">&quot;FaultTypeClassesIn3.map&quot;</span>
<span class="k">END</span>
</pre></div>
</div>
</div>
<div class="section" id="id73">
<h3>Simple feature WFS<a class="headerlink" href="#id73" title="Permalink to this headline">¶</a></h3>
<p>Whilst MapServer is not able to provide a complex feature WFS (such as is required to supply GeoSciML 4.0)  it is possible to configure it to provide a simple feature WFS.  If you have already set up a WMS with a vector data source it is possible with only minor additions to the SERVER and LAYER configuration to enable a WFS service.  If your data supports it, you can also configure a portrayal service, to provide a GeoSciML-Lite simple feature service for example.</p>
<p>A WFS service will be enabled by the presence of an <strong>OWS_ENABLE_REQUEST</strong> or <strong>WFS_ENABLE_REQUEST</strong> statement in the MAP &gt; WEB &gt; METADATA section, or in the LAYER &gt; METADATA section.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="c"># The following statment enables all operations for all OGC services</span>
<span class="s">&quot;OWS_ENABLE_REQUEST&quot;</span> <span class="s">&quot;*&quot;</span>

<span class="c"># The following statement disables all WFS operations</span>
<span class="s">&quot;WFS_ENABLE_REQUEST&quot;</span> <span class="s">&quot;!*&quot;</span>

<span class="c"># The following statement disables GetCapabilities and DescribeFeatureType operations but allows GetFeature</span>
<span class="c"># If !GetCapabilities is set in a LAYER &gt; METADATA section level, and in the WEB &gt; METADATA section</span>
<span class="c"># WFS GetCapabilities is enabled, the feature type (layer)  won&#39;t appear in the WFS GetCapabilities response.</span>
<span class="s">&quot;WFS_ENABLE_REQUEST&quot;</span> <span class="s">&quot;!GetCapabilities !DescribeFeatureType GetFeature&quot;</span>
</pre></div>
</div>
<p>The MapServer WFS Server pages <a class="reference external" href="http://mapserver.org/ogc/wfs_server.html">http://mapserver.org/ogc/wfs_server.html</a> give full details of the options to configure a WFS service but below we give some hints to get you going with ERML-Lite and GeoSciML-Lite schemas.</p>
<p>In the MAP &gt; WEB &gt; METADATA section you can set the default WFS language, and also configure a namespace prefix and uri like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;WFS_LANGUAGES&quot;</span> <span class="s">&quot;eng&quot;</span>

<span class="c"># For GeoSciML-Lite use:</span>
<span class="s">&quot;WFS_NAMESPACE_PREFIX&quot;</span> <span class="s">&quot;gmlsp&quot;</span>
<span class="s">&quot;WFS_NAMESPACE_URI&quot;</span> <span class="s">&quot;http://xmlns.geosciml.org/geosciml-portrayal/4.0&quot;</span>

<span class="c"># ERML-Lite use:</span>
<span class="s">&quot;WFS_NAMESPACE_PREFIX&quot;</span> <span class="s">&quot;erl&quot;</span>
<span class="s">&quot;WFS_NAMESPACE_URI&quot;</span> <span class="s">&quot;http://xmlns.earthresourceml.org/earthresourceml-lite/1.0&quot;</span>
</pre></div>
</div>
<p>In any LAYER &gt; METADATA section you can define any number of GML constants. You can use this mecahnism as a way to add nil values or other constant information that is missing from your data source but required by the GeoSciML-Lite schema, or simply because you wish to supply it.</p>
<p>In the below example we have used this mechanism to populate specification_uri and metadata_uri which were required with GeoSciML-Portrayal version 2; in the current GeoSciML-Lite 4.0 version these propreties are now optional.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;GML_CONSTANTS&quot;</span> <span class="s">&quot;specification_uri,metadata_uri&quot;</span>
<span class="s">&quot;GML_metadata_uri_TYPE&quot;</span> <span class="s">&quot;string&quot;</span>
<span class="s">&quot;GML_metadata_uri_VALUE&quot;</span> <span class="s">&quot;http://metadata.bgs.ac.uk/geonetwork/srv/en/iso19139.xml?id=6074&quot;</span>
<span class="s">&quot;GML_specification_uri_TYPE&quot;</span> <span class="s">&quot;string&quot;</span>
<span class="s">&quot;GML_specification_uri_VALUE&quot;</span> <span class="s">&quot;http://inspire.ec.europa.eu/codelist/VoidReasonValue/Unpopulated/&quot;</span>
</pre></div>
</div>
<p>Once a constant has been defined for a layer, the constant can be accessed in a template using the standard notation.</p>
<p>In any LAYER &gt; METADATA section you can specify which items in your datasource to include (or exclude) in your Feature response, so in this below example we are saying effectively include everything (GML_INCLUDE_ITEMS) except (GML_EXCLUDE_ITEMS).</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;GML_INCLUDE_ITEMS&quot;</span> <span class="s">&quot;all&quot;</span>
<span class="s">&quot;GML_EXCLUDE_ITEMS&quot;</span> <span class="s">&quot;AgeMax,AgeMin,EventEnvironment,EventProcess,Lithology_1,ProportionTerms_1,GeologicUnitPartRole_1,Lithology_2,ProportionTerms_2,GeologicUnitPartRole_2,Lithology_3,ProportionTerms_3,GeologicUnitPartRole_3,Lithology_4,ProportionTerms_4,GeologicUnitPartRole_4,Lithology_5,ProportionTerms_5,GeologicUnitPartRole_5,MetamorphicGrade,NameIndex,BodyMorphology,SamplingFrame,GUObservationMethod,GUPurpose,SHAPE_Length,SHAPE_Area,RELEASED,gu_id,mf_id&quot;</span>
</pre></div>
</div>
<p>In any LAYER &gt; METADATA section you can specify an alias to be used in your feature response, so for example if your feature identifier is called OBJECTID in your database you can alias it to the required identifier, or if you want to change the case of a field (or property) from Name to name you would use:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;GML_OBJECTID_ALIAS&quot;</span> <span class="s">&quot;identifier&quot;</span>
<span class="s">&quot;GML_Name_ALIAS&quot;</span> <span class="s">&quot;name&quot;</span>
</pre></div>
</div>
<p>You can specify your own grouping of the properties (and the order in which they appear) within a feature and give this grouping a name like below. If you have used any aliases you must reference the original name and not the alias value in the grouping, though the alias will appear in the output.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;GML_GROUPS&quot;</span> <span class="s">&quot;ShearDisplacementStructureView&quot;</span>
<span class="s">&quot;GML_ShearDisplacementStructureView_GROUP&quot;</span> <span class="s">&quot;OBJECTID,Name,faultType,observationMethod,positionalAccuracy,faultType_uri,movementType_uri,deformationStyle_uri,representativeAge_uri,representativeOlderAge_uri,representativeYoungerAge_uri,specification_uri,metadata_uri&quot;</span>
</pre></div>
</div>
<p>By default MapServer outputs the geometry in a field called _msGeometry_ to change the name of the field to a value relevant to your schema you use GML_GEOMETRIES, like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;GML_GEOMETRIES&quot;</span> <span class="s">&quot;shape&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id74">
<h3>WCS<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h3>
<p>In the same way as WMS and WFS are enabled on a service, WCS operations are enabled using either the <strong>OWS_ENABLE_REQUEST</strong> or <strong>WCS_ENABLE_REQUEST”</strong> statement in the MAP &gt; WEB &gt; METADATA section (enabling WCS for all coverages) or in the LAYER &gt; METADATA section for enabling operations on a per coverage (layer) basis.</p>
<p>For example:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="c"># The following statement enables all core WCS operations (GetCapabilities, GetCoverage and DescribeCoverage)</span>
<span class="s">&quot;WCS_ENABLE_REQUEST&quot;</span> <span class="s">&quot;*&quot;</span>
</pre></div>
</div>
<p>In addition to default metadata specified above a OneGeology WCS service should specify the following information in the MAP &gt; WEB &gt; METADATA.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="c"># You need to provide both an _ABSTRACT and a _DESCRIPTION to cover all WCS versions</span>
<span class="c">#============================================================================================#</span>
<span class="s">&quot;WCS_ABSTRACT&quot;</span> <span class="s">&quot;The European Marine Observation and Data Network (EMODnet) is a long term marine data initiative from the European Commission Directorate-General for Maritime Affairs and Fisheries (DG MARE) underpinning its Marine Knowledge 2020 strategy. EMODnet is a consortium of organisations assembling European marine data, data products and metadata from diverse sources in a uniform way. The main purpose of EMODnet is to unlock fragmented and hidden marine data resources and to make these available to individuals and organisations (public and private), and to facilitate investment in sustainable coastal and offshore activities through improved access to quality-assured, standardised and harmonised marine data which are interoperable and free of restrictions on use.&quot;</span>

<span class="s">&quot;WCS_DESCRIPTION&quot;</span> <span class="s">&quot;The European Marine Observation and Data Network (EMODnet) is a long term marine data initiative from the European Commission Directorate-General for Maritime Affairs and Fisheries (DG MARE) underpinning its Marine Knowledge 2020 strategy. EMODnet is a consortium of organisations assembling European marine data, data products and metadata from diverse sources in a uniform way. The main purpose of EMODnet is to unlock fragmented and hidden marine data resources and to make these available to individuals and organisations (public and private), and to facilitate investment in sustainable coastal and offshore activities through improved access to quality-assured, standardised and harmonised marine data which are interoperable and free of restrictions on use.&quot;</span>

<span class="s">&quot;WCS_KEYWORDLIST&quot;</span> <span class="s">&quot;OneGeology,infoCoverageAccessService,Europe,EMODnet,Bathymetry,MD_LANG@ENG,MD_DATE@2015-04-14&quot;</span>

<span class="c">#============================================================================================#</span>
<span class="c"># &quot;WCS_LABEL&quot; Is MANDATORY metadata for WCS version 1.0.0 GetCapabilities in SERVICE and LAYER metadata.</span>
<span class="c"># &quot;WCS_LABEL&quot; should be the same value as the WCS_TITLE (which is used as its replacement in later WCS versions).</span>
<span class="c">#============================================================================================#</span>
<span class="s">&quot;WCS_LABEL&quot;</span> <span class="s">&quot;BGS EMODnet bathymetry&quot;</span>
<span class="s">&quot;WCS_TITLE&quot;</span> <span class="s">&quot;BGS EMODnet bathymetry&quot;</span>

<span class="c"># You need to list the default projection first</span>
<span class="s">&quot;WCS_SRS&quot;</span> <span class="s">&quot;EPSG:4326 EPSG:3031 EPSG:3034 EPSG:3413 EPSG:3857 EPSG:4258&quot;</span>
</pre></div>
</div>
<p>The following is an example of a coverage LAYER</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&quot;BGS_EMODNET_CentralMed-MCol&quot;</span>
    <span class="k">DATA</span> <span class="s">&quot;Adriatic Sea - Ionian Sea - Central Mediterranean [Multi Colour].tif&quot;</span>

    <span class="k">METADATA</span>
        <span class="k">INCLUDE</span> <span class="s">&quot;../DefaultMapIncludes/BGS-Attribution.map&quot;</span>
        <span class="k">INCLUDE</span> <span class="s">&quot;emodnet-mcol-legend.map&quot;</span>
        <span class="s">&quot;band1_BAND_DESCRIPTION&quot;</span> <span class="s">&quot;Red&quot;</span>
        <span class="s">&quot;band2_BAND_DESCRIPTION&quot;</span> <span class="s">&quot;Green&quot;</span>
        <span class="s">&quot;band3_BAND_DESCRIPTION&quot;</span> <span class="s">&quot;Blue&quot;</span>
        <span class="s">&quot;WCS_BAND_INTERPRETATION&quot;</span> <span class="s">&quot;Colour&quot;</span>
        <span class="s">&quot;WCS_BANDCOUNT&quot;</span> <span class="s">&quot;3&quot;</span>
        <span class="s">&quot;WCS_BAND_NAMES&quot;</span> <span class="s">&quot;band1 band2 band3&quot;</span>
        <span class="s">&quot;WCS_DESCRIPTION&quot;</span> <span class="s">&quot;European Marine Observation and Data Network (EMODnet) bathymetry for the Adriatic Sea - Ionian Sea - Central Mediterranean region. Native data is multi-colour GeoTiff.&quot;</span>
        <span class="s">&quot;WCS_IMAGEMODE&quot;</span> <span class="s">&quot;BYTE&quot;</span>
        <span class="s">&quot;WCS_INTERVAL&quot;</span> <span class="s">&quot;0 255&quot;</span>
        <span class="s">&quot;WCS_LABEL&quot;</span> <span class="s">&quot;Adriatic Sea - Ionian Sea - Central Mediterranean [Multi Colour]&quot;</span>
        <span class="s">&quot;WCS_NATIVE_FORMAT&quot;</span> <span class="s">&quot;image/tiff&quot;</span>
        <span class="s">&quot;WCS_RANGESET_AXES&quot;</span> <span class="s">&quot;bands&quot;</span>
        <span class="s">&quot;WCS_RANGESET_DESCRIPTION&quot;</span> <span class="s">&quot;Depth&quot;</span>
        <span class="c">#===================================================</span>
        <span class="c"># &quot;WCS_RANGESET_LABEL&quot; is mandatory 1.0.0 metadata</span>
        <span class="c">#===================================================</span>
        <span class="s">&quot;WCS_RANGESET_LABEL&quot;</span> <span class="s">&quot;Red/Green/Blue colour interpretations&quot;</span>
        <span class="c">#===================================================</span>
        <span class="c"># &quot;WCS_RANGESET_NAME&quot; is mandatory 1.0.0 metadata</span>
        <span class="c">#===================================================</span>
        <span class="s">&quot;WCS_RANGESET_NAME&quot;</span> <span class="s">&quot;band&quot;</span>
        <span class="s">&quot;WCS_SIGNIFICANT_FIGURES&quot;</span> <span class="s">&quot;3&quot;</span>
        <span class="s">&quot;WCS_SIZE&quot;</span> <span class="s">&quot;2977 3883&quot;</span>
        <span class="s">&quot;OWS_ABSTRACT&quot;</span> <span class="s">&quot;European Marine Observation and Data Network (EMODnet) bathymetry for the Adriatic Sea - Ionian Sea - Central Mediterranean region. Native data is multi-colour GeoTiff.&quot;</span>
        <span class="s">&quot;OWS_KEYWORDLIST&quot;</span> <span class="s">&quot;OneGeology,continent@Europe,dataprovider@EMODnet,serviceprovider@British Geological Survey,DS_TOPIC@geoscientificInformation,DS_DATE@2011-06-30,Bathymetry,CRS_SUPPORTED@EPSG:4326 EPSG:3031 EPSG:3034 EPSG:3413 EPSG:3857 EPSG:4258&quot;</span>
        <span class="s">&quot;OWS_SRS&quot;</span> <span class="s">&quot;EPSG:4326 EPSG:3031 EPSG:3034 EPSG:3413 EPSG:3857 EPSG:4258&quot;</span>
        <span class="s">&quot;OWS_TITLE&quot;</span> <span class="s">&quot;Adriatic Sea - Ionian Sea - Central Mediterranean [Multi Colour]&quot;</span>
    <span class="k">END</span>

    <span class="k">PROJECTION</span>
        <span class="s">&quot;init=epsg:4326&quot;</span>
    <span class="k">END</span>

    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">TOLERANCE</span> <span class="mi">10</span>
    <span class="k">TYPE</span> <span class="nb">RASTER</span>
 <span class="k">END</span>
</pre></div>
</div>
<p>Further details for configuring WCS with Mapserver can be found at: <a class="reference external" href="http://mapserver.org/ogc/wcs_server.html">WCS Server</a></p>
</div>
</div>
<div class="section" id="inspire-metadata">
<h2>INSPIRE metadata<a class="headerlink" href="#inspire-metadata" title="Permalink to this headline">¶</a></h2>
<p>INSPIRE specific metadata can either be referenced in an external INSPIRE service metadata document (scenario 1) or can be directly embedded in the capabilities document (scenario 2). MapServer supports both scenarios.  In either scenario an extended capabilities section is added to the GetCapabilities response for the service, using metadata configured in the <strong>SERVICE &gt; WEB &gt; METADATA</strong> section of the Mapfile.</p>
<p>For example to add a scenario 1 INSPIRE extended capabilities section for an INSPIRE View service (WMS) you would use something like the below:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;WMS_LANGUAGES&quot;</span> <span class="s">&quot;eng&quot;</span>
<span class="s">&quot;WMS_INSPIRE_CAPABILITIES&quot;</span> <span class="s">&quot;URL&quot;</span>
<span class="s">&quot;WMS_INSPIRE_METADATAURL_FORMAT&quot;</span> <span class="s">&quot;application/xml&quot;</span>
<span class="s">&quot;WMS_INSPIRE_METADATAURL_HREF&quot;</span> <span class="s">&quot;http://metadata.bgs.ac.uk/geonetwork/srv/en/csw?SERVICE=CSW&amp;REQUEST=GetRecordById&amp;ID=7822e848-822d-45a5-8584-56d352fd2170&amp;elementSetName=full&amp;OutputSchema=csw:IsoRecord&amp;&quot;</span>
</pre></div>
</div>
<p>Which would create:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;inspire_vs:ExtendedCapabilities&gt;</span>
    <span class="nt">&lt;inspire_common:MetadataUrl</span> <span class="na">xsi:type=</span><span class="s">&quot;inspire_common:resourceLocatorType&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;inspire_common:URL&gt;</span>http://metadata.bgs.ac.uk/geonetwork/srv/en/csw?SERVICE=CSW
        <span class="ni">&amp;amp;</span>REQUEST=GetRecordById<span class="ni">&amp;amp;</span>ID=7822e848-822d-45a5-8584-56d352fd2170<span class="ni">&amp;amp;</span>elementSetName=full<span class="ni">&amp;amp;</span>OutputSchema=csw:IsoRecord<span class="ni">&amp;amp;</span>
        <span class="nt">&lt;/inspire_common:URL&gt;</span>
        <span class="nt">&lt;inspire_common:MediaType&gt;</span>application/xml<span class="nt">&lt;/inspire_common:MediaType&gt;</span>
    <span class="nt">&lt;/inspire_common:MetadataUrl&gt;</span>
    <span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
        <span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
            <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
        <span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
    <span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
    <span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
        <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
    <span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
<span class="nt">&lt;/inspire_vs:ExtendedCapabilities&gt;</span>
</pre></div>
</div>
<p>And similarly for a WFS (INSPIRE download service) you would use something like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;WFS_INSPIRE_CAPABILITIES&quot;</span> <span class="s">&quot;url&quot;</span>
<span class="s">&quot;WFS_INSPIRE_DSID_CODE&quot;</span> <span class="s">&quot;c8a4207f-adb8-43fc-ad70-8ae1f7d4b50d&quot;</span>
<span class="s">&quot;WFS_INSPIRE_DSID_NS&quot;</span> <span class="s">&quot;http://ogc.bgs.ac.uk&quot;</span>
<span class="s">&quot;WFS_INSPIRE_METADATAURL_FORMAT&quot;</span> <span class="s">&quot;application/xml&quot;</span>
<span class="s">&quot;WFS_INSPIRE_METADATAURL_HREF&quot;</span> <span class="s">&quot;http://ogc.bgs.ac.uk/terrafirma/metadata/TerraFirmaSRVMD.xml&quot;</span>
<span class="s">&quot;WFS_LANGUAGES&quot;</span> <span class="s">&quot;eng&quot;</span>
</pre></div>
</div>
<p>To create:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ows:ExtendedCapabilities&gt;</span>
    <span class="nt">&lt;inspire_dls:ExtendedCapabilities&gt;</span>
        <span class="nt">&lt;inspire_common:MetadataUrl</span> <span class="na">xsi:type=</span><span class="s">&quot;inspire_common:resourceLocatorType&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;inspire_common:URL&gt;</span>
                http://ogc.bgs.ac.uk/terrafirma/metadata/TerraFirmaSRVMD.xml
            <span class="nt">&lt;/inspire_common:URL&gt;</span>
            <span class="nt">&lt;inspire_common:MediaType&gt;</span>application/xml<span class="nt">&lt;/inspire_common:MediaType&gt;</span>
        <span class="nt">&lt;/inspire_common:MetadataUrl&gt;</span>
        <span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
            <span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
                <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
            <span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
        <span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
        <span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
            <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
        <span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
        <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
            <span class="nt">&lt;inspire_common:Code&gt;</span>c8a4207f-adb8-43fc-ad70-8ae1f7d4b50d<span class="nt">&lt;/inspire_common:Code&gt;</span>
            <span class="nt">&lt;inspire_common:Namespace&gt;</span>http://ogc.bgs.ac.uk<span class="nt">&lt;/inspire_common:Namespace&gt;</span>
        <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
    <span class="nt">&lt;/inspire_dls:ExtendedCapabilities&gt;</span>
<span class="nt">&lt;/ows:ExtendedCapabilities&gt;</span>
</pre></div>
</div>
<p>and finally for a WCS (INSPIRE download service) you could use something like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;WCS_INSPIRE_CAPABILITIES&quot;</span> <span class="s">&quot;url&quot;</span>
<span class="s">&quot;WCS_INSPIRE_DSID_CODE&quot;</span> <span class="s">&quot;http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?request=GetMetadata&amp;layer=PARENTMATERIAL&amp;,http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?request=GetMetadata&amp;layer=REFIEFM&amp;,http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?request=GetMetadata&amp;layer=LVBATHY&amp;,http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?request=GetMetadata&amp;layer=POPN&amp;&quot;</span>
<span class="s">&quot;WCS_INSPIRE_METADATAURL_FORMAT&quot;</span> <span class="s">&quot;text/html&quot;</span>
<span class="s">&quot;WCS_INSPIRE_METADATAURL_HREF&quot;</span> <span class="s">&quot;http://ogc2.bgs.ac.uk/ARGI_UPP/&quot;</span>
<span class="s">&quot;WCS_LANGUAGES&quot;</span> <span class="s">&quot;eng&quot;</span>
</pre></div>
</div>
<p>To create:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ows:ExtendedCapabilities&gt;</span>
  <span class="nt">&lt;inspire_dls:ExtendedCapabilities&gt;</span>
    <span class="nt">&lt;inspire_common:MetadataUrl</span> <span class="na">xsi:type=</span><span class="s">&quot;inspire_common:resourceLocatorType&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;inspire_common:URL&gt;</span>http://ogc2.bgs.ac.uk/UGA_ARGI/<span class="nt">&lt;/inspire_common:URL&gt;</span>
      <span class="nt">&lt;inspire_common:MediaType&gt;</span>text/html<span class="nt">&lt;/inspire_common:MediaType&gt;</span>
    <span class="nt">&lt;/inspire_common:MetadataUrl&gt;</span>
    <span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
      <span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
        <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
      <span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
    <span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
    <span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
      <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
    <span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
    <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
      <span class="nt">&lt;inspire_common:Code&gt;</span>http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?request=GetMetadata<span class="ni">&amp;amp;</span>layer=PARENTMATERIAL<span class="ni">&amp;amp;</span><span class="nt">&lt;/inspire_common:Code&gt;</span>
    <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
    <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
      <span class="nt">&lt;inspire_common:Code&gt;</span>http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?request=GetMetadata<span class="ni">&amp;amp;</span>layer=REFIEFM<span class="ni">&amp;amp;</span><span class="nt">&lt;/inspire_common:Code&gt;</span>
    <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
    <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
      <span class="nt">&lt;inspire_common:Code&gt;</span>http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?request=GetMetadata<span class="ni">&amp;amp;</span>layer=LVBATHY<span class="ni">&amp;amp;</span><span class="nt">&lt;/inspire_common:Code&gt;</span>
    <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
    <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
      <span class="nt">&lt;inspire_common:Code&gt;</span>http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?request=GetMetadata<span class="ni">&amp;amp;</span>layer=POPN<span class="ni">&amp;amp;</span><span class="nt">&lt;/inspire_common:Code&gt;</span>
    <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
  <span class="nt">&lt;/inspire_dls:ExtendedCapabilities&gt;</span>
<span class="nt">&lt;/ows:ExtendedCapabilities&gt;</span>
</pre></div>
</div>
<p>To add a scenario 2 INSPIRE extended capabilities section (where you have no external metadata document for your service) you could add the following parameters for a WMS:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;WMS_LANGUAGES&quot;</span> <span class="s">&quot;eng&quot;</span>
<span class="s">&quot;WMS_INSPIRE_CAPABILITIES&quot;</span> <span class="s">&quot;embed&quot;</span>
<span class="s">&quot;WMS_INSPIRE_KEYWORD&quot;</span> <span class="s">&quot;infoMapAccessService&quot;</span>
<span class="s">&quot;WMS_INSPIRE_MPOC_EMAIL&quot;</span> <span class="s">&quot;enqiries@bgs.ac.uk&quot;</span>
<span class="s">&quot;WMS_INSPIRE_MPOC_NAME&quot;</span> <span class="s">&quot;Mr Matthew Harrison&quot;</span>
<span class="s">&quot;WMS_INSPIRE_METADATADATE&quot;</span> <span class="s">&quot;2014-03-28&quot;</span>
<span class="s">&quot;WMS_INSPIRE_RESOURCELOCATOR&quot;</span> <span class="s">&quot;http://ogc.bgs.ac.uk/cgi-bin/TFL-PSI/ows?&quot;</span>
<span class="s">&quot;WMS_INSPIRE_TEMPORAL_REFERENCE&quot;</span> <span class="s">&quot;2014-06-06&quot;</span>
</pre></div>
</div>
<p>Which would create:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;inspire_vs:ExtendedCapabilities&gt;</span>
    <span class="nt">&lt;inspire_common:ResourceLocator&gt;</span>
        <span class="nt">&lt;inspire_common:URL&gt;</span>http://ogc.bgs.ac.uk/cgi-bin/TFL-PSI/ows?<span class="nt">&lt;/inspire_common:URL&gt;</span>
    <span class="nt">&lt;/inspire_common:ResourceLocator&gt;</span>
    <span class="nt">&lt;inspire_common:ResourceType&gt;</span>service<span class="nt">&lt;/inspire_common:ResourceType&gt;</span>
    <span class="nt">&lt;inspire_common:TemporalReference&gt;</span>
        <span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2014-06-06<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
    <span class="nt">&lt;/inspire_common:TemporalReference&gt;</span>
    <span class="nt">&lt;inspire_common:Conformity&gt;</span>
        <span class="nt">&lt;inspire_common:Specification&gt;</span>
            <span class="nt">&lt;inspire_common:Title&gt;</span>-<span class="nt">&lt;/inspire_common:Title&gt;</span>
            <span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2014-06-06<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
        <span class="nt">&lt;/inspire_common:Specification&gt;</span>
        <span class="nt">&lt;inspire_common:Degree&gt;</span>notEvaluated<span class="nt">&lt;/inspire_common:Degree&gt;</span>
    <span class="nt">&lt;/inspire_common:Conformity&gt;</span>
    <span class="nt">&lt;inspire_common:MetadataPointOfContact&gt;</span>
        <span class="nt">&lt;inspire_common:OrganisationName&gt;</span>Mr Matthew Harrison<span class="nt">&lt;/inspire_common:OrganisationName&gt;</span>
        <span class="nt">&lt;inspire_common:EmailAddress&gt;</span>enqiries@bgs.ac.uk<span class="nt">&lt;/inspire_common:EmailAddress&gt;</span>
    <span class="nt">&lt;/inspire_common:MetadataPointOfContact&gt;</span>
    <span class="nt">&lt;inspire_common:MetadataDate&gt;</span>2014-03-28<span class="nt">&lt;/inspire_common:MetadataDate&gt;</span>
    <span class="nt">&lt;inspire_common:SpatialDataServiceType&gt;</span>view<span class="nt">&lt;/inspire_common:SpatialDataServiceType&gt;</span>
    <span class="nt">&lt;inspire_common:MandatoryKeyword&gt;</span>
        <span class="nt">&lt;inspire_common:KeywordValue&gt;</span>infoMapAccessService<span class="nt">&lt;/inspire_common:KeywordValue&gt;</span>
    <span class="nt">&lt;/inspire_common:MandatoryKeyword&gt;</span>
    <span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
        <span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
            <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
        <span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
    <span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
    <span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
        <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
    <span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
<span class="nt">&lt;/inspire_vs:ExtendedCapabilities&gt;</span>
</pre></div>
</div>
<p>Similarly for an INSPIRE WFS (download) service you would use:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;WFS_INSPIRE_CAPABILITIES&quot;</span> <span class="s">&quot;embed&quot;</span>
<span class="s">&quot;WFS_INSPIRE_DSID_CODE&quot;</span> <span class="s">&quot;c8a4207f-adb8-43fc-ad70-8ae1f7d4b50d&quot;</span>
<span class="s">&quot;WFS_INSPIRE_DSID_NS&quot;</span> <span class="s">&quot;http://ogc.bgs.ac.uk&quot;</span>
<span class="s">&quot;WFS_INSPIRE_KEYWORD&quot;</span> <span class="s">&quot;infoFeatureAccessService&quot;</span>
<span class="s">&quot;WFS_INSPIRE_MPOC_EMAIL&quot;</span> <span class="s">&quot;enqiries@bgs.ac.uk&quot;</span>
<span class="s">&quot;WFS_INSPIRE_MPOC_NAME&quot;</span> <span class="s">&quot;Mr Matthew Harrison&quot;</span>
<span class="s">&quot;WFS_INSPIRE_METADATADATE&quot;</span> <span class="s">&quot;2016-04-13&quot;</span>
<span class="s">&quot;WFS_INSPIRE_RESOURCELOCATOR&quot;</span> <span class="s">&quot;http://ogc.bgs.ac.uk/cgi-bin/TFL-PSI/ows?&quot;</span>
<span class="s">&quot;WFS_INSPIRE_TEMPORAL_REFERENCE&quot;</span> <span class="s">&quot;2016-04-13&quot;</span>
<span class="s">&quot;WFS_LANGUAGES&quot;</span> <span class="s">&quot;eng&quot;</span>
</pre></div>
</div>
<p>To create:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ows:ExtendedCapabilities&gt;</span>
    <span class="nt">&lt;inspire_dls:ExtendedCapabilities&gt;</span>
        <span class="nt">&lt;inspire_common:ResourceLocator&gt;</span>
            <span class="nt">&lt;inspire_common:URL&gt;</span>http://ogc.bgs.ac.uk/cgi-bin/TFL-PSI/ows?<span class="nt">&lt;/inspire_common:URL&gt;</span>
        <span class="nt">&lt;/inspire_common:ResourceLocator&gt;</span>
        <span class="nt">&lt;inspire_common:ResourceType&gt;</span>service<span class="nt">&lt;/inspire_common:ResourceType&gt;</span>
        <span class="nt">&lt;inspire_common:TemporalReference&gt;</span>
            <span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2016-04-13<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
        <span class="nt">&lt;/inspire_common:TemporalReference&gt;</span>
        <span class="nt">&lt;inspire_common:Conformity&gt;</span>
            <span class="nt">&lt;inspire_common:Specification&gt;</span>
                <span class="nt">&lt;inspire_common:Title&gt;</span>-<span class="nt">&lt;/inspire_common:Title&gt;</span>
                <span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2016-04-13<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
            <span class="nt">&lt;/inspire_common:Specification&gt;</span>
            <span class="nt">&lt;inspire_common:Degree&gt;</span>notEvaluated<span class="nt">&lt;/inspire_common:Degree&gt;</span>
        <span class="nt">&lt;/inspire_common:Conformity&gt;</span>
        <span class="nt">&lt;inspire_common:MetadataPointOfContact&gt;</span>
            <span class="nt">&lt;inspire_common:OrganisationName&gt;</span>Mr Matthew Harrison<span class="nt">&lt;/inspire_common:OrganisationName&gt;</span>
            <span class="nt">&lt;inspire_common:EmailAddress&gt;</span>enqiries@bgs.ac.uk<span class="nt">&lt;/inspire_common:EmailAddress&gt;</span>
        <span class="nt">&lt;/inspire_common:MetadataPointOfContact&gt;</span>
        <span class="nt">&lt;inspire_common:MetadataDate&gt;</span>2016-04-13<span class="nt">&lt;/inspire_common:MetadataDate&gt;</span>
        <span class="nt">&lt;inspire_common:SpatialDataServiceType&gt;</span>download<span class="nt">&lt;/inspire_common:SpatialDataServiceType&gt;</span>
        <span class="nt">&lt;inspire_common:MandatoryKeyword&gt;</span>
            <span class="nt">&lt;inspire_common:KeywordValue&gt;</span>infoFeatureAccessService<span class="nt">&lt;/inspire_common:KeywordValue&gt;</span>
        <span class="nt">&lt;/inspire_common:MandatoryKeyword&gt;</span>
        <span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
            <span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
                <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
            <span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
        <span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
        <span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
            <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
        <span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
        <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
            <span class="nt">&lt;inspire_common:Code&gt;</span>c8a4207f-adb8-43fc-ad70-8ae1f7d4b50d<span class="nt">&lt;/inspire_common:Code&gt;</span>
            <span class="nt">&lt;inspire_common:Namespace&gt;</span>http://ogc.bgs.ac.uk<span class="nt">&lt;/inspire_common:Namespace&gt;</span>
        <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
    <span class="nt">&lt;/inspire_dls:ExtendedCapabilities&gt;</span>
<span class="nt">&lt;/ows:ExtendedCapabilities&gt;</span>
</pre></div>
</div>
<p>Finally for an INSPIRE WCS (download) service you could use:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;WCS_INSPIRE_CAPABILITIES&quot;</span> <span class="s">&quot;embed&quot;</span>
<span class="s">&quot;WCS_INSPIRE_DSID_CODE&quot;</span> <span class="s">&quot;ARGI_UPP:PARENTMATERIAL,ARGI_UPP:REFIEFM,ARGI_UPP:LVBATHY,ARGI_UPP:POPN&quot;</span>
<span class="s">&quot;WCS_INSPIRE_KEYWORD&quot;</span> <span class="s">&quot;infoCoverageAccessService&quot;</span>
<span class="s">&quot;WCS_INSPIRE_MPOC_EMAIL&quot;</span> <span class="s">&quot;enqiries@bgs.ac.uk&quot;</span>
<span class="s">&quot;WCS_INSPIRE_MPOC_NAME&quot;</span> <span class="s">&quot;Mr Matthew Harrison&quot;</span>
<span class="s">&quot;WCS_INSPIRE_METADATADATE&quot;</span> <span class="s">&quot;2016-04-13&quot;</span>
<span class="s">&quot;WCS_INSPIRE_RESOURCELOCATOR&quot;</span> <span class="s">&quot;http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?&quot;</span>
<span class="s">&quot;WCS_INSPIRE_TEMPORAL_REFERENCE&quot;</span> <span class="s">&quot;2016-01-01&quot;</span>
<span class="s">&quot;WCS_LANGUAGES&quot;</span> <span class="s">&quot;eng&quot;</span>
</pre></div>
</div>
<p>To create:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ows:ExtendedCapabilities&gt;</span>
  <span class="nt">&lt;inspire_dls:ExtendedCapabilities&gt;</span>
    <span class="nt">&lt;inspire_common:ResourceLocator&gt;</span>
      <span class="nt">&lt;inspire_common:URL&gt;</span>http://ogc2.bgs.ac.uk/cgi-bin/UGA_ARGI/ows?<span class="nt">&lt;/inspire_common:URL&gt;</span>
    <span class="nt">&lt;/inspire_common:ResourceLocator&gt;</span>
    <span class="nt">&lt;inspire_common:ResourceType&gt;</span>service<span class="nt">&lt;/inspire_common:ResourceType&gt;</span>
    <span class="nt">&lt;inspire_common:TemporalReference&gt;</span>
      <span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2016-01-01<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
    <span class="nt">&lt;/inspire_common:TemporalReference&gt;</span>
    <span class="nt">&lt;inspire_common:Conformity&gt;</span>
      <span class="nt">&lt;inspire_common:Specification&gt;</span>
        <span class="nt">&lt;inspire_common:Title&gt;</span>-<span class="nt">&lt;/inspire_common:Title&gt;</span>
        <span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2016-01-01<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
      <span class="nt">&lt;/inspire_common:Specification&gt;</span>
      <span class="nt">&lt;inspire_common:Degree&gt;</span>notEvaluated<span class="nt">&lt;/inspire_common:Degree&gt;</span>
    <span class="nt">&lt;/inspire_common:Conformity&gt;</span>
    <span class="nt">&lt;inspire_common:MetadataPointOfContact&gt;</span>
      <span class="nt">&lt;inspire_common:OrganisationName&gt;</span>James Passmore<span class="nt">&lt;/inspire_common:OrganisationName&gt;</span>
      <span class="nt">&lt;inspire_common:EmailAddress&gt;</span>enquiries@bgs.ac.uk<span class="nt">&lt;/inspire_common:EmailAddress&gt;</span>
    <span class="nt">&lt;/inspire_common:MetadataPointOfContact&gt;</span>
    <span class="nt">&lt;inspire_common:MetadataDate&gt;</span>2018-10-04<span class="nt">&lt;/inspire_common:MetadataDate&gt;</span>
    <span class="nt">&lt;inspire_common:SpatialDataServiceType&gt;</span>download<span class="nt">&lt;/inspire_common:SpatialDataServiceType&gt;</span>
    <span class="nt">&lt;inspire_common:MandatoryKeyword&gt;</span>
      <span class="nt">&lt;inspire_common:KeywordValue&gt;</span>infoCoverageAccessService<span class="nt">&lt;/inspire_common:KeywordValue&gt;</span>
    <span class="nt">&lt;/inspire_common:MandatoryKeyword&gt;</span>
    <span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
      <span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
        <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
      <span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
    <span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
    <span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
      <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
    <span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
    <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
      <span class="nt">&lt;inspire_common:Code&gt;</span>ARGI_UPP:PARENTMATERIAL<span class="nt">&lt;/inspire_common:Code&gt;</span>
    <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
    <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
      <span class="nt">&lt;inspire_common:Code&gt;</span>ARGI_UPP:REFIEFM<span class="nt">&lt;/inspire_common:Code&gt;</span>
    <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
    <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
      <span class="nt">&lt;inspire_common:Code&gt;</span>ARGI_UPP:LVBATHY<span class="nt">&lt;/inspire_common:Code&gt;</span>
    <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
    <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
      <span class="nt">&lt;inspire_common:Code&gt;</span>ARGI_UPP:POPN<span class="nt">&lt;/inspire_common:Code&gt;</span>
    <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
  <span class="nt">&lt;/inspire_dls:ExtendedCapabilities&gt;</span>
<span class="nt">&lt;/ows:ExtendedCapabilities&gt;</span>
</pre></div>
</div>
<p><strong>Note 1</strong> Although MapServer supports multi-lingual GetCapabilities responses we don’t discuss them here because the OneGeology profile mandates having separate services per language offered.</p>
<p><strong>Note 2</strong> You don’t have to set a namespace separately for the SpatialDataSetIdentifier, and can have multiple datasets identified (by providing a comma separated list).  If you want to specify code and namespace and have multiple multiple codes, your lists must be the same length.</p>
<p><strong>Note 3</strong> Since MapServer version 7.2, by default filling in a complete set of service and layer metadata will also give you a full ISO 19139 XML metadata record for your dataset, which is available through a GetMetadata request, and is automatically added to your service where the GetCapabilites response supports a dataset metadata URL.</p>
</div>
<div class="section" id="using-arcgis">
<h2>Using ArcGIS<a class="headerlink" href="#using-arcgis" title="Permalink to this headline">¶</a></h2>
<p>The following notes are based on ESRI ArcGIS server version 10.5 (SP1)</p>
<div class="section" id="id76">
<h3>WMS<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h3>
<div class="section" id="prepare-the-map-document">
<h4>Prepare the map document<a class="headerlink" href="#prepare-the-map-document" title="Permalink to this headline">¶</a></h4>
<p>Initial set up of WMS services is relatively straightforward and simply requires the creation of a map document (.mxd) containing the data you want to add to the service.</p>
<p>It is important to pay attention to the layer names in the map document, since the individual service layer names will use the map document layer names. The service will also use the map document layer names for the respective layer titles in the GetCapabilities document.</p>
<div class="figure align-default" id="id121">
<img alt="Using ArcMap layer names in the service" src="_images/image048.jpg" />
<p class="caption"><span class="caption-text">Figure 1 - Using ArcMap layer names in the service</span><a class="headerlink" href="#id121" title="Permalink to this image">¶</a></p>
</div>
<p>Eg. an unmodified GetCapabilities (version 1.3.0) response for the above example would look like:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Layer&gt;</span>
<span class="nt">&lt;Title&gt;</span>BGS_BEDROCK_GEOLOGY<span class="nt">&lt;/Title&gt;</span>
<span class="nt">&lt;CRS&gt;</span>CRS:84<span class="nt">&lt;/CRS&gt;</span>
<span class="nt">&lt;CRS&gt;</span>EPSG:4326<span class="nt">&lt;/CRS&gt;</span>
...
<span class="nt">&lt;Layer</span> <span class="na">queryable=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Name&gt;</span>GBR_BGS_625k_BA<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;Title&gt;</span>GBR_BGS_625k_BA<span class="nt">&lt;/Title&gt;</span>
    <span class="nt">&lt;Abstract&gt;&lt;/Abstract&gt;</span>
    <span class="nt">&lt;CRS&gt;</span>CRS:84<span class="nt">&lt;/CRS&gt;</span>
    <span class="nt">&lt;CRS&gt;</span>EPSG:4326<span class="nt">&lt;/CRS&gt;</span>
   ...
    <span class="nt">&lt;Style&gt;</span>
        <span class="nt">&lt;Name&gt;</span>default<span class="nt">&lt;/Name&gt;</span>
        <span class="nt">&lt;Title&gt;</span>GBR_BGS_625k_BA<span class="nt">&lt;/Title&gt;</span>
        <span class="nt">&lt;LegendURL</span> <span class="na">width=</span><span class="s">&quot;68&quot;</span> <span class="na">height=</span><span class="s">&quot;2048&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Format&gt;</span>image/png<span class="nt">&lt;/Format&gt;</span>
            <span class="nt">&lt;OnlineResource</span> <span class="na">xlink:href=</span><span class="s">&quot;...&quot;</span> <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/LegendURL&gt;</span>
    <span class="nt">&lt;/Style&gt;</span>
<span class="nt">&lt;/Layer&gt;</span>
<span class="nt">&lt;Layer</span> <span class="na">queryable=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Name&gt;</span>GBR_BGS_625k_BLT<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;Title&gt;</span>GBR_BGS_625k_BLT<span class="nt">&lt;/Title&gt;</span>
    <span class="nt">&lt;Abstract&gt;&lt;/Abstract&gt;</span>
...
</pre></div>
</div>
</div>
<div class="section" id="publishing-your-wms">
<h4>Publishing your WMS<a class="headerlink" href="#publishing-your-wms" title="Permalink to this headline">¶</a></h4>
<p>Once you are happy with the layer names, the easiest way to publish your WMS is doing it directly from the map document:</p>
<ul class="simple">
<li><p>Go to <em>File &gt; Share As &gt; Service…</em> to open the <em>Share as Service</em> dialog.</p></li>
<li><p>Select <em>Publish a service</em> and click <em>Next &gt;</em>.</p></li>
<li><p>On the <em>Publish a Service</em> dialog, choose/add a connection to your ArcGIS Server instance and write a name for your map service. The name you enter will be part of the WMS url, so you must ensure that meets the OneGeology profile naming conventions. Click <em>Next &gt;.</em></p></li>
<li><p>Select whether to <em>Use existing folder</em> or <em>Create new folder</em>. The folder name will also appear as part of the WMS url. Click <em>Continue</em>.</p></li>
<li><p>In the <em>Service Editor</em> dialog, go to <em>Capabilities</em> and select <em>WMS</em>. If you wish, you can unselect KML.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you <strong>do not</strong> want to expose the data behind your WMS service, make sure that the <strong>WFS</strong> option is <strong>unselected</strong>.</p>
</div>
<ul class="simple">
<li><p>Now go to <em>Capabilities &gt; WMS</em> to access the WMS properties</p></li>
</ul>
<div class="figure align-default" id="id122">
<img alt="Adding a new WMS service in ArcGIS" src="_images/image049.jpg" />
<p class="caption"><span class="caption-text">Figure 2 - Adding a new WMS service in ArcGIS</span><a class="headerlink" href="#id122" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>You will be presented with a form to edit your service level metadata (as above) or you may opt to use external capabilities. We suggest at this stage that you should use the form to fill in as much detail as possible, though you should note that you will eventually need to use external files to enter any layer level metadata and add missing service level metadata parameters; we can use the data you enter initially as the basis for these external static files.</p></li>
<li><p>You also need to tick the <em>Use layer names from the map document</em> option; otherwise, the layer names will be given numbers instead. Again, you will need to ensure that the ArcMap layer names follow the naming guidelines.</p></li>
<li><p>ArcGIS Server creates only one style named <em>default</em> for every layer, but allows you to do include additional styles for each layer using a SLD file. The default style matches the symbology set in the map document.</p></li>
<li><p>Once you finish configuring your WMS, click <em>Publish</em> on the top-right corner of the <em>Service Editor</em> dialog to create your service.</p></li>
</ul>
<p>Your new service will have a URL like below, with the folder name part being optional:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="p">[</span><span class="n">hostname</span><span class="p">]</span><span class="o">/</span><span class="n">ArcGIS</span><span class="o">/</span><span class="n">services</span><span class="o">/</span><span class="p">[</span><span class="n">folder</span> <span class="n">name</span><span class="p">]</span><span class="o">/</span><span class="p">[</span><span class="nb">map</span> <span class="n">service</span> <span class="n">title</span><span class="p">]</span><span class="o">/</span><span class="n">MapServer</span><span class="o">/</span><span class="n">WMSServer</span>
</pre></div>
</div>
</div>
<div class="section" id="edit-the-getcapabilities-documents">
<h4>Edit the GetCapabilities documents<a class="headerlink" href="#edit-the-getcapabilities-documents" title="Permalink to this headline">¶</a></h4>
<p>ArcGIS Server doesn’t create any static GetCapabilities xml documents, but does allow you to use external files. You will need to use such external files if you want to add any additional spatial reference systems, correct the keywords listing, change the LegendURL images, add better abstracts and layer titles, or add an INSPIRE extended capabilities section. We think to provide a fully compliant WMS it is highly likely that you will need to use a set of static files.</p>
<p>The first step to editing your files is to create them.</p>
<p>The quickest way to do this is to use the response documents from your initial service. You will need to have a file for all the WMS versions that you want your service to support. We require at least a version 1.3.0 document but you could also have a 1.1.1 response.</p>
<p>Your WMS version 1.1.1 GetCapabilities document is generated using a request like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://[hostname]/ArcGIS/services/[folder name]/[map service title]/MapServer/WMSServer?service=WMS&amp;request=GetCapabilities&amp;version=1.1.1&amp;
</pre></div>
</div>
<p><strong>Save this as [short service name]111.xml</strong></p>
<p>Your WMS version 1.3.0 GetCapabilities document is generated using a request like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://[hostname]/ArcGIS/services/[folder name]/[map service title]/MapServer/WMSServer?service=WMS&amp;request=GetCapabilities&amp;version=1.3.0&amp;
</pre></div>
</div>
<p><strong>Save this as [short service name]130.xml</strong></p>
<p>It doesn’t really matter what name you give these files, as long as you use the same name prefix for all files that belong to the same service.</p>
<p>You need to put these files on the server (or at a location available to your server), and make them browsable. These files only need to be browsable internally by the ArcGIS server.</p>
<p>Now go back to your map service and edit it using either <a class="reference external" href="http://server.arcgis.com/en/server/latest/publish-services/windows/editing-service-properties-in-manager.htm">ArcGIS Server Manager</a> or <a class="reference external" href="http://server.arcgis.com/en/server/latest/publish-services/windows/editing-service-properties-in-arcgis-for-desktop.htm">ArcMap</a>.</p>
<div class="figure align-default" id="id123">
<img alt="Setting up external capabilities files" src="_images/image050.jpg" />
<p class="caption"><span class="caption-text">Figure 3 - Setting up external capabilities files</span><a class="headerlink" href="#id123" title="Permalink to this image">¶</a></p>
</div>
<p>Select <em>WMS</em>, then select the <em>Use External capabilities files</em> option and in the <em>Specify the location and prefix</em> dialog add the web address to the folder containing the capabilities response documents plus your <em>[short service name]</em> prefix.</p>
<p>For example, for a service called BGS_BEDROCK_GEOLOGY, we may save our initial GetCapabilities response documents using a prefix “BEDROCK-“, giving us a file called BEDROCK-130.xml for our version 1.3.0 GetCapabilities response document, BEDROCK-111.xml for our version 1.1.1 GetCapabilities response document. We might then save these to a location on our web server such as <em>C:InetpubwwwrootGetCapabilitiesFiles,</em> which would be browsable locally as <em>http://localhost/GetCapabilitiesFiles/</em>.  When we select the “Use External capabilities files” option, we then provide the web address and <strong>prefix</strong> as <em>http://localhost/GetCapabilitiesFiles/BEDROCK-</em></p>
<p>Having created your files, you may then edit them as required. We would recommend you make a second copy of the files in case you make an error whilst editing.</p>
</div>
<div class="section" id="inspire">
<h4>INSPIRE<a class="headerlink" href="#inspire" title="Permalink to this headline">¶</a></h4>
<p>If you want your OneGeology service to comply to INSPIRE standards, in addition to meet the requirements of the OneGeology profile, you need to ensure that the following conditions are fulfilled:</p>
<ol class="arabic simple">
<li><p>Layer name and layer title must follow INSPIRE naming conventions. For example the <a class="reference external" href="http://inspire.ec.europa.eu/documents/Data_Specifications/INSPIRE_DataSpecification_GE_v3.0.pdf">D2.8.II.4 Data Specification on Geology–Technical Guidelines</a> tell us (section 11.1 ~ Layers to be provided by INSPIRE view services) that any layer to do with lithology or age must have the name <em>GE.GeologicUnit</em> and title <em>Geologic Units</em>. See the <a class="reference external" href="https://themes.jrc.ec.europa.eu/discussion/view/13952/layer-naming">layer-naming</a> discussion on the INSPIRE Thematic Clusters Geology forum for fuller details.</p></li>
<li><p>Layers must support at least one of the INSPIRE coordinate systems. See <a class="reference external" href="http://inspire.ec.europa.eu/documents/Data_Specifications/INSPIRE_Specification_CRS_v3.0.pdf">D2.8.I.1 INSPIRE Specification on Coordinate Reference Systems - Guidelines</a>.</p></li>
<li><p>Your GetCapabilities document must include the INSPIRE Extended Capabilities tag.</p></li>
</ol>
<p>There are two ways of achieving these conditions using ESRI software. The first one is using a standard ArcGIS map document and standard ArcGIS Server tools, where you’ll need to modify layer names to make them compliant, change service properties to include required coordinate systems and modify the get capabilities document to include the INSPIRE Extended Capabilities section. The second option is using the ArcGIS for INSPIRE extension, which provides tools and new services to ensure compliance with INSPIRE directives. If you want to go for the second option, there is an <a class="reference external" href="http://www.onegeology.org/technical_progress/esriGrantOffer.html">ESRI OneGeology Grant</a> for OneGeology members.</p>
</div>
</div>
<div class="section" id="arcgis-server">
<h3>ArcGIS Server<a class="headerlink" href="#arcgis-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="inspire-layer-names">
<h4>INSPIRE Layer Names<a class="headerlink" href="#inspire-layer-names" title="Permalink to this headline">¶</a></h4>
<p>In order to make your service INSPIRE compliant, you will need to configure the name of your layers (e.g. GE.GeologicUnit); however, this clashes with OneGeology naming standards. In this situation, it is desirable to create a group layer. For example, you may want to create a layer called GE.GeologicUnit to group all of your layers that are spatial objects of type GeologicUnit. The layer name and title rules set out in the OneGeology profile relate to the grouped (or child) layers, whereas the INSPIRE name and title relate to the group (or parent) layer.</p>
<p>If your INSPIRE service is only serving layers of one type, one way of applying group layering would be to use the root layer name and title (not service name and title) as the grouping layer. If, on the other hand, your INSPIRE service is serving layers of several types (e.g. GE.GeologicUnit and GE.GeologicFault), we believe the only option is for you to configure actual group layering.</p>
<p>To <strong>add group layers to a new service</strong> simply <a class="reference external" href="http://desktop.arcgis.com/en/arcmap/latest/map/working-with-layers/working-with-group-layers.htm#GUID-058900C7-6A45-4260-83D8-9039C00D875C">add a group layer</a> to the map document that will create your service, rename it and place your layers inside. The WMS service published form this map document will keep the same group layer structure.</p>
<div class="figure align-default" id="id124">
<img alt="Adding group layers to the service" src="_images/image051.jpg" />
<p class="caption"><span class="caption-text">Figure 4 - Adding group layers to the service</span><a class="headerlink" href="#id124" title="Permalink to this image">¶</a></p>
</div>
<p>If you want <strong>add group layers to an existing service</strong>, open the map document that created the service, modify it as described above and publish it again as a WMS service; however, when publishing the service, make sure that you select the option “Overwrite an existing service”. This will save you having to delete the original service as well as having to type again all service properties.</p>
<p>Note that ArcGIS Server will generate only the <em>&lt;Title&gt;</em> tag of group layers in the GetCapabilities document. The content of this tag will be the same that you wrote in the map document. In order to comply with INSPIRE layer naming regulations for group layers, you will need to manually add the <em>&lt;Name&gt;</em> tag, filling it in with the adequate group layer name, by editing the GetCapabilities document using an external capabilities file.</p>
<p>Group layers created in ArcGIS Server will not have a style associated to them and the group layer itself will not display a map.</p>
</div>
<div class="section" id="inspire-coordinate-systems">
<h4>INSPIRE Coordinate Systems<a class="headerlink" href="#inspire-coordinate-systems" title="Permalink to this headline">¶</a></h4>
<p>ArcGIS Server always adds 2 coordinate systems: EPSG:4326 (or CRS:84 for version 1.3.0) and the coordinate system set on the map document creating the service. To add any additional coordinate systems go to your map service and edit it using either <a class="reference external" href="http://server.arcgis.com/en/server/latest/publish-services/windows/editing-service-properties-in-manager.htm">ArcGIS Server Manager</a> or <a class="reference external" href="http://server.arcgis.com/en/server/latest/publish-services/windows/editing-service-properties-in-arcgis-for-desktop.htm">ArcMap</a>.  On the <em>Service Editor</em> dialog go to <em>Capabilities &gt; WMS</em> and, in the <em>Additional spatial reference systems</em> text box, type any well-known EPSG ID in the format indicated below.</p>
<div class="figure align-default" id="id125">
<img alt="Additional spatial reference systems option" src="_images/esriimage009.png" />
<p class="caption"><span class="caption-text">Figure 5 - Additional spatial reference systems option</span><a class="headerlink" href="#id125" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="id81">
<h4>INSPIRE extended capabilities<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h4>
<p>The extended capabilites section is inserted into your external GetCapabilities section, between the Exception element block and the first Layer element.</p>
<p>For example to add a scenario 1 INSPIRE extended capabilities section (where you have an external XML document or service that provides such an XML document containing metadata for your WMS service) you would insert a section like below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;/Exception&gt;</span>
<span class="nt">&lt;inspire_vs:ExtendedCapabilities</span> <span class="na">xmlns:inspire_vs=</span><span class="s">&quot;http://inspire.ec.europa.eu/schemas/inspire_vs/1.0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;inspire_common:MetadataUrl</span> <span class="na">xsi:type=</span><span class="s">&quot;inspire_common:resourceLocatorType&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;inspire_common:URL&gt;</span>http://metadata.bgs.ac.uk/geonetwork/srv/en/csw?SERVICE=CSW
        <span class="ni">&amp;amp;</span>REQUEST=GetRecordById<span class="ni">&amp;amp;</span>ID=7822e848-822d-45a5-8584-56d352fd2170<span class="ni">&amp;amp;</span>elementSetName=full<span class="ni">&amp;amp;</span>OutputSchema=csw:IsoRecord<span class="ni">&amp;amp;</span>
        <span class="nt">&lt;/inspire_common:URL&gt;</span>
        <span class="nt">&lt;inspire_common:MediaType&gt;</span>application/xml<span class="nt">&lt;/inspire_common:MediaType&gt;</span>
    <span class="nt">&lt;/inspire_common:MetadataUrl&gt;</span>
    <span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
        <span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
            <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
        <span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
    <span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
    <span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
        <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
    <span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
<span class="nt">&lt;/inspire_vs:ExtendedCapabilities&gt;</span>
<span class="nt">&lt;Layer&gt;</span>
</pre></div>
</div>
<p>Alternatively, to add a scenario 2 INSPIRE extended capabilities section (where you have no external metadata document for your WMS service) you would insert a section like below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;/Exception&gt;</span>
<span class="nt">&lt;inspire_vs:ExtendedCapabilities</span> <span class="na">xmlns:inspire_vs=</span><span class="s">&quot;http://inspire.ec.europa.eu/schemas/inspire_vs/1.0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;inspire_common:ResourceLocator&gt;</span>
        <span class="nt">&lt;inspire_common:URL&gt;</span>http://ogc2.bgs.ac.uk/cgi-bin/BGS_OGE_Bedrock_and_Surface_Geology_in3/ows?<span class="nt">&lt;/inspire_common:URL&gt;</span>
    <span class="nt">&lt;/inspire_common:ResourceLocator&gt;</span>
    <span class="nt">&lt;inspire_common:ResourceType&gt;</span>service<span class="nt">&lt;/inspire_common:ResourceType&gt;</span>
    <span class="nt">&lt;inspire_common:TemporalReference&gt;</span>
        <span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2015-10-23<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
    <span class="nt">&lt;/inspire_common:TemporalReference&gt;</span>
    <span class="nt">&lt;inspire_common:Conformity&gt;</span>
        <span class="nt">&lt;inspire_common:Specification&gt;</span>
            <span class="nt">&lt;inspire_common:Title&gt;</span>-<span class="nt">&lt;/inspire_common:Title&gt;</span>
            <span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2015-10-23<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
        <span class="nt">&lt;/inspire_common:Specification&gt;</span>
        <span class="nt">&lt;inspire_common:Degree&gt;</span>notEvaluated<span class="nt">&lt;/inspire_common:Degree&gt;</span>
    <span class="nt">&lt;/inspire_common:Conformity&gt;</span>
    <span class="nt">&lt;inspire_common:MetadataPointOfContact&gt;</span>
        <span class="nt">&lt;inspire_common:OrganisationName&gt;</span>Mr Matthew Harrison<span class="nt">&lt;/inspire_common:OrganisationName&gt;</span>
        <span class="nt">&lt;inspire_common:EmailAddress&gt;</span>enqiries@bgs.ac.uk<span class="nt">&lt;/inspire_common:EmailAddress&gt;</span>
    <span class="nt">&lt;/inspire_common:MetadataPointOfContact&gt;</span>
    <span class="nt">&lt;inspire_common:MetadataDate&gt;</span>2015-10-23<span class="nt">&lt;/inspire_common:MetadataDate&gt;</span>
    <span class="nt">&lt;inspire_common:SpatialDataServiceType&gt;</span>view<span class="nt">&lt;/inspire_common:SpatialDataServiceType&gt;</span>
    <span class="nt">&lt;inspire_common:MandatoryKeyword</span> <span class="na">xsi:type=</span><span class="s">&#39;inspire_common:classificationOfSpatialDataService&#39;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;inspire_common:KeywordValue&gt;</span>infoMapAccessService<span class="nt">&lt;/inspire_common:KeywordValue&gt;</span>
    <span class="nt">&lt;/inspire_common:MandatoryKeyword&gt;</span>
    <span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
        <span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
            <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
        <span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
    <span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
    <span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
        <span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
    <span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
<span class="nt">&lt;/inspire_vs:ExtendedCapabilities&gt;</span>
<span class="nt">&lt;Layer&gt;</span>
</pre></div>
</div>
<p>In addition (for both scenarios) you will need to <strong>reference the inspire_common schema and namespace</strong> in your root element, so it will become something like:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;WMS_Capabilities</span>
    <span class="na">xmlns:inspire_common=</span><span class="s">&quot;http://inspire.ec.europa.eu/schemas/common/1.0&quot;</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://www.opengis.net/wms&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:esri_wms=</span><span class="s">&quot;http://www.esri.com/wms&quot;</span>
    <span class="na">version=</span><span class="s">&quot;1.3.0&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/wms http://schemas.opengis.net/wms/1.3.0/capabilities_1_3_0.xsd</span>
<span class="s">    http://inspire.ec.europa.eu/schemas/inspire_vs/1.0 http://inspire.ec.europa.eu/schemas/inspire_vs/1.0/inspire_vs.xsd</span>
<span class="s">    http://www.esri.com/wms http://../arcgis/services/.../MapServer/WmsServer?version=1.3.0%26service=WMS%26request=GetSchemaExtension&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="inspire-extension">
<h4>INSPIRE Extension<a class="headerlink" href="#inspire-extension" title="Permalink to this headline">¶</a></h4>
<p>The ArcGIS for INSPIRE extension allows to create an INSPIRE compliant WMS through a new ESRI map service, specific to this extension, called INSPIRE View service. In our experience, creating a INSPIRE compliant WMS service using custom INSPIRE extension tools is more difficult than using standard ArcGIS tools, due to the complexity of the datasets that you have to use, the scarce amount of documentation and the limited ESRI support for the extension.</p>
</div>
<div class="section" id="create-inspire-geodatabase">
<h4>Create INSPIRE geodatabase<a class="headerlink" href="#create-inspire-geodatabase" title="Permalink to this headline">¶</a></h4>
<p>The first step to use ArcGIS for INSPIRE is creating a geodatabase with one of the templates supplied by the extension.  To create a geodatabase for Geology follow the steps in <a class="reference external" href="http://enterprise.arcgis.com/en/inspire/10.5/get-started/pdf/InstallationGuide_ArcGISForINSPIRE_GDB_10_5_EN.pdf">this document</a> in sections 3.3.1 and 3.3.4.</p>
</div>
<div class="section" id="populate-inspire-geodatabase">
<h4>Populate INSPIRE geodatabase<a class="headerlink" href="#populate-inspire-geodatabase" title="Permalink to this headline">¶</a></h4>
<p>Fill in the geodatabase with your data. There are multiple feature classes and tables; fill in the ones that are relevant to you.</p>
<p>Note that all feature classes will be grouped on a feature dataset called <em>GE</em>. You’ll need to add your features to the appropriate feature class so that they can be used by the INSPIRE extension. Feel free to add new fields to these feature classes if you want to show attributes not available by default on the template; however, refrain from deleting any existing field as you might break one of the multiple relationships set on the template.</p>
</div>
<div class="section" id="customise-layers-in-inspire-geodatabase">
<h4>Customise layers in INSPIRE geodatabase<a class="headerlink" href="#customise-layers-in-inspire-geodatabase" title="Permalink to this headline">¶</a></h4>
<p>You’ll do this by modifying the <em>LayerInfo</em> table. In this extension, each INSPIRE layer consists normally of four hidden sublayers.  We need to modify the <em>LayerInfo</em> table to make the relevant sublayers visible and to be able to change the name and title of the sublayers (<a class="reference external" href="http://enterprise.arcgis.com/en/inspire/10.5/get-started/pdf/CustomizationGuide_ArcGISForINSPIRE_LayerInfo_10_5_EN.pdf">see Customization Guide</a>). The INSPIRE layer will act as a group layer and will follow INSPIRE naming conventions. The sublayers will follow OneGeology naming conventions. In the following example, we are going to configure two sublayers to represent bedrock units symbolised by age and by lithology. These layers are going to be looking at the same feature class in the geodabase template, defined in the FC_NAME field as <em>geUnitS</em> (short for geology unit surface). Given that in this example we are dealing only with geologic features represented as polygons, the final <em>LayerInfo</em> table could look like this (table transposed for visibility reasons):</p>
<table border=1 cellspacing=0 cellpadding=0 width=0 style='width:375.65pt;border-collapse:collapse;border:none'>
 <tr style='height:15.0pt;color:white;'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;background: black;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt;color:white;'>
  <p align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>FIELD NAME
  </td>
  <td width=116 style='vertical-align:center;width:99.2pt;border:solid windowtext 1.0pt;border-left: none;background:black;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt;color:white;'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>ROW 1
  </td>
  <td width=123 style='width:99.25pt;border:solid windowtext 1.0pt;border-left: none;background:black;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt;color:white;'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>ROW 2
  </td>
  <td width=136 style='width:4.0cm;border:solid windowtext 1.0pt;border-left: none;background:black;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt;color:white;'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>ROW 3
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>OBJECTID
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>2
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>4
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>12
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>ID
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>417
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>420
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>421
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>THEME
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geology
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geology
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geology
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>FC_NAME
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>-
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>geUnitS
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>geUnitS
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>STYPE
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>-1
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>-1
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>-1
  </td>
 </tr>
 <tr style='height:15.75pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.75pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>APP_SCHEMA
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.75pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geology
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.75pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geology
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.75pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geology
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>IR_VERSION
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>0
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>0
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>
  </td>
 </tr>
 <tr style='height:30.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:30.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>LAYER_NAME
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:30.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>GE.GeologicUnit
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:30.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>GBR_BGS_625k_BA
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:30.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>GBR_BGS_625k_BLT
  </td>
 </tr>
 <tr style='height:23.9pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:23.9pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>LAYER_TITLE
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:23.9pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geologic Units
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:23.9pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>GBR BGS 1:625k Bedrock Age
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:23.9pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>GBR BGS 1:625k Bedrock Lithology
  </td>
 </tr>
 <tr style='height:21.8pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:21.8pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>SPATIAL_OBJECT_TYPE
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:21.8pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>-
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:21.8pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>MappedFeature
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:21.8pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>MappedFeature
  </td>
 </tr>
 <tr style='height:13.7pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:13.7pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>DEF_QUERY
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:13.7pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>-
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:13.7pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>-
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:13.7pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>-
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>PARENT_ID
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>-1
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>417
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>417
  </td>
 </tr>
 <tr style='height:22.55pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:22.55pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>SPATIAL_OBJECT_
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>TYPE_PREFIX
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:22.55pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>ge
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:22.55pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>ge
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:22.55pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>ge
  </td>
 </tr>
 <tr style='height:27.8pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:27.8pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>LAYER_KEYWORDS
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:27.8pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geology, Lithology, Age, Geologic unit
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:27.8pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geology, Lithology, Age, Geologic unit
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:27.8pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>Geology, Lithology, Age, Geologic unit
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>IS_HIDDEN
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>0
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>0
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>0
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>IS_VISIBLE
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>1
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>1
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>1
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>MIN_SCALE
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'></td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'></td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>
  </td>
 </tr>
 <tr style='height:15.0pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>MAX_SCALE
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'></td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:15.0pt'></td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:15.0pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>
  </td>
 </tr>
 <tr style='height:13.55pt'>
  <td width=126 style='width:63.8pt;border:solid windowtext 1.0pt;border-top: none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt;height:13.55pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>GDBTEMPLATE_NAME
  </td>
  <td width=116 style='width:99.2pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:13.55pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>GE
  </td>
  <td width=123 style='width:99.25pt;border-top:none;border-left:none; border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; padding:0cm 5.4pt 0cm 5.4pt;height:13.55pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>GE
  </td>
  <td width=136 style='width:4.0cm;border-top:none;border-left:none;border-bottom: solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt; height:13.55pt'>
  <p  align=center style='margin-bottom:0cm;margin-bottom:.0001pt; text-align:center;line-height:normal'>GE
  </td>
 </tr>
</table><p>Table 1 Custom <em>Layer Info</em> table</p>
<ul class="simple">
<li><p>Rows with ID = 417 and ID = 420 were kept; the remaining rows were deleted. In addition, a new row with ID = 421 was added. Note that you don’t need to delete any row, this was done purely to create a simpler example.</p></li>
<li><p>As specified in the PARENT_ID field, row ID 417 is the group layer, whereas rows 420 and 421 are its sublayers.</p></li>
<li><p>The group layer doesn’t point to any feature class. Both child layers point at the same feature class (geUnitS), since we want the same dataset with different symbology (this can be set once layers are loaded on the map document).</p></li>
<li><p>Group layer name and title must conform to INSPIRE standards.  Child layer titles must conform to OneGeology standards (ideally layer names too, but the GetCapabilities document created with the ArcGIS for INSPIRE extension doesn’t honour the layer names defined on the <em>LayerInfo</em> table if more than one layer is pointing at the same feature class).</p></li>
<li><p>Child layers must have a value of <em>0</em> in the IS_HIDDEN field so that they are visible on the INSPIRE VIEW service.</p></li>
</ul>
</div>
<div class="section" id="add-inspire-layers-to-your-map-document">
<h4>Add INSPIRE layers to your map document<a class="headerlink" href="#add-inspire-layers-to-your-map-document" title="Permalink to this headline">¶</a></h4>
<p>Open a map document and add your layers to the map using the <em>Add INSPIRE Layer</em> button (if you can’t see this button, make sure that you have the <em>INSPIRE Tools</em> toolbar enabled).</p>
<div class="figure align-default" id="id126">
<img alt="Add INSPIRE Tools to map document" src="_images/image052.jpg" />
<p class="caption"><span class="caption-text">Figure 6 - Add INSPIRE Tools to map document</span><a class="headerlink" href="#id126" title="Permalink to this image">¶</a></p>
</div>
<p>This will open <em>INSPIRE Layer Wizard</em> where you can first select your INSPIRE database and second select the INSPIRE layers you wish to add. Note that this dialog will reflect changes done in the <em>LayerInfo</em> table therefore your custom layers should now be available. See <a class="reference external" href="http://server.arcgis.com/en/inspire/latest/inspire-services/create-inspire-view-service-map-document.htm">Create the INSPIRE View Service map document.</a></p>
<div class="figure align-default" id="id127">
<img alt="INSPIRE Layer wizard" src="_images/image053.jpg" />
<p class="caption"><span class="caption-text">Figure 7 - INSPIRE Layer wizard</span><a class="headerlink" href="#id127" title="Permalink to this image">¶</a></p>
</div>
<p>Click <em>Create</em>, and your selected layers will be added to the map document. The <em>LayerInfo</em> table specifies the hierarchical structure of the layers in the service as well as their names and titles, so we don’t need to (and shouldn’t) modify the layer names in the map document.</p>
<div class="figure align-default" id="id128">
<img alt="INSPIRE layers on map document" src="_images/image054.jpg" />
<p class="caption"><span class="caption-text">Figure 8 - INSPIRE layers on map document</span><a class="headerlink" href="#id128" title="Permalink to this image">¶</a></p>
</div>
<p>Note that, as well as the layers shown on the map, a few tables have also been added to the map document. These tables are required for the creation of the INSPIRE service therefore they shouldn’t be removed.</p>
<div class="figure align-default" id="id129">
<img alt="Additional INSPIRE related tables added to map document" src="_images/image055.jpg" />
<p class="caption"><span class="caption-text">Figure 9 - Additional INSPIRE related tables added to map document</span><a class="headerlink" href="#id129" title="Permalink to this image">¶</a></p>
</div>
<p>Now you can proceed to style your layers using the appropriate symbology. The symbology set on the map document will be defined within the GetCapabilities document as a style named <em>default</em>. In addition, each layer will have another style called <em>inspire_common:DEFAULT</em>, which is meant to assign by default a common style to INSPIRE layers; however, in ArcGIS server version 10.5, this default visualization style only supports Annex I INSPIRE layers.</p>
<div class="figure align-default" id="id130">
<img alt="INSPIRE layer styles" src="_images/image056.jpg" />
<p class="caption"><span class="caption-text">Figure 10 - Each INSPIRE layer will have 2 styles: <em>inspire_common:DEFAULT</em> and <em>default</em></span><a class="headerlink" href="#id130" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id131">
<img alt="The symbology set in the map document will correspond to the &quot;default&quot; style" src="_images/image057.jpg" />
<p class="caption"><span class="caption-text">Figure 11 - The symbology set in the map document will correspond to the <em>default</em> style</span><a class="headerlink" href="#id131" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="publish-inspire-view-service">
<h4>Publish INSPIRE View service<a class="headerlink" href="#publish-inspire-view-service" title="Permalink to this headline">¶</a></h4>
<p>A INSPIRE View service is the ESRI equivalent of a INSPIRE compliant WMS. Publishing a INSPIRE View service is very similar to publishing a WMS, the only difference being that you need to select and configure one additional capability.</p>
<ul class="simple">
<li><p>Go to <em>File &gt; Share As &gt; Service…</em> to open the <em>Share as Service</em> dialog.</p></li>
<li><p>Select <em>Publish a service</em> and click <em>Next &gt;</em>.</p></li>
<li><p>On the <em>Publish a Service</em> dialog, choose/add a connection to your ArcGIS Server instance and write a name for your map service. The name you enter will be part of the WMS url, so you must ensure that meets the OneGeology profile naming conventions.</p></li>
<li><p>Select whether to <em>Use existing folder</em> or <em>Create new folder</em>. The folder name will also appear as part of the WMS url. Click <em>Continue</em>.</p></li>
<li><p>In the <em>Service Editor</em> dialog, go to <em>Capabilities</em>. You’ll notice that the ArcGIS for INSPIRE extension has added three new capabilities. Select <em>WMS</em> and <em>ArcGIS for INSPIRE View Service</em>. Note that in order for the INSPIRE View service to work, the WMS capability must be enabled.</p></li>
</ul>
<div class="figure align-default" id="id132">
<img alt="Capabilities option in Service Editor dialog" src="_images/image058.jpg" />
<p class="caption"><span class="caption-text">Figure 12 - <em>Capabilities</em> option in <em>Service Editor</em> dialog</span><a class="headerlink" href="#id132" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>Now go to <em>Capabilities &gt; ArcGIS for INSPIRE View Service</em> to access the INSPIRE View Service properties</p></li>
</ul>
<div class="figure align-default" id="id133">
<img alt="ArcGIS for INSPIRE View Service properties in Service Editor dialog" src="_images/image059.jpg" />
<p class="caption"><span class="caption-text">Figure 13 - <em>ArcGIS for INSPIRE View Service</em> properties in <em>Service Editor</em> dialog</span><a class="headerlink" href="#id133" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>The properties of the above dialog can be left as they are, unless you want to modify the supported languages. Also, make sure that if you checked the <em>Use layer names from the map document</em> option in the WMS capabilities, you also check the <em>WMS uses layernames from map document</em> option in the ArcGIS for INSPIRE View Service capabilities. This won’t affect your INSPIRE View Service, only the WMS service that is being created in parallel.</p></li>
<li><p>Click <em>Publish</em> on the top-right corner of the <em>Service Editor</em> dialog to create your service. We’ll deal with Advance Properties after the service has been published because the properties for INSPIRE layers will be available then.</p></li>
</ul>
<p>For more information go to <a class="reference external" href="http://server.arcgis.com/en/inspire/latest/inspire-services/create-the-inspire-view-service.htm">Create an INSPIRE View Service</a>.</p>
</div>
<div class="section" id="configure-inspire-view-service">
<h4>Configure INSPIRE View service<a class="headerlink" href="#configure-inspire-view-service" title="Permalink to this headline">¶</a></h4>
<p>Once the service has been published, we are going to use ArcCatalog to configure INSPIRE View service properties which will be reflected on the service’s GetCapabilities document.</p>
<ul class="simple">
<li><p>On ArcCatalog, go to the <em>GIS Servers</em> folder, select the appropriate instance of ArcGIS Server and navigate to your service.</p></li>
<li><p>Right-click on the service and go to <em>Service Properties…</em></p></li>
</ul>
<div class="figure align-default" id="id134">
<img alt="Accessing Service Properties" src="_images/image060.jpg" />
<p class="caption"><span class="caption-text">Figure 14 - Accessing <em>Service Properties</em></span><a class="headerlink" href="#id134" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>On the Service Editor go to <em>Capablities &gt; ArcGIS for INSPIRE View Service</em> (see figure 13) and click <em>Advanced Properties</em> to open the <em>Editing the InspireView properties</em> dialog.</p></li>
</ul>
<p>The <em>Editing the InspireView properties</em> dialog allows you to set the options below. Fields in yellow are compulsory and, depending on the options you choose, there might be disabled fields in grey. We recommend you fill in as many fields as you can.</p>
<ul class="simple">
<li><p>Select INSPIRE external capabilities scenario</p></li>
</ul>
<div class="figure align-default" id="id135">
<img alt="Inspire View properties: extended capabilities type" src="_images/image061.jpg" />
<p class="caption"><span class="caption-text">Figure 15 - Inspire View properties: extended capabilities type</span><a class="headerlink" href="#id135" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>Service properties. Do not modify <em>Online resource</em> on this dialog, as it will change the value of the property <em>xlink:href</em> in all <em>OnlineResource</em> tags in the get capabilities document. You’ll need create a custom GetCapabilities document if you want to change the tag <em>/WMS_Capabilities/Service/OnlineResource</em> to provide a link to the data owner organization web site, or web site with information about the data owner organization, as requested in the OneGeology profile.</p></li>
</ul>
<div class="figure align-default" id="id136">
<img alt="Inspire View properties: service information" src="_images/image062.jpg" />
<p class="caption"><span class="caption-text">Figure 16 - Inspire View properties: service information</span><a class="headerlink" href="#id136" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>Contact information</p></li>
</ul>
<div class="figure align-default" id="id137">
<img alt="Inspire View properties: contact information" src="_images/image063.jpg" />
<p class="caption"><span class="caption-text">Figure 17 - Inspire View properties: contact information</span><a class="headerlink" href="#id137" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>GEMET Keywords</p></li>
</ul>
<div class="figure align-default" id="id138">
<img alt="Inspire View properties: GEMET Keywords" src="_images/image064.jpg" />
<p class="caption"><span class="caption-text">Figure 18 - Inspire View properties: GEMET Keywords</span><a class="headerlink" href="#id138" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>Layer properties. Note the highlighted sublayer names. One of them doesn’t honour the name defined in the <em>LayerInfo</em> table, taking the name of the other sublayer and adding “1” at the end of it. This seems to be a bug within the INSPIRE extension. Since OneGeology naming conventions for layer names are only a recommendation, the service will still comply with the OneGeology profile.</p></li>
</ul>
<div class="figure align-default" id="id139">
<img alt="Inspire View properties: Layers informatio" src="_images/image065.jpg" />
<p class="caption"><span class="caption-text">Figure 19 - Inspire View properties: Layers information</span><a class="headerlink" href="#id139" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="custom-inspire-view-service-getcapabilities-document">
<h4>Custom INSPIRE View service GetCapabilities document<a class="headerlink" href="#custom-inspire-view-service-getcapabilities-document" title="Permalink to this headline">¶</a></h4>
<p>If you need to modify any option that’s not on the <em>Editing the InspireView properties</em> dialog, like the Online Resource tag mentioned above, you need to go to the service cached capabilities folder (<em>C:arcgisserverdirectoriesarcgisforinspire[folder_name][map service title]_MapServer[folder_name]_ [map service title]_MapServer_inspireview</em>) and create a file called <em>GetCapabilities&lt;version&gt;_&lt;3 letter language code&gt;.xml</em>. Your service will now use the custom GetCapabilities file instead of the dynamically created one (e.g. <em>GetCapabilities130_ENG.xml</em>), also stored in the same location. When creating your custom file it’s recommended to start from a copy of the dynamically created file.</p>
</div>
<div class="section" id="use-inspire-view-service">
<h4>Use INSPIRE View service<a class="headerlink" href="#use-inspire-view-service" title="Permalink to this headline">¶</a></h4>
<p>Your service will be accessible from the following endpoint:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="p">[</span><span class="n">hostname</span><span class="p">]</span><span class="o">/</span><span class="n">ArcGIS</span><span class="o">/</span><span class="n">services</span><span class="o">/</span><span class="p">[</span><span class="n">folder_name</span><span class="p">]</span><span class="o">/</span><span class="p">[</span><span class="nb">map</span> <span class="n">service</span> <span class="n">title</span><span class="p">]</span><span class="o">/</span><span class="n">exts</span><span class="o">/</span><span class="n">InspireView</span><span class="o">/</span><span class="n">service</span>
</pre></div>
</div>
<p>For more information see <a class="reference external" href="http://server.arcgis.com/en/inspire/latest/inspire-services/use-the-inspire-view-service.htm">Use an INSPIRE View service</a>.</p>
</div>
</div>
<div class="section" id="arcgis-server-issues">
<h3>ArcGIS server issues<a class="headerlink" href="#arcgis-server-issues" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>When using the SLD parameter to get an external SLD file, ArcGIS 10.0 expects the layer name and styles parameter to be to be sent as part of a GetMap request, even though this is not required by the WMS+SLD specification. A bug has been raised with ESRI on this issue (<a class="reference external" href="http://support.esri.com/en/bugs/nimbus/TklNMDk1NTY4">NIM095568</a>) back in version 10.0, but it’s still present.</p></li>
</ul>
</div>
<div class="section" id="id84">
<h3>Simple Feature WFS<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h3>
<p>Creating a simple feature WFS requires almost the same steps as creating a WMS. The only difference being that, when publishing the service, you need to select the WFS capability.</p>
<div class="figure align-default" id="id140">
<img alt="Enabling WFS capabilities in Service Editor dialog" src="_images/image066.jpg" />
<p class="caption"><span class="caption-text">Figure 20 - Enabling WFS capabilities in <em>Service Editor</em> dialog</span><a class="headerlink" href="#id140" title="Permalink to this image">¶</a></p>
</div>
<p>After activating WFS, you’ll have access to the properties of this capability. Some of these properties will coincide with WMS properties, but there will also be WFS specific properties, such us namespace, prefix or maximum number of features returned.</p>
<div class="figure align-default" id="id141">
<img alt="WFS service properties" src="_images/image067.jpg" />
<p class="caption"><span class="caption-text">Figure 21 - WFS service properties</span><a class="headerlink" href="#id141" title="Permalink to this image">¶</a></p>
</div>
<p>For more information on how to create a simple feature WFS service and how to edit its GetCapabilities document, go to the WMS section of this cookbook or to ESRI’s documentation about <a class="reference external" href="http://server.arcgis.com/en/server/latest/publish-services/windows/wfs-services.htm">WFS services</a>.</p>
</div>
<div class="section" id="id86">
<h3>WCS<a class="headerlink" href="#id86" title="Permalink to this headline">¶</a></h3>
<div class="section" id="create-a-map-document">
<h4>Create a map document<a class="headerlink" href="#create-a-map-document" title="Permalink to this headline">¶</a></h4>
<p>In ArcGIS, a WCS can be created mainly through 3 routes: a map document with raster data, a raster dataset or a mosaic dataset. Publishing a mosaic dataset requires ArcGIS Image Server, so unless you have this extension enabled, the only way to publish multiple rasters at once on a single WCS will be through a map document; therefore we’re are going to focus on this route. For more information see <a class="reference external" href="http://server.arcgis.com/en/server/latest/publish-services/windows/wcs-services.htm">WCS services</a>.</p>
<p>Start by creating a map document and adding your rasters to it. Note that, if you have feature data in your map document, it’ll be excluded from your WCS.</p>
<div class="figure align-default" id="id142">
<img alt="Adding WCS data to your map document" src="_images/image068.jpg" />
<p class="caption"><span class="caption-text">Figure 22 - Adding WCS data to your map document</span><a class="headerlink" href="#id142" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="publish-the-wcs-service">
<h4>Publish the WCS service<a class="headerlink" href="#publish-the-wcs-service" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Go to <em>File &gt; Share As &gt; Service… *to open the *Share as Service</em> dialog.</p></li>
<li><p>Select <em>Publish a service</em> and click <em>Next &gt;</em>.</p></li>
<li><p>On the <em>Publish a Service</em> dialog, choose/add a connection to your ArcGIS Server instance and write a name for your map service. The name you enter will be part of the WCS url. Click <em>Next &gt;.</em></p></li>
<li><p>Select whether to <em>Use existing folder</em> or <em>Create new folder</em>. The folder name will also appear as part of the WCS url. Click <em>Continue</em>.</p></li>
<li><p>In the <em>Service Editor</em> dialog, go to <em>Capabilities</em> and select <em>WCS</em>.</p></li>
<li><p>Now go to <em>Capabilities &gt; WCS</em> to access the WCS properties</p></li>
</ul>
<div class="figure align-default" id="id143">
<img alt="WCS service properties" src="_images/image069.jpg" />
<p class="caption"><span class="caption-text">Figure 23 - WCS service properties</span><a class="headerlink" href="#id143" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>Fill in all relevant service-level and contact properties.</p></li>
<li><p>Check <em>Use layer names from the map document</em> so that layer names/identifiers use the layer names given in the map document rather than numbers.</p></li>
<li><p>Click <em>Publish</em> on the top-right corner of the <em>Service Editor</em> dialog to create your service.</p></li>
</ul>
<p>Your new service will have a URL like below, with the folder name part being optional:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="p">[</span><span class="n">hostname</span><span class="p">]</span><span class="o">/</span><span class="n">ArcGIS</span><span class="o">/</span><span class="n">services</span><span class="o">/</span><span class="p">[</span><span class="n">folder_name</span><span class="p">]</span><span class="o">/</span><span class="p">[</span><span class="nb">map</span> <span class="n">service</span> <span class="n">title</span><span class="p">]</span><span class="o">/</span><span class="n">MapServer</span><span class="o">/</span><span class="n">WCSServer</span>
</pre></div>
</div>
</div>
<div class="section" id="edit-the-getcapabilities-document">
<h4>Edit the GetCapabilities document<a class="headerlink" href="#edit-the-getcapabilities-document" title="Permalink to this headline">¶</a></h4>
<p>ArcGIS server doesn’t create any static GetCapabilities xml documents, but does allow you to use external files. You will need to use such external files if you want to add any supported CRS, add keywords and abstracts for coverages or modify coverage titles. Note that, independently of the supported CRSs added, ESRI WCSs will always support the over 6000 projections that come with the ArcGIS projection engine.</p>
<p>The quickest way to create your custom GetCapabilities document is to use the response documents from your initial service. You will need to have a file for all the WCS versions that you want your service to support.</p>
<p>Your WCS version 1.1.0 GetCapabilities document is generated using a request like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://[hostname]/argis/services/[folder name]/[map service title]/MapServer/WCSServer?service=WCS&amp;request=GetCapabilities&amp;version=1.1.0&amp;
</pre></div>
</div>
<p><strong>Save this as [short service name]110.xml</strong></p>
<p>Your WCS version 2.0.1 GetCapabilities document is generated using a request like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://[hostname]/argis/services/[folder name]/[map service title]/MapServer/WCSServer?service=WCS&amp;request=GetCapabilities&amp;version=2.0.1&amp;
</pre></div>
</div>
<p><strong>Save this as [short service name]201.xml</strong></p>
<p>It doesn’t really matter what name you give these files, as long as you use the same name prefix for all files that belong to the same service.</p>
<p>You need to put these files on the server (or at a location available to your server), and make them browsable. These files only need to be browsable internally by the ArcGIS server.</p>
<p>Now go back to your map service and edit it using either <a class="reference external" href="http://server.arcgis.com/en/server/latest/publish-services/windows/editing-service-properties-in-manager.htm">ArcGIS Server Manager</a> or <a class="reference external" href="http://server.arcgis.com/en/server/latest/publish-services/windows/editing-service-properties-in-arcgis-for-desktop.htm">ArcMap</a>.</p>
<p>Go to <em>Capabilities &gt; WCS</em>, then select the “Use External capabilities files” option and in the ‘Specify the location and prefix’ dialog add the web address to the folder containing the capabilities response documents plus your [short service name] prefix.</p>
<div class="figure align-default" id="id144">
<img alt="WCS service properties: external capabilities" src="_images/image070.jpg" />
<p class="caption"><span class="caption-text">Figure 24 - WCS service properties: external capabilities</span><a class="headerlink" href="#id144" title="Permalink to this image">¶</a></p>
</div>
<p>For example, for a service called BGS_EMODnet_Bathymetry, we may save our initial GetCapabilities response documents using a prefix “EMODnet-“, giving us a file called EMODnet-201.xml for our version 2.0.1 GetCapabilities response document, EMODnet-110.xml for our version 1.1.0 GetCapabilities response document and so on. We might then save these to a location on our web server such as <em>C:\Inetpub\wwwroot\GetCapabilitiesFiles\</em> which would be browseable locally as <em>http://localhost/GetCapabilitiesFiles/</em>.  When we select the “Use External capabilities files” option, we then provide the web address and <strong>prefix</strong>
as <em>http://localhost/GetCapabilitiesFiles/EMODnet-</em></p>
<p>Having created your files, you may then edit them as required. We would recommend you make a second copy of the files in case you make an error whilst editing.</p>
<p>We have found that, if you make a GetCapabilities request using external capabilities files, it always defaults to version 1.1.0, even if you specify a different version as a url parameter. For instance, <em>http://[my_server]s:6080/arcgis/services/[folder_name]/BGS_EMODnet_bathymetry/MapServer/WCSServer?request=GetCapabilities&amp;service=WCS&amp;version=2.0.1</em> will return the GetCapabilities document for version 1.1.0 (if available, otherwise you will get an error), even though we’ve created the version 2.0.1 of the document. The only exception is version 1.0.0, which does return the correct version of the GetCapabilities document if specified in the url.</p>
<p>For more information, see <a class="reference external" href="http://server.arcgis.com/en/server/latest/publish-services/windows/using-external-capabilities-files-with-wcs-services.htm">Use external capabilities files with WCS Services</a>.</p>
</div>
</div>
</div>
<div class="section" id="using-apache-http-server-as-a-reverse-proxy">
<h2>Using Apache HTTP server as a reverse proxy<a class="headerlink" href="#using-apache-http-server-as-a-reverse-proxy" title="Permalink to this headline">¶</a></h2>
<p>To serve a OneGeology WMS through the OneGeology Portal that service must be served using port 80; the default port for any http web service. If you are already serving another web service on port 80 on the same server (such as a GeoNetwork spatial data metadata catalogue for example), then you will need to use a different port number for the existing service. In itself this shouldn’t be too difficult to do, however this might cause problems for your customers due to restrictive firewall rules that prevent them consuming any web service not served on the standard web port number. One way around this is to merge the services together; another possibility (as detailed below) is to use the Apache HTTP web server as a reverse proxy, that is, to handle all requests to the second service as if that service was coming from the MS4W Apache service. The user is thus unaware that there is more than one web service. Each service proxied in this way runs on a separate port number, and may still be accessed directly on that port (depending on your configuration), but it is also available as if it were running on port 80.</p>
<p>(<a class="reference external" href="http://httpd.apache.org/docs/2.2/urlmapping.html">Comprehensive information on configuring Apache</a>)</p>
<p>The first step is to change the <a class="reference external" href="http://www.iana.org/assignments/port-numbers">port numbers</a> on which your other web servers work; in this example we have two other web services (a Tomcat based web service which we will run on port 8080, and a jetty based web service which we will run on port 8008). Note that both these ports are recognized alternate ports for http traffic but they may not be open to such traffic in your corporate firewall.</p>
<p>Now we need to edit the Apache HTTP server httpd.conf file. If you have installed the MS4W Apache HTTP server as part of the ms4w-and-exemplar-data.zip download this would be located at: c:\ms4w\Apache\conf\httpd.conf.</p>
<p>Check that the following modules are uncommented (by removing the # sign from the line start).</p>
<p>Change</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="c">#LoadModule proxy_module modules/mod_proxy.so</span>
<span class="c">#LoadModule proxy_ajp_module modules/mod_proxy_ajp.so</span>
<span class="c">#LoadModule proxy_http_module modules/mod_proxy_http.so</span>
</pre></div>
</div>
<p>To:</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nb">LoadModule</span> proxy_module modules/mod_proxy.so
<span class="nb">LoadModule</span> proxy_ajp_module modules/mod_proxy_ajp.so
<span class="nb">LoadModule</span> proxy_http_module modules/mod_proxy_http.so
</pre></div>
</div>
<p>Note, we have used mod_proxy here as it is included with the Apache HTTP Server binaries, but you could use other proxy modules such as mod_jk if desired.</p>
<p>Now you need to add or uncomment the following directives (as appropriate for your configuration file); we suggest adding these directives at the end of the file for clarity.</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nb">TraceEnable</span> <span class="k">off</span>
<span class="c">#Important for security!!</span>

<span class="nb">ProxyRequests</span> <span class="k">Off</span>
<span class="c">#This sets up the reverse proxy, if ’ ProxyRequests On’ is set you have a forward proxy.</span>

<span class="nb">ProxyPreserveHost</span> <span class="k">On</span>
</pre></div>
</div>
<p>Now for each service (or set of pages within a service) that you wish to proxy you need to add the following set of directives:</p>
<p>A &lt;Proxy&gt; or a &lt;ProxyMatch&gt; block to restrict access to your resources, a ProxyPass directive (to map that web service into the local server URL space), and a ProxyPassReverse directive (which lets Apache adjust the URL in the Location, Content-Location and URI headers on HTTP redirect responses).</p>
<p>Examples:</p>
<p>Adding a reverse proxy to the BRGM OneGeology Europe connector for WP6 WMS. This connector runs on the Tomcat server running on port 8080, but will appear to be running as part of the Apache http service running on port 80.</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Proxy</span> <span class="s">/1GEconnector</span><span class="nt">&gt;</span>
    <span class="nb">Order</span> deny,allow
    <span class="nb">Allow</span> from <span class="k">all</span>
<span class="nt">&lt;/Proxy&gt;</span>

<span class="nb">ProxyPass</span> <span class="sx">/1GEconnector</span> http://localhost:8080/1GEconnector
<span class="nb">ProxyPassReverse</span> <span class="sx">/1GEconnector</span> http://localhost:8080/1GEconnector
</pre></div>
</div>
<p>Adding a reverse proxy to our Jetty web service which is running a GeoNetwork catalogue. The Jetty service is running on port 8008 but will appear to be running as part of the Apache http service running on port 80. You would normally be able to use ’ localhost’ or ’ 127.0.0.1’ to specify a web service running on the same physical server as your Apache web server, but in this instance Jetty has been configured to only accept requests from the server IP (194.66.252.156).</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Proxy</span> <span class="s">/geonetwork</span><span class="nt">&gt;</span>
    <span class="nb">Order</span> deny,allow
    <span class="nb">Allow</span> from <span class="k">all</span>
<span class="nt">&lt;/Proxy&gt;</span>

<span class="nb">ProxyPass</span> <span class="sx">/geonetwork</span> http://194.66.252.156:8008/geonetwork
<span class="nb">ProxyPassReverse</span> <span class="sx">/geonetwork</span> http://194.66.252.156:8008/geonetwork
</pre></div>
</div>
<p>Adding a reverse proxy to our Jetty web service which is running an Intermap mapping client (used by the GeoNetwork catalogue). The Jetty service is running on port 8008 but will appear to be running as part of the Apache http service running on port 80.</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Proxy</span> <span class="s">/intermap</span><span class="nt">&gt;</span>
    <span class="nb">Order</span> deny,allow
    <span class="nb">Allow</span> from <span class="k">all</span>
<span class="nt">&lt;/Proxy&gt;</span>

<span class="nb">ProxyPass</span> <span class="sx">/intermap</span> http://194.66.252.156:8008/intermap
<span class="nb">ProxyPassReverse</span> <span class="sx">/intermap</span> http://194.66.252.156:8008/intermap
</pre></div>
</div>
<p>Adding a reverse proxy to our cocoon service, which we need to run our old WFS. The cocoon service runs on the Tomcat server running on port 8080, but will appear to be running as part of the Apache http service running on port 80. In this example we are using a ProxyMatch block, which allows us to use a regular expression to map the allowable paths to cocoon.</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ProxyMatch</span> <span class="s">http://[^/]*/cocoon/*</span><span class="nt">&gt;</span>
    <span class="nb">Order</span> deny,allow
    <span class="nb">Allow</span> from <span class="m">127.0.0.1</span>
<span class="nt">&lt;/ProxyMatch&gt;</span>

<span class="nb">ProxyPass</span> <span class="sx">/cocoon</span> http://127.0.0.1:8080/cocoon/
<span class="nb">ProxyPassReverse</span> <span class="sx">/cocoon</span> http://127.0.0.1:8080/cocoon/
</pre></div>
</div>
<p>That’s it as far as the Apache HTTP server is concerned, but you may also wish to configure your other web servers so that they always proxy their HTTP content through Apache.</p>
<p>To do this in Tomcat, you need to modify a Connector block in the server.xml configuration file as below:</p>
<p>Change:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Connector</span>
    <span class="na">port=</span><span class="s">&quot;8080&quot;</span>
    <span class="na">protocol=</span><span class="s">&quot;HTTP/1.1&quot;</span>
    <span class="na">connectionTimeout=</span><span class="s">&quot;20000&quot;</span>
    <span class="na">redirectPort=</span><span class="s">&quot;8443&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>To:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Connector</span>
    <span class="na">port=</span><span class="s">&quot;8080&quot;</span>
    <span class="na">protocol=</span><span class="s">&quot;HTTP/1.1&quot;</span>
    <span class="na">connectionTimeout=</span><span class="s">&quot;20000&quot;</span>
    <span class="na">redirectPort=</span><span class="s">&quot;8443&quot;</span>
    <span class="na">proxyName=</span><span class="s">&quot;yourserver.org&quot;</span>
    <span class="na">proxyPort=</span><span class="s">&quot;80&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>ProxyName: is the domain name or IP of the standard (Apache HTTP Server) web service and can be omitted if you are running your Tomcat service on the same server as the http service.</p>
<p>To do this in Jetty you need to make a similar change in the jetty.xml file</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="portal.html" class="btn btn-neutral float-right" title="Using the OneGeology Portal" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to OneGeology documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, OneGeology.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>